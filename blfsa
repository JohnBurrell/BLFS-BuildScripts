#!/bin/bash
#
LFS=$LFS
if [[ ! -d $LFS || "$LFS" = "" ]]; then
  echo "'$LFS' is not a directory"
  echo "do: export LFS=/mnt/lfs"
  echo
  exit 1
fi

# repository will be for BLFS
REPO="BLFS"
blfscommands="/blfs-commands"
DumpedCommands=${LFS}${blfscommands}
Dumpedhtml=$LFS/blfs-html
WgetList="wget-list" # default name for the source list file
hostwgetopts="" # Options for wget, e.g. proxy settings, certs etc on the host
wgetopts="" # Options for wget, e.g. proxy settings, certs etc on the LFS machine
sortedfile="sortedfile" # name of the sorted WgetList file
anduin_src_root="http://anduin.linuxfromscratch.org/sources/BLFS/svn"
patch_root="http://www.linuxfromscratch.org/patches/blfs/svn" # patch url
RETURN_PARAM=35  # error return
RETURN_NOTSET=37 #  no dependencies set
RETURN_DEPNOTMET=39 # package dependency not met
RETURN_ALLDEPSMET=41 # all dependencies met
srcrootdir=/blfs-sources # all source files are under this dir
blfsBuildFiles=/blfsBuildFiles # location of the pkgs, pkg-order and pkg-dependencies files
blfsfiles=blfsfiles # name of the subdir to the build files dir
blfsfilesTar=${blfsfiles}.tar.xz # tar file with files names and dependencies for each section
PKGUSERDIR=/usr/src # pkguser dir will be $PKGUSERDIR/$Section
BuildLog=${LFS}/BLFS-buildlog.log # keep a record of packages and times
if [ ! -e $BuildLog ]; then
  touch $BuildLog
fi
BLFSBUILDFILES=${LFS}${blfsBuildFiles}/${blfsfiles} # location of the blfs build files
SOURCEDIR=${LFS}${srcrootdir}
build="build" # name of the build file for each package
cfg=~/BLFS.conf # config file to hold required params

#initialize the config variables
BLFS_BOOK_LOC_DIR=$HOME/LFS_SVN/$REPO # define local dir for the downloaded book xml
SVN_URL="svn://svn.linuxfromscratch.org/$REPO/" # svn url
BOOK_VERSION=$BOOK_VERSION
SOURCES=$SOURCES
BOOK=$BOOK
SECTION=$SECTION
XORG_PREFIX=$XORG_PREFIX
XVERSION=$XVERSION
GNOME_OR_XFCE=$GNOME_OR_XFCE
BROWSER=$BROWSER
SINGLE_PACKAGE=$SINGLE_PACKAGE
AS_ROOT=$AS_ROOT # 'no' install as package user, 'yes' install as root
SYSTEMD=$SYSTEMD # 'yes' - use systemd. 'no' use sysvinit.
if [ -e $cfg ]; then
  source $cfg # exists so source it
else
  touch $cfg #cfg is new
  if [ -z $BOOK_VERSION ]; then
    BOOK_VERSION="BOOK"
  fi
  if [ -z $SOURCES ]; then
    SOURCES="download"
  fi
  if [ -z $BOOK ]; then
    BOOK="svn"
  fi
  if [ -z $SECTION ]; then
    SECTION="libraries"
  fi
  if [ -z $XORG_PREFIX ]; then
    XORG_PREFIX="/usr"
  fi
  if [ -z $XVERSION ]; then
    XVERSION="7.7-1"
  fi
  if [ -z $GNOME_OR_XFCE ]; then
    GNOME_OR_XFCE="gnome"
  fi
  if [ -z $BROWSER ]; then
    BROWSER="firefox"
  fi
  if [ -z $SINGLE_PACKAGE ]; then
    SINGLE_PACKAGE="no"
  fi
  if [ -z $AS_ROOT ]; then
    AS_ROOT="no"
  fi
  if [ -z $SYSTEMD ]; then
    SYSTEMD="no"
  fi
# store the values in the new config file
  echo "BLFS_BOOK_LOC_DIR=$HOME/LFS_SVN/$REPO" | tee $cfg
  echo "SVN_URL=svn://svn.linuxfromscratch.org/$REPO/" | tee -a $cfg
  echo "BOOK_VERSION=$BOOK_VERSION" | tee -a $cfg
  echo "SOURCES=$SOURCES" | tee -a $cfg
  echo "BOOK=$BOOK" | tee -a $cfg
  echo "SECTION=$SECTION" | tee -a $cfg
  echo "XORG_PREFIX=$XORG_PREFIX" | tee -a $cfg
  echo "XVERSION=$XVERSION" | tee -a $cfg
  echo "GNOME_OR_XFCE=$GNOME_OR_XFCE" | tee -a $cfg
  echo "BROWSER=$BROWSER" | tee -a $cfg
  echo "SINGLE_PACKAGE=$SINGLE_PACKAGE" | tee -a $cfg
  echo "AS_ROOT=$AS_ROOT" | tee -a $cfg
  echo "SYSTEMD=$SYSTEMD" | tee -a $cfg
fi
#
# set up names of x subdirs
xproto="x7proto"
xlib="x7lib"
xapp="x7app"
xfont="x7font"
#
# functions
#
_log() {                      # turn on debugging commands with _DEBUG=true
  if [ "$_DEBUG" == "true" ]; then
    echo 1>&2 "$@"
  fi
} # end _log
#
configEdit () {
tempfile1=dialog_1
tempfile2=dialog_2
tempfile3=dialog_3
DIALOG=dialog # could set to gui dialog - xdialog, if availale
#test -n "$DISPLAY" && DIALOG=xdialog
# delete temp files on exit
trap "rm -f $tempfile1 $tempfile2 $tempfile3" 0 1 2 5 15

_edit () {
   items=$(awk -F\= '{print $1,$2}' $cfg)
   $DIALOG --title "" \
          --menu "BLFS config file editor:" 0 0 0 $items 2> $tempfile1

   retval=$?
   parameter=$(cat $tempfile1)

   [ $retval -eq 0 ] && tochange=$parameter || return 1
   if [ "$tochange" = BLFS_BOOK_LOC_DIR ]; then
     display="Enter the local directory to store the BLFS Book"
   elif [ "$tochange" = SVN_URL ]; then
     display="Enter the svn url of the BLFS book"
   elif [ "$tochange" = BOOK_VERSION ]; then
     display="BLFS book version. For the current book, type BOOK (type blank to get a list). You should probably use the current version"
   elif [ "$tochange" = BOOK ]; then
     display="Enter svn or local (if local the book must be under $BLFS_BOOK_LOC_DIR)"
   elif [ "$tochange" = SOURCES ]; then
     display="Type download or local (if local, source files must be in ${LFS}${srcrootdir}/${SECTION})"
   elif [ "$tochange" = SECTION ]; then
     display="options are blfs, security, libraries, genutils, sysutils, programming, networks, server, x, xlibs, gnomeplatform, gnomedesktop, gnomeutils, xfce, browser, office, xsoftware, multimedia, pst, avr or ALL"
   elif [ "$tochange" = XORG_PREFIX ]; then
     display="Choose the installation prefix for Xorg"
   elif [ "$tochange" = XVERSION ]; then
     display="Enter the current X version in the BLFS book"
   elif [ "$tochange" = GNOME_OR_XFCE ]; then
     display="type gnome or xfce - you can install one or the other, not both"
   elif [ "$tochange" = BROWSER ]; then
     if [ "$SECTION" = browser ]; then
       display="Type firefox or seamonkey"
     else
       display="Type firefox or seamonkey. Set SECTION to browser to install it."
     fi
   elif [ "$tochange" = SINGLE_PACKAGE ]; then
     if [[ "$SECTION" = ALL || "$SECTION" = all ]]; then
     display="Name of the package to install. There is no section ALL, so change it to the correct section for the package you have specified."
     else
     display="Name of the package to install. It must be in $SECTION. If specified, this will take precedence. Type no to switch off this option"
     fi
   elif [ $tochange = "AS_ROOT" ]; then
     display="If yes, install packages as root. If no, install as package user"
   elif [ $tochange = "SYSTEMD" ]; then
     display="Set to yes if LFS was installed using systemd. Otherwise set to no."
   fi
   val=$(awk -F\= -v x=$tochange '$1==x {print $2}' $cfg)
   $DIALOG --clear --title "Change value" \
          --inputbox "$display" 0 0 $val 2> $tempfile2

   $DIALOG --title "Confirmation"  --yesno "Commit ?" 0 0
   case $? in
       0) newval=$(cat $tempfile2)
          awk -v x=$tochange -v n=$newval '
               BEGIN {FS=OFS="="}$1==x {$2=n} {print}
               ' $cfg > $cfg.tmp
          mv $cfg.tmp $cfg
          . $cfg
       ;;
       1|255) $DIALOG --infobox "Value not changed" 0 0
              sleep 1
   ;;
   esac
   $DIALOG --textbox $cfg 0 0
}

_main () {
   $DIALOG --title "BLFS config file editor" \
           --menu "Please choose an option:" 15 55 5 \
                   1 "View the config file" \
                   2 "Edit config file" \
                   3 "Exit from this menu" 2> $tempfile3

   retv=$?
   choice=$(cat $tempfile3)
   if [ $retv -eq 1 -o $retv -eq 255 ]; then
     echo "cancel pressed - exiting now"
     exit 1
   fi
   case $choice in
       1) $DIALOG --textbox $cfg 0 0
          _main
           ;;
       2) _edit
          _main 
           ;;
       3) return 
           ;;
   esac
}
_main
rm -rf $tempfile1 $tempfile2 $tempfile3 # make sure temp files are removed
} #end configEdit
#
GetAllSections () {
local allsec=""
secfile=${BLFSBUILDFILES}/allSections
if [ ! -e $secfile ]; then
  return $RETURN_PARAM
else
IFS='
'
allsec=( $( < $secfile ) )
rtrnSec=(${allsec[@]})
return 0
fi
} # end GetAllSections
#
SetupSections () {
numSections=1
if [ "$SECTION" = all ]; then
  rtrnSec=""
  GetAllSections
  return_val=$?
  if [ $return_val -eq $RETURN_PARAM ]; then
    echo "Error reading in allSections file."
    echo "Make sure file allSections is in $BLFSBUILDFILES"
    echo "Exiting now"
    exit 1
  else
    SectionsALL=(${rtrnSec[@]})
    numSections=${#SectionsALL[@]}
  fi
else
  SectionsALL[0]=$SECTION
fi
} # end SetupSections
#
GetLocalREPO () {
bookdir=$1
#
# create a list of local BLFS books - only works relative to $bookdir
unset Paths
for Path in $( find $bookdir -name index.xml -exec dirname {} ';' )
do
  if [ -e $Path/.svn ]; then
    Paths="$Paths $Path"
  fi
done
PathCount=$( echo $Paths | awk '{print NF}' )
case $PathCount in
   0) echo >&2 "Couldn't find any local BLFS book in $bookdir"
      echo >&2 "Suggest you svn one or specify a different location"
      return $RETURN_PARAM
   ;;
   1) Path=$Paths
      svn info $Path >&2
      PS3="Is this correct? : "
      select confirm in Yes No
      do
        case $confirm in
          '') echo >&2 "Please enter 1 for Yes or 2 for No"
          ;;
          ?*) break
          ;;
        esac
      done
      case $confirm in
         No) echo >&2 "This is the only BLFS book in $bookdir"
             return $RETURN_PARAM
         ;;
        Yes) 
            BOOK_VERSION=$(echo $Path | awk 'BEGIN {FS="/"}{print $5}')
            tochange="BOOK_VERSION"
            awk -v x=$tochange -v n=$BOOK_VERSION '
               BEGIN {FS=OFS="="}$1==x {$2=n} {print}
               ' $cfg > $cfg.tmp
            mv $cfg.tmp $cfg
            return 0
         ;;
      esac
   ;;
   *)
      PS3="which is your $REPO svn repo? : "
      select Path in $( echo $Paths | sed 's@'$HOME'@~@g')
      do
        Path=$( echo $Path | sed 's@~@'$HOME'@' )
        case $Path in
         '') echo >&2 "Please select using number"
         ;;
         ?*) echo >&2 "You have selected svn repo"
             svn info $Path >&2
             PS3="Is this correct? : "
             select confirm in Yes No
             do
               case $confirm in
                '') echo >&2 "Please enter 1 for Yes or 2 for No"
                ;;
                ?*) break
                ;;
               esac
             done
             case $confirm in
               No) 
                   return $RETURN_PARAM
               ;;
               Yes)
                   BOOK_VERSION=$(echo $Path | awk 'BEGIN {FS="/"}{print $5}')
                   tochange="BOOK_VERSION"
                   awk -v x=$tochange -v n=$BOOK_VERSION '
                   BEGIN {FS=OFS="="}$1==x {$2=n} {print}
                   ' $cfg > $cfg.tmp
                   mv $cfg.tmp $cfg
                   return 0
               ;;
             esac
         ;;
        esac
      done
   ;;
esac
} # end GetLocalREPO
#
ChkLocalBook () {
localbookdir=$1
ChkLocalBookExists $localbookdir
    return_val=$?
    if [ $return_val -eq $RETURN_PARAM ]; then # requested book not present
      echo "Requested book not present locally. Will svn it"
    else # book present, test if need to svn an update
      ChkLocalBookDetails $localbookdir
      return_val=$?
      if [ $return_val -eq $RETURN_PARAM ]; then
        exit 1
      fi
    fi
} # end ChkLocalBook
#
ChkLocalBookExists () {
local bookdir=$1
#
unset BookPath
if [ -d $bookdir ]; then
for BookPath in $( find $bookdir -name index.xml -exec dirname {} ';' )
do
  if [ -e $BookPath/.svn ]; then #a book exists, check the version
    if [ "$BOOK_VERSION" = Current_Development -o "$BOOK_VERSION" = BOOK ]; then
      version="BOOK"
    else
      version=$BOOK_VERSION
    fi
    if [ $BookPath = $bookdir ]; then
      return 0 #requested version is present locally
    fi
  fi
done
else
  echo "Dir $bookdir not present locally."
fi
return $RETURN_PARAM #requested book not present locally
} #end ChkLocalBookExists
#
ChkLocalBookDetails () {
local bookdir=$1
#
if [[ "$BOOK_VERSION" = Current_Development || "$BOOK_VERSION" = BOOK || "$BOOK_VERSION" = systemd ]]; then
  # check the last svn date
  returned_array=( $(LastAccessSvn "$argument") )
  retval=$?
  if [ $retval -eq 0 ]; then # compare last svn date with today's date
    if [ ${returned_array[0]} -eq ${returned_array[1]} ]; then
      echo "same book already downloaded today"
      echo "To use it, set BOOK=local in the config file."
      echo "To download it again, delete $bookdir"
      return $RETURN_PARAM
    else
      return 0
    fi
  else
    echo "Could not retrieve date of last svn - no entries file found."
    echo "Will svn the requested book"
    return 0
  fi
else # book is a release version so don't update it
  echo "Requested book is present locally and is a release version"
  echo "so update not necessary"
  return $RETURN_PARAM
fi
} # end ChkLocalBookDetails
#
CleanLocalREPO () { # del any files in the local directory
local bookdir=$1
if [ -d $bookdir ]; then #local dir exists
  if [ "$(ls -A $bookdir)" ]; then
    rm -rf ${bookdir}/${version} # delete contents of local book dir
  fi
else  # create it
  mkdir -pv $bookdir
fi
} # end CleanLocalREPO
#
GetSvnUrl () {
if [ $SVN_URL = "blank" ]; then
  SVN_URL="svn://svn.linuxfromscratch.org/${REPO}/"
fi
} # end GetSvnUrl
#
WhichBLFSBook () {
Ignore="bootscripts"
PS3="Please select the book version : "
select TAG in 'Current Development' $( svn ls ${SVN_URL}tags | grep -vE "$Ignore" )
do
  case $TAG in
    '') echo >&2 "Please select a numbered option";;
    Current*)
      type=trunk
      version=BOOK
      BOOK_VERSION="Current_Development"
    ;;
    ?*)
      if [ "$BOOK_VERSION" = systemd ]; then
        type="branches"
        version="systemd"
      else
        type="tags"
        version=$TAG
        BOOK_VERSION=$TAG
      fi
    ;;
  esac
  BOOK_SVN_URL="${SVN_URL}$type/$version"
  echo >&2 "You have selected '$TAG'"
  echo >&2 "$BOOK_SVN_URL"
  PS3="Is this correct? : "
  select confirm in Yes No
  do
    case $confirm in
      '') echo >&2 "Please enter 1 for Yes or 2 for No";;
      ?*) break
    esac
  done
  case $confirm in
    No) PS3="Please select the book version : "
    ;;
# update the config file with the book version
    Yes) awk -v x=BOOK_VERSION -v n=$BOOK_VERSION '
             BEGIN {FS=OFS="="}$1==x {$2=n} {print}
             ' $cfg > $cfg.tmp
             mv $cfg.tmp $cfg
         break
    ;;
  esac
done
} #end WhichBLFSBook
#
SetBLFSBook () {
case $BOOK_VERSION in
   Current_Development)
         type="trunk"
         version="BOOK"
   ;;
   BOOK)
         type="trunk"
         version="BOOK"
   ;;
   systemd)
         type="branches"
         version="systemd"
   ;;
   *)
         type="tags"
         version=$BOOK_VERSION
   ;;
esac
} #end SetBLFSBook
#
LastAccessSvn () {
local passed_array   # Local variable
local bookdir=$BLFS_BOOK_LOC_DIR
if [ "$BOOK_VERSION" = systemd ]; then bookdir=${bookdir}/SYSTEMD; fi
BookLoc=${bookdir}/${version}
if [ -e ${BookLoc}/.svn/entries ]; then #check time of last svn
  EntriesDate=$( stat --printf=%y ${BookLoc}/.svn/entries | awk 'gsub(/-/,"") {printf $1}' )
  date=$(date +'%Y-%m-%d %H:%M:%S') # today's date
  read Y M D h m s <<< ${date//[-: ]/ }
  today=$Y$M$D
  passed_array=( $EntriesDate $today ) # return the last svn date and today
  echo "${passed_array[@]}"
  return 0
else
  return $RETURN_PARAM # no entries file found
fi
} # end LastAccessSvn
CheckoutSVN () {
local bookdir=$1
#
Url="${SVN_URL}${type}/${version}"
#
echo "Will svn the LFS book at $Url"
echo "and place it in $bookdir"
svn co $Url $bookdir # get the requested book
#
} # end CheckoutSVN
#
LocalBook () {
if [ "$BOOK_VERSION" = Current_Development -o "$BOOK_VERSION" = BOOK ]; then
    type="trunk"
    version="BOOK"
elif [ "$BOOK_VERSION" = systemd ]; then
    type="branches"
    version="systemd"
else
  type="tags"
  version=$BOOK_VERSION
fi
} # end LocalBook
#
CleanSourceDir () {
DirToClean=${SOURCEDIR}/${1}
wgetFile=${DirToClean}/${WgetList}
sortedFile=${DirToClean}/${sortedfile}
if [ -d $DirToClean ]; then
  if [ "$(ls -A $DirToClean)" ]; then # dir has files in it
    for File in ${DirToClean}/*
    do
      fndfile=$( echo $File | awk -F\/ '{print $NF}' )
      if [ -e $wgetFile ]; then
        if [ "$( grep -q $fndfile $wgetFile ; echo $? )" = "0" ]; then
          rm -rf ${DirToClean}/${fndfile} # delete the file if in wget-list
        fi
      fi
    done
    if [ -e $wgetFile ]; then rm $wgetFile; fi
    if [ -e $sortedFile ]; then rm $sortedFile; fi
  else
     echo "directory $DirToClean is empty"
  fi
else
  install -v -d $DirToClean
fi
} #end CleanSourceDir
#
ChkSrcPresent () {
# $1 is the directory to check and $2 is the wget-list of files
fileMissing=false
dirtochk=$1
wgetFile=$2
if [ -z $wgetFile ]; then
  echo "No wget file present in ${SOURCEDIR}/${Section}"
  echo "sources are not available"
  return 0
fi
while read FileUrl; do
  if [[ ${FileUrl:0:1} != '#' ]]; then # ignore file if it has a hash at the start
    filetofind=$( echo $FileUrl | awk -F\/ '{print $NF}' )
    if [ ! -e ${dirtochk}/${filetofind} ]; then
      echo "file $filetofind not downloaded"
      fileMissing=true
    fi
  fi
done < $wgetFile
if $fileMissing; then
  return $RETURN_PARAM
else
  return 0
fi
} # end ChkSrcPresent
#
createMd5File () {
  commandname=$1
  xmlsec="x"
  rtrnCom=""
  filetoget=${1}fnames
  getComms $filetoget
  fileComm=(${rtrnCom[@]})
  tempfile=$(date +%d%B%Y_%H:%M)tmp.file
  printf "%s\n" "${fileComm[@]}" > ${SrcPath}/${1}/${tempfile} #write to a tmp file
  currentdir=$( echo $PWD )
  cd ${SrcPath}/${1}
  source $tempfile
  rm $tempfile
  cd $currentdir
  return 0
} # createMd5File
#
  GetXtraFiles () {
  commandname=$1
  xmlsec="x"
  rtrnCom=""
  filetoget=${1}wget
  getComms $filetoget
  fileComm=(${rtrnCom[@]})
  tempfile=$(date +%d%B%Y_%H:%M)tmp.file
  printf "%s\n" "${fileComm[@]}" | sed -e 's/\(.*\)&&$/\1/' > ${SrcPath}/${1}/${tempfile}
  currentdir=$( echo $PWD )
  cd ${SrcPath}/${1}
  source $tempfile # download the files
  cd ..
  rm $tempfile
  cd $currentdir
  return 0
} # end GetXtraFiles
#
GetSources () {
# $1 is the section name, $2 is array of pkg names and $3 is array of src names
local fname
local extName
declare -a pkgname=("${!2}")
declare -a srcname=("${!3}")
local section_name=$1
#
# can use your own wget-list file for a particular section
# Here I'm downloading latest versions of gnome and the X libraries
# The wget list files are in the blfsfiles.tar.xz tar file
#
if [ "$section_name" = gnomeplatform ]; then
  pkgfile=${BLFSBUILDFILES}/gnomeplatform-wget-list
elif [ "$section_name" = gnomedesktop ]; then
  pkgfile=${BLFSBUILDFILES}/gnomedesktop-wget-list
elif [ "$section_name" = gnomeutils ]; then
  pkgfile=${BLFSBUILDFILES}/gnomeutils-wget-list
elif [ "$section_name" = xlibs ]; then
  pkgfile=${BLFSBUILDFILES}/xlibs-wget-list
else
  pkgfile=${SOURCEDIR}/${WgetList}
fi
if [ ! -e "$pkgfile" ]; then
  echo "\""$pkgfile"\" does not exist. Please download wget-list"
  exit 1
else
  echo "will use $pkgfile to download the source files"
fi
#
SrcPath=${SOURCEDIR}/${section_name}
if [ ! -d $SrcPath ]; then
  mkdir -v $SrcPath
fi
for (( ik=0; ik<${#srcname[@]}; ik++ ))
do
  if $single_package; then # find the package
    if [[ "$SINGLE_PACKAGE" == "${pkgname[ik]}" ]]; then # found the package
      tomatch="/${srcname[ik]}"
      grep $tomatch $pkgfile >> ${SrcPath}/${WgetList}
      break
    fi
  else
    tomatch="/${srcname[ik]}"
    grep $tomatch $pkgfile >> ${SrcPath}/${WgetList} # list of files in this section
  fi
done
# make sure there are no duplicate lines
sort -u ${SrcPath}/${WgetList} > ${SrcPath}/${sortedfile}
if [[ "$BROWSER" == firefox ]]; then
  sed -i '/seamonkey-/d' ${SrcPath}/${sortedfile}
elif [[ "$BROWSER" == seamonkey ]]; then
  sed -i '/firefox-/d' ${SrcPath}/${sortedfile}
fi
#
# download the sources
#
while read url_line
do
  fname=$(echo $url_line |  awk -F\/ '{print $NF}' )
  extName=$(echo $fname | awk -F\. '{print $NF}' )
  skipit=false # download this file by default
  case $Section in
      x)
         case $fname in # MesaLib is not part of Xorg
           MesaLib*)
             initial="m"
           ;;
           *)
             initial="Xorg"
           ;;
         esac
      ;;
      programming) # don't download the jdk sources - a binary is in blfsfiles
         case $fname in
           jdkbin*) # skip these
             skipit=true
           ;;
           Archive*|ExtUtils*|Glib*|URI*|XML*) # perl modules
             initial="perl-modules"
           ;;
           docutils|pyatspi*|py2cairo*|pygtk*|pygobject*|pyxdg*) # python modules
             initial="python-modules"
           ;;
           *)
             initial=${fname:0:1}
             initial=$(echo ${initial,,*}) # make sure first char is lower case
           ;;
         esac
      ;;
      xlibs) # if xulrunner, don't download firefox source
         case $fname in
           xulrunner)
             skipit=true
           ;;
           *)
             initial=${fname:0:1}
             initial=$(echo ${initial,,*}) # make sure first char is lower case
           ;;
         esac
      ;;
      *)
         initial=${fname:0:1}
         initial=$(echo ${initial,,*}) # make sure first char is lower case
      ;;
  esac
  if ! $skipit; then # get the source
    if [[ "$section_name" == gnomeplatform || "$section_name" == gnomedesktop || "$section_name" == gnomeutils || "$section_name" == xlibs ]]; then
      full_url=$url_line # use the url in the wget-list file
    else
      full_url=${anduin_src_root}/${initial}/${fname} # use anduin
    fi
    if [ "$extName" = patch ]; then full_url=${patch_root}/${fname}; fi
    hostwgetopts="-e use_proxy=yes -e http_proxy=$http_proxy -e ftp_proxy=$ftp_proxy"
    wget $hostwgetopts $full_url -P $SrcPath
  fi
done < ${SrcPath}/${sortedfile}
#
if [ "$Section" = x ]; then # get all the extra files
  srcUrl="http://xorg.freedesktop.org/releases/individual"
#set up the dirs under x
  if [ ! -e ${SrcPath}/${xproto} ]; then
    install -v -d ${SrcPath}/${xproto}
  fi
  if [ ! -e ${SrcPath}/${xlib} ]; then
    install -v -d ${SrcPath}/${xlib}
  fi
  if [ ! -e ${SrcPath}/${xapp} ]; then
    install -v -d ${SrcPath}/${xapp}
  fi
  if [ ! -e ${SrcPath}/${xfont} ]; then
    install -v -d ${SrcPath}/${xfont}
  fi
  createMd5File $xproto # create all the md5 files
  createMd5File $xlib
  createMd5File $xapp
  createMd5File $xfont
  GetXtraFiles $xproto # get the wget commands
  GetXtraFiles $xlib
  GetXtraFiles $xapp
  GetXtraFiles $xfont
fi
} #end GetSources
#
GetListFile () {
REPODIR=${1}/${version}
if [ -e ${SOURCEDIR}/${WgetList} ]; then
  rm ${SOURCEDIR}/${WgetList}
fi
make -j1 -f $REPODIR/Makefile -C $REPODIR BASEDIR=$SOURCEDIR $WgetList
WgetFile=${SOURCEDIR}/${WgetList}
#
} #end GetListFile
#
ChkEmptySrcFiles () {
if [ ! -d ${SOURCEDIR}/${1} ]; then
  mkdir -pv ${SOURCEDIR}/${1}
  return $RETURN_PARAM
fi
if [ "$(ls -A ${SOURCEDIR}/${1})" ]; then #  directory is not empty
  zeroLenFiles=$(ls -l $SOURCEDIR/${1}|awk '!/^d/&&$5==0 {print $NF}')
  len=${#zeroLenFiles}
  if [ $len -gt 0 ]; then
    echo -e "These files are empty:\n$zeroLenFiles"
    return $RETURN_PARAM
  else
    return 0 # no empty files found
  fi
else
  return $RETURN_PARAM # section directory is empty
fi
} # end ChkEmptySrcFiles
#
DumpCommands () {
local bookdir=$2
#
REPODIR=$bookdir
target=$( echo $1 | awk '{print tolower($1)}')
SVNINFO="$(svn info $REPODIR | awk '{printf $0"|"}')"
# Note, tagged | on the end so it can be used as a record separator later
# e.g.
# echo $SVNINFO | awk 'BEGIN{ RS = "|" }; {print $0}'
# will 'reconstitute it
SVNrevision=$( echo $SVNINFO | awk 'BEGIN{ RS = "|" };/Revision/ {print $0}' )
for dir in $DumpedCommands $Dumpedhtml
do
  if [ ! -d $dir ]; then
    install -vd $dir
    touch $dir/.revision #suppress error message for the cat  5 lines below
  fi
done
for dir in $Dumpedhtml $DumpedCommands
do
  if [ -e "$dir" -a "$SVNrevision" != "$( cat $dir/.revision | awk '/Revision/ {print $0}')" ]; then
    if [ -d $Dumpedhtml ]; then rm -rf $Dumpedhtml;fi
    if [ -d $DumpedCommands ]; then rm -rf $DumpedCommands;fi
    pushd $REPODIR
            make -j1 DUMPDIR=$DumpedCommands BASEDIR=$Dumpedhtml $target dump-commands
            for dir in $DumpedCommands $Dumpedhtml
            do
              echo $SVNINFO | awk 'BEGIN{ RS = "|" }; {print $0}' > $dir/.revision
            done
    popd
    break
  fi
done
} # end of DumpCommands
#
unpackBLFSfiles () {
# * NOTE * the tar file $blfsfilesTar and the directory $blfsBuildFiles
# must exist before calling this function
#
tar -xvf ${LFS}/${blfsfilesTar} -C ${LFS}${blfsBuildFiles} --no-same-owner
#untarred so delete it
rm ${LFS}/${blfsfilesTar}
# move the java jdk file to /blfs-sources/programming
if [ ! -d ${LFS}${srcrootdir}/programming ]; then
  mkdir -pv ${LFS}${srcrootdir}/programming
fi
if [ -e ${BLFSBUILDFILES}/jdk-*-linux-x64.tar.gz ]; then
    rm -rf ${LFS}${srcrootdir}/programming/jdk-*-linux-x64.tar.gz # delete any existing
    mv ${BLFSBUILDFILES}/jdk-*-linux-x64.tar.gz  ${LFS}${srcrootdir}/programming/
fi
} #end unpackBLFSfiles
#
combineScripts () {
declare -a commands=("${!1}")
declare -a buildWrap=("${!2}")
local combine=""
local numc=${#commands[@]}
local numb=${#buildWrap[@]}
countc=0 # counter for the combine array
countbl=0 # counter for build lines written
inc=false # switch for whether a configure, make and install section is present
cont=0 # number of continuation lines
ifDoc=false # true if an if block containing a doc
#
for (( i=0; i<$numb; i++ ))
do
  case "${buildWrap[i]}" in
    configure_commands*)
      combine[countc++]=${buildWrap[countbl++]}
      combine[countc++]=${buildWrap[countbl++]} # the {: line
      for (( jk=$countg; jk<$numc; jk++ )); do
        case ${commands[jk]} in
           make*) # assume either a make command or make install
              countg=$jk
              break
           ;;
           *install*) # test to see if part of a continuation squence
              case ${commands[jk]} in
                 *\\) # a continuation line
                    if [ $cont -gt 0 ]; then # part of configure sequence so store it
                      storit[cont++]="${commands[jk]}"
                    else # assume an install cont line
                      countg=$jk
                      break
                    fi
                 ;;
                 *)
                    countg=$jk
                    break
                 ;;
              esac
           ;;
           error_count*)
              countg=$jk
              break
           ;;
           *"waf build")
              countg=$jk
              break
           ;;
           './build.sh -Ddist.dir='*) # apache-ant build
              countg=$jk
              break
           ;;
           "ant dist"*) # junit build
              countg=$jk
              break
           ;;
           '_bindir="bin.linuxx86"'*) # boost
              countg=$jk
              break
           ;;
           *)
              case "${commands[jk]}" in
                 *\\)
                    storit[cont++]="${commands[jk]}"
                 ;;
                 *)
                    # write with any continuation lines
                    if [ $cont -gt 0 ]; then
                      for (( l=0; l<$cont; l++ )); do
                        combine[countc++]="  ${storit[l]}"
                      done
                      combine[countc++]="  ${commands[jk]}"
                      cont=0
                      inc=true
                    else
                      combine[countc++]="  ${commands[jk]}" # configure command
                      inc=true # found at least one configure command
                    fi
                    if [ $[jk+1] -eq $numc ]; then countg=$jk; fi
                 ;;
              esac
           ;;
        esac
      done
      if [ $cont -gt 0 ]; then
        for (( l=0; l<$cont; l++ )); do
          combine[countc++]="  ${storit[l]}"
        done
        combine[countc++]="  ${commands[countg++]}"
        inc=true
        cont=0
      fi
      if ! $inc; then
        combine[countc++]='  echo "no configure script for this package"'
      fi
    ;;
    make_commands*)
      inc=false
      combine[countc++]=${buildWrap[countbl++]}
      combine[countc++]=${buildWrap[countbl++]} # the {: command
      for (( jl=$countg; jl<$numc; jl++ )); do
        case ${commands[jl]} in
           *install*) # assume an install command
              case ${commands[jl]} in
                 *"/usr/bin/bjam"*) # this is boost so stay in make
                       combine[countc++]="  ${commands[jl]}"
                 ;;
                 *)
                       countg=$jl
                       break
                 ;;
              esac
           ;;
           docsdir*)
              countg=$jl
              break
           ;;
           "make update")
              countg=$jl
              break
           ;;
           "ln -v -sfn ant-"*) # apache-ant symlink
              countg=$jl
              break
           ;;
           *)
              case "${commands[jl]}" in
                 *\\)
                     storit[cont++]="${commands[jl]}"
                 ;;
                 *)
                     if [ $cont -gt 0 ]; then # write the continuation lines
                       for (( l=0; l<$cont; l++ )); do
                         combine[countc++]="  ${storit[l]}"
                       done
                       combine[countc++]="  ${commands[jl]}"
                       cont=0
                       inc=true
                     else
                       combine[countc++]="  ${commands[jl]}" # make commands
                       inc=true #at least one make command found
                     fi
                     if [ $[jl+1] -eq $numc ]; then # no more commands
                       countg=$jl
                       if [[ "${commands[$countg]}" != *make* ]]; then
                         ((countc--))
                       fi
                     fi
                 ;;
              esac
           ;;
        esac
      done
       if ! $inc; then
         combine[countc++]='  echo "no make script for this package"'
       fi
    ;;
    install_commands*)
      inc=false
      foundDoc=false
      combine[countc++]=${buildWrap[countbl++]}
      combine[countc++]=${buildWrap[countbl++]} # the {: command
      for (( jm=$countg; jm<$numc; jm++ )); do
        case ${commands[jm]} in
          *install*)
             case "${commands[jm]}" in
               *\\) # cont line so store it
                  case "${commands[jm]}" in
                    *'/usr/share/doc'*) # cont line contains a doc
                        foundDoc=true
                        storit[cont++]="${commands[jm]}"
                    ;;
                    *) # no doc in this cont line
                        storit[cont++]="${commands[jm]}"
                    ;;
                  esac
               ;;
               'make'*'=/usr/share/doc'*) # genuine install command
                    combine[countc++]="  ${commands[jm]}"
                    inc=true
               ;;
               *'/usr/share/doc'*) # don't write a doc install
                    :
               ;;
               *) # install line so write it out
                    if [ $cont -gt 0 ]; then # first write out cont lines
                      for (( l=0; l<$cont; l++ )); do
                        combine[countc++]="  ${storit[l]}"
                      done
                    fi 
                    combine[countc++]="  ${commands[jm]}"
                    inc=true
                    cont=0
                    countg=$[jm+1]
               ;;
             esac
          ;;
          *docsdir*) # libjpegturbo sets an env variable for the docs dir
              combine[countc++]="  ${commands[jm]}"
              cont=0
              inc=true
              countg=$[jm+1]
          ;;
          '#'*) # comment line so ignore it
              countg=$[jm+1]
          ;;
          "make update")
              combine[countc++]="  ${commands[jm]}"
              cont=0
              inc=true
              countg=$[jm+1]
          ;;
          *'/usr/share/doc/php'*) # php so write the docs
              for (( l=0; l<$cont; l++ )); do
                combine[countc++]="  ${storit[l]}"
              done
              combine[countc++]="  ${commands[jm]}"
              cont=0
              inc=true
              countg=$[jm+1]
          ;;
          if*) # starts with if so if a doc, will need to delete the closing fi
                   case ${commands[jm]} in
                   *'/usr/share/doc'*)
                       ifDoc=true
                       case ${commands[j]} in
                          *\\) # a continuation line so store it
                                storit[cont++]="${commands[jm]}"
                          ;;
                       esac
                   ;;
                   *\\) # a continuation line
                       storit[cont++]="${commands[jm]}"
                   ;;
                   *) # if block but not a doc or a cont line
                       echo ${commands[jm]}
                   ;;
                esac
          ;;
          *'/usr/share/doc'*) # would have got here because we have a cont line
              cont=0 # doc so don't write it out
              countg=$[jm+1] # update countg in case this is the last line
          ;;
          "ln -v -sfn ant-"*) # apache-ant symlink
             countg=$jm
             break
          ;;
          "for "*) # begining of a for loop so break
             countg=$jm
             cont=0
             inc=true
             break
          ;;
          *)
             case "${commands[jm]}" in
               *\\) # if a cont line, then store it
                   storit[cont++]="${commands[jm]}"
               ;;
               *)
                 if ! $foundDoc; then # write out any cont lines
                   if [ $cont -gt 0 ]; then
                     for (( l=0; l<$cont; l++ )); do
                       combine[countc++]="  ${storit[l]}"
                     done
                     combine[countc++]="  ${commands[jm]}"
                     cont=0
                     inc=true
                   else
                     countg=$jm
                     cont=0
                     inc=true
                     break
                   fi
                 else # continuation of a doc line so ignore it
                   cont=0
                 fi
               ;;
             esac
          ;;
        esac
      done
      if ! $inc; then
        combine[countc++]='  echo "no install script for this package"'
      fi
    ;;
    *)
      if [ $i -lt $countbl ]; then
        :
      else
        combine[countc++]=${buildWrap[i]}
        ((countbl++)) # increment because have written another build command
      fi
    ;;
  esac
done
rtr=(${combine[@]})
} # end combineScript
#
getBuild () {
local abuild=""
buildfile=$BLFSBUILDFILES/buildsrc
if [ ! -e $buildfile ]; then
  return $RETURN_PARAM
else
IFS='
'
abuild=( $( < $buildfile ) )
rtrnBuild=(${abuild[@]})
return 0
fi
} # end getBuild
#
Getxmlsec () {
xmlsec=general
case $1 in
  blfs|security)
        xmlsec=postlfs
  ;;
  networks)
        xmlsec=basicnet
  ;;
  gnomeplatform|gnomedesktop|gnomeutils)
        xmlsec=gnome
  ;;
  office|xsoftware|browser)
        xmlsec=xsoft
  ;;
  multimedia)
        xmlsec=multimedia
  ;;
  pst)
        xmlsec=pst
  ;;
  server)
        xmlsec=server
  ;;
  x|xlibs)
        xmlsec=x
  ;;
  xfce)
        xmlsec=xfce
  ;;
esac
} # end Getxmlsec
#
getComms () {
local acom=""
local bcom=""
local localpkgname=$1
if [[ "$localpkgname" == ffmpeg || "$localpkgname" == atk ]]; then # avoid at-spi2-atk which *-atk matches
  curfile=${DumpedCommands}/${xmlsec}/???-${commandname}
else
  if [ -e ${DumpedCommands}/${xmlsec}/*-${commandname} ]; then
    curfile=${DumpedCommands}/${xmlsec}/*-${commandname}
  else
    echo -e 'echo "No commands matching '"${blfscommands}"'/'"${xmlsec}"'/*-'"${commandname}"'"'
    echo 'echo "Adjust the command name before continuing. Exiting now"'
    echo "exit 1"
    exit 1
  fi
fi
IFS='
'
acom=( $( < $curfile ) )
case $localpkgname in
     docbook-xsl)
             ic=0
             catcount=0 # need to find 4 xmlcatalog commands then ignore the rest
             xmlcatfound=false
             for tline in ${acom[@]}
             do
               case $tline in
                  xmlcatalog*)
                    ((catcount++))
                    if [ $catcount -ge 5 ]; then #ignore remaining commands
                      xmlcatfound=true
                    else
                      bcom[ic++]=$tline
                     fi
                  ;;
                  *)
                     if ! $xmlcatfound; then #write the commands
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     firewall)
             ic=0
             EOFfound=false # need to find 2 EOFs and ignore the remaining commands
             for tline in ${acom[@]}
             do
               case $tline in
                  *EOF*)
                    if ! $EOFfound; then # found first EOF  - write til next EOF
                      EOFfound=true
                      bcom[ic++]=$tline # write the cat - EOF line
                    else # finish writing commands
                      bcom[ic++]=$tline # EOF line
                      EOFfound=false
                    fi   
                  ;;
                  modprobe*)
                    :
                  ;;
                  chmod*)
                      bcom[ic++]=$tline
                      break
                  ;;
                  *)   
                    if $EOFfound; then # write all commands until next EOF
                      bcom[ic++]=$tline
                    fi   
                  ;;   
               esac 
             done 
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     gimp) # only want the commands to the first make install
             ic=0
             foundinstall=false
             for tline in ${acom[@]}
             do
               case $tline in
                  "make install"*)
                     if ! $foundinstall; then
                       bcom[ic++]=$tline
                       foundinstall=true
                     fi
                  ;;
                  *)
                     if ! $foundinstall; then
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     git)
             ic=0
             foundhtml=false
             for tline in ${acom[@]}
             do
               case $tline in
                  "make htmldir"*)
                     foundhtml=true
                  ;;
                  "tar -xf ../git-manpages"*)
                     foundhtml=false
                  ;;
                  *)
                     if ! $foundhtml; then
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     linux-pam) # remove all the test commands
             ic=0
             instfound=false
             for tline in ${acom[@]}
             do
               case $tline in
                  *install*)
                     if ! $instfound; then
                       instfound=true
                     else
                       bcom[ic++]=$tline
                       instfound=false
                     fi
                  ;;
                  *)
                     if ! $instfound; then #write the commands
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     openldap) # only want the commands for a client install
             ic=0
             foundmake=false
             for tline in ${acom[@]}
             do
               case $tline in
                  make)
                     if $foundmake; then
                       foundmake=false
                     else
                       foundmake=true
                       bcom[ic++]=$tline
                     fi
                  ;;
                  *)
                     if ! $foundmake; then
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     pango) # commands include those for pangox-compat, so remove them
             ic=0
             foundconfig=false
             for tline in ${acom[@]}
             do
               case $tline in
                  './configure'*)
                     if $foundconfig; then
                       foundconfig=false
                     else
                       foundconfig=true
                       bcom[ic++]=$tline
                     fi
                  ;;
                  *)
                     if $foundconfig; then
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     pangox-compat) # commands come from pango, so extract them
             ic=0
             foundconfig=false
             for tline in ${acom[@]}
             do
               case $tline in
                  './configure'*)
                     if $foundconfig; then
                       foundconfig=false
                       bcom[ic++]=$tline
                     else
                       foundconfig=true
                     fi
                  ;;
                  *)
                     if ! $foundconfig; then
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     py2cairo) # only want the first set of ./waf lines
             ic=0
             foundwaf=false
             for tline in ${acom[@]}
             do
               case $tline in
                  'PYTHON=/usr/bin/python3 ./waf configure --prefix=/usr'*)
                       if $foundwaf; then break; fi
                  ;;
                  './waf configure'*|*"waf build"*|*"waf install"*)
                       bcom[ic++]=$tline
                       if ! $foundwaf; then foundwaf=true; fi
                  ;;
                  *)
                       continue
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     pygobject2)
             ic=0
             foundpatch=false
             for tline in ${acom[@]}
             do
               case $tline in
                  'patch -p1 < ../pygobject-2.28.6-introspection-1.patch'*)
                       foundpatch=true
                       bcom[ic++]=$tline
                  ;;
                  "make install"*)
                       if $foundpatch; then
                         bcom[ic++]=$tline
                         foundpatch=false
                         break
                       else
                         continue
                       fi
                  ;;
                  *)
                       if $foundpatch; then
                         bcom[ic++]=$tline
                       else
                         continue
                       fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     shadow) # only pass system-passwd with cracklib
             ic=0
             passwdcount=0
             syspasswdfound=false
             for tline in ${acom[@]}
             do
               case $tline in
                  'cat > /etc/pam.d/system-password'*)
                       ((passwdcount++))
                       if [ $passwdcount -eq 2 ]; then
                         syspasswdfound=true
                       else
                         bcom[ic++]=$tline
                       fi
                  ;;
                  EOF*)
                       if $syspasswdfound; then
                         syspasswdfound=false
                       else
                         bcom[ic++]=$tline
                       fi
                  ;;
                  *)
                       if ! $syspasswdfound; then
                         bcom[ic++]=$tline
                       fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     xml-parser|tie-ixhash|xml-simple|extutls-dpnds|extutls-pkgcnfg|perl-glib|uri|archive-zip)
             ic=0
             found=false
             for tline in ${acom[@]}
             do
               case $tline in
                  perl*)
                         if ! $found; then
                           found=true
                           bcom[ic++]=$tline
                         fi
                  ;;
                  *install*)
                         if $found; then
                           bcom[ic++]=$tline
                           rtrnCom=(${bcom[@]})
                           return 0
                         fi
                  ;;
                  *)
                         if $found; then
                           bcom[ic++]=$tline
                         fi
                  ;;
               esac
             done
             return $RETURN_PARAM #install command not found
     ;;
     xorg-evdev|xorg-synaptics|xorg-wacom|xorg-nouveau|aspell)
             ic=0
             found=false
             for tline in ${acom[@]}
             do
               case $tline in
                  *configure*)
                         if $found; then
                           break # write no more lines
                         else
                           found=true
                           bcom[ic++]=$tline
                         fi
                  ;;
                  *)
                         if $found; then # write commands until next configure
                           bcom[ic++]=$tline
                         fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     xorg-vmmouse)
             ic=0
             found=false
             for tline in ${acom[@]}
             do
               case $tline in
                  *"XORG_CONFIG \\")
                         found=true
                         bcom[ic++]=$tline
                  ;;
                  *configure*)
                         if $found; then break; fi
                  ;;
                  *)
                         if $found; then # write commands until next configure
                           bcom[ic++]=$tline
                         fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     ${xproto}fnames|${xlib}fnames|${xapp}fnames|${xfont}fnames)
             ic=0
             for tline in ${acom[@]}
             do
               case $tline in
                  mkdir*)
                     break
                  ;;
                  *)
                     bcom[ic++]=$tline
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     ${xproto}wget|${xlib}wget|${xapp}wget|${xfont}wget)
             ic=0
             mkdirfound=false
             for tline in ${acom[@]}
             do
               case $tline in
                  mkdir*)
                     bcom[ic++]=$tline
                     mkdirfound=true
                  ;;
                  export*)
                     break
                  ;;
                  *)
                     if $mkdirfound; then
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     $xproto|$xlib|$xapp|$xfont)
             ic=0
             foundbash=false
             for tline in ${acom[@]}
             do
               case $tline in
                  bash*)
                     foundbash=true
                     bcom[ic++]=$tline
                  ;;
                  *)
                     if $foundbash; then
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     *)
             rtrnCom=(${acom[@]})
             return 0
     ;;
esac
} # end getComms
#
GetCommands () {
#get access to the arrays
rtrnBuild=""
getBuild
return_val=$?
if [ $return_val -eq $RETURN_PARAM ]; then # no build file present
  return $RETURN_PARAM
else
  buildScripts=(${rtrnBuild[@]})
  rtrnCom=""
  getComms $pkgname
  commandScripts=(${rtrnCom[@]})
  numclines=${#commandScripts[@]} # # of commands
# 
# output commands until first configure found (or special chars)
#
  countg=0 # # of commands wriiten out
  cont=0
  wpa_sup=false
  mozconfigfnd=false
  isSed=false
  for line in "${commandScripts[@]}"
  do
    if $mozconfigfnd || $wpa_sup; then # never both true - are in different sections
       case "$line" in
          EOF)
            echo "$line"
            ((countg++))
            if $mozconfigfnd; then 
              mozconfigfnd=false
            else
              wpa_sup=false
            fi
          ;;
          *)  # continue writing until an EOF found
            echo "$line"
            ((countg++))
          ;;
       esac
    else
      case "$line" in
        'cat > wpa_supplicant/.config << "EOF"'|'cat >> wpa_supplicant/.config << "EOF"') # wpa_supp writes .config document
            wpa_sup=true
            echo $line
            ((countg++))
        ;;
        "cat > mozconfig <<"*) # xulrunner, firefox, seamonkey write mozconfig
            mozconfigfnd=true
            echo $line
            ((countg++))
        ;;
        sed*)
# test if sed has continuation line
          case "$line" in
            *\\)
              isSed=true # this is a sed with cont line(s)
              cacheit[cont++]="$line"
              ((countg++))
            ;;
            *)
              echo "$line"
              ((countg++))
            ;;
          esac
        ;;
        export*) # catch any env variables being set up
          echo "$line"
          ((countg++))
        ;;
        "perl Makefile.PL"*) # a perl module
          break
        ;;
        'cat > /etc/rc.d/rc.iptables << "EOF"') # the firewall for iptables
         echo $line
         ((countg++))
        ;;
        *configure*|*Configure*|*bootstrap*|*config*|*autogen.sh*|cmake*|*"build.sh -Ddist.dir"*)
          if $isSed; then # test if another cont line
            case "$line" in
              *\\) # another cont line found so store it
                 cacheit[cont++]="$line"
                 ((countg++))
              ;;
              *) # write out the stored lines
                 for (( l=0; l<$cont; l++ )); do
                   echo "${cacheit[l]}"
                 done
                 echo "$line"
                 cont=0
                 ((countg++))
                 isSed=false # finished with this sed command
              ;;
            esac
          else
            if [ $cont -gt 0 ]; then countg=$countg-$cont; fi
            break
          fi
        ;;
        make*) # begins with make or install so break
          if $isSed; then # write out the sed lines
            for (( l=0; l<$cont; l++ )); do
              echo "${cacheit[l]}"
            done
            echo "$line"
            cont=0
            ((countg++))
            isSed=false # finished with any sed command
          else
            break
          fi
        ;;
        'install -v -d -m755 /usr/share/xml/docbook/xml-dtd-4.5'*) # break for docbook-xml
           break
        ;;
        *)
          case "$line" in
            *\\) # if a continuation line, store in cache
              cacheit[cont++]="$line"
              ((countg++))
            ;;
            *)
             if [ $cont -gt 0 ]; then # write out continuation line 
               for (( l=0; l<$cont; l++ )); do
                 echo "${cacheit[l]}"
               done
               echo "$line"
               cont=0
               isSed=false # finished with any sed command
               ((countg++)) # count # of commands written to output
               [ $countg -eq $numclines ] && return 0
             else
               echo "$line"
               ((countg++)) # count # of commands written to output
               [ $countg -eq $numclines ] && return 0
             fi
            ;;
          esac
       ;;
      esac
    fi
  done
#
  rtr=""
  combineScripts commandScripts[@] buildScripts[@]
  scriptOut=(${rtr[@]})
  for t in "${scriptOut[@]}"
  do
    echo $t
  done
  if [ $countg -ne $numclines ]; then # output remaining commands
    cont=0 # counter for continuation lines
    foundDoc=false # doc command
    tarcomm=false # tar command
    symtest=false # symlink
#
    for (( k=$countg; k<$numclines; k++ ))
    do
      case ${commandScripts[k]} in
         install*)
                case ${commandScripts[k]} in
                   *'/usr/share/doc'*)
                       case ${commandScripts[k]} in
                          *\\) # a doc continuation line
                             foundDoc=true
                          ;;
                       esac
                   ;;
                   *\\) # a continuation line
                       cacheit[cont++]=${commandScripts[k]}
                   ;;
                   *) # install but not a doc or a cont line
                       echo ${commandScripts[k]}
                   ;;
                esac
         ;;
         ln*) # is a symlink so write it
                case ${commandScripts[k]} in
                   *\\) # a continuation line
                       cacheit[cont++]=${commandScripts[k]}
                       symtest=true
                   ;;
                   *) # write it out
                       echo ${commandScripts[k]}
                   ;;
                esac
         ;;
         if*) # starts with if so if a doc, will need to delete the closing fi
                   case ${commandScripts[k]} in
                   *'/usr/share/doc'*)
                       ifDoc=true
                       case ${commandScripts[k]} in
                          *\\) # a continuation line
                                cacheit[cont++]=${commandScripts[k]}
                          ;;
                       esac
                   ;;
                   *\\) # a continuation line
                       cacheit[cont++]=${commandScripts[k]}
                   ;;
                   *) # if block but not a doc or a cont line
                       echo ${commandScripts[k]}
                   ;;
                esac
         ;;
         tar*) # untar a file, so catch the cont lines
                case ${commandScripts[k]} in
                   *\\) # a continuation line
                       cacheit[cont++]=${commandScripts[k]}
                       tarcomm=true
                   ;;
                   *) 
                       echo ${commandScripts[k]}
                   ;;
                esac
         ;;
         gunzip*) # unpack a tarball so write it
                echo ${commandScripts[k]}
         ;;
         mv*) # a move commands so write it
                echo ${commandScripts[k]}
         ;;
         'mkdir    /usr/share/doc/git-'*) # want the git docs
                echo ${commandScripts[k]}
         ;;
         *'/usr/share/doc/php'*) # php doc so write it
                for (( l=0; l<$cont; l++ )); do
                  echo "${cacheit[l]}"
                done
                echo ${commandScripts[k]}
                cont=0
         ;;
         *'/usr/share/doc'*)
                if $tarcomm; then
                  case ${commandScripts[k]} in
                     *\\) # another continuation line
                         cacheit[cont++]=${commandScripts[k]}
                     ;;
                     *)
                         for (( l=0; l<$cont; l++ )); do
                           echo "${cacheit[l]}"
                         done
                         echo ${commandScripts[k]}
                         tarcomm=false
                         cont=0
                     ;;
                   esac
                elif $symtest; then
                  case ${commandScripts[k]} in
                     *\\) # another continuation line
                         cacheit[cont++]=${commandScripts[k]}
                     ;;
                     *) 
                         for (( l=0; l<$cont; l++ )); do
                           echo "${cacheit[l]}"
                         done
                         echo ${commandScripts[k]}
                         symtest=false
                         cont=0
                     ;;
                   esac
                else
                  case ${commandScripts[k]} in
                      *\\) # a continuation line
                         foundDoc=true
                      ;;
                      *)
                         if $foundDoc; then # is a doc, so don't write
                           foundDoc=false
                         fi
                         cont=0
                      ;;
                  esac
                fi
         ;;
         "fi"*)
                if $ifDoc; then # end of a doc if test - don't write it
                  ifDoc=false
                else
                  echo ${commandScripts[k]} # if block is not a doc
                fi
         ;;
         *)
              if ! $ifDoc; then # not commands within a doc if block
                case ${commandScripts[k]} in
                    *\\) # continuation line, store it
                       cacheit[cont++]=${commandScripts[k]}
                    ;;
                    *) 
                       if [ $cont -gt 0 ]; then # write out continuation line(s)
                         for (( l=0; l<$cont; l++ )); do
                           echo "${cacheit[l]}"
                         done
                         symtest=false
                         tarcomm=false
                         cont=0
                       fi
                       echo ${commandScripts[k]}
                    ;;
                esac
              fi
         ;;
      esac
    done
  fi
  return 0
fi
} # end GetCommands
#
GetXCommands () {
#get access to the xml x commands
rtrnCom=""
getComms $pkgname
commandScripts=(${rtrnCom[@]})
numclines=${#commandScripts[@]} # # of commands
for xt in "${commandScripts[@]}"
do
  echo $xt
done
return 0
} # end GetXCommands
#
GetcacertsCommands () {
rtrnCom=""
getComms $pkgname
commandScripts=(${rtrnCom[@]})
# dump all the commands
for line in "${commandScripts[@]}"
do
  echo $line
done
} # end GetcacertsCommands
#
avrbinutilsComms () {
local avrbinutilscom=""
avrbinutilscom[0]="sed -i -e 's/@colophon/@@colophon/' \\"
avrbinutilscom[1]="       -e 's/doc@cygnus.com/doc@@cygnus.com/' bfd/doc/bfd.texinfo"
avrbinutilscom[2]="if [ -e ../avr-size.patch ]; then"
avrbinutilscom[3]="patch -Np0 < ../avr-size.patch"
avrbinutilscom[4]="else"
avrbinutilscom[5]='echo "patch avr-size.patch does not exist"'
avrbinutilscom[6]='echo "Please place it in /usr/src/avr/avr-binutils"'
avrbinutilscom[7]="exit 1"
avrbinutilscom[8]="fi"
avrbinutilscom[9]="mkdir -v ../binutils-build"
avrbinutilscom[10]="cd ../binutils-build"
avrbinutilscom[11]="../binutils-2.23.2/configure --prefix=/usr \\"
avrbinutilscom[12]="--with-lib-path=/usr/lib \\"
avrbinutilscom[13]="--enable-ld=default \\"
avrbinutilscom[14]="--enable-gold \\"
avrbinutilscom[15]="--enable-plugins \\"
avrbinutilscom[16]="--enable-threads \\"
avrbinutilscom[17]="--with-pic \\"
avrbinutilscom[18]="--enable-shared \\"
avrbinutilscom[19]="--disable-werror \\"
avrbinutilscom[20]="--disable-multilib \\"
avrbinutilscom[21]="--target=avr"
avrbinutilscom[22]="make tooldir=/usr"
avrbinutilscom[23]='make tooldir=/usr DESTDIR="/tmp/" install'
avrbinutilscom[24]="cp /tmp/usr/bin/avr-*  /usr/bin/"
avrbinutilscom[25]="cp /tmp/usr/lib/ldscripts/avr* /usr/lib/ldscripts/"
avrbinutilscom[26]="for info in as bfd binutils configure gprof ld standards; do"
avrbinutilscom[27]="cp /tmp/usr/share/info/\${info}.info /usr/share/info/avr-\${info}.info"
avrbinutilscom[28]="done"
avrbinutilscom[29]="cp /tmp/usr/share/man/man1/avr-* /usr/share/man/man1/"
avrbinutilscom[30]="install -v -d /usr/x86_64-unknown-linux-gnu"
avrbinutilscom[31]="cp -r /tmp/usr/x86_64-unknown-linux-gnu/avr /usr/x86_64-unknown-linux-gnu"
avrbinutilscom[32]="rm -rf /tmp/usr"
rtrncommands=(${avrbinutilscom[@]})
} # end avrbinutilsComms
#
avrgccComms () {
local avrgcccom=""
avrgcccom[0]="case \$(uname -m) in"
avrgcccom[1]="  i?86) sed -i 's/^T_CFLAGS =$/& -fomit-frame-pointer/' gcc/Makefile.in ;;"
avrgcccom[2]="esac"
avrgcccom[3]="sed -i 's/install_to_\$(INSTALL_DEST) //' libiberty/Makefile.in"
avrgcccom[4]="sed -i -e /autogen/d -e /check.sh/d fixincludes/Makefile.in"
avrgcccom[5]="mv -v libmudflap/testsuite/libmudflap.c++/pass41-frag.cxx{,.disable}"
avrgcccom[6]="mkdir -v ../gcc-build"
avrgcccom[7]="cd ../gcc-build"
avrgcccom[8]="../gcc-${gccvers}/configure --prefix=/usr               \\"
avrgcccom[9]="                  --disable-cloog-version-check \\"
avrgcccom[10]="                 --disable-install-libiberty \\"
avrgcccom[11]="                 --disable-libssp \\"
avrgcccom[12]="                 --disable-libstdcxx-pch \\"
avrgcccom[13]="                 --disable-libunwind-exceptions \\"
avrgcccom[14]="                 --disable-linker-build-id \\"
avrgcccom[15]="                 --disable-nls \\"
avrgcccom[16]="                 --disable-werror \\"
avrgcccom[17]="                 --enable-__cxa_atexit \\"
avrgcccom[18]="                 --enable-checking=release \\"
avrgcccom[19]="                 --enable-clocale=gnu \\"
avrgcccom[20]="                 --enable-cloog-backend=isl \\"
avrgcccom[21]="                 --enable-gnu-unique-object \\"
avrgcccom[22]="                 --enable-gold \\"
avrgcccom[23]="                 --enable-languages=c,c++ \\"
avrgcccom[24]="                 --enable-ld=default \\"
avrgcccom[25]="                 --enable-lto \\"
avrgcccom[26]="                 --enable-plugin \\"
avrgcccom[27]="                 --enable-shared \\"
avrgcccom[28]="                 --infodir=/usr/share/info \\"
avrgcccom[29]="                 --libdir=/usr/lib \\"
avrgcccom[30]="                 --libexecdir=/usr/lib \\"
avrgcccom[31]="                 --mandir=/usr/share/man \\"
avrgcccom[32]="                 --target=avr \\"
avrgcccom[33]="                 --with-as=/usr/bin/avr-as \\"
avrgcccom[34]="                 --with-gnu-as \\"
avrgcccom[35]="                 --with-gnu-ld \\"
avrgcccom[36]="                 --with-ld=/usr/bin/avr-ld \\"
avrgcccom[37]="                 --with-plugin-ld=ld.gold \\"
avrgcccom[38]="                 --with-system-zlib"
avrgcccom[39]="make"
avrgcccom[40]='make DESTDIR="/tmp/" install'
avrgcccom[41]='find /tmp/usr/lib -type f -name "*.a" \'
avrgcccom[42]="   -exec /usr/bin/avr-strip --strip-debug '{}' \\;"
avrgcccom[43]="cp /tmp/usr/bin/avr-*  /usr/bin/"
avrgcccom[44]="cp -r /tmp/usr/lib/gcc/avr  /usr/lib/gcc/"
avrgcccom[45]="cp /tmp/usr/share/man/man1/avr-* /usr/share/man/man1"
rtrncommands=(${avrgcccom[@]})
} # end avrgccComms
#
basicComms () {
local basiccom=""
basiccom[0]="./configure --prefix=/usr \\"
basiccom[1]="            --sysconfdir=/etc \\"
basiccom[2]="            --localstatedir=/var \\"
basiccom[3]="            --libexecdir=/usr/lib \\"
basiccom[4]="            --disable-static"
basiccom[5]="make"
basiccom[6]="make install"
rtrncommands=(${basiccom[@]})
} # basicComms
#
blfsbtscrptsComms () {
local blfscom=""
blfscom[0]='make install-$bsToInstall'
rtrncommands=(${blfscom[@]})
} # end blfsbtscrptsComms
#
boostComms () {
local boostcom=""
boostcom[0]="patch -Np2 -i ../boost_1_54_0-fix-new-glibc-1.patch"
boostcom[1]='echo "using gcc : : : <compileflags>-fno-strict-aliasing ;" >> tools/build/v2/user-config.jam'
boostcom[2]='echo "using python : 3.3 : /usr/bin/python3 : /usr/include/python3.3m : /usr/lib ;" >> tools/build/v2/user-config.jam'
boostcom[3]='echo "using mpi ;" >> tools/build/v2/user-config.jam'
boostcom[4]="./bootstrap.sh --with-toolset=gcc --with-icu --with-python=/usr/bin/python2"
boostcom[5]='_bindir="bin.linuxx86"'
boostcom[6]='[ "$(uname -m)" = x86_64 ] && _bindir="bin.linuxx86_64"'
boostcom[7]="install tools/build/v2/engine/\${_bindir}/bjam /usr/bin/bjam"
boostcom[8]="pushd tools"
boostcom[9]="for _tool in bcp inspect quickbook compiler_status process_jam_log wave; do"
boostcom[10]="  /usr/bin/bjam --toolset=gcc \$_tool"
boostcom[11]="done"
boostcom[12]='/usr/bin/bjam --toolset=gcc cflags="-std=gnu++11" library_status'
boostcom[13]="popd"
boostcom[14]="cp -a dist/bin/* /usr/bin"
boostcom[15]="/usr/bin/bjam \\"
boostcom[16]="      variant=release \\"
boostcom[17]="      debug-symbols=off \\"
boostcom[18]="      threading=multi \\"
boostcom[19]="      runtime-link=shared \\"
boostcom[20]="      link=shared \\"
boostcom[21]="      toolset=gcc \\"
boostcom[22]="      python=2.7 \\"
boostcom[23]="      --layout=system \\"
boostcom[24]="      --prefix=/usr \\"
boostcom[25]="      install"
rtrncommands=(${boostcom[@]})
} # end boostComms
#
coreutilsComms () {
local corecom=""
corecom[0]="patch -Np1 -i ../coreutils-${coreutilsvers}-i18n-1.patch"
corecom[1]='FORCE_UNSAFE_CONFIGURE=1 ./configure \'
corecom[2]='--prefix=/usr --libexecdir=/usr/lib --enable-no-install-program=kill,uptime'
corecom[3]='make'
corecom[4]='make install'
corecom[5]='mv -v /usr/bin/chroot /usr/sbin'
corecom[6]='mv -v /usr/share/man/man1/chroot.1 /usr/share/man/man8/chroot.8'
corecom[7]='sed -i s/\"1\"/\"8\"/1 /usr/share/man/man8/chroot.8'
rtrncommands=(${corecom[@]})
} # end coreutilsComms
#
espeakComms () {
local espeakcom=""
espeakcom[0]="cd src"
espeakcom[1]="cp portaudio19.h portaudio.h"
espeakcom[2]="make AUDIO=runtime"
espeakcom[3]="make install"
espeakcom[4]="chmod 644 /usr/lib/libespeak.a"
rtrncommands=(${espeakcom[@]})
} # end espeakComms
#
gtkvncComms () {
local gtkvnccom=""
gtkvnccom[0]="./configure --prefix=/usr \\"
gtkvnccom[1]="            --with-gtk=3.0 \\"
gtkvnccom[2]="            --enable-vala"
gtkvnccom[3]="make"
gtkvnccom[4]="make install"
rtrncommands=(${gtkvnccom[@]})
} # end gtkvncComms
hamcrestComms () {
local hamcrestcom=""
hamcrestcom[0]="install -v -dm755 /usr/share/java/hamcrest"
hamcrestcom[1]="for hamtype in core library generator integration; do"
hamcrestcom[2]="  cp \${SrcName}\${hamtype}-\${pkgver}.jar /usr/share/java/hamcrest"
hamcrestcom[3]="ln -sv hamcrest/\${SrcName}\${hamtype}-\${pkgver}.jar \\"
hamcrestcom[4]="       /usr/share/java/\${SrcName}\${hamtype}.jar"
hamcrestcom[5]="done"
rtrncommands=(${hamcrestcom[@]})
} # end hamcrestComms
#
jdkbinComms () {
local jdkbincom=""
jdkbincom[0]="install -v -m755 -d /opt/jdk-${jdkvers}"
jdkbincom[1]="mv -v * /opt/jdk-${jdkvers}"
jdkbincom[2]="ln -v -nsf jdk-${jdkvers} /opt/jdk"
jdkbincom[3]="chown -R -h jdkbin:jdkbin /opt/jdk-${jdkvers}"
jdkbincom[4]='cat > /etc/profile.d/openjdk.sh << "EOF"'
jdkbincom[5]="# Begin /etc/profile.d/openjdk.sh"
jdkbincom[6]="# Set JAVA_HOME directory"
jdkbincom[7]="JAVA_HOME=/opt/jdk"
jdkbincom[8]="# Adjust PATH"
jdkbincom[9]="pathappend \${JAVA_HOME}/bin PATH"
jdkbincom[10]="# Auto Java CLASSPATH"
jdkbincom[11]="# Copy jar files to, or create symlinks in this directory"
jdkbincom[12]="AUTO_CLASSPATH_DIR=/usr/share/java"
jdkbincom[13]="pathprepend . CLASSPATH"
jdkbincom[14]="for dir in \`find \${AUTO_CLASSPATH_DIR} -type d 2>/dev/null\`; do"
jdkbincom[15]="    pathappend \$dir CLASSPATH"
jdkbincom[16]="done"
jdkbincom[17]='for jar in `find ${AUTO_CLASSPATH_DIR} -name "*.jar" 2>/dev/null`; do'
jdkbincom[18]="    pathappend \$jar CLASSPATH"
jdkbincom[19]="done"
jdkbincom[20]="export JAVA_HOME CLASSPATH"
jdkbincom[21]="unset AUTO_CLASSPATH_DIR dir jar"
jdkbincom[22]="# End /etc/profile.d/openjdk.sh"
jdkbincom[23]="EOF"
rtrncommands=(${jdkbincom[@]})
} #end jdkbinComms
#
junitComms () {
local junitcom=""
junitcom[0]="if [ ! -e ../Manifest.txt ]; then"
junitcom[1]="  cp ${blfsBuildFiles}/${blfsfiles}/Manifest.txt ../"
junitcom[2]="fi"
junitcom[3]="ant dist -Dversion-status=''"
junitcom[4]="jar ufm junit4.12/junit-dep-4.12.jar ../Manifest.txt"
junitcom[5]="install -Dm644 junit4.12/junit-dep-4.12.jar /usr/share/java/junit-4.12.jar"
junitcom[6]="ln -svf junit-4.12.jar /usr/share/java/junit.jar"
rtrncommands=(${junitcom[@]}) 
} # end junitComms
#
libproxyComms () {
local libproxycom=""
libproxycom[0]="mkdir build"
libproxycom[1]="cd build"
libproxycom[2]="cmake -DCMAKE_INSTALL_PREFIX=/usr \\"
libproxycom[3]="      -DLIBEXEC_INSTALL_DIR=/usr/lib/libproxy \\"
libproxycom[4]="      -DCMAKE_SKIP_RPATH=ON \\"
libproxycom[5]="      -DWITH_WEBKIT=OFF \\"
libproxycom[6]="      .."
libproxycom[7]="make"
libproxycom[8]="make install"
rtrncommands=(${libproxycom[@]})
} # end libproxyComms
#
libpwqualityComms () {
local libpwqualitycom=""
libpwqualitycom[0]="./configure --prefix=/usr \\"
libpwqualitycom[1]="            --sysconfdir=/etc \\"
libpwqualitycom[2]="            --with-securedir=/lib/security \\"
libpwqualitycom[3]="            --disable-static"
libpwqualitycom[4]="make"
libpwqualitycom[5]="make install"
rtrncommands=(${libpwqualitycom[@]})
} # end libpwqualityComms
#
mariadbComms () {
local mariadbciom=""
mariadbcom[0]="if [ ! -d build ]; then"
mariadbcom[1]="  mkdir build"
mariadbcom[2]="fi"
mariadbcom[3]="cd build"
mariadbcom[4]="cmake -DCMAKE_BUILD_TYPE=Release \\"
mariadbcom[5]="      -DCMAKE_INSTALL_PREFIX=/usr \\"
mariadbcom[6]="      -DSYSCONFDIR=/etc/mysql \\"
mariadbcom[7]="      -DMYSQL_DATADIR=/var/lib/mysql \\"
mariadbcom[8]="      -DMYSQL_UNIX_ADDR=/run/mysqld/mysqld.sock \\"
mariadbcom[9]="      -DDEFAULT_CHARSET=utf8 \\"
mariadbcom[10]="      -DDEFAULT_COLLATION=utf8_general_ci \\"
mariadbcom[11]="      -DENABLED_LOCAL_INFILE=ON \\"
mariadbcom[12]="      -DINSTALL_INFODIR=share/mysql/docs \\"
mariadbcom[13]="      -DINSTALL_MANDIR=share/man \\"
mariadbcom[14]="      -DINSTALL_PLUGINDIR=lib/mysql/plugin \\"
mariadbcom[15]="      -DINSTALL_SCRIPTDIR=bin \\"
mariadbcom[16]="      -DINSTALL_INCLUDEDIR=include/mysql \\"
mariadbcom[17]="      -DINSTALL_DOCREADMEDIR=share/mysql \\"
mariadbcom[18]="      -DINSTALL_SUPPORTFILESDIR=share/mysql \\"
mariadbcom[19]="      -DINSTALL_MYSQLSHAREDIR=share/mysql \\"
mariadbcom[20]="      -DINSTALL_DOCDIR=share/mysql/docs \\"
mariadbcom[21]="      -DINSTALL_SHAREDIR=share/mysql \\"
mariadbcom[22]="      -DWITH_READLINE=ON \\"
mariadbcom[23]="      -DWITH_ZLIB=system \\"
mariadbcom[24]="      -DWITH_SSL=system \\"
mariadbcom[25]="      -DWITH_LIBWRAP=OFF \\"
mariadbcom[26]="      -DWITH_LIBEVENT=system \\"
mariadbcom[27]="      -DWITH_EXTRA_CHARSETS=complex \\"
mariadbcom[28]="      -DWITH_EMBEDDED_SERVER=ON \\"
mariadbcom[29]="      -DWITH_ARCHIVE_STORAGE_ENGINE=1 \\"
mariadbcom[30]="      -DWITH_BLACKHOLE_STORAGE_ENGINE=1 \\"
mariadbcom[31]="      -DWITH_INNOBASE_STORAGE_ENGINE=1 \\"
mariadbcom[32]="      -DWITH_PARTITION_STORAGE_ENGINE=1 \\"
mariadbcom[33]="      -DWITHOUT_EXAMPLE_STORAGE_ENGINE=1 \\"
mariadbcom[34]="      -DWITHOUT_FEDERATED_STORAGE_ENGINE=1 \\"
mariadbcom[35]="      -DWITHOUT_PBXT_STORAGE_ENGINE=1 \\"
mariadbcom[36]='      -DCMAKE_C_FLAGS="-fPIC -fno-strict-aliasing -DBIG_JOINS=1 -fomit-frame-pointer" \'
mariadbcom[37]='      -DCMAKE_CXX_FLAGS="-fPIC -fno-strict-aliasing -DBIG_JOINS=1 -felide-constructors -fno-rtti" \'
mariadbcom[38]="      .."
mariadbcom[39]="make"
mariadbcom[40]="make install"
rtrncommands=(${mariadbcom[@]})
} # end mariadbComms
#
netctlComms () {
local netctlcom=""
netctlcom[0]="make install"
netctlcom[1]="install -D -m644 contrib/bash-completion /usr/share/bash-completion/completions/netctl"
netctlcom[2]="install -D -m644 contrib/zsh-completion /usr/share/zsh/site-functions/_netctl"
rtrncommands=(${netctlcom[@]})
} # end netctlComms
#
ntificatndemonComms () {
local ntificatndemoncom=""
ntificatndemoncom[0]="./configure --prefix=/usr \\"
ntificatndemoncom[1]="            --sysconfdir=/etc \\"
ntificatndemoncom[2]="            --libexecdir=/usr/lib/notification-daemon"
ntificatndemoncom[3]="make"
ntificatndemoncom[4]="make install"
rtrncommands=(${ntificatndemoncom[@]})
} # end ntificatndemonComms
#
openjdkComms () {
local openjdkcom=""
openjdkcom[0]="if [ ! -d /usr/share/java ]; then install -v -d -m755 /usr/share/java; fi"
openjdkcom[1]="if [[ ! -e /usr/share/java/js.jar || ! -e /usr/share/java/js-14.jar ]]; then"
openjdkcom[2]="  unzip ../rhino1_7R4.zip"
openjdkcom[3]="  install -v -m755 rhino1_7R4/*.jar /usr/share/java"
openjdkcom[4]="fi"
openjdkcom[5]="cp -v ../corba.tar.gz     ."
openjdkcom[6]="cp -v ../hotspot.tar.gz   ."
openjdkcom[7]="cp -v ../jaxp.tar.gz      ."
openjdkcom[8]="cp -v ../jaxws.tar.gz     ."
openjdkcom[9]="cp -v ../jdk.tar.gz       ."
openjdkcom[10]="cp -v ../langtools.tar.gz ."
openjdkcom[11]="cp -v ../openjdk.tar.gz   ."
openjdkcom[12]="patch -Np1 -i ../icedtea-2.4.1-add_cacerts-2.patch"
openjdkcom[13]="patch -Np1 -i ../icedtea-2.4.1-fixed_paths-1.patch"
openjdkcom[14]="patch -Np1 -i ../icedtea-2.4.1-fix_tests-1.patch"
openjdkcom[15]="unset JAVA_HOME"
openjdkcom[16]="./autogen.sh"
openjdkcom[17]="./configure \\"
openjdkcom[18]="  --disable-tests \\"
openjdkcom[19]="  --disable-downloading --disable-Werror \\"
openjdkcom[20]="  --with-jdk-home=/opt/jdk-${jdkvers} \\"
openjdkcom[21]="  --enable-nss \\"
openjdkcom[22]="  --with-version-suffix=blfs \\"
openjdkcom[23]="  --enable-pulse-java"
openjdkcom[24]="make"
openjdkcom[25]="chmod 0644 openjdk.build/j2sdk-image/lib/sa-jdi.jar"
openjdkcom[26]="install -m755 -d /opt/jdk7-openjdk"
openjdkcom[27]="cp -R openjdk.build/j2sdk-image/* /opt/jdk7-openjdk"
openjdkcom[28]="if [ ! -d /usr/share/applications ]; then install -m755 -d /usr/share/applications; fi"
openjdkcom[29]="install -m644 jconsole.desktop /usr/share/applications"
openjdkcom[30]="rm -rf /opt/jdk"
openjdkcom[31]="ln -v -nsf jdk7-openjdk /opt/jdk"
rtrncommands=(${openjdkcom[@]})
} # openjdkComms
#
pyComms () {
local pycom=""
if [ "$pkgname" = py3cairo ]; then
pycom[0]="sed -i 's:bin/env python:bin/env python3:' waf"
pycom[1]="python3 ./waf --version"
pycom[2]="PYTHON=/usr/bin/python3 ./waf configure --prefix=/usr"
pycom[3]="PYTHON=/usr/bin/python3 ./waf build"
pycom[4]="PYTHON=/usr/bin/python3 ./waf install"
elif [ "$pkgname" = "py2-xdg" ]; then
pycom[0]="python2 setup.py install --optimize=1"
elif [ "$pkgname" = "py3-xdg" ]; then
pycom[0]="python3 setup.py install --optimize=1"
elif [ "$pkgname" = docutils ]; then
pycom[0]="python3 setup.py install --optimize=1"
fi
rtrncommands=(${pycom[@]})
} #end pyComms
#
py2atspiComms () {
py2atspicom=""
py2atspicom[0]="sed '/AC_PATH_XTRA/d' -i configure.ac"
py2atspicom[1]="autoreconf -fi"
py2atspicom[2]="mkdir ../python2"
py2atspicom[3]="cd ../python2"
py2atspicom[4]="../\${srcdir}/configure --prefix=/usr --with-python=/usr/bin/python2"
py2atspicom[5]="make"
py2atspicom[6]="make install"
rtrncommands=(${py2atspicom[@]})
} # end py2atspiComms
#
py2dbusComms () {
local py2dbuscom=""
py2dbuscom[0]="PYTHON=python2 ./configure --prefix=/usr \\"
py2dbuscom[1]="                            --docdir=/usr/share/doc/dbus-python-1.2.0"
py2dbuscom[2]="make"
py2dbuscom[3]="make install"
rtrncommands=(${py2dbuscom[@]})
} # end py2dbusComms
#
py3dbusComms () {
local py3dbuscom=""
py3dbuscom[0]="PYTHON=python3 ./configure --prefix=/usr \\"
py3dbuscom[1]="                            --docdir=/usr/share/doc/dbus-python-1.2.0"
py3dbuscom[2]="make"
py3dbuscom[3]="make install"
rtrncommands=(${py3dbuscom[@]})
} # end py3dbusComms
#
pysolfcComms () {
local pysolfccom=""
pysolfccom[0]="find . -name \\*.py -exec sed -i -e 's|#!/usr/bin/env python|#!/usr/bin/env python2|' {} \\;"
pysolfccom[1]="python2 setup.py install"
pysolfccom[2]="ln -sv pysol.py /usr/bin/pysol"
rtrncommands=(${pysolfccom[@]})
} # end pysolssComms
#
pysolssComms () {
local pysolsscom=""
pysolsscom[0]="cd src"
pysolsscom[1]="./configure"
pysolsscom[2]="make PYTHON=python2"
pysolsscom[3]="python2 setup.py install"
rtrncommands=(${pysolsscom[@]})
} # end pysolssComms
#
smpegComms () {
local smpegcom=""
smpegcom[0]="patch -p1 -i ../smpeg-0.4.4-gcc41-1.patch"
smpegcom[1]="./configure --prefix=/usr --mandir=/usr/share/man --disable-static"
smpegcom[2]="make LDFLAGS+=-lstdc++"
smpegcom[3]="make install"
smpegcom[4]="sed -i 's#(AM_PATH_SMPEG#([AM_PATH_SMPEG]#' /usr/share/aclocal/smpeg.m4"
rtrncommands=(${smpegcom[@]})
} #end smpegComms
#
squidComms () {
local squidcom=""
squidcom[0]="sed -i '/^DEFAULT_SWAP_DIR/ s@/cache@/cache/squid@' src/Makefile.in"
squidcom[1]="sed -i -e '/^#cache_dir/ s/100/256/' \\"
squidcom[2]="       -e '/^NAME: cache_effective_group/ {n;n;s/none/proxy/}' src/cf.data.pre"
squidcom[3]="./configure --prefix=/usr \\"
squidcom[4]="            --localstatedir=/var \\"
squidcom[5]="            --libexecdir=/usr/lib/squid \\"
squidcom[6]="            --datadir=/usr/share/squid \\"
squidcom[7]="            --sysconfdir=/etc/squid \\"
squidcom[8]="            --with-default-user=proxy \\"
squidcom[9]="            --with-logdir=/var/log/squid"
squidcom[10]="make"
squidcom[11]="make install"
squidcom[12]="cp ${blfsBuildFiles}/${blfsfiles}/conf-files/squid.conf /etc/squid"
squidcom[13]='cat > /etc/pam.d/squid << "SQUIDEOF"'
squidcom[14]="auth              required        pam_unix.so"
squidcom[15]="account           required        pam_unix.so"
squidcom[16]="SQUIDEOF"
rtrncommands=(${squidcom[@]})
} # end squidComms
#
systemdComms () {
local systemdcom=""
systemdcom[0]="./configure --prefix=/usr \\"
systemdcom[1]="            --libexecdir=/usr/lib \\"
systemdcom[2]="            --localstatedir=/var \\"
systemdcom[3]="            --sysconfdir=/etc \\"
systemdcom[4]="            --enable-introspection \\"
systemdcom[5]="            --enable-gtk-doc \\"
systemdcom[6]="            --with-rootprefix= \\"
systemdcom[7]="            --with-dbuspolicydir=/etc/dbus-1/system.d \\"
systemdcom[8]="            --with-rootlibdir=/usr/lib \\"
systemdcom[9]='            --with-firmware-path="/usr/lib/firmware/updates:/usr/lib/firmware" \'
systemdcom[10]="            --docdir=/usr/share/doc/systemd-${systemdvers}"
systemdcom[11]="make"
systemdcom[12]="make install"
systemdcom[13]="for tool in runlevel reboot shutdown poweroff halt telinit; do"
systemdcom[14]="    ln -sfv systemctl /usr/bin/\$tool"
systemdcom[15]="done"
systemdcom[16]="ln -sfv ../lib/systemd/systemd /usr/bin/init"
systemdcom[17]='sed -i "s@0775 root lock@0755 root root@g" /usr/lib/tmpfiles.d/legacy.conf'
systemdcom[18]="systemd-machine-id-setup"
rtrncommands=(${systemdcom[@]})
} # end systemdComms
#
telepathyglibComms () {
local telepathyglibcom=""
telepathyglibcom[0]="./configure --prefix=/usr \\"
telepathyglibcom[1]="            --enable-vala-bindings \\"
telepathyglibcom[2]="            --disable-static"
telepathyglibcom[3]="make"
telepathyglibcom[4]="make install"
rtrncommands=(${telepathyglibcom[@]})
} # end telepathyglibComms
#
telepathylogrComms () {
local telepathylogrcom=""
telepathylogrcom[0]="./configure --prefix=/usr \\"
telepathylogrcom[1]="            --libexecdir=/usr/lib/telepathy \\"
telepathylogrcom[2]="            --enable-vala-bindings \\"
telepathylogrcom[3]="            --disable-static"
telepathylogrcom[4]="make"
telepathylogrcom[5]="make install"
rtrncommands=(${telepathylogrcom[@]})
} # end telepathylogrComms
#
tlpthyfrstreamComms () {
local tlpthyfrstreamcom=""
tlpthyfrstreamcom[0]="./configure --prefix=/usr \\"
tlpthyfrstreamcom[1]="            --disable-static"
tlpthyfrstreamcom[2]="make"
tlpthyfrstreamcom[3]="make install"
rtrncommands=(${tlpthyfrstreamcom[@]})
} # end tlpthyfrstreamComms
#
tpthymisscntrlComms () {
local tpthymisscntrlcom=""
tpthymisscntrlcom[0]="./configure --prefix=/usr \\"
tpthymisscntrlcom[1]="            --libexecdir=/usr/lib/telepathy \\"
tpthymisscntrlcom[2]="            --enable-gnome-keyring \\"
tpthymisscntrlcom[3]="            --disable-static"
tpthymisscntrlcom[4]="make"
tpthymisscntrlcom[5]="make install"
rtrncommands=(${tpthymisscntrlcom[@]})
} # end tpthymisscntrlComms
#
v4lComms () {
local v4lcom=""
v4lcom[0]="source /etc/profile.d/qt.sh"
v4lcom[1]="./configure --prefix=/usr --sysconfdir=/etc"
v4lcom[2]="make"
v4lcom[3]="make install"
v4lcom[4]="rm /usr/bin/ivtv-ctl"
rtrncommands=(${v4lcom[@]})
} # v4lComms
#
GetInternalCommands () {
# $1 is the function name that creates the commands
# get access to the build array
rtrnBuild=""
getBuild
return_val=$?
if [ $return_val -eq $RETURN_PARAM ]; then # no build file present
  return $RETURN_PARAM
else
  buildScripts=(${rtrnBuild[@]})
  declare -a rtrncommands=""
  eval $1
  commandScripts=(${rtrncommands[@]})
  numclines=${#commandScripts[@]}
  countg=0 # initialize commands counter
  cont=0
  for line in "${commandScripts[@]}"
  do
    case "$line" in
       sed*)
# test if sed has continuation line
         case "$line" in
           *\\)
             cacheit[cont++]="$line"
             ((countg++))
           ;;
           *)
             echo "$line"
             ((countg++))
           ;;
         esac
       ;;
       *configure*)
         break
       ;;
       cmake*) # configure commands for libproxy, mysql
         break
       ;;
       *bootstrap*) # boost
         break
       ;;
       make*) # no configure script
         break
       ;;
       *"setup.py install"*) # python modules
         break
       ;;
       "ant dist"*) # junit
         break
       ;;
       *)
         case "$line" in
            *\\) # if a continuation line then store in cache
             cacheit[cont++]="$line"
             ((countg++))
            ;;
            *)
             if [ $cont -gt 0 ]; then # continuation line found
               for (( l=0; l<$cont; l++ )); do
                 echo "${cacheit[l]}"
               done
               echo "$line"
               cont=0
               ((countg++)) # count # of commands written to output
               [ $countg -eq $numclines ] && return 0
             else
               echo "$line"
               ((countg++)) # count # of commands written to output
               [ $countg -eq $numclines ] && return 0
             fi
            ;;
          esac
       ;;
    esac
  done
#
  rtr=""
  combineScripts commandScripts[@] buildScripts[@]
  scriptOut=(${rtr[@]})
  for t in "${scriptOut[@]}"
  do
    echo $t
  done
  if [ $countg -ne $numclines ]; then # output remaining commands
    contin=false
    for (( k=$countg; k<$numclines; k++ ))
    do
      if [[ "${commandScripts[k]}" == install* ]]; then #don't install docs
        case ${commandScripts[k]} in
            *\\) # continuation line
                contin=true
            ;;
            */usr/share/doc*) # doc so don't write
                continue
            ;;
            *) # not a doc so write it
                echo ${commandScripts[k]}
            ;;
        esac
      else
        if $contin; then
          if [[ "${commandScripts[k]}" == *\\ ]]; then # more continuation
            :
          else
            contin=false
          fi
        else
          echo ${commandScripts[k]}
        fi
      fi
    done
  fi
  return 0
fi
} # end GetInternalCommands
#
CreateBuildDirasroot () {  #1 is the build dir
cat << "EOF"
CreateBuildDirasroot () {
BuildDirasroot=$1
if [ ! -e $BuildDirasroot ]; then install -d $BuildDirasroot; fi
cd $BuildDirasroot
CUR_DIR=".."
}
EOF
} # end CreateBuildDirasroot
#
Header () {
echo writing the script to: $Output
cat > $Output << "EOF"
#!/bin/bash
#
if [ $UID -ne 0 ]; then echo Please run this script as root. ; exit 1; fi
#
EOF
if [[ "$Section" == blfs ]]; then
  echo 'bsToInstall=$1' >> $Output
else
echo "RETURN_PARAM=$RETURN_PARAM # exit with an error
RETURN_NOTSET=$RETURN_NOTSET # no dependencies set
RETURN_DEPNOTMET=$RETURN_DEPNOTMET # package dependency not met
RETURN_ALLDEPSMET=$RETURN_ALLDEPSMET # all dependencies met" >> $Output
fi
echo "me=\$0
LFS=$LFS
SVNINFO=\"$SVNINFO\"
srcrootdir=$srcrootdir
blfsfiles=${blfsBuildFiles}/${blfsfiles}
BuildLog=$BuildLog
build=$build # name of the build file for each package
Section=$cursection
PKGUSERDIR=$PKGUSERDIR
SYSTEMD=$SYSTEMD
INSTALLPKG=true # by default install the packages
if [ \"\$1\" = noinstall ]; then INSTALLPKG=false; fi # do not install, look at deps. only" >> $Output
if $as_root; then CreateBuildDirasroot >> $Output; fi
} # end Header
#
pkguser () {
cat >> $Output << "EOF"
pkguser_ () {
# make sure pkgusers can write to the logfile
chgrp install $BuildLog
chmod 664 $BuildLog
#
cat > /etc/pkgusr/bash_profile << "BashProfile"
export PATH=/usr/lib/pkgusr:/bin:/usr/bin:/opt/jdk/bin:/opt/ant/bin
export PROMPT_COMMAND='PS1="package \u:"$(pwd)"> "'
cd
EOF
echo "PkgUserDir=${PKGUSERDIR}/${cursection}" >> $Output
cat >> $Output << "EOF"
complete -o default -o nospace -A user su finger pinky
export PkgName=$LOGNAME
EOF
echo "if [ -e \${PkgUserDir}/\${LOGNAME}/$build -a ! -e ~/.\${LOGNAME} ]; then
  cd
  bash \${PkgUserDir}/\${LOGNAME}/$build" >> $Output
cat >> $Output << "EOF"
  exit
fi
BashProfile
install -v -d ${PkgUserDir}/${LOGNAME}
}
EOF
} # end of pkguser
#
updatePkgUser () {
cat >> $Output << "EOF"
updatePkgUser_ () {
cat > /etc/pkgusr/bash_profile << "BashProfile"
export PATH=/usr/lib/pkgusr:/bin:/usr/bin
export PROMPT_COMMAND='PS1="package \u:"$(pwd)"> "'
cd
EOF
echo "PkgUserDir=${PKGUSERDIR}/${cursection}" >> $Output
cat >> $Output << "EOF"
complete -o default -o nospace -A user su finger pinky
export PkgName=$LOGNAME
EOF
echo "if [ -e \${PkgUserDir}/\${LOGNAME}/$build -a ! -e ~/.\${LOGNAME} ]; then
  cd
  bash \${PkgUserDir}/\${LOGNAME}/$build" >> $Output
cat >> $Output << "EOF"
  exit
fi
BashProfile
install -v -d ${PkgUserDir}/${LOGNAME}
}
EOF
} # end updatePkgUser
#
delSrcFile () {
echo "cd \$curdir
cd ..
rm -rf \$curdir
rm -rf .cache"
} # end of delSrcFile
#
php_setup () {
    cat << "EOF"
php_setup () {
# setup the configure variables _phpconfig and _phpextensions for php
#
if [ -f /blfsBuildFiles/blfsfiles/conf-files/php.conf ]; then
  . /blfsBuildFiles/blfsfiles/conf-files/php.conf
else
  echo "php.conf not found in /blfsBuildFiles/blfsfiles/conf-files/"
  echo "Place it there to continue"
  exit 1
fi
} # end php_setup
EOF
} # end php_setup
#
Function () {
echo "${FuncName}_ () {
PkgName=$pkgname
SrcName=$srcname
cursection=$cursection
PkgUserDir=${PKGUSERDIR}/${cursection}" >> $Output
if $as_root; then 
  case $pkgname in
    coreutils|systemd)
      echo "sourcedir=${PKGUSERDIR}/${cursection}/${pkgname}" >> $Output
    ;;
    shadow)
      echo "sourcedir=${srcrootdir}/security" >> $Output
    ;;
    *)
      echo "sourcedir=${srcrootdir}/${cursection}" >> $Output
    ;;
  esac
fi
#
case $pkgname in
   blfs-btscrpts)
      cat >> $Output << "EOF"
bsToInstall=$bsToInstall
EOF
   ;;
   udev)
echo "udevvers=$udevvers" >> $Output
   ;;
esac
#
echo "starttime=\$( date +%s )" >> $Output
# check whether already installed
case $pkgname in
   blfs-btscrpts)
      cat >> $Output << "EOF"
if [ -e "${PkgUserDir}/${PkgName}/.${bsToInstall}" ]; then
  echo "skipping ${PkgName}/${bsToInstall}"
  return
fi
EOF
   ;;
   systemd) # check for name .systemd_gudev
      cat >> $Output << "EOF"
if [ -e "${PkgUserDir}/${PkgName}/.${PkgName}_gudev" ]; then
  echo "skipping ${PkgName}"
  return
fi
EOF
   ;;
   *)
      cat >> $Output << "EOF"
if [ -e "${PkgUserDir}/${PkgName}/.${PkgName}" ]; then
  echo "skipping $PkgName"
  return
fi
EOF
   ;;
esac
# check for dependencies
case $pkgname in
   firewall) # no need to check dependencies
   echo "BuildScript=true" >> $Output
   ;;
   *)
cat >> $Output << "EOF"
# check for dependencies
BuildScript=false
FuncName=$( echo $PkgName | sed -e s/-//g -e s/_//g )
DepRtrn=""
PkgDepend
return_val=$?
if [[ $return_val -eq $RETURN_PARAM || $return_val -eq $RETURN_NOTSET ]]; then
  if $INSTALLPKG; then echo "No dependencies - building script for $PkgName"; fi
  BuildScript=true
elif [[ $return_val -eq 0 ]]; then # test if dependencies met
EOF
# next case for xfce
    case $pkgname in
      glib-networking|libsoup|gvfs|webkitgtk|pulseaudio|gst-plgns-good|libcanberra)
          if [ "$GNOME_OR_XFCE" = xfce ]; then
            cat >> $Output << "EOF"
  rtrPlessArray=""
EOF
            case $pkgname in
              glib-networking)
                cat >> $Output << "EOF"
  delElementPattern DepRtrn[@] "gnomeplatform/gset-dsktp-schms"
EOF
              ;;
              libsoup|gvfs)
                cat >> $Output << "EOF"
  delElementPattern DepRtrn[@] "gnomeplatform/libgnome-keyring"
EOF
              ;;
              webkitgtk)
                cat >> $Output << "EOF"
  delElementPattern DepRtrn[@] "networks/geoclue"
EOF
              ;;
              pulseaudio|gst-plgns-good|libcanberra)
                cat >> $Output << "EOF"
  delElementPattern DepRtrn[@] "gnomeplatform/gconf"
EOF
              ;;
            esac
            cat >> $Output << "EOF"
  unset DepRtrn
  DepRtrn=(${rtrPlessArray[@]})
EOF
          fi
      ;;
    esac
# end case xfce
cat >> $Output << "EOF"
  rtrnDepNotMet=""
  testDeps DepRtrn[@]
  ret_val=$?
  if [ $ret_val -eq $RETURN_ALLDEPSMET ]; then
    if $INSTALLPKG; then echo "All dependencies met - building script for $PkgName"; fi
    BuildScript=true
  fi
fi
EOF
   ;;
esac
# end case testing dependencies
echo "if \$BuildScript; then
if \$INSTALLPKG; then" >> $Output

if ! $as_root; then
  echo 'install -v -d ${PkgUserDir}/${PkgName}' >> $Output
  echo "touch \${PkgUserDir}/\${PkgName}/$build" >> $Output
  cat >> $Output << "EOF"
echo "#!/bin/bash
EOF
  echo 'BuildLog=$BuildLog" > ${PkgUserDir}/${PkgName}/'$build >> $Output
  if [[ "$pkgname" == "blfs-btscrpts" ]]; then
    echo "echo \"bsToInstall=\$bsToInstall\" >> \${PkgUserDir}/\${PkgName}/$build" >> $Output
  fi
  echo "cat >> \${PkgUserDir}/\${PkgName}/$build << \"IPS\"" >>$Output
  cat >> $Output << "EOF"
set +h
PkgName=$LOGNAME
CUR_DIR=$HOME
EOF
  if [[ "$Section" == x || "$pkgname" == libdrm || "$pkgname" == freeglut ]]; then
    echo "source /etc/profile.d/xorg.sh" >> $Output
  fi
  echo "SrcName=$srcname" >> $Output
# define sourcedir in the build file
  case $pkgname in
    boost|cups|gnome-menus|gnome-panel|gnm-scrnsaver|gnome-shell|nss|smpeg) # need to define blfsfiles to apply patches
     echo "sourcedir=${srcrootdir}/${Section}
blfsfiles=${blfsBuildFiles}/${blfsfiles}" >> $Output
    ;;
    firewall) # no source file
     cat >> $Output << "EOF"
starttime=$( date +%s )
EOF
    ;;
    python3) # include the version
      echo "sourcedir=${srcrootdir}/${Section}
Python3vers=$Python3vers" >> $Output
    ;;
    xulrunner) # source is firefox - i.e. /blfs-sources/browser
      echo "sourcedir=${srcrootdir}/browser" >> $Output
    ;;
    *)
      echo "sourcedir=${srcrootdir}/${Section}" >> $Output
    ;;
  esac
# end defining sourcedir
else # building as root
  echo "starttime=\$( date +%s )" >> $Output
  cat >> $Output << "EOF"
CreateBuildDirasroot ${PkgUserDir}/${PkgName}
EOF
  if [[ "$Section" == x || "$pkgname" == libdrm || "$pkgname" == freeglut ]]; then
    echo "source /etc/profile.d/xorg.sh" >> $Output
  fi
fi # end as_root
# add a function to set up the proxy values on the LFS machine
# ** TODO ** make this available only where it's needed
setproxy >> $Output
echo "setproxy" >> $Output
# case to unpack sources
case $pkgname in
  cacerts)
     cat >> $Output << "EOF"
starttime=$( date +%s )
EOF
  ;;
  firewall) # don't need to unpack sources
     :
  ;;
  *)
unpack >> $Output
cat >> $Output << "EOF"
unpack
if [ "$?" -eq 1 ]; then # unpack failed so abort
  echo "Failed to unpack source for package $pkgname. Exiting now."
  exit 1
fi
EOF
  case $pkgname in # need to set up some env variables if building as root
    $xproto|$xlib|$xapp|$xfont)
      cursec=${pkgname//x7/}
echo "cursec=$cursec" >> $Output
    ;;
    php)
      echo "curdir=\$( echo \$PWD )" >> $Output
      php_setup >> $Output
      cat >> $Output << "EOF"
php_setup
EOF
    ;;
    *)
      echo "curdir=\$( echo \$PWD )" >> $Output
      case $pkgname in
         avahi|vlc)
            echo "source /etc/profile.d/qt.sh" >> $Output
         ;;
         apache-ant|icedtea-web)
            echo "source /etc/profile.d/openjdk.sh" >> $Output
            if $as_root; then
              echo "export PATH=\$PATH:/opt/jdk/bin" >> $Output
            fi
         ;;
         py2-atspi|py3-atspi)
            echo "srcdir=\$( echo \$curdir | awk -F\\/ '{print \$NF}')" >> $Output
         ;;
      esac
    ;;
  esac
  ;;
esac
# end case unpacking sources
WriteScript
closefunction
} # end of Function
#
closefunction () {
case $pkgname in
  aspell)  # install a dictionary (english by default)
    cat >> $Output << "EOF"
cd ..
language="aspell6-en"
dictionary="${language}-7.1-0.tar.bz2"
EOF
    cat >> $Output << "EOF"
wgetopts="-e use_proxy=yes -e http_proxy=$http_proxy -e ftp_proxy=$ftp_proxy"
if [ ! -e $dictionary ]; then
  wget $wgetopts ftp://ftp.gnu.org/gnu/aspell/dict/en/${dictionary}
fi
cd $(tar vxf ${language}*.tar.*z* | awk -F\/ 'END{print $1}')
dictdir=$( echo $PWD )
./configure
make
make install
#end install dict
EOF
  ;;
  gimp) # install the help file
    cat >> $Output << "EOF"
cd ..
cd $(tar vxf ${SrcName}help*.tar.*z* | awk -F\/ 'END{print $1}')
helpdir=$( echo $PWD )
./configure --prefix=/usr
sed -i -e 's/ca da de el en en_GB es fi fr hr it ja ko lt nl nn pl ru sl sv zh_CN/en/' \
       -e 's/ca de el en fi fr it ja ko ru sv zh_CN/en/' Makefile
sed -i -e 's/ca da de el en en_GB es fi fr hr it ja ko lt nl nn pl ru sl sv zh_CN/en/' \
       -e 's/ca de el en fi fr it ja ko ru sv zh_CN/en/' quickreference/Makefile
make
make install
EOF
  ;;
esac
case $pkgname in
    blfs-btscrpts)
      if $as_root; then
        echo 'touch ${PkgUserDir}/${PkgName}/.${bsToInstall}' >> $Output
      else
        echo 'touch ~/.${bsToInstall}' >> $Output
      fi
    ;;
    $xproto|$xlib|$xapp|$xfont)
      if $as_root; then
        echo 'set +e
touch ${PkgUserDir}/${PkgName}/.${PkgName}' >> $Output
      else
        echo "set +
touch ~/.${pkgname}" >> $Output
      fi
    ;;
    udev) # need to know when udev-extras has been installed
      if $as_root; then
        echo 'touch ${PkgUserDir}/${PkgName}/.${PkgName}_extras' >> $Output
      else
        echo "touch ~/.${pkgname}_extras" >> $Output
      fi
    ;;
    systemd) # need to know when systemd with gudev has been installed
      if $as_root; then
        echo 'touch ${PkgUserDir}/${PkgName}/.${PkgName}_gudev' >> $Output
      else
        echo "touch ~/.${pkgname}_gudev" >> $Output
      fi
    ;;
    *)
      if $as_root; then
        echo 'touch ${PkgUserDir}/${PkgName}/.${PkgName}' >> $Output
      else
        echo "touch ~/.${pkgname}" >> $Output
      fi
    ;;
esac
cat >> $Output << "EOF"
endtime=$( date +%s )
EOF
case $pkgname in
  aspell) # delete the dictionary dir as well
     delSrcFile >> $Output
     echo "if [ -e \$dictdir ]; then rm -rf \$dictdir; fi" >> $Output
  ;;
  avr-binutils)
     delSrcFile >> $Output
     echo "rm -rf binutils-build" >> $Output
  ;;
  avr-gcc)
     delSrcFile >> $Output
     echo "rm -rf gcc-build" >> $Output
  ;;
  blfs-btscrpts|cacerts|firewall|java-hamcrest|$xapp|$xfont|$xlib|$xproto|xterm)
     : # don't delete any files
  ;;
  gimp) # delete the help dir as well
     delSrcFile >> $Output
     echo "if [ -e \$helpdir ]; then rm -rf \$helpdir; fi" >> $Output
  ;;
  mesalib) # delete the glu dir as well
     delSrcFile >> $Output
     echo "if [ -e \$gludir ]; then rm -rf \$gludir; fi" >> $Output
  ;;
  py2-atspi|py3-atspi)
     delSrcFile >> $Output
     echo "rm -rf python*" >> $Output
  ;;
  webkitgtk) # unset CPPFLAGS as well (suppress warnings in gcc-4.8.0)
     delSrcFile >> $Output
     echo "unset CPPFLAGS" >> $Output
  ;;
  *)
     delSrcFile >> $Output
  ;;
esac
cat >> $Output << "EOF"
elapsedtime=$( expr $endtime - $starttime )
echo "${PkgName} $unpacktime $elapsedtime" >> $BuildLog
EOF
if ! $as_root; then
echo "IPS" >> $Output
setuplinks # setup any preprocessing commands - then test doFirst and links
if [[ ! -z $doFirst || ! -z $links ]]; then resolvelinks; fi # not null
if [ "$pkgname" = evolution ]; then # write out the functions to get version #
float_test
evolutionVersion
fi
cat >> $Output << "EOF"
if [ "$(grep -q ^$PkgName\: /etc/passwd;echo $?)" != 0 ]; then
  if [ "$(grep -q ^install3\: /etc/group;echo $?)" = 0 ]; then # install3 exists
    numcharInstall install3
    if [ $numchars -gt 2030 ]; then
      echo "You'll have to make yet another install group - install4"
      echo "Update /usr/sbin/installpkg as before"
      exit 1
    fi
  elif [ "$(grep -q ^install2\: /etc/group;echo $?)" = 0 ]; then
    numcharInstall install2
    if [ $numchars -gt 2030 ]; then
      echo "Install2 has nearly reached the limit of 2048 chars"
      echo "Make another install group - install3, in /etc/group"
      echo "Update /usr/sbin/installpkg to use install3"
      exit 1
    fi
  else
    numcharInstall install
    if [ $numchars -gt 2030 ]; then # limit of 2048. Create a new install group
      echo "install group has nearly reached the limit of 2048 chars"
      echo "create a new install group called install2. To do this, edit"
      echo "/etc/group and insert install2:x:9999:"
      echo "Then change install in /usr/sbin/installpkg to install2"
      echo "You'll find it at the end of the useradd line."
      exit 1
    fi
  fi
EOF
case $pkgname in
  apache)
   cat >> $Output << "EOF"
    installpkg $PkgName $cursection 25
EOF
  ;;
  colord)
   cat >> $Output << "EOF"
    installpkg $PkgName $cursection 71
EOF
  ;;
  mysql)
   cat >> $Output << "EOF"
    installpkg $PkgName $cursection 40
EOF
  ;;
  avahi)
   cat >> $Output << "EOF"
    installpkg $PkgName $cursection 84
EOF
  ;;
  gdm)
   cat >> $Output << "EOF"
    installpkg $PkgName $cursection 21
EOF
  ;;
  *)
   cat >> $Output << "EOF"
    installpkg $PkgName $cursection
EOF
  ;;
esac
cat >> $Output << "EOF"
fi
EOF
if [[ "$pkgname" == nautilus || "$pkgname" == gcr || "$pkgname" == brasero ]]; then
echo "setMime $pkgname # need to own everything under /usr/share/mime" >> $Output
fi
if [[ ! -z $doFirst || ! -z $links ]]; then # preprocessing
cat >> $Output << "EOF"
resolvelinks
EOF
fi
cat >> $Output << "EOF"
su $PkgName
EOF
case $pkgname in
   blfs-btscrpts)
    cat >> $Output << "EOF"
if [ ! -e $PkgUserDir/$PkgName/.$bsToInstall ]; then
  echo "${bsToInstall} failed"
  exit 1
fi
EOF
   ;;
   *)
cat >> $Output << "EOF"
if [ ! -e $PkgUserDir/$PkgName/.$PkgName ]; then
  echo "${PkgName} failed"
  exit 1
fi
EOF
   ;;
esac
cat >> $Output << "EOF"
ldconfig
EOF
echo "chown \$PkgName:\$PkgName \${PkgUserDir}/\${PkgName}/$build" >> $Output
# evolution now installed so get the version #
if [ "$pkgname" = evolution ]; then
cat >> $Output << "EOF"
evolutionVersion
EOF
fi
#
#set required dirs to be install dirs if installing as a package user 
#
case $pkgname in
    aisleriot)
          cat >> $Output << "EOF"
chgrp install /usr/share/help/eu
chmod g+w,o+t /usr/share/help/eu
chgrp install /usr/share/help/en_GB
chmod g+w,o+t /usr/share/help/en_GB
chgrp install /usr/share/help/oc
chmod g+w,o+t /usr/share/help/oc
chgrp install /usr/share/help/zh_CN
chmod g+w,o+t /usr/share/help/zh_CN
EOF
    ;;
    alsa-lib)
           cat >> $Output << "EOF"
chgrp install /usr/lib/alsa-lib
chmod g+w,o+t /usr/lib/alsa-lib
chgrp install /usr/share/alsa
chmod g+w,o+t /usr/share/alsa
EOF
    ;;
    alsa-utils)
           cat >> $Output << "EOF"
chgrp install /usr/share/sounds
chmod g+w,o+t /usr/share/sounds
if [ -d /usr/lib/udev ]; then
  chgrp install /usr/lib/udev
  chmod g+w,o+t /usr/lib/udev
  chgrp install /usr/lib/udev/rules.d
  chmod g+w,o+t /usr/lib/udev/rules.d
fi
if [ -d /usr/lib/systemd/system/basic.target.wants ]; then
  chgrp install /usr/lib/systemd/system/basic.target.wants
  chmod g+w,o+t /usr/lib/systemd/system/basic.target.wants
fi
if [ -e /usr/lib/systemd/system/alsa-restore.service ]; then
  sed -i 's/oneshop/oneshot/' /usr/lib/systemd/system/alsa-restore.service
fi
if [ ! -d /var/lib/alsa ]; then
  install -v -m0755 -d /var/lib/alsa
  chown alsa-utils:alsa-utils /var/lib/alsa
fi
if [ "$SYSTEMD" = yes ]; then
  if [ ! -d /etc/pm/sleep.d ]; then install -v -m0755 -d /etc/pm/sleep.d; fi
  install -D -m755 ${blfsfiles}/conf-files/90alsa /etc/pm/sleep.d/90alsa
  chown alsa-utils:alsa-utils /etc/pm/sleep.d/90alsa
fi
EOF
    ;;
    apache)
           cat >> $Output << "EOF"
chgrp install /usr/lib/httpd/modules
chmod g+w,o+t /usr/lib/httpd/modules
EOF
    ;;
    apr) # /usr/include/apr-1
          cat >> $Output << "EOF"
chgrp install /usr/include/apr-1 #for apr-util
chmod g+w,o+t /usr/include/apr-1
chgrp install /srv
chmod g+w,o+t /srv
chgrp install /var/log
chmod g+w,o+t /var/log
EOF
    ;;
    archive-zip)  #perl
echo "case \$(uname -m) in
   x86_64) archi=x86_64-linux
   ;;
   *)      archi=i686-linux
   ;;
esac
chgrp install /usr/lib/perl5/site_perl/${perlvers}/\$archi/auto
chmod g+w,o+t /usr/lib/perl5/site_perl/${perlvers}/\$archi/auto" >> $Output
    ;;
    aspell)
          cat >> $Output << "EOF"
echo "*************************************************************"
echo "*                                                           *"
echo "* English dictionary installed - edit script to change this *"
echo "*                                                           *"
echo "*************************************************************"
EOF
    ;;
    at-spi2-atk)
          cat >> $Output << "EOF"
chgrp install /usr/lib/gnome-settings-daemon-3.0
chmod g+w,o+t /usr/lib/gnome-settings-daemon-3.0
chgrp install /usr/lib/gnome-settings-daemon-3.0/gtk-modules
chmod g+w,o+t /usr/lib/gnome-settings-daemon-3.0/gtk-modules
chgrp install /usr/lib/gtk-2.0
chmod g+w,o+t /usr/lib/gtk-2.0
chgrp install /usr/lib/gtk-2.0/modules
chmod g+w,o+t /usr/lib/gtk-2.0/modules
EOF
    ;;
    at-spi2-core)
          cat >> $Output << "EOF"
chgrp install /etc/xdg
chmod g+w,o+t /etc/xdg
chgrp install /etc/xdg/autostart # for polkit-gnome
chmod g+w,o+t /etc/xdg/autostart
EOF
    ;;
    attr)   #/usr/include/sys
          cat >> $Output << "EOF"
chgrp install /usr/include/sys # for acl
chmod g+w,o+t /usr/include/sys
EOF
    ;;
    avahi)
           cat >> $Output << "EOF"
chgrp install /usr/share/applications
chmod g+w,o+t /usr/share/applications
EOF
    ;;
    babl) # /usr/share/gtk-doc/html
          cat >> $Output << "EOF"
chgrp install /usr/share/gtk-doc
chmod g+w,o+t /usr/share/gtk-doc
chgrp install /usr/share/gtk-doc/html # for gnutls
chmod g+w,o+t /usr/share/gtk-doc/html
EOF
    ;;
    baobab)
          cat >> $Output << "EOF"
chgrp install /usr/share/help/*
chmod g+w,o+t /usr/share/help/*
chown rarian:rarian /usr/share/help/rarian.document
chmod 644 /usr/share/help/rarian.document
sed -i '/MimeType/d' /usr/share/applications/baobab.desktop
EOF
    ;;
    bind)
          cat >> $Output << "EOF"
mknod /srv/named/dev/null c 1 3
mknod /srv/named/dev/random c 1 8
chmod 666 /srv/named/dev/{null,random}
EOF
    ;;
    brasero)
          cat >> $Output << "EOF"
chgrp install /usr/lib/nautilus/extensions-3.0
chmod g+w,o+t /usr/lib/nautilus/extensions-3.0
chgrp install /usr/share/mime/packages
chmod g+w,o+t /usr/share/mime/packages
EOF
    ;;
    clutter)
          cat >> $Output << "EOF"
chgrp install /usr/include/clutter-1.0
chmod g+w,o+t /usr/include/clutter-1.0
EOF
    ;;
    colord)
           cat >> $Output << "EOF"
chgrp install /usr/include/colord-1 # for colord-gtk
chmod g+w,o+t /usr/include/colord-1
EOF
    ;;
    consolekit)
          cat >> $Output << "EOF"
chgrp install /usr/share/dbus-1/interfaces # for upower
chmod g+w,o+t /usr/share/dbus-1/interfaces
EOF
    ;;
    cups)
           cat >> $Output << "EOF"
chgrp install /usr/lib/cups/driver # for gutenprint
chmod g+w,o+t /usr/lib/cups/driver
chgrp install /usr/lib/cups/filter
chmod g+w,o+t /usr/lib/cups/filter
chgrp install /usr/share/cups
chmod g+w,o+t /usr/share/cups
chgrp install /usr/share/cups/model # for ghostscript
chmod g+w,o+t /usr/share/cups/model
chgrp install /usr/share/cups/data # for cups-filters
chmod g+w,o+t /usr/share/cups/data
chgrp install /usr/share/cups/drv
chmod g+w,o+t /usr/share/cups/drv
chgrp install /usr/share/cups/ppdc
chmod g+w,o+t /usr/share/cups/ppdc
chgrp install /etc/cups
chmod g+w,o+t /etc/cups
chgrp install /usr/lib/cups/backend
chmod g+w,o+t /usr/lib/cups/backend # for samba symlink smb
cat > /etc/cups/printers.conf << "EOFCUPS"
# Printer configuration file for CUPS v1.6.1
# Written by cupsd
# DO NOT EDIT THIS FILE WHEN CUPSD IS RUNNING
<Printer Dell_3130cn_Color_Laser>
UUID urn:uuid:051a0c0e-3e62-3936-7af9-0e901f7d8cfd
Info Dell 3130cn Color Laser
Location main
MakeModel Dell 3130cn Foomatic/pxlcolor (recommended)
DeviceURI usb://Dell/3130cn%20Color%20Laser?serial=0932091440
State Idle
StateTime 1361307988
Type 8400924
Accepting Yes
Shared Yes
JobSheets none none
QuotaPeriod 0
PageLimit 0
KLimit 0
OpPolicy default
ErrorPolicy retry-job
</Printer>
EOFCUPS
# change ownership of cups files as needed
chown root:lp /etc/cups/printers.conf
chmod 600 /etc/cups/printers.conf
chown root:lp /etc/cups/cupsd.conf
chown root:lp /etc/cups/cupsd.conf.default
chown root:lp /etc/cups/interfaces
chown root:lp /etc/cups/ppd
chown root:lp /etc/cups/snmp.conf
chown root:lp /etc/cups/ssl
chown lp:lpadmin /run/cups/certs
chown root:lp /var/cache/cups
chown root:lp /var/cache/cups/rss
chown root:lp /var/spool/cups
chown root:lp /var/spool/cups/*
chown root /usr/sbin/cupsd
chown root /usr/lib/cups/cgi-bin/*.cgi
chown root /usr/lib/cups/filter/{commandtops,pstops}
chown root /usr/lib/cups/notifier/dbus
chown root /usr/lib/cups/backend/usb
if [ "$SYSTEMD" = yes ]; then
cat > /etc/udev/rules.d/10-local.rules << "RULESEOF"
SUBSYSTEM=="usb", ATTRS{idVendor}=="413c", ATTRS{idProduct}=="5603", GROUP="lp", MODE:="664"
RULESEOF
fi
EOF
    ;;
    cups-filters)
           cat >> $Output << "EOF"
chown root /usr/lib/cups/backend
chmod 755  /usr/lib/cups/backend
chown root /usr/lib/cups/filter/{bannertopdf,pdftopdf,pdftops,pstopdf}
EOF
    ;;
    cvs) #/opt /etc/profile.d/extrapaths.sh
          cat >> $Output << "EOF"
chgrp install /opt
chmod g+w,o+t /opt
chgrp install /etc/profile.d
chmod g+w,o+t /etc/profile.d
chgrp install /etc/profile.d/extrapaths.sh
chmod 664 /etc/profile.d/extrapaths.sh
chgrp install /etc/ld.so.conf
chmod 664 /etc/ld.so.conf
EOF
    ;;
    cyrus-sasl)
       if [ "$SYSTEMD" = yes ]; then
          cat >> $Output << "EOF"
install -Dm644 ${blfsfiles}/conf-files/saslauthd.conf.d /etc/conf.d/saslauthd
install -Dm644 ${blfsfiles}/service/saslauthd.service /usr/lib/systemd/system/saslauthd.service
install -Dm644 ${blfsfiles}/conf-files/sastmpfiles.conf /usr/lib/tmpfiles.d/saslauthd.conf
chown cyrus-sasl:cyrus-sasl {/etc/conf.d/saslauthd,/usr/lib/{systemd/system/saslauthd.service,tmpfiles.d/saslauthd.conf}}
EOF
       fi
    ;;
    dbus)
          cat >> $Output << "EOF"
chgrp install /usr/lib/dbus-1.0
chmod g+w,o+t /usr/lib/dbus-1.0
chgrp install /usr/include/dbus-1.0/dbus
chmod g+w,o+t /usr/include/dbus-1.0/dbus
chgrp install /etc/dbus-1/system.d
chmod g+w,o+t /etc/dbus-1/system.d
chgrp install /usr/share/dbus-1
chmod g+w,o+t /usr/share/dbus-1
chgrp install /usr/share/dbus-1/services
chmod g+w,o+t /usr/share/dbus-1/services
chgrp install /usr/share/dbus-1/system-services
chmod g+w,o+t /usr/share/dbus-1/system-services
chown root:messagebus /usr/lib/dbus-1.0/dbus-daemon-launch-helper
chmod 4750 /usr/lib/dbus-1.0/dbus-daemon-launch-helper  # set uid root binary
dbus-uuidgen --ensure # generate the dbus uuid
EOF
    ;;
    dconf)
          cat >> $Output << "EOF"
chgrp install /usr/share/applications
chmod g+w,o+t /usr/share/applications
chgrp install /usr/share/icons/HighContrast
chmod g+w,o+t /usr/share/icons/HighContrast
for req in 16 22 24 32 48 256; do
chgrp install /usr/share/icons/HighContrast/${req}x${req}
chmod g+w,o+t /usr/share/icons/HighContrast/${req}x${req}
chgrp install /usr/share/icons/HighContrast/${req}x${req}/apps
chmod g+w,o+t /usr/share/icons/HighContrast/${req}x${req}/apps
done
EOF
    ;;
    docbook-xml)
          cat >> $Output << "EOF"
chgrp install /usr/share/xml/docbook
chmod g+w,o+t /usr/share/xml/docbook
chgrp install /etc/xml/catalog
chgrp install /etc/xml/docbook
chmod 664 /etc/xml/catalog
chmod 664 /etc/xml/docbook
EOF
    ;;
    eog)
          cat >> $Output << "EOF"
chgrp install /usr/share/help/th # for gedit
chmod g+w,o+t /usr/share/help/th
EOF
    ;;
    epiphany)
          cat >> $Output << "EOF"
chgrp install /usr/share/epiphany
chmod g+w,o+t /usr/share/epiphany
EOF
    ;;
    evince)
          cat >> $Output << "EOF"
chgrp install /usr/lib/nautilus/extensions-3.0 # in case brasero not installed
chmod g+w,o+t /usr/lib/nautilus/extensions-3.0
EOF
    ;;
    evolution)
          cat >> $Output << "EOF"
chgrp install /usr/lib/evolution/$evolVers/plugins
chmod g+w,o+t /usr/lib/evolution/$evolVers/plugins
chgrp install /usr/share/help/mk
chmod g+w,o+t /usr/share/help/mk
EOF
    ;;
    exo)
          cat >> $Output << "EOF"
chgrp install /usr/share/xfce4
chmod g+w,o+t /usr/share/xfce4
EOF
    ;;
    extutls-dpnds)
echo "case \$(uname -m) in
   x86_64) archi=x86_64-linux
   ;;
   *)      archi=i686-linux
   ;;
esac
chgrp install /usr/lib/perl5/site_perl/${perlvers}/ExtUtils
chmod g+w,o+t /usr/lib/perl5/site_perl/${perlvers}/ExtUtils
chgrp install /usr/lib/perl5/site_perl/${perlvers}/\$archi/auto/ExtUtils
chmod g+w,o+t /usr/lib/perl5/site_perl/${perlvers}/\$archi/auto/ExtUtils" >> $Output
    ;;
    faad2)
          cat >> $Output << "EOF"
chgrp install /usr/share/man/manm
chmod g+w,o+t /usr/share/man/manm
EOF
    ;;
    file-roller)
          cat >> $Output << "EOF"
chgrp install /usr/lib/nautilus/extensions-3.0
chmod g+w,o+t /usr/lib/nautilus/extensions-3.0
EOF
    ;;
    fontconfig)
          cat >> $Output << "EOF"
chgrp install /usr/share/xml # for iso-codes
chmod g+w,o+t /usr/share/xml
chgrp install /usr/share/fontconfig/conf.avail
chmod g+w,o+t /usr/share/fontconfig/conf.avail
chgrp install /etc/fonts
chmod g+w,o+t /etc/fonts
chgrp install /etc/fonts/conf.d # for xfont
chmod g+w,o+t /etc/fonts/conf.d
EOF
    ;;
    foomatic)
          cat >> $Output << "EOF"
chown root /usr/lib/cups/backend
chmod 755  /usr/lib/cups/backend
chown root /usr/lib/cups/filter
chmod 755  /usr/lib/cups/filter
chown root /usr/bin/foomatic-rip
EOF
    ;;
    freetype) #/var/cache
          cat >> $Output << "EOF"
chgrp install /var/cache
chmod g+w,o+t /var/cache
chgrp install /usr/lib/udev
chmod g+w,o+t /usr/lib/udev
EOF
echo "case \$(uname -m) in
   x86_64) archi=x86_64-linux
   ;;
   *)      archi=i686-linux
   ;;
esac
chgrp install /usr/lib/perl5/${perlvers}/\$archi
chmod g+w,o+t /usr/lib/perl5/${perlvers}/\$archi
chgrp install /usr/lib/perl5/site_perl/${perlvers}
chmod g+w,o+t /usr/lib/perl5/site_perl/${perlvers}
chgrp install /usr/lib/perl5/site_perl/${perlvers}/\$archi
chmod g+w,o+t /usr/lib/perl5/site_perl/${perlvers}/\$archi" >> $Output
    ;;
    garcon)
           cat >> $Output << "EOF"
chgrp install /etc/xdg
chmod g+w,o+t /etc/xdg
chgrp install /etc/xdg/menus
chmod g+w,o+t /etc/xdg/menus
EOF
    ;;
    gconf)
          cat >> $Output << "EOF"
chgrp install /etc/gconf
chmod g+w,o+t /etc/gconf
chgrp install /etc/gconf/gconf.xml.defaults
chmod g+w,o+t /etc/gconf/gconf.xml.defaults
EOF
    ;;
    gcr)
          cat >> $Output << "EOF"
chgrp install /usr/share/GConf
chmod g+w,o+t /usr/share/GConf
chgrp install /usr/share/GConf/gsettings
chmod g+w,o+t /usr/share/GConf/gsettings
chgrp install /usr/lib/gnome-keyring
chmod g+w,o+t /usr/lib/gnome-keyring
EOF
    ;;
    gdk-pixbuf)
          cat >> $Output << "EOF"
chgrp install /usr/lib/gdk-pixbuf-2.0/2.10.0/loaders # for librsvg
chmod g+w,o+t /usr/lib/gdk-pixbuf-2.0/2.10.0/loaders
EOF
    ;;
    gdm)
          cat >> $Output << "EOF"
if [ "$SYSTEMD" = no ]; then
  usermod -a -G audio gdm
  usermod -a -G video gdm
fi
if [ -e /etc/inittab ]; then
  sed -i 's/id:3:initdefault:/id:5:initdefault:/' \
    /etc/inittab
fi
EOF
    ;;
    gedit)
          cat >> $Output << "EOF"
chgrp install /usr/share/help/ar
chmod g+w,o+t /usr/share/help/ar
chgrp install /usr/share/help/bg
chmod g+w,o+t /usr/share/help/bg
chgrp install /usr/share/help/cs
chmod g+w,o+t /usr/share/help/cs
chgrp install /usr/share/help/da
chmod g+w,o+t /usr/share/help/da
chgrp install /usr/share/help/ko
chmod g+w,o+t /usr/share/help/ko
chgrp install /usr/share/help/th
chmod g+w,o+t /usr/share/help/th
chgrp install /usr/share/help/uk
chmod g+w,o+t /usr/share/help/uk
EOF
    ;;
    gimp)
          cat >> $Output << "EOF"
gtk-update-icon-cache
update-desktop-database
chgrp install /usr/lib/gimp/2.0/plug-ins
chmod g+w,o+t /usr/lib/gimp/2.0/plug-ins
chgrp install /usr/share/applications
chmod g+w,o+t /usr/share/applications
EOF
    ;;
    git)
          cat >> $Output << "EOF"
cat > /root/.gitconfig << "GITEOF"
[user]
	name = John Burrell
	email = John_burrell@hotmail.com
[core]
	autocrlf = false
	filemode = false
GITEOF
git config --global http.sslCAPath /etc/ssl/certs
chgrp install /usr/share/locale/pt_PT
chmod g+w,o+t /usr/share/locale/pt_PT
install -D -m 644 ${blfsfiles}/service/git-daemon@.service /usr/lib/systemd/system/git-daemon@.service
install -D -m 644 ${blfsfiles}/service/git-daemon.socket /usr/lib/systemd/system/git-daemon.socket
chown git:git /usr/lib/systemd/system/git-daemon*
EOF
    ;;
    glib)
          cat >> $Output << "EOF"
chgrp install /usr/share/glib-2.0/schemas
chmod g+w,o+t /usr/share/glib-2.0/schemas
chgrp install /usr/lib/gio/modules # for dconf
chmod g+w,o+t /usr/lib/gio/modules
chgrp install /usr/share/bash-completion/completions
chmod g+w,o+t /usr/share/bash-completion/completions
EOF
    ;;
    gnm-thems-stndrd)
           cat >> $Output << "EOF"
chgrp install /usr/share/icons/HighContrast/scalable/apps
chmod g+w,o+t /usr/share/icons/HighContrast/scalable/apps
EOF
    ;;
    gnm-user-share)
           cat >> $Output << "EOF"
chgrp install /usr/lib/nautilus/extensions-3.0
chmod g+w,o+t /usr/lib/nautilus/extensions-3.0
EOF
    ;;
    gnome-bckgrnds)
           cat >> $Output << "EOF"
chgrp install /usr/share/gnome-background-properties
chmod g+w,o+t /usr/share/gnome-background-properties
EOF
    ;;
    gnome-bluetooth)
          cat >> $Output << "EOF"
chgrp install /usr/lib/gnome-bluetooth/plugins
chmod g+w,o+t /usr/lib/gnome-bluetooth/plugins
chgrp install /usr/share/help/ro
chmod g+w,o+t /usr/share/help/ro
chgrp install /usr/share/help/th
chmod g+w,o+t /usr/share/help/th
chgrp install /usr/share/help/zh_HK
chmod g+w,o+t /usr/share/help/zh_HK
chgrp install /usr/share/help/zh_TW
chmod g+w,o+t /usr/share/help/zh_TW
/usr/bin/update-desktop-database /usr/share/applications
EOF
    ;;
    gnome-desktop)
          cat >> $Output << "EOF"
chgrp install /usr/share/help/* # for gnome-user-docs
chmod g+w,o+t /usr/share/help/*
chgrp rarian /usr/share/help/rarian.document
chmod 644 /usr/share/help/rarian.document
EOF
    ;;
    gnome-doc-utils)
          cat >> $Output << "EOF"
chgrp install /usr/share/gnome
chmod g+w,o+t /usr/share/gnome
chgrp install /usr/share/gnome/help
chmod g+w,o+t /usr/share/gnome/help
EOF
    ;;
    gnome-games)
          cat >> $Output << "EOF"
chgrp install /usr/share/help/tr
chmod g+w,o+t /usr/share/help/tr
EOF
    ;;
    gnome-icon-thme)
          cat >> $Output << "EOF"
chgrp install /usr/share/icons/gnome
chmod g+w,o+t /usr/share/icons/gnome
chgrp install /usr/share/icons/gnome/{256x256,48x48,8x8}
chmod g+w,o+t /usr/share/icons/gnome/{256x256,48x48,8x8}
chgrp install /usr/share/icons/gnome/*/*
chmod g+w,o+t /usr/share/icons/gnome/*/*
EOF
    ;;
    gnome-menus)
          cat >> $Output << "EOF"
chgrp install /usr/share/desktop-directories
chmod g+w,o+t /usr/share/desktop-directories
chgrp install /etc/xdg/menus
chmod g+w,o+t /etc/xdg/menus
EOF
    ;;
    gnome-panel)
          cat >> $Output << "EOF"
chgrp install /usr/share/gnome-panel/4.0/applets
chmod g+w,o+t /usr/share/gnome-panel/4.0/applets
chgrp install /usr/share/help/pt
chmod g+w,o+t /usr/share/help/pt
EOF
    ;;
    gnome-session)
          cat >> $Output << "EOF"
chgrp install /usr/share/gnome-session/sessions
chmod g+w,o+t /usr/share/gnome-session/sessions
EOF
    ;;
    gnome-shell)
          cat >> $Output << "EOF"
chgrp install /usr/share/gnome-shell # if gnome-shell installed first
chmod g+w,o+t /usr/share/gnome-shell
chgrp install /usr/lib/mozilla/plugins
chmod g+w,o+t /usr/lib/mozilla/plugins
EOF
    ;;
    gnome-user-docs)
          cat >> $Output << "EOF"
chgrp install /usr/share/help/*
chmod g+w,o+t /usr/share/help/*
chown rarian:rarian /usr/share/help/rarian.document
chmod 644 /usr/share/help/rarian.document
EOF
    ;;
    gobject-intro)   #/usr/share/gir-1.0
          cat >> $Output << "EOF"
chgrp install /usr/share/gir-1.0 # for json-glib
chmod g+w,o+t /usr/share/gir-1.0
chgrp install /usr/lib/girepository-1.0
chmod g+w,o+t /usr/lib/girepository-1.0
EOF
    ;;
    gperf) # reset /usr/share/info/dir permissions
          cat >> $Output << "EOF"
chgrp install /usr/share/info/dir
chmod 664 /usr/share/info/dir
EOF
    ;;
    gstreamer)
           cat >> $Output << "EOF"
chgrp install /usr/include/gstreamer-1.0/gst # for plugins
chmod g+w,o+t /usr/include/gstreamer-1.0/gst
chgrp install /usr/lib/gstreamer-1.0
chmod g+w,o+t /usr/lib/gstreamer-1.0
EOF
    ;;
    gstreamer0)
          cat >> $Output << "EOF"
chgrp install /usr/include/gstreamer-0.10/gst # for plugins
chmod g+w,o+t /usr/include/gstreamer-0.10/gst
chgrp install /usr/lib/gstreamer-0.10
chmod g+w,o+t /usr/lib/gstreamer-0.10
EOF
    ;;
    gst-plgns-base)
           cat >> $Output << "EOF"
chgrp install /usr/include/gstreamer-1.0/gst/video
chmod g+w,o+t /usr/include/gstreamer-1.0/gst/video
chgrp install /usr/share/gst-plugins-base
chmod g+w,o+t /usr/share/gst-plugins-base
EOF
    ;;
    gst-plgns-base0)
           cat >> $Output << "EOF"
chgrp install /usr/include/gstreamer-0.10/gst/interfaces
chmod g+w,o+t /usr/include/gstreamer-0.10/gst/interfaces
chgrp install /usr/include/gstreamer-0.10/gst/video
chmod g+w,o+t /usr/include/gstreamer-0.10/gst/video
chgrp install /usr/share/gst-plugins-base
chmod g+w,o+t /usr/share/gst-plugins-base
EOF
    ;;
    gst-plgns-bad)
          cat >> $Output << "EOF"
chgrp install /usr/include/gstreamer-1.0/gst/interfaces
chmod g+w,o+t /usr/include/gstreamer-1.0/gst/interfaces
EOF
    ;;
    gst-plgns-good0)
          cat >> $Output << "EOF"
chgrp install /etc/gconf/schemas
chmod g+w,o+t /etc/gconf/schemas
EOF
    ;;
    gtk-doc)
          cat >> $Output << "EOF"
chgrp install /usr/share/help/*
chmod g+w,o+t /usr/share/help/*
if [ -e /usr/share/help/rarian.document ]; then
  chown rarian:rarian /usr/share/help/rarian.document
  chmod 644 /usr/share/help/rarian.document
fi
EOF
    ;;
    gtk-engines)
          cat >> $Output << "EOF"
chgrp install /usr/share/themes/Crux
chmod g+w,o+t /usr/share/themes/Crux
EOF
    ;;
    gtkplus3)
          cat >> $Output << "EOF"
chgrp install /usr/lib/gtk-3.0
chmod g+w,o+t /usr/lib/gtk-3.0
chgrp install /usr/lib/gtk-3.0/3.0.0 # for gnome-themes-standard
chmod g+w,o+t /usr/lib/gtk-3.0/3.0.0
chgrp install /usr/lib/gtk-3.0/3.0.0/immodules # for ibus
chmod g+w,o+t /usr/lib/gtk-3.0/3.0.0/immodules
EOF
    ;;
    gtkplus2)
          cat >> $Output << "EOF"
chgrp install /usr/share/themes
chmod g+w,o+t /usr/share/themes
chgrp install /usr/share/themes/Default
chmod g+w,o+t /usr/share/themes/Default
chgrp install /usr/share/themes/Emacs
chmod g+w,o+t /usr/share/themes/Emacs
chgrp install /usr/lib/gtk-2.0/2.10.0
chmod g+w,o+t /usr/lib/gtk-2.0/2.10.0
chgrp install /usr/lib/gtk-2.0/2.10.0/engines
chmod g+w,o+t /usr/lib/gtk-2.0/2.10.0/engines
chgrp install /usr/lib/gtk-2.0/modules
chmod g+w,o+t /usr/lib/gtk-2.0/modules
chgrp install /usr/lib/gtk-2.0/2.10.0/immodules # for ibus
chmod g+w,o+t /usr/lib/gtk-2.0/2.10.0/immodules
EOF
    ;;
    gutenprint)
          cat >> $Output << "EOF"
chown root /usr/lib/cups/driver
chmod 755  /usr/lib/cups/driver
chown root /usr/lib/cups/filter
chmod 755  /usr/lib/cups/filter
EOF
    ;;
    hcolr-icon-thme)
          cat >> $Output << "EOF"
chgrp install /usr/share/icons/hicolor
chmod g+w,o+t /usr/share/icons/hicolor
chgrp install /usr/share/icons/hicolor/*/apps
chmod g+w,o+t /usr/share/icons/hicolor/*/apps
chgrp install /usr/share/icons/hicolor/*/actions
chmod g+w,o+t /usr/share/icons/hicolor/*/actions
chgrp install /usr/share/icons/hicolor/*/mimetypes # for color-manager
chmod g+w,o+t /usr/share/icons/hicolor/*/mimetypes
chgrp install /usr/share/icons/hicolor/*/devices
chmod g+w,o+t /usr/share/icons/hicolor/*/devices
chgrp install /usr/share/icons/hicolor/*/status
chmod g+w,o+t /usr/share/icons/hicolor/*/status
chgrp install /usr/share/icons/hicolor/*/emblems
chmod g+w,o+t /usr/share/icons/hicolor/*/emblems
chgrp install /usr/share/icons/hicolor/*/categories
chmod g+w,o+t /usr/share/icons/hicolor/*/categories
chgrp install /usr/share/icons/hicolor/*/stock/navigation
chmod g+w,o+t /usr/share/icons/hicolor/*/stock/navigation
chgrp install /usr/share/icons/hicolor/*/stock/media
chmod g+w,o+t /usr/share/icons/hicolor/*/stock/media
EOF
    ;;
    ibus)
          cat >> $Output << "EOF"
chgrp install /etc/dconf/profile
chmod g+w,o+t /etc/dconf/profile
chgrp install /etc/dconf/db
chmod g+w,o+t /etc/dconf/db
EOF
    ;;
    icon-nam-utls) #/usr/share/pkgconfig
          cat >> $Output << "EOF"
chgrp install /usr/share/pkgconfig
chmod g+w,o+t /usr/share/pkgconfig
EOF
    ;;
    iso-codes)   #/usr/share/locale/LC_MESSAGES
           cat >> $Output << "EOF"
chgrp install /usr/share/pkgconfig # for usbutils
chmod g+w,o+t /usr/share/pkgconfig
chmod g+w,o+t /usr/share/locale/*/LC_MESSAGES
chgrp install /usr/share/xml # for docbook-xml
chmod g+w,o+t /usr/share/xml
EOF
    ;;
    java-hamcrest)
          cat >> $Output << "EOF"
chgrp install /usr/share/java
chmod g+w,o+t /usr/share/java
EOF
    ;;
    libatasmart)   #/usr/share/vala/vapi
          cat >> $Output << "EOF"
chgrp install /usr/share/vala # for vala
chmod g+w,o+t /usr/share/vala
chgrp install /usr/share/vala/vapi # for libgee
chmod g+w,o+t /usr/share/vala/vapi
EOF
    ;;
    libcanberra)
          cat >> $Output << "EOF"
chgrp install /usr/lib/gtk-3.0/modules
chmod g+w,o+t /usr/lib/gtk-3.0/modules
chgrp install /usr/share/gdm # for gdm
chmod g+w,o+t /usr/share/gdm
EOF
    ;;
    libcap)
          cat >> $Output << "EOF"
chmod -v 0755 /lib/libcap.so.2.22
EOF
    ;;
    libcdio)
          cat >> $Output << "EOF"
chgrp install /usr/share/man/jp
chmod g+w,o+t /usr/share/man/jp
EOF
    ;;
    libgnomekbd)
          cat >> $Output << "EOF"
chgrp install /usr/share/GConf/gsettings
chmod g+w,o+t /usr/share/GConf/gsettings
EOF
    ;;
    libgpg-error)   #/usr/share/common-lisp/source
          cat >> $Output << "EOF"
chgrp install /usr/share/common-lisp/source # for gpgme
chmod g+w,o+t /usr/share/common-lisp/source
EOF
    ;;
    libgsf)
          cat >> $Output << "EOF"
chgrp install /usr/share/thumbnailers
chmod g+w,o+t /usr/share/thumbnailers
EOF
    ;;
    libgweather)
          cat >> $Output << "EOF"
rm /etc/gconf/gconf.xml.defaults/*
chgrp install /usr/share/icons/gnome
chmod g+w,o+t /usr/share/icons/gnome
chgrp install /usr/share/icons/gnome/*
chmod g+w,o+t /usr/share/icons/gnome/*
chgrp install /usr/share/icons/gnome/*/status
chmod g+w,o+t /usr/share/icons/gnome/*/status
EOF
    ;;
    libsigcpp)   #/usr/share/devhelp/books
         cat >> $Output << "EOF"
chgrp install /usr/share/devhelp # for devhelp
chmod g+w,o+t /usr/share/devhelp
chgrp install /usr/share/devhelp/books # for glibmm
chmod g+w,o+t /usr/share/devhelp/books
EOF
    ;;
    libxcb) # /usr/include/xcb
         cat >> $Output << "EOF"
chgrp install /usr/include/xcb
chmod g+w,o+t /usr/include/xcb
EOF
    ;;
    libxfce4ui)
          cat >> $Output << "EOF"
chgrp install /etc/xdg/xfce4
chmod g+w,o+t /etc/xdg/xfce4
chgrp install /etc/xdg/xfce4/xfconf/xfce-perchannel-xml
chmod g+w,o+t /etc/xdg/xfce4/xfconf/xfce-perchannel-xml
EOF
    ;;
    libxfce4util)
          cat >> $Output << "EOF"
chgrp install /usr/include/xfce4
chmod g+w,o+t /usr/include/xfce4
EOF
    ;;
    linux-pam)   #/etc/pam.d
         cat >> $Output << "EOF"
chown linux-pam:install /etc/pam.d
chmod g+w,o+t /etc/pam.d
chgrp install /usr/lib/security # for consolekit
chmod g+w,o+t /usr/lib/security
chgrp install /etc/security # for libpwquality
chmod g+w,o+t /etc/security
EOF
    ;;
    mutter)
           cat >> $Output << "EOF"
chgrp install /usr/share/gnome/wm-properties
chmod g+w,o+t /usr/share/gnome/wm-properties
chgrp install /usr/share/gnome-control-center
chmod g+w,o+t /usr/share/gnome-control-center
chgrp install /usr/share/gnome-control-center/keybindings
chmod g+w,o+t /usr/share/gnome-control-center/keybindings
EOF
    ;;
    nautilus)
          cat >> $Output << "EOF"
chgrp install /usr/lib/nautilus
chmod g+w,o+t /usr/lib/nautilus
chgrp install /usr/lib/nautilus/extensions-3.0
chmod g+w,o+t /usr/lib/nautilus/extensions-3.0
chgrp install /usr/share/gnome-shell
chmod g+w,o+t /usr/share/gnome-shell
chgrp install /usr/share/gnome-shell/search-providers
chmod g+w,o+t /usr/share/gnome-shell/search-providers
EOF
    ;;
    nautilus-sendto)
          cat >> $Output << "EOF"
if [ -e /usr/lib/nautilus-sendto/plugins ]; then
chgrp install /usr/lib/nautilus-sendto/plugins
chmod g+w,o+t /usr/lib/nautilus-sendto/plugins
fi
if [ -e /usr/lib/nautilus/extensions-3.0 ]; then
chgrp install /usr/lib/nautilus/extensions-3.0
chmod g+w,o+t /usr/lib/nautilus/extensions-3.0
fi
EOF
    ;;
    nmap)
          cat >> $Output << "EOF"
chgrp install /usr/share/man/jp/man1
chmod g+w,o+t /usr/share/man/jp/man1
if [ -e /usr/share/applications ]; then
  chgrp install /usr/share/applications
  chmod g+w,o+t /usr/share/applications
fi
EOF
    ;;
    openssh)
       if [ "$SYSTEMD" = yes ]; then
          cat >> $Output << "EOF"
install -Dm644 ${blfsfiles}/service/sshdgenkeys.service /usr/lib/systemd/system/sshdgenkeys.service
install -Dm644 ${blfsfiles}/service/sshd.service /usr/lib/systemd/system/sshd.service
install -Dm644 ${blfsfiles}/service/sshd.socket /usr/lib/systemd/system/sshd.socket
install -Dm644 ${blfsfiles}/service/sshd@.service /usr/lib/systemd/system/sshd@.service
install -Dm644 ${blfsfiles}/conf-files/sshd.conf /usr/lib/tmpfiles.d
chown openssh:openssh /usr/lib/systemd/system/sshd*
chown openssh:openssh /usr/lib/tmpfiles.d/sshd.conf
EOF
       fi
    ;;
    openssl)   #/usr/share/gtk-doc/html
          cat >> $Output << "EOF"
chgrp install /run # for linux-pam
chmod g+w,o+t /run
chgrp install /etc/ssl # for cacerts
chmod g+w,o+t /etc/ssl
chgrp install /etc/ssl/certs
chmod g+w,o+t /etc/ssl/certs
EOF
    ;;
    p11-kit)
          cat >> $Output << "EOF"
chgrp install /usr/share/gtk-doc/html # for gegl
chmod g+w,o+t /usr/share/gtk-doc/html
chgrp install /usr/share/p11-kit/modules # for gnome-keyring
chmod g+w,o+t /usr/share/p11-kit/modules
chgrp install /usr/lib/pkcs11
chmod g+w,o+t /usr/lib/pkcs11
chgrp install /etc/pkcs11
chmod g+w,o+t /etc/pkcs11
EOF
    ;;
    pango)
          cat >> $Output << "EOF"
chgrp install /etc/pango # for pangox-compat
chmod g+w,o+t /etc/pango
chgrp install /usr/include/pango-1.0/pango
chmod g+w,o+t /usr/include/pango-1.0/pango
EOF
    ;;
    parole)
          cat >> $Output << "EOF"
chgrp install /usr/share/applications
chmod g+w,o+t /usr/share/applications
EOF
    ;;
    php)
          cat >> $Output << "EOF"
cat >> /etc/httpd/httpd.conf << "PHPEOF"
LoadModule php5_module /usr/lib/httpd/modules/libphp5.so
AddType application/x-httpd-php .php
AddType application/x-httpd-php-source .phps
PHPEOF
chown apache:apache /etc/httpd/httpd.conf
EOF
    ;;
    polkit)
          cat >> $Output << "EOF"
groupadd -fg 27 polkitd # dedicated user to take control of polkitd
useradd -c "PolicyKit Daemon Owner" -d /etc/polkit-1 -u 27 \
        -g polkitd -s /bin/false polkitd
chgrp install /usr/share/polkit-1/actions # for colord
chmod g+w,o+t /usr/share/polkit-1/actions
chown root /usr/lib/polkit-1/polkit-agent-helper-1
chmod 4755 /usr/lib/polkit-1/polkit-agent-helper-1
chown root /usr/bin/pkexec
chmod 4755 /usr/bin/pkexec
chown polkitd /etc/polkit-1/rules.d
chmod 700 /etc/polkit-1/rules.d
chown polkitd:install /usr/share/polkit-1/rules.d
chmod 1775 /usr/share/polkit-1/rules.d
chgrp install /etc/dbus-1 # for dbus
chmod g+w,o+t /etc/dbus-1
chgrp install /etc/dbus-1/system.d
chmod g+w,o+t /etc/dbus-1/system.d
chgrp install /usr/share/dbus-1 # for dbus
chmod g+w,o+t /usr/share/dbus-1
chgrp install /usr/share/dbus-1/system-services
chmod g+w,o+t /usr/share/dbus-1/system-services
EOF
    ;;
    py2cairo)
          cat >> $Output << "EOF"
chgrp install /usr/include/pycairo
chmod g+w,o+t /usr/include/pycairo
EOF
    ;;
    pygobject2)
          cat >> $Output << "EOF"
chgrp install /usr/lib/python2.7/site-packages/gi
chmod g+w,o+t /usr/lib/python2.7/site-packages/gi
chgrp install /usr/lib/python2.7/site-packages/gi/repository
chmod g+w,o+t /usr/lib/python2.7/site-packages/gi/repository
chgrp install /usr/lib/python2.7/site-packages/gi/overrides
chmod g+w,o+t /usr/lib/python2.7/site-packages/gi/overrides
chgrp install /usr/lib/python2.7/site-packages/gtk-2.0
chmod g+w,o+t /usr/lib/python2.7/site-packages/gtk-2.0
chgrp install /usr/include/pygtk-2.0
chmod g+w,o+t /usr/include/pygtk-2.0
EOF
    ;;
    py2-gobject3)
          cat >> $Output << "EOF"
chgrp install /usr/lib/python2.7/site-packages/gi
chmod g+w,o+t /usr/lib/python2.7/site-packages/gi
chgrp install /usr/lib/python2.7/site-packages/gi/overrides
chmod g+w,o+t /usr/lib/python2.7/site-packages/gi/overrides
chgrp install /usr/include/pygobject-3.0
chmod g+w,o+t /usr/include/pygobject-3.0
EOF
    ;;
    py3-gobject3)
          cat >> $Output << "EOF"
chgrp install /usr/lib/python3.3/site-packages/gi
chmod g+w,o+t /usr/lib/python3.3/site-packages/gi
chgrp install /usr/lib/python3.3/site-packages/gi/overrides
chmod g+w,o+t /usr/lib/python3.3/site-packages/gi/overrides
chgrp install /usr/lib/python3.3/site-packages/gi/overrides/__pycache__
chmod g+w,o+t /usr/lib/python3.3/site-packages/gi/overrides/__pycache__
EOF
    ;;
    pygtk)
          cat >> $Output << "EOF"
chgrp install /usr/share/pygtk/2.0/defs
chmod g+w,o+t /usr/share/pygtk/2.0/defs
EOF
    ;;
    python2)  #/usr/share/man
          cat >> $Output << "EOF"
chgrp install /usr/share/man
chmod g+w,o+t /usr/share/man
chgrp install /usr/lib/python2.7/site-packages #for python modules
chmod g+w,o+t /usr/lib/python2.7/site-packages
EOF
    ;;
    python3)  #/usr/share/man
          cat >> $Output << "EOF"
chgrp install /usr/lib/python3.3/site-packages #for python modules
chmod g+w,o+t /usr/lib/python3.3/site-packages
EOF
    ;;
    qt4) # needed to create /usr/tests, so put back to owner root
          cat >> $Output << "EOF"
chown root:root /usr
chmod 755 /usr
EOF
    ;;
    rarian)
           cat >> $Output << "EOF"
chgrp install /usr/share/help
chmod g+w,o+t /usr/share/help
EOF
    ;;
    ruby)
           cat >> $Output << "EOF"
chgrp install /usr/lib/ruby/site_ruby/2.0.0 # for subversion
chmod g+w,o+t /usr/lib/ruby/site_ruby/2.0.0
chgrp install /usr/lib/ruby/site_ruby/2.0.0/x86_64-linux
chmod g+w,o+t /usr/lib/ruby/site_ruby/2.0.0/x86_64-linux
chgrp install /usr/lib/ruby/vendor_ruby/2.0.0
chmod g+w,o+t /usr/lib/ruby/vendor_ruby/2.0.0
chgrp install /usr/lib/ruby/vendor_ruby/2.0.0/x86_64-linux
chmod g+w,o+t /usr/lib/ruby/vendor_ruby/2.0.0/x86_64-linux
EOF
    ;;
    samba)
          cat >> $Output << "EOF"
ln -v -sf /usr/bin/smbspool /usr/lib/cups/backend/smb
EOF
    ;;
    sgml-common)
          cat >> $Output << "EOF"
chgrp install /usr/share/sgml
chmod g+w,o+t /usr/share/sgml # for opensp
EOF
    ;;
    shadow)  #/bin/su, etc setuid root
           cat >> $Output << "EOF"
chown root /bin/{su,passwd}
chmod 4755 /bin/{su,passwd}
chown root /usr/bin/{chage,chfn,chsh,expiry,gpasswd,newgrp}
chmod 4755 /usr/bin/{chage,chfn,chsh,expiry,gpasswd,newgrp}
chgrp install /etc/pam.d/system-session
chmod 664 /etc/pam.d/system-session # consolekit adds to it
EOF
    ;;
    shrd-mime-info)
          cat >> $Output << "EOF"
chgrp install /usr/share/mime
chmod g+w,o+t /usr/share/mime
chgrp install /usr/share/mime/packages
chmod g+w,o+t /usr/share/mime/packages
EOF
    ;;
    subversion) # write the PYTHONPATH variable to profile.d
          cat >> $Output << "EOF"
echo "export PYTHONPATH=/usr/lib/svn-python" >> /etc/profile.d/python3.sh
if [ "$SYSTEMD" = yes ]; then
  install -D -m 644 ${blfsfiles}/service/svnserve.service /usr/lib/systemd/system/svnserve.service
  install -D -m 644 ${blfsfiles}/conf-files/svnserve.tmpfiles /usr/lib/tmpfiles.d/svnserve.conf
  install -D -m 644 ${blfsfiles}/conf-files/svnserve.conf /etc/conf.d/svnserve
  chown subversion:subversion /usr/lib/systemd/system/svnserve.service
  chown subversion:subversion /usr/lib/tmpfiles.d/svnserve.conf
  chown subversion:subversion /etc/conf.d/svnserve
fi
EOF
    ;;
    sudo)
          cat >> $Output << "EOF"
chown root /usr/bin/{sudo,sudoedit}
chmod 4111 /usr/bin/{sudo,sudoedit}
chown root /usr/lib/sudo/sudoers.so
chown root /etc/sudoers
chown root /etc/sudoers.d
chmod 444  /etc/sudoers
chown root /var/lib/sudo
# add your username to /etc/sudoers so you can sudo
sed -i 's/root ALL=(ALL) ALL/root ALL=(ALL) ALL\njohn ALL=(ALL) ALL/' /etc/sudoers
EOF
    ;;
    systemd)
          cat >> $Output << "EOF"
chgrp install /usr/share/dbus-1/interfaces # for upower
chmod g+w,o+t /usr/share/dbus-1/interfaces
chgrp install /usr/lib/systemd/system-sleep
chmod g+w,o+t /usr/lib/systemd/system-sleep
chgrp install /usr/share/polkit-1
chmod g+w,o+t /usr/share/polkit-1
chgrp install /usr/share/polkit-1/actions
chmod g+w,o+t /usr/share/polkit-1/actions
sed -i "/session   required    pam_unix.so/a session   optional    pam_systemd.so\nsession   optional    pam_loginuid.so" /etc/pam.d/system-session
EOF
    ;;
    tcl)   #/usr/share/man
         cat >> $Output << "EOF"
chgrp install /usr/share/man/mann
chmod g+w,o+t /usr/share/man/mann
chgrp install /usr/share/gdb/auto-load #for glib
chmod g+w,o+t /usr/share/gdb/auto-load
chgrp install /etc/bash_completion.d #for glib
chmod g+w,o+t /etc/bash_completion.d
EOF
    ;;
    telepathy-glib)
          cat >> $Output << "EOF"
chgrp install /usr/include/telepathy-1.0
chmod g+w,o+t /usr/include/telepathy-1.0
EOF
    ;;
    telepathy-logr)
          cat >> $Output << "EOF"
chgrp install /usr/lib/telepathy # for telepathy-mission-control
chmod g+w,o+t /usr/lib/telepathy
chgrp install /usr/share/telepathy/clients
chmod g+w,o+t /usr/share/telepathy/clients
EOF
    ;;
    thunar)
          cat >> $Output << "EOF"
chgrp install /usr/share/Thunar/sendto
chmod g+w,o+t /usr/share/Thunar/sendto
EOF
    ;;
    traceroute) # set suid root binary
          cat >> $Output << "EOF"
chown root /bin/traceroute
chmod 4755 /bin/traceroute
EOF
    ;;
    udev)
          cat >> $Output << "EOF"
chgrp install /usr/lib/udev/rules.d
chmod g+w,o+t /usr/lib/udev/rules.d
chgrp install /etc/udev
chmod g+w,o+t /etc/udev
EOF
    ;;
    upower)
          cat >> $Output << "EOF"
chgrp install /usr/share/dbus-1/interfaces
chmod g+w,o+t /usr/share/dbus-1/interfaces
EOF
    ;;
    usbutils) #/usr/share/pkgconfig
          cat >> $Output << "EOF"
chgrp install /usr/share/pkgconfig
chmod g+w,o+t /usr/share/pkgconfig
EOF
    ;;
    vala)
          cat >> $Output << "EOF"
chgrp install /usr/share/vala
chmod g+w,o+t /usr/share/vala
chgrp install /usr/share/vala-0.20/vapi
chmod g+w,o+t /usr/share/vala-0.20/vapi
EOF
    ;;
    vlc)
          cat >> $Output << "EOF"
gtk-update-icon-cache
update-desktop-database
chgrp install /usr/share/applications
chmod g+w,o+t /usr/share/applications
EOF
    ;;
    vte)
          cat >> $Output << "EOF"
chown root.utmp /usr/lib/vte-2.90/gnome-pty-helper
chmod g+s       /usr/lib/vte-2.90/gnome-pty-helper
EOF
    ;;
    $xapp)
           cat >> $Output << "EOF"
chgrp install /etc/X11
chmod g+w,o+t /etc/X11
chgrp install /usr/share/terminfo/x #for xterm
chmod g+w,o+t /usr/share/terminfo/x
EOF
    ;;
    xclock)
           cat >> $Output << "EOF"
chgrp install /etc/X11/app-defaults
chmod g+w,o+t /etc/X11/app-defaults
chgrp install /etc/sysconfig
chmod g+w,o+t /etc/sysconfig
EOF
    ;;
    xcursor-themes)
           cat >> $Output << "EOF"
chgrp install /usr/share/icons
chmod g+w,o+t /usr/share/icons
EOF
    ;;
    xfconf)
          cat >> $Output << "EOF"
chgrp install /usr/lib/xfce4
chmod g+w,o+t /usr/lib/xfce4
EOF
    ;;
    xfce4pwrmngr)
          cat >> $Output << "EOF"
chgrp install /etc/xdg/autostart
chmod g+w,o+t /etc/xdg/autostart
EOF
    ;;
    $xfont)
           cat >> $Output << "EOF"
chgrp install /usr/share/fonts
chmod g+w,o+t /usr/share/fonts
EOF
    ;;
    $xlib)
           cat >> $Output << "EOF"
chgrp install /usr/share/X11
chmod g+w,o+t /usr/share/X11
EOF
    ;;
    xml-parser)  #perl
echo "case \$(uname -m) in
   x86_64) archi=x86_64-linux
   ;;
   *)      archi=i686-linux
   ;;
esac
chgrp install /usr/lib/perl5/site_perl/${perlvers}/\$archi/auto/XML
chmod g+w,o+t /usr/lib/perl5/site_perl/${perlvers}/\$archi/auto/XML
chgrp install /usr/lib/perl5/${perlvers}/\$archi/perllocal.pod
chmod 664 /usr/lib/perl5/${perlvers}/\$archi/perllocal.pod" >> $Output
    ;;
    xorg-evdev)
               cat >> $Output << "EOF"
chgrp install /usr/lib/xorg/modules/input
chmod g+w,o+t /usr/lib/xorg/modules/input
EOF
    ;;
    xorg-server)
           cat >> $Output << "EOF"
chgrp install /usr/include/xorg
chmod g+w,o+t /usr/include/xorg
chgrp install /usr/share/X11/xorg.conf.d
chmod g+w,o+t /usr/share/X11/xorg.conf.d
chgrp install /usr/lib/xorg
chmod g+w,o+t /usr/lib/xorg
chgrp install /usr/lib/xorg/modules
chmod g+w,o+t /usr/lib/xorg/modules
chgrp install /usr/lib/xorg/modules/multimedia
chmod g+w,o+t /usr/lib/xorg/modules/multimedia
chown root /usr/bin/Xorg # setuid root binary
chmod 4755 /usr/bin/Xorg
EOF
    ;;
    $xproto) # /usr/include/X11
           cat >> $Output << "EOF"
chgrp install /usr/include/X11
chmod g+w,o+t /usr/include/X11
chgrp install /usr/include/X11/extensions
chmod g+w,o+t /usr/include/X11/extensions
chgrp install /usr/include/X11/fonts
chmod g+w,o+t /usr/include/X11/fonts
chgrp install /usr/include/GL # for MesaLib
chmod g+w,o+t /usr/include/GL
chgrp install /usr/include/GL/internal
chmod g+w,o+t /usr/include/GL/internal
EOF
    ;;
    xterm)
           cat >> $Output << "EOF"
cd ${PkgUserDir}/${PkgName}/${PkgName}*
make install-ti # have to do this as root
cd ..
for flToDlt in *.tgz
do
  dltfile=${flToDlt%.tgz}
done
rm -rf $dltfile
chown xterm:xterm /usr/share/terminfo/x/xterm-65
chown xterm:xterm /usr/share/terminfo/x/xterm+app+pc
chown xterm:xterm /usr/share/terminfo/x/xterm-boldso
chown xterm:xterm /usr/share/terminfo/x/xterm+decedit
chown xterm:xterm /usr/share/terminfo/x/xterm-ic
chown xterm:xterm /usr/share/terminfo/x/xterm+kbs
chown xterm:xterm /usr/share/terminfo/x/xterm-mono
chown xterm:xterm /usr/share/terminfo/x/xterm+noapp+pc
chown xterm:xterm /usr/share/terminfo/x/xterm-nrc
chown xterm:xterm /usr/share/terminfo/x/xterm+pce0
chown xterm:xterm /usr/share/terminfo/x/xterm+pce1
chown xterm:xterm /usr/share/terminfo/x/xterm+pce3
chown xterm:xterm /usr/share/terminfo/x/xterm+pcf1
chown xterm:xterm /usr/share/terminfo/x/xterm+pcf3
chown xterm:xterm /usr/share/terminfo/x/xterm+pcfn
chown xterm:xterm /usr/share/terminfo/x/xterm+pcfN
chown xterm:xterm /usr/share/terminfo/x/xterm-rep
chown xterm:xterm /usr/share/terminfo/x/xterm+tmux
chown xterm:xterm /usr/share/terminfo/x/xterm-vi
chown xterm:xterm /usr/share/terminfo/x/xterm-xmc
chgrp install /usr/share/pixmaps # for evol-data-server
chmod g+w,o+t /usr/share/pixmaps
cat >> /etc/X11/app-defaults/XTerm << "XTERMEOF"
*VT100*locale: true
*VT100*faceName: Monospace
*VT100*faceSize: 10
*backarrowKeyIsErase: true
*ptyInitialErase: true
XTERMEOF
EOF
    ;;
    xulrunner)
          cat >> $Output << "EOF"
chgrp install /usr/lib/mozilla/plugins
chmod g+w,o+t /usr/lib/mozilla/plugins
EOF
    ;;
    yelp-xsl)
          cat >> $Output << "EOF"
chgrp install /usr/share/yelp-xsl/xslt/common/domains
chmod g+w,o+t /usr/share/yelp-xsl/xslt/common/domains
EOF
    ;;
    zenity)
          cat >> $Output << "EOF"
chgrp install /usr/share/help/{bg,da,en_GB} # for gnome-terminal
chmod g+w,o+t /usr/share/help/{bg,da,en_GB}
EOF
    ;;
esac
fi # end ! as_root
#
# the following are needed whether root or package user
case $pkgname in
    alsa-utils)
          cat >> $Output << "EOF"
touch /var/lib/alsa/asound.state
/usr/sbin/alsactl store
usermod -a -G audio john # replace john with your username
EOF
    ;;
    avr-libc)
          cat >> $Output << "EOF"
chgrp root /usr
chmod 755 /usr
EOF
    ;;
    apache)
          cat >> $Output << "EOF"
if [ "$SYSTEMD" = yes ]; then
  install -m644 ${blfsfiles}/service/httpd.service /usr/lib/systemd/system/httpd.service
  install -Dm644 ${blfsfiles}/conf-files/httpd.conf /usr/lib/tmpfiles.d
  chown apache:apache /usr/lib/systemd/system/httpd.service
  chown apache:apache /usr/lib/tmpfiles.d/httpd.conf
fi
EOF
    ;;
    apache-ant)
          cat >> $Output << "EOF"
cat > /etc/profile.d/apache_ant.sh << "EOFANT"
export PATH=$PATH:/opt/ant/bin
export ANT_HOME=/opt/ant
EOFANT
EOF
if $as_root; then
          cat >> $Output << "EOF"
chown apache-ant:apache-ant /etc/profile.d/apache_ant.sh
EOF
fi
    ;;
    bind)
          cat >> $Output << "EOF"
chown -R named:named /srv/named
echo "****************************************"
echo "Edit /etc/resolv.conf to suit your needs"
echo "****************************************"
if [ "$SYSTEMD" = yes ]; then
  install -D -m644 ${blfsfiles}/conf-files/tmpfiles.d /usr/lib/tmpfiles.d/named.conf
  install -D -m644 ${blfsfiles}/service/named.service /usr/lib/systemd/system
  chown named:named /usr/lib/tmpfiles.d/named.conf
  chown named:named /usr/lib/systemd/system/named.service
fi
install -D -m640 -o 0 -g 20 ${blfsfiles}/conf-files/named.conf /etc/named.conf
install -d -m770 -o 0 -g 20 /var/named
install    -m640 -o 0 -g 20 ${blfsfiles}/zone/root.hint /var/named
install    -m640 -o 0 -g 20 ${blfsfiles}/zone/127.0.0.zone /var/named
install    -m640 -o 0 -g 20 ${blfsfiles}/zone/localhost.zone /var/named
EOF
    ;;
    cracklib)
          cat >> $Output << "EOF"
create-cracklib-dict /usr/share/dict/cracklib-words \
                     /usr/share/dict/cracklib-extra-words
EOF
    ;;
    cups)
       if $as_root; then # already done this if a package-user
          cat >> $Output << "EOF"
cat > /etc/cups/printers.conf << "EOFCUPS"
# Printer configuration file for CUPS v1.6.1
# Written by cupsd
# DO NOT EDIT THIS FILE WHEN CUPSD IS RUNNING
<Printer Dell_3130cn_Color_Laser>
UUID urn:uuid:051a0c0e-3e62-3936-7af9-0e901f7d8cfd
Info Dell 3130cn Color Laser
Location main
MakeModel Dell 3130cn Color Laser v3017.104 PS
DeviceURI usb://Dell/3130cn%20Color%20Laser?serial=0932091440
State Idle
StateTime 1355080729
Type 8388612
Accepting Yes
Shared Yes
JobSheets none none
QuotaPeriod 0
PageLimit 0
KLimit 0
OpPolicy default
ErrorPolicy retry-job
</Printer>
EOFCUPS
chown root:lp /etc/cups/printers.conf
chmod 600 /etc/cups/printers.conf
if [ "$SYSTEMD" = yes ]; then
  install -Dm644 ${blfsfiles}/service/cupsd.service /usr/lib/systemd/system
  chown cups:cups /usr/lib/systemd/system/cupsd.service
  cat > /etc/udev/rules.d/10-local.rules << "RULESEOF"
SUBSYSTEM=="usb", ATTRS{idVendor}=="413c", ATTRS{idProduct}=="5603", GROUP="lp", MODE:="664"
RULESEOF
fi
EOF
       fi
    ;;
    dhcpcd)
          cat >> $Output << "EOF"
if [ "$SYSTEMD" = yes ]; then
  install -Dm644 ${blfsfiles}/service/dhcpcd_.service /usr/lib/systemd/system/dhcpcd@.service
  install -Dm644 ${blfsfiles}/service/dhcpcd.service /usr/lib/systemd/system/dhcpcd.service
  chown dhcpcd:dhcpcd /usr/lib/systemd/system/{dhcpcd@.service,dhcpcd.service}
fi
EOF
    ;;
    ffmpeg)
          cat >> $Output << "EOF"
unset CFLAGS
EOF
    ;;
    firewall) # add more rules for the squid proxy server
          cat >> $Output << "EOF"
sed -i '/^# End/d' /etc/rc.d/rc.iptables
cat >> /etc/rc.d/rc.iptables << "ADDRULES"
# permit Squid box out to the Internet
iptables -t mangle -A PREROUTING -p tcp --dport 80 -s  192.168.1.120 -j ACCEPT
# mark everything else on port 80 to be routed to the Squid box
iptables -t mangle -A PREROUTING -i wlp3s0 -p tcp --dport 80 -j MARK --set-mark 2
iptables -t mangle -A PREROUTING -m mark --mark 2 -j ACCEPT
# Ensure that traffic from inside the network is allowed to loop back inside
iptables -t filter -A FORWARD -i wlp3s0 -o wlp3s0 -p tcp --dport 80 -j ACCEPT

# End /etc/rc.d/rc.iptables
ADDRULES
EOF
    ;;
    gnome-session)
          cat >> $Output << "EOF"
cat > ~/.xinitrc << "EOL"
dbus-launch --exit-with-session gnome-session
EOL
cat > /etc/profile.d/gnome.sh << "EOW"
export XDG_DATA_DIRS=/usr/share
export XDG_CONFIG_DIRS=/etc/xdg
export XDG_MENU_PREFIX=""
EOW
EOF
    ;;
    gpm)
          cat >> $Output << "EOF"
if [ "$SYSTEMD" = yes ]; then
  install -m644 ${blfsfiles}/service/gpm.service /usr/lib/systemd/system/gpm.service
  chown gpm:gpm /usr/lib/systemd/system/gpm.service
fi
EOF
    ;;
    iptables)
          cat >> $Output << "EOF"
if [ "$SYSTEMD" = yes ]; then
  install -v -d /etc/iptables
  install -v -d /etc/conf.d
# remove the procps version of sysctl.conf
  rm -rf /etc/sysctl.conf
  install -D -m644 ${blfsfiles}/conf-files/sysctl.conf /etc
  install -D -m644 ${blfsfiles}/conf-files/iptables.conf.d /etc/conf.d/iptables
  install -D -m644 ${blfsfiles}/iptables.rules /etc/iptables/iptables.rules
  install -Dm644 ${blfsfiles}/service/{iptables.service,ip6tables.service} /usr/lib/systemd/system
  chown iptables:iptables /etc/{sysctl.conf,conf.d/iptables,iptables/iptables.rules}
  chown iptables:iptables /usr/lib/systemd/system/{iptables.service,ip6tables.service}
fi
EOF
    ;;
    isl)
          cat >> $Output << "EOF"
mv /usr/lib/libisl.so.10.2.1-gdb.py /usr/share/gdb/auto-load/usr/lib/
EOF
    ;;
    jdkbin) # update man_db.conf
          cat >> $Output << "EOF"
cat >> /etc/man_db.conf << "MANDBEOF"
MANDATORY_MANPATH     /opt/jdk/man
MANPATH_MAP           /opt/jdk/bin     /opt/jdk/man
MANDB_MAP             /opt/jdk/man     /var/cache/man/jdk
MANDBEOF
mandb -c /opt/jdk/man
chgrp install /opt/jdk/jre
chmod 1775 /opt/jdk/jre
chgrp install /opt/jdk/jre/{lib,bin}
chmod 1775 /opt/jdk/jre/{lib,bin}
chgrp install /opt/jdk/man/man1
chmod 1775 /opt/jdk/man/man1
EOF
if $as_root; then
          cat >> $Output << "EOF"
chown -h -R root:root /opt/jdk
EOF
else
  echo "chown -h -R jdkbin:jdkbin /opt/jdk-${jdkvers}" >> $Output
fi
    ;;
    krb5)
          cat >> $Output << "EOF"
if [ "$SYSTEMD" = yes ]; then
  install -m 644 ${blfsfiles}/service/krb5-{kadmind.service,kdc.service,kpropd.service,kpropd@.service,kpropd.socket} /usr/lib/systemd/system
  chown krb5:krb5 /usr/lib/systemd/system/krb5-*
fi
EOF
    ;;
    libgphoto2)
          cat >> $Output << "EOF"
rm -rf  /usr/include/gphoto2/gphoto2
rm -rf /opt/qt # qt4 will create this symlink
if [ ! -d /usr/lib/udev/rules.d ]; then
  install -v -m0755 -d /usr/lib/udev/rules.d
fi
touch /usr/lib/udev/rules.d/40-gphoto.rules
chown libgphoto2:libgphoto2 /usr/lib/udev/rules.d/40-gphoto.rules
EOF
    ;;
    linux-pam)   #/etc/pam.d
          cat >> $Output << "EOF"
chown root /usr/sbin/unix_chkpwd
chmod -v 4755 /usr/sbin/unix_chkpwd
cat > /etc/pam.d/other << "PAMEND"
# Begin /etc/pam.d/other
auth            required        pam_unix.so     nullok
account         required        pam_unix.so
session         required        pam_unix.so
password        required        pam_unix.so     nullok
# End /etc/pam.d/other
PAMEND
cat > /etc/security/limits.conf << "_EOT"
# Begin /etc/security/limits.conf

*               -       rtprio          0
*               -       nice            0
@audio          -       rtprio          65
@audio          -       nice           -10
@audio          -       memlock         40000

# End /etc/security/limits.conf
_EOT
chown linux-pam:linux-pam /etc/security/limits.conf
EOF
    ;;
    lvm2)
           cat >> $Output << "EOF"
if [ "$SYSTEMD" = yes ]; then
  install -D -m644 ${blfsfiles}/service/dmeventd.service /usr/lib/systemd/system/dmeventd.service
  install -D -m644 ${blfsfiles}/service/dmeventd.socket /usr/lib/systemd/system/dmeventd.socket
  ln -sf ../dmeventd.socket /usr/lib/systemd/system/sockets.target.wants/dmeventd.socket
  install -D -m644 ${blfsfiles}/service/lvm-monitoring.service /usr/lib/systemd/system/lvm-monitoring.service
  install -D -m644 ${blfsfiles}/service/lvmetad.service /usr/lib/systemd/system/lvmetad.service
  install -D -m644 ${blfsfiles}/service/lvmetad.socket /usr/lib/systemd/system/lvmetad.socket
  ln -sf ../lvmetad.socket /usr/lib/systemd/system/sockets.target.wants/lvmetad.socket
chown lvm2:lvm2 /usr/lib/systemd/system/{dmeventd.*,lvm*}
chown -h lvm2:lvm2 /usr/lib/systemd/system/sockets.target.wants/{dmeventd.*,lvmetad.*}
fi
EOF
    ;;
    mysql)
          cat >> $Output << "EOF"
install -Dm644 /usr/share/mysql/my-medium.cnf /etc/mysql/my.cnf
chown mysql:mysql /etc/mysql/my.cnf
if [ "$SYSTEMD" = yes ]; then
  install -Dm755 ${blfsfiles}/service/mariadb-post.sh /usr/bin/mysqld-post
  install -m644 ${blfsfiles}/service/mariadb.service /usr/lib/systemd/system/mysqld.service
  install -m644 ${blfsfiles}/conf-files/mariadb-tmpfile.conf /usr/lib/tmpfiles.d/mysql.conf
  chown mysql:mysql /usr/lib/systemd/system/mysqld.service
  chown mysql:mysql /usr/bin/mysqld-post
  chown mysql:mysql /usr/lib/tmpfiles.d/mysql.conf
  echo "*****************************************************************"
  echo "*                                                               *"
  echo "* The mysql root password is currently blank.                   *"
  echo "* The first time you start the mysql daemon, do                 *"
  echo "* /usr/bin/mysql_secure_installation to set up the password     *"
  echo "*                                                               *"
  echo "*****************************************************************"
else
  echo "*****************************************************************"
  echo "*                                                               *"
  echo "* The mysql root password is currently blank.                   *"
  echo "* After this do: mysqld_safe --user=mysql 2>&1 >/dev/null &     *"
  echo "* to start the mysql server                                     *" 
  echo "* and /usr/bin/mysql_secure_installation to set up the password *"
  echo "*                                                               *"
  echo "*****************************************************************"
fi
mysql_install_db --basedir=/usr --datadir=/srv/mysql --user=mysql
chgrp -v mysql /srv/mysql{,/test,/mysql}
install -v -m755 -o mysql -g mysql -d /var/run/mysqld
EOF
    ;;
    nettle) # remove static libs
          cat >> $Output << "EOF"
rm -f /usr/lib/{libhogweed,libnettle}.a
EOF
    ;;
    openssl) # install /etc/pam.d for linux-pam
          cat >> $Output << "EOF"
install -v -m755 -d /etc/pam.d
EOF
    ;;
    pciutils) # run update-pciids
          cat >> $Output << "EOF"
update-pciids
EOF
    ;;
    polkit-gnome)
          cat >> $Output << "EOF"
install -m644 ${blfsfiles}/polkit-gnome-authentication-agent-1.desktop /usr/share/applications/
chown polkit-gnome:polkit-gnome /usr/share/applications/polkit-gnome-authentication-agent-1.desktop
EOF
    ;;
    pulseaudio)
          cat >> $Output << "EOF"
groupadd -g 58 pulse
groupadd -g 59 pulse-access
useradd -c "Pulseaudio User" -d /var/run/pulse -g pulse \
        -s /bin/false -u 58 pulse
usermod -a -G audio pulse
EOF
    ;;
    py3cairo) # put the python symlink back to python2
          cat >> $Output << "EOF"
rm /usr/bin/python
ln -svf python2 /usr/bin/python
chown -h python2:python2 /usr/bin/python
EOF
    ;;
    python3)
          cat >> $Output << "EOF"
cat > /etc/profile.d/python3.sh << "PYEOF"
EOF
echo "export PYTHONDOCS=/usr/share/doc/python-${Python3vers}/html" >> $Output
          cat >> $Output << "EOF"
PYEOF
chown python3:python3 /etc/profile.d/python3.sh
EOF
    ;;
    samba) # install systemd files
          cat >> $Output << "EOF"
if [ "$SYSTEMD" = yes ]; then
  install -m644 ${blfsfiles}/service/{samba.service,nmbd.service,smbd.service,smbd@.service,swat@.service,winbindd.service} /usr/lib/systemd/system
  install -m644 ${blfsfiles}/service/{smbd.socket,swat.socket} /usr/lib/systemd/system/
  install -m644 ${blfsfiles}/conf-files/samba.conf.d /etc/conf.d/samba
  install -D -m644 ${blfsfiles}/conf-files/samba.conf /usr/lib/tmpfiles.d/samba.conf
  chown samba:samba /usr/lib/systemd/system/{samba.service,nmbd.service,smbd.service,smbd@.service,swat@.service,winbindd.service,smbd.socket,swat.socket}
  chown samba:samba /etc/conf.d/samba
  chown samba:samba /usr/lib/tmpfiles.d/samba.conf
fi
install -D -m644 ${blfsfiles}/conf-files/samba.pam /etc/pam.d/samba
install -d -m1777 /var/spool/samba
chown samba:samba /etc/pam.d/samba
chown samba:samba /var/spool/samba
EOF
    ;;
    speechd)
          cat >> $Output << "EOF"
if [ "$SYSTEMD" = yes ]; then
  install -Dm644 ${blfsfiles}/service/speechd.service /usr/lib/systemd/system/speech-dispatcherd.service
  chown speechd:speechd /usr/lib/systemd/system/speech-dispatcherd.service
  install -v -d /var/log/speech-dispatcher
fi
EOF
    ;;
    squid)
          cat >> $Output << "EOF"
touch /var/cache/squid/cache.log
chown -R proxy:proxy /var/cache/squid
install -v -d /var/log/squid
touch /var/log/squid/access.log
chown -R proxy:proxy /var/log/squid
if [ "$SYSTEMD" = yes ]; then
  install -Dm644 ${blfsfiles}/service/squid.service /usr/lib/systemd/system/squid.service
  chown squid:squid /usr/lib/systemd/system/squid.service
else
  cp ${blfsfiles}/squid /etc/rc.d/init.d
  chmod 755 /etc/rc.d/init.d/squid
  for rcnum in 0 1 2 6; do
    ln -svf ../init.d/squid /etc/rc.d/rc${rcnum}.d/K29squid
  done
  for rcnum in 3 4 5; do
    ln -svf ../init.d/squid /etc/rc.d/rc${rcnum}.d/S35squid
  done
  chown squid:squid /etc/rc.d/init.d/squid
  chown -h squid:squid /etc/rc.d/*/K29squid
  chown -h squid:squid /etc/rc.d/*/S35squid
fi
EOF
    ;;
    usbutils) # run update-usbids
          cat >> $Output << "EOF"
update-usbids
EOF
    ;;
    xfce4-session)
          cat >> $Output << "EOF"
echo "exec dbus-launch --exit-with-session xfce4-session" > ~/.xinitrc
echo john ${HOSTNAME} = NOPASSWD: /usr/lib/xfce4/session/xfsm-shutdown-helper \
  >> /etc/sudoers
echo "********************************************************************"
echo "Change last line in /etc/sudoers file to your username and hostname"
echo "********************************************************************"
EOF
    ;;
    $xlib)
          if [[ "$XORG_PREFIX" != "/usr" ]]; then # set up symlinks
            cat >> $Output << "EOF"
ln -sv $XORG_PREFIX/lib/X11 /usr/lib/X11
ln -sv $XORG_PREFIX/include/X11 /usr/include/X11
ln -sv $XORG_PREFIX /usr/X11R6
EOF
          fi
    ;;
esac
if [[ "$Section" != blfs ]]; then
cat >> $Output << "EOF"
else
  echo -e "\033[1mCan install $PkgName\033[0m"
fi
else
echo -e "\e[1;32mCan't install $PkgName\e[0m"
echo -e "\e[0;34munmet dependencies are:"; tput sgr0
echo -e '\e[0;31m'${rtrnDepNotMet[@]}; tput sgr0
fi
EOF
fi
cat >> $Output << "EOF"
}
EOF
} #end closefunction
#
setuplinks () { # setup preprocessing
case $pkgname in
    alsa-utils)
        doFirst="chgrp install /usr/share/man/* && chmod g+w,o+t /usr/share/man/*"
        links=""
    ;;
    avahi)
        doFirst="groupadd -fg 86 netdev"
        links=""
    ;;
    avr-binutils)
        doFirst="chgrp install /usr/lib/ldscripts && chmod g+w,o+t /usr/lib/ldscripts"
        links=""
    ;;
    avr-gcc)
        doFirst="chgrp install /usr/lib/gcc && chmod g+w,o+t /usr/lib/gcc"
        links=""
    ;;
    avr-libc)
        doFirst="chgrp install /usr && chmod g+w,o+t /usr"
        links=""
    ;;
    bind)
        doFirst='groupadd -g 20 named && useradd -c "BIND Owner" -g named -s /bin/false -u 20 named'
        links=""
    ;;
    cups)
        doFirst='useradd -c "Print Service User" -d /var/spool/cups -g lp -s /bin/false -u 9 lp && groupadd -g 19 lpadmin && usermod -a -G lpadmin john && chgrp install /var/spool && chmod g+w,o+t /var/spool'
        links=""
    ;;
    cups-filters)
        doFirst=""
        links="/usr/lib/cups/backend /usr/lib/cups/filter"
    ;;
    dbus)
        doFirst='groupadd -g 18 messagebus && useradd -c "D-Bus Message Daemon User" -d /var/run/dbus -u 18 -g messagebus -s /bin/false messagebus'
        links=""
    ;;
    faad2)
        doFirst="chgrp install /usr/share/man && chmod g+w,o+t /usr/share/man"
        links=""
    ;;
    farstream)
        doFirst=""
        links="/usr/lib/gstreamer-1.0/{libfsrawconference.*,libfsrtpconference.*,libfsmsnconference.*,libfsfunnel.*,libfsrtcpfilter.*,libfsvideoanyrate.*}"
    ;;
    firewall)
        doFirst="chgrp install /etc/rc.d && chmod 1775 /etc/rc.d"
        links=""
    ;;
    foomatic)
        doFirst=""
        links="/usr/lib/cups/filter /usr/lib/cups/backend"
    ;;
    gconf|gvfs)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled /usr/lib/gio/modules/giomodule.cache"
    ;;
    gdk-pixbuf)
        doFirst=""
        links="/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache"
    ;;
    glib)
        doFirst=""
        links="/usr/share/aclocal/{glib-2.0.m4,glib-gettext.m4,gsettings.m4}"
    ;;
    gnm-thems-stndrd)
        doFirst=""
        links="/usr/share/icons/HighContrast/icon-theme.cache"
    ;;
    gnome-games)
        doFirst='install -v -m755 -d /var/games && groupadd -g 60 games && useradd -c "Games High Score Owner" -d /var/games -g games -s /bin/false -u 60 games && chown -v games:games /var/games'
        links="/usr/share/glib-2.0/schemas/gschemas.compiled"
    ;;
    gperf) # has to re-create /usr/share/info/dir
        doFirst=""
        links="/usr/share/info/dir"
    ;;
    gtkplus2)
        doFirst=""
        links="/usr/bin/gtk-update-icon-cache /usr/share/man/man1/gtk-update-icon-cache.1"
    ;;
    gtkplus3) # has to own /usr/bin/gtk-update-icon-cache
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled /usr/bin/gtk-update-icon-cache /usr/share/man/man1/gtk-update-icon-cache.1"
    ;;
    gutenprint)
        doFirst=""
        links="/usr/lib/cups/driver /usr/lib/cups/filter"
    ;;
    libcanberra)
        doFirst=""
        links="/etc/gconf/gconf.xml.defaults/*"
    ;;
    librsvg)
        doFirst=""
        links="/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache"
    ;;
    nautilus-sendto)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled /usr/lib/nautilus-sendto/plugins/{libnstburn.la,libnstburn.so,libnstgajim.la,libnstgajim.so,libnstpidgin.la,libnstpidgin.so,libnstremovable_devices.la,libnstremovable_devices.so} /usr/bin/nautilus-sendto"
    ;;
    net-tools)
        doFirst=""
        links="/bin/hostname"
    ;;
    openjdk)
        doFirst=""
        links="/opt/jdk"
    ;;
    openssh)
        doFirst="install -v -m700 -d /var/lib/sshd && chown -v root:sys /var/lib/sshd && groupadd -g 50 sshd && useradd -c 'sshd PrivSep' -d /var/lib/sshd -g sshd -s /bin/false -u 50 sshd"
        links=""
    ;;
    php) # needs to write to /etc/httpd/httpd.conf
        doFirst=""
        links="/etc/httpd/httpd.conf"
    ;;
    polkit)
        doFirst=""
        links="/usr/lib/polkit-1/polkit-agent-helper-1 /usr/bin/pkexec /etc/polkit-1/rules.d /usr/share/polkit-1/rules.d"
    ;;
    py3cairo) # change symlink python so it points to python3, not python2
        doFirst="rm /usr/bin/python && ln -svf python3 /usr/bin/python"
        links=""
    ;;
    py3-dbus) # give access to /usr/include/dbus-1.0/dbus/dbus-python.h
        doFirst=""
        links="/usr/include/dbus-1.0/dbus/dbus-python.h /usr/share/doc/{dbus-python-1.2.0,dbus-python-1.2.0/*} /usr/lib/pkgconfig/dbus-python.pc"
    ;;
    py2-gobject3)
        doFirst=""
        links="/usr/lib/python2.7/site-packages/gi/{repository/*,overrides/*,_gi*,*.p*}"
    ;;
    py3-gobject3)
        doFirst=""
        links="/usr/include/pygobject-3.0/pygobject.h /usr/lib/pkgconfig/pygobject-3.0.pc"
    ;;
    python3)
        doFirst=""
        links="/usr/bin/2to3"
    ;;
    qt4)
        doFirst="chgrp install /etc/ld.so.conf && chmod 664 /etc/ld.so.conf && chgrp install /usr && chmod 1775 /usr && if [ ! -d /usr/share/applications ]; then install -m0755 -d /usr/share/applications; fi && chgrp install /usr/share/applications && chmod 1775 /usr/share/applications"
        links=""
    ;;
    shadow)
        doFirst=""
        links="/bin/su /bin/passwd /etc/pam.d/other"
    ;;
    shrd-mime-info)
        doFirst="if [ -d /usr/share/mime/packages ]; then
  chgrp install /usr/share/mime/packages
  chmod 1775 /usr/share/mime/packages
fi"
        links="/usr/share/mime/packages/freedesktop.org.xml"
    ;;
    squid)
        doFirst='groupadd -g 38 proxy && useradd -c "Squid Cache User" -d /var/cache/squid -u 38 -g proxy -s /bin/false proxy'
        links=""
    ;;
    subversion) # needs to install to /usr/libexec
        doFirst="install -v -m0755 -d /usr/libexec && chgrp install /usr/libexec && chmod 1775 /usr/libexec"
        links=""
    ;;
    talloc)
        doFirst="if [ -e /usr/lib/python2.7/site-packages/talloc.so ]; then chown talloc:talloc /usr/lib/python2.7/site-packages/talloc.so; fi"
        links=""
    ;;
    traceroute)
        doFirst="if [ -e /bin/traceroute ]; then rm /bin/traceroute; fi"
        links=""
    ;;
    xorg-server)
        doFirst="if [ -e /etc/sysconfig/createfiles ]; then
  chown root:install /etc/sysconfig/createfiles
  chmod 664 /etc/sysconfig/createfiles
fi"
        links=""
    ;;
    at-spi2-atk|caribou|colord|gdm|gnome-keyring|gnome-shell|gset-dsktp-schms|gst-plgns-bad|gst-plgns-bad0|ibus|libgnomekbd|mutter|telepathy-logr|yelp)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled"
    ;;
    epiphany|evol-data-server|folks|gnome-calculator|gnome-contacts|gnome-dictionary|gnome-set-daemon|metacity|tpthymisscntrl)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled"
    ;;
    gnm-power-mngr|gnome-sys-monitr|gnome-scrnshot|gucharmap|mousetweaks|vino|gedit|epiphany-ext)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled"
    ;;
    gst-plgns-good|aisleriot|file-roller|evince|gnome-applets|gnome-panel|evolution|ntwrk-mngr-applt|empathy|gnome-nettool|libpeas|totem|libgweather|gcr|goa|gnome-session|gnome-terminal)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled /etc/gconf/gconf.xml.defaults/* /usr/share/icons/hicolor/icon-theme.cache"
    ;;
    dconf|nautilus|gnome-bluetooth|gnm-user-share|gnome-cntrl-cntr|baobab|alacarte|brasero|cheese|eog|gnome-disk-util|gnome-serch-tool|gnome-system-log)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled /usr/share/icons/hicolor/icon-theme.cache"
    ;;
    gnome-icon-thme|gnm-icn-thme-ext|gnm-icn-thme-sym)
        doFirst=""
        links="/usr/share/icons/gnome/icon-theme.cache"
    ;;
    accerciser|gnome-tweak-tool|xfce4-session)
        doFirst=""
        links="/usr/share/icons/hicolor/icon-theme.cache"
    ;;
    *)
        doFirst=""
        links=""
    ;;
esac
} # end setuplinks
#
resolvelinks() {
echo "resolvelinks () {
$doFirst
for link in $links
do
  if [ -e "\$link" ]; then
    chown -h \$PkgName:\$PkgName \$link # change owner to package user so can overwrite
  fi
done
return
}" >> $Output
} #end resolvelinks
#
wgetwrite () {
# $1 is the file version and $2 is the URL
cat << "EOF"
wgetopts="-e use_proxy=yes -e http_proxy=$http_proxy -e ftp_proxy=$ftp_proxy"
EOF
echo "srcpkg=\"${1}\""
case $pkgname in
   docutils|libpwquality)
           echo "if [ ! -e \$srcpkg ]; then
  wget \$wgetopts --no-check-certificate ${2}\${srcpkg}
fi" >> $Output
   ;;
   *)
           echo "if [ ! -e \$srcpkg ]; then
  wget \$wgetopts ${2}\${srcpkg}
fi" >> $Output
   ;;
esac
case $pkgname in
   espeak) # a zip file downloaded
           cat << "EOF"
espeakDir="${srcpkg%.zip}"
unzip $srcpkg
cd $espeakDir
EOF
   ;;
   portaudio) # untars to portaudio
     echo "tar zxf \$srcpkg
cd portaudio" >> $Output
   ;;
   smpeg) # need a patch first so do nothing
     :
   ;;
   *)
     echo "cd \$(tar vxf \$srcpkg | awk -F\/ 'END{print \$1}')" >> $Output
   ;;
esac
} # end wgetwrite
#
gnmPkgVers () {
# $1 is the source name
# $2 is the compressed source package name
# $3 is the extension name to trim to, usually tar
local srcnm=$1
local spkg=$2
local trm=$3
local fext="${spkg#*${srcnm}}" # this is vers # plus .tar.xz or similar
local vnum="${fext%.${trm}*}" # this is the full vers # e.g 0.16.2
gnmvers=$(echo $vnum | awk -F\. '{print $1"."$2}') # this is the required version in gnome
revsrcnm=${srcnm%?} # src name without the trailing -
} # end gnmPkgVers
#
setproxy () {
# need a function to setup the proxy settings in the build script
    cat << "EOF"
setproxy () {
ipadd=$(ip addr | grep 192 | awk '{print $2}' | awk -F\/ '{print $1}')
proxyset=http://${ipadd}:3128/
http_proxy=$proxyset
ftp_proxy=$proxyset
https_proxy=$proxyset
} # end setproxy
EOF
} # end setproxy
#
unpack () {
    cat << "EOF"
unpack () {
starttime=$( date +%s )
EOF
case $srcname in
   avr-binutils-) # usr the core/binutils source file
    cat << "EOF"
cd $(tar vxf /usr/src/core/binutils/binutils-*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   avr-gcc-) # use the core/gcc source file
    cat << "EOF"
cd $(tar vxf /usr/src/core/gcc/gcc-*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   boost_) # need a patch
    cat << "EOF"
cp ${blfsfiles}/patches/libraries/boost_1_54_0-fix-new-glibc-1.patch .
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   certdata.txt) # copy certdata.txt to pkguser dir
    cat << "EOF"
cp ${sourcedir}/${SrcName} .
EOF
   ;;
   coreutils-|systemd-) # don't need to copy the source - already in place
    cat << "EOF"
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   cracklib-) # not cracklib words
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.*z* .
cd $(tar vxf ${SrcName}[0-9]*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   cups-1) # need a patch from patches/pst
    cat << "EOF"
cp ${blfsfiles}/patches/pst/cups-systemd-socket.patch .
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   avr-libc-|apache-ant-|cloog-|dialog|docutils-|dotconf-|espeak-|ExtUtils-Depends-|ExtUtils-PkgConfig-|ffmpegthumbnailer-|foomatic-filters-|isl-|iw-|liboauth-|libcdio-|libgphoto2-|libproxy-|libpwquality-|libunique-|mariadb-|netctl-|nmap-|pa_stable_|pycairo-|PySolFC-|pysol-sound-server-|ragel-|speech-dispatcher-|squid-|v4l-utils-|wavpack-|x264-)
     case $srcname in
        apache-ant-)
            pkgvers=${srcname}1.9.2-src.tar.bz2
            pkgURL=http://archive.apache.org/dist/ant/source/
        ;;
        avr-libc-)
            pkgvers=${srcname}1.8.0.tar.bz2
            pkgURL=http://download.savannah.gnu.org/releases/avr-libc/
        ;;
        cloog-)
            pkgvers=${srcname}0.18.0.tar.gz
            pkgURL=http://www.bastoul.net/cloog/pages/download/
        ;;
        dialog)
            pkgvers=${srcname}.tar.gz
            pkgURL=ftp://invisible-island.net/dialog/
        ;;
        docutils-)
            pkgvers=${srcname}0.10.tar.gz
            pkgURL=https://pypi.python.org/packages/source/d/docutils/
        ;;
        dotconf-)
            pkgvers=${srcname}1.3.tar.gz
            pkgURL=ftp://ftp.uwsg.indiana.edu/linux/gentoo/distfiles/
        ;;
        espeak-)
            pkgvers=${srcname}1.47.05-source.zip
            pkgURL=http://sourceforge.net/projects/espeak/files/espeak/espeak-1.47/
        ;;
        ExtUtils-Depends-)
            pkgvers=${srcname}0.304.tar.gz
            pkgURL=http://search.cpan.org/CPAN/authors/id/F/FL/FLORA/
        ;;
        ExtUtils-PkgConfig-)
            pkgvers=${srcname}1.14.tar.gz
            pkgURL=http://search.cpan.org/CPAN/authors/id/X/XA/XAOC/
        ;;
        ffmpegthumbnailer-)
            pkgvers=${srcname}2.0.8.tar.gz
            pkgURL=http://ffmpegthumbnailer.googlecode.com/files/
        ;;
        foomatic-filters-)
            pkgvers=${srcname}4.0-current.tar.gz
            pkgURL=http://www.openprinting.org/download/foomatic/
        ;;
        isl-)
            pkgvers=${srcname}0.12.1.tar.bz2
            pkgURL=ftp://ftp.linux.student.kuleuven.be/pub/people/skimo/isl/
        ;;
        iw-)
            pkgvers=${srcname}3.8.tar.xz
            pkgURL=http://www.mirrorservice.org/sites/ftp.kernel.org/pub/software/network/iw/
        ;;
        liboauth-)
            pkgvers=${srcname}1.0.1.tar.gz
            pkgURL=http://sourceforge.net/projects/liboauth/files/
        ;;
        libcdio-)
            pkgvers=${srcname}0.90.tar.gz
            pkgURL=http://ftp.gnu.org/gnu/libcdio/
        ;;
        libgphoto2-)
            pkgvers=${srcname}2.5.1.1.tar.bz2
            pkgURL=http://sourceforge.net/projects/gphoto/files/libgphoto/2.5.1.1/
        ;;
        libproxy-)
            pkgvers=${srcname}0.4.11.tar.gz 
            pkgURL=http://libproxy.googlecode.com/files/
        ;;
        libpwquality-)
            pkgvers=${srcname}1.2.2.tar.bz2
            pkgURL=https://fedorahosted.org/releases/l/i/libpwquality/
        ;;
        libunique-)
            pkgvers=${srcname}3.0.2.tar.xz
            pkgURL=http://ftp.acc.umu.se/pub/gnome/sources/libunique/3.0/
        ;;
        mariadb-)
            pkgvers=${srcname}5.5.32.tar.gz
            pkgURL=http://mirror.jmu.edu/pub/mariadb/mariadb-5.5.32/kvm-tarbake-jaunty-x86/
        ;;
        netctl-)
            pkgvers=${srcname}1.3.tar.xz
            pkgURL=ftp://ftp.archlinux.org/other/packages/netctl/
        ;;
        nmap-)
            pkgvers=${srcname}6.25.tar.bz2
            pkgURL=http://nmap.org/dist/
        ;;
        pa_stable_) # portaudio
            pkgvers=${srcname}v19_20111121.tgz
            pkgURL=http://www.portaudio.com/archives/
        ;;
        pycairo-) # src for py3cairo
            pkgvers=${srcname}1.10.0.tar.bz2
            pkgURL=http://cairographics.org/releases/
        ;;
        PySolFC-)
            pkgvers=${srcname}2.0.tar.bz2
            pkgURL=http://downloads.sourceforge.net/pysolfc/
        ;;
        pysol-sound-server-)
            pkgvers=${srcname}3.01.tar.bz2
            pkgURL=http://www.pysol.org/download/pysol/
        ;;
        ragel-)
            pkgvers=${srcname}6.8.tar.gz
            pkgURL=http://www.complang.org/ragel/
        ;;
        speech-dispatcher-)
            pkgvers=${srcname}0.8.tar.gz
            pkgURL=http://devel.freebsoft.org/pub/projects/speechd/
        ;;
        squid-)
            pkgvers=${srcname}3.3.8.tar.xz
            pkgURL=http://www2.us.squid-cache.org/Versions/v3/3.3/
        ;;
        v4l-utils-)
            pkgvers=${srcname}0.9.5.tar.bz2
            pkgURL=http://linuxtv.org/downloads/v4l-utils/
        ;;
        wavpack-)
            pkgvers=${srcname}4.60.1.tar.bz2
            pkgURL=http://wavpack.com/
        ;;
        x264-)
            pkgvers=last_stable_x264.tar.bz2
            pkgURL=ftp://ftp.videolan.org/pub/x264/snapshots/
        ;;
     esac
     wgetwrite $pkgvers $pkgURL
   ;;
   ghostscript-) # get the fonts too
    cat << "EOF"
wgetopts="-e use_proxy=yes -e http_proxy=$http_proxy -e ftp_proxy=$ftp_proxy"
cp ${sourcedir}/${SrcName}*.* .
extraFont=gnu-gs-fonts-other-6.0.tar.gz
if [ ! -e $extraFont ]; then
wget $wgetopts http://downloads.sourceforge.net/gs-fonts/${extraFont}
fi
count=0
for fl in *font*
do
  fontfile[$count]=$fl
  ((count++))
done
cd $(tar vxf ${SrcName}[0-9]*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   gimp-) # make sure the help file is present. If not download it
    cat << "EOF"
wgetopts="-e use_proxy=yes -e http_proxy=$http_proxy -e ftp_proxy=$ftp_proxy"
cp ${sourcedir}/${SrcName}*.tar.*z* .
if [ ! -e ${SrcName}help* ]; then # download it
  helpfile=gimp-help-2.8.0.tar.bz2
  wget $wgetopts ftp://gimp.org/pub/gimp/help/${helpfile}
fi
cd $(tar vxf ${SrcName}[0-9]*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   colord-|git-|dbus-|docbook-xsl-|freetype-|polkit-|poppler-) # colord-gtk, polkit-gnome, freetype-doc, git man-pages and htmldocs
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.tar.*z* .
cd $(tar vxf ${SrcName}[0-9]*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   glib-|glib-networking-|gobject-introspection-|clutter-|libsoup-|pygobject-3|rest-|yelp-tools-) # use the latest version from gnome
     case $srcname in
       glib-)
          pkgvers=${srcname}2.37.5.tar.xz
          gnmvers=""
          revsrcnm=""
          gnmPkgVers $srcname $pkgvers tar
          pkgURL=ftp://ftp.gnome.org/pub/gnome/sources/${revsrcnm}/${gnmvers}/
       ;;
       glib-networking-)
          pkgvers=${srcname}2.37.5.tar.xz
          gnmvers=""
          revsrcnm=""
          gnmPkgVers $srcname $pkgvers tar
          pkgURL=ftp://ftp.gnome.org/pub/gnome/sources/${revsrcnm}/${gnmvers}/
       ;;
       glibmm-)
          pkgvers=${srcname}2.37.5.tar.xz
          gnmvers=""
          revsrcnm=""
          gnmPkgVers $srcname $pkgvers tar
          pkgURL=ftp://ftp.gnome.org/pub/gnome/sources/${revsrcnm}/${gnmvers}/
       ;;
       gobject-introspection-)
          pkgvers=${srcname}1.37.4.tar.xz
          gnmvers=""
          revsrcnm=""
          gnmPkgVers $srcname $pkgvers tar
          pkgURL=ftp://ftp.gnome.org/pub/gnome/sources/${revsrcnm}/${gnmvers}/
       ;;
       clutter-)
          pkgvers=${srcname}1.15.2.tar.xz
          gnmvers=""
          revsrcnm=""
          gnmPkgVers $srcname $pkgvers tar
          pkgURL=ftp://ftp.gnome.org/pub/gnome/sources/${revsrcnm}/${gnmvers}/
       ;;
       json-glib-)
          pkgvers=${srcname}0.16.0.tar.xz
          gnmvers=""
          revsrcnm=""
          gnmPkgVers $srcname $pkgvers tar
          pkgURL=ftp://ftp.gnome.org/pub/gnome/sources/${revsrcnm}/${gnmvers}/
       ;;
       libsoup-)
          pkgvers=${srcname}2.43.5.tar.xz
          gnmvers=""
          revsrcnm=""
          gnmPkgVers $srcname $pkgvers tar
          pkgURL=ftp://ftp.gnome.org/pub/gnome/sources/${revsrcnm}/${gnmvers}/
       ;;
       pygobject-3)
          pkgvers=${srcname}.9.5.tar.xz
          gnmvers=""
          revsrcnm=""
          revisednm=${srcname%?} # remove the 3
          gnmPkgVers $revisednm $pkgvers tar
          pkgURL=ftp://ftp.gnome.org/pub/gnome/sources/${revsrcnm}/${gnmvers}/
       ;;
       rest-)
          pkgvers=${srcname}0.7.90.tar.xz
          gnmvers=""
          revsrcnm=""
          gnmPkgVers $srcname $pkgvers tar
          pkgURL=ftp://ftp.gnome.org/pub/gnome/sources/${revsrcnm}/${gnmvers}/
       ;;
       yelp-tools-)
          pkgvers=${srcname}3.9.90.tar.xz
          gnmvers=""
          revsrcnm=""
          gnmPkgVers $srcname $pkgvers tar
          pkgURL=http://ftp.gnome.org/pub/gnome/sources/${revsrcnm}/${gnmvers}/
        ;;
     esac
     wgetwrite $pkgvers $pkgURL
   ;;
   gnome-menus-|gnome-panel-|gnome-screensaver-|gnome-shell-) # need a patch
    cat << "EOF"
cp ${blfsfiles}/patches/gnomedesktop/${SrcName}*.patch .
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   hamcrest-)
           cat << "EOF"
wgetopts="-e use_proxy=yes -e http_proxy=$http_proxy -e ftp_proxy=$ftp_proxy"
pkgver=1.3
corejar=${SrcName}core-${pkgver}.jar
libraryjar=${SrcName}library-${pkgver}.jar
generatorjar=${SrcName}generator-${pkgver}.jar
integrationjar=${SrcName}integration-${pkgver}.jar
pkgURL=https://hamcrest.googlecode.com/files/
wgetopts="${wgetopts} --no-check-certificate"
if [ ! -e $corejar ]; then
  wget $wgetopts ${pkgURL}${corejar}
fi
if [ ! -e $libraryjar ]; then
  wget $wgetopts ${pkgURL}${libraryjar}
fi
if [ ! -e $generatorjar ]; then
  wget $wgetopts ${pkgURL}${generatorjar}
fi
if [ ! -e $integrationjar ]; then
  wget $wgetopts ${pkgURL}${integrationjar}
fi
EOF
   ;;
   icedtea-) # download icedtea and all the additional files
    cat << "EOF"
wgetopts="-e use_proxy=yes -e http_proxy=$http_proxy -e ftp_proxy=$ftp_proxy"
_icedtea_ver=2.4.1
cp ${sourcedir}/${SrcName}${_icedtea_ver}*.patch .
if [ ! -e rhino1_7R4.zip ]; then
  if [ -e ${sourcedir}/rhino1_7R4.zip ]; then
    cp ${sourcedir}/rhino1_7R4.zip .
  fi
fi
_CORBA_CHANGESET=23ae4e0e0cce
_JAXP_CHANGESET=5be6b670d08b
_JAXWS_CHANGESET=c0e48fdfb695
_JDK_CHANGESET=65d95818d79e
_LANGTOOLS_CHANGESET=91c95fd8eea8
_OPENJDK_CHANGESET=ae86c6974e8e
_HOTSPOT_CHANGESET=5f53e7717116
if [ ! -e icedtea-${_icedtea_ver}.tar.gz ]; then
  wget $wgetopts http://icedtea.classpath.org/download/source/icedtea-${_icedtea_ver}.tar.gz
fi
_url=http://icedtea.classpath.org/hg/release/icedtea7-forest-${_icedtea_ver:0:3}
wgetopts="${wgetopts} --output-document"
if [ ! -e openjdk.tar.gz ]; then
  wget $wgetopts openjdk.tar.gz ${_url}/archive/${_OPENJDK_CHANGESET}.tar.gz
fi
if [ ! -e corba.tar.gz ]; then
  wget $wgetopts corba.tar.gz ${_url}/corba/archive/${_CORBA_CHANGESET}.tar.gz
fi
if [ ! -e jaxp.tar.gz ]; then
  wget $wgetopts jaxp.tar.gz ${_url}/jaxp/archive/${_JAXP_CHANGESET}.tar.gz
fi
if [ ! -e jaxws.tar.gz ]; then
  wget $wgetopts jaxws.tar.gz ${_url}/jaxws/archive/${_JAXWS_CHANGESET}.tar.gz
fi
if [ ! -e jdk.tar.gz ]; then
  wget $wgetopts jdk.tar.gz ${_url}/jdk/archive/${_JDK_CHANGESET}.tar.gz
fi
if [ ! -e langtools.tar.gz ]; then
  wget $wgetopts langtools.tar.gz ${_url}/langtools/archive/${_LANGTOOLS_CHANGESET}.tar.gz
fi
if [ ! -e hotspot.tar.gz ]; then
  wget $wgetopts hotspot.tar.gz ${_url}/hotspot/archive/${_HOTSPOT_CHANGESET}.tar.gz
fi
EOF
    cat << "EOF"
wgetopts="-e use_proxy=yes -e http_proxy=$http_proxy -e ftp_proxy=$ftp_proxy"
if [ ! -e rhino1_7R4.zip ]; then
  wget $wgetopts https://github.com/downloads/mozilla/rhino/rhino1_7R4.zip
fi
cd $(tar vxf ${SrcName}${_icedtea_ver}.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   jasper-|docbook-xml-) # src is a zip file
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
EOF
    case $srcname in
       docbook-xml*)
           cat << "EOF"
for f in *.zip; do
docbookDir="${f%.zip}"
done
mkdir -pv $docbookDir
cd $docbookDir
unzip ../${SrcName}*.zip
EOF
       ;;
       *)
         cat << "EOF"
unzip ${SrcName}*.zip
cd ${SrcName}*
EOF
       ;;
    esac
   ;;
   jdk-)
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*-linux-x64.tar.gz | awk -F\/ 'END{print $1}')
EOF
   ;;
   junit) # git the source, so srcname is junit not junit-
    cat << "EOF"
if [ ! -d junit ]; then
  git clone https://github.com/junit-team/junit.git
fi
cd junit
EOF
   ;;
   krb5-) # untars to a tar.gz and a tar.gz.asc
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
tar xvf ${SrcName}*.tar
#  ** TODO **
# check the gpg key here but need to download it first
rm *.asc
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   libreoffice-) # don't need the translations. need --no-overwrite-dir when untaring
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
rm -rf libreoffice-translations*
cd $(tar vxf ${SrcName}[0-9]*.tar.*z* --no-overwrite-dir | awk -F\/ 'END{print $1}')
EOF
   ;;
   Linux-PAM-|libusb-) # do not want to untar the docs or libusb-compat
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}?.?.?.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
# add this if you want the clang compiler
#   llvm-)
#    cat << "EOF"
#wgetopts="-e use_proxy=yes -e http_proxy=$http_proxy -e ftp_proxy=$ftp_proxy"
#clangSrc=cfe-3.3.src.tar.gz
#compilerrt=compiler-rt-3.3.src.tar.gz
#releasevers=3.3
#if [ ! -e $clangSrc ]; then
#  wget $wgetopts http://llvm.org/releases/${releasevers}/${clangSrc}
#fi
#if [ ! -e $compilerrt ]; then
#  wget $wgetopts http://llvm.org/releases/${releasevers}/${compilerrt}
#fi
#cp ${sourcedir}/${SrcName}*.* .
#cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
#EOF
#   ;;
   LVM2.|sg3_utils-|zip|icu4c-|cdparanoia-|xterm-|sgml-common-|openldap-) # a .tgz src file
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   MesaLib-) # download the glu src and extract to Mesa-xxx not MesaLib
    cat << "EOF"
wgetopts="-e use_proxy=yes -e http_proxy=$http_proxy -e ftp_proxy=$ftp_proxy"
glusrc="glu-9.0.0.tar.bz2"
gludir="glu-9.0.0"
if [ ! -e $glusrc ]; then
wget $wgetopts ftp://ftp.freedesktop.org/pub/mesa/glu/${glusrc}
fi
tar xf $glusrc
cp ${sourcedir}/${SrcName}*.* .
tar xf ${SrcName}*.tar.*z*
cd Mesa-*
EOF
   ;;
   nasm-) # delete the docs file
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
rm ${SrcName}*doc.tar.xz
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   nss-) # copy the patch from patches/security
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cp ${blfsfiles}/patches/security/nss*.patch .
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   php-) # wget the docs (single html)
    cat << "EOF"
wgetopts="-e use_proxy=yes -e http_proxy=$http_proxy -e ftp_proxy=$ftp_proxy"
cp ${sourcedir}/${SrcName}*.* .
phpManual=php_manual_en.html.gz
if [ ! -e $phpManual ]; then
wget $wgetopts -O $phpManual http://us.php.net/get/${phpManual}/from/this/mirror
fi
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   Python-3) # get the docs as well
    cat << "EOF"
wgetopts="-e use_proxy=yes -e http_proxy=$http_proxy -e ftp_proxy=$ftp_proxy"
pythondocs="python-${Python3vers}-docs-html.tar.bz2"
if [ ! -e $pythondocs ]; then
wget $wgetopts http://docs.python.org/ftp/python/doc/${Python3vers}/${pythondocs}
fi
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   shadow-) # delete original src
    cat << "EOF"
rm -rf shadow*.tar.*z*
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   smpeg-) # get the source and a patch
    pkgvers=${srcname}0.4.4.tar.gz
    pkgURL=ftp://ftp.uwsg.indiana.edu/linux/gentoo/distfiles/
    wgetwrite $pkgvers $pkgURL
    cat << "EOF"
cp ${blfsfiles}/patches/multimedia/smpeg-0.4.4-gcc41-1.patch .
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   tcl*) # there is -src and -html so specify src
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*-src.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   telepathy-glib-|telepathy-logger-|telepathy-farstream-|telepathy-mission-control-)
     case $srcname in
        telepathy-glib-)
            pkgvers=${srcname}0.21.1.tar.gz
            pkgURL=http://telepathy.freedesktop.org/releases/telepathy-glib/
        ;;
        telepathy-logger-)
            pkgvers=${srcname}0.8.0.tar.bz2
            pkgURL=http://telepathy.freedesktop.org/releases/telepathy-logger/
        ;;
        telepathy-farstream-)
            pkgvers=${srcname}0.6.0.tar.gz
            pkgURL=http://telepathy.freedesktop.org/releases/telepathy-farstream/
        ;;
        telepathy-mission-control-)
            pkgvers=${srcname}5.15.0.tar.gz
            pkgURL=http://telepathy.freedesktop.org/releases/telepathy-mission-control/
        ;;
     esac
     wgetwrite $pkgvers $pkgURL
   ;;
   Tie-IxHash-)
    cat << "EOF"
wgetopts="-e use_proxy=yes -e http_proxy=$http_proxy -e ftp_proxy=$ftp_proxy"
tieixhashSrc=${SrcName}1.22.tar.gz
if [ ! -e $tieixhashSrc ]; then
wget $wgetopts http://search.cpan.org/CPAN/authors/id/C/CH/CHORNY/${tieixhashSrc}
fi
cd $(tar vxf $tieixhashSrc | awk -F\/ 'END{print $1}')
EOF
   ;;
   xcb-util-)
    cat << "EOF"
cp ${sourcedir}/${SrcName}[0-9]*.tar.*z* .
cd $(tar vxf ${SrcName}[0-9]*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   $xproto|$xlib|$xapp|$xfont)
    cat << "EOF"
cp -r ${sourcedir}/${SrcName}/* . # copy the md5 file and sources
EOF
   ;;
   yajl-) # git the source
    cat << "EOF"
git clone git://github.com/lloyd/yajl
cd yajl
EOF
   ;;
   *) # tar.xz,gz,bz2,tgz
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
esac
    cat << "EOF"
endtime=$( date +%s )
unpacktime=$( expr $endtime - $starttime )
starttime=$( date +%s )
}
EOF
} # end unpack
#
WriteScript () {
# remove docs statements and && and some other stuff
case $pkgname in
    acl)
     if ! $as_root; then
       GetCommands \
        | sed -e 's/INSTALL_USER=root/INSTALL_USER=acl/' \
              -e 's/INSTALL_GROUP=root/INSTALL_GROUP=acl/' \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_BIN_DIR)/d' getfacl\/Makefile" \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_BIN_DIR)/d' setfacl\/Makefile" \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_BIN_DIR)/d' chacl\/Makefile" \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man1\/Makefile" \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man3\/Makefile" \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man5\/Makefile" \
              -e "/make install/i\  sed -i '0,/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_INC_DIR)/{//d;}' include\/Makefile" \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_INC_DIR)\\\/sys/d' include\/Makefile" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
     else
       GetCommands \
        | sed -e 's/\(.*\)&&$/\1/' \
        >> $Output
     fi
    ;;
    aisleriot)
       GetInternalCommands basicComms \
        | sed -e 's/disable-static/disable-static \\\n\              --with-card-theme-formats=svg/' \
        >> $Output
    ;;
    alacarte)
       GetInternalCommands basicComms >> $Output
    ;;
    alsa-lib)
       GetCommands \
        | sed -e '/make doc/,/install -m644 src\/.libs\/libasound.a/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    alsa-utils)
         if [ "$SYSTEMD" = yes ]; then
           GetCommands \
            | sed -e 's#\./configure#\./configure --with-udev-rules-dir=/usr/lib/udev/rules.d \\\n\   --with-systemdsystemunitdir=/usr/lib/systemd/system#' \
                  -e '/make install-alsa/d' \
                  -e '/make install/a\  cd alsactl\n\  make 90-alsa-restore.rules\n\  install -D -m644 90-alsa-restore.rules \/usr\/lib\/udev\/rules.d' \
                  -e '/touch/,/usermod/d' \
                  -e 's/\(.*\)&&$/\1/' \
            >> $Output
         else
           GetCommands \
            | sed -e '/make install-alsa/d' \
                  -e '/touch/,/usermod/d' \
                  -e 's/\(.*\)&&$/\1/' \
            >> $Output
         fi
    ;;
    apache)
       if ! $as_root; then
         GetCommands \
          | sed -e '/groupadd/,/-s \/bin\/false/d' \
                -e '/make install-httpd/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/make install-httpd/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    apache-ant)
       GetCommands \
        | sed -e '/cp -v/d' \
              -e 's/1.8.4/1.9.1/' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    attr)
     if ! $as_root; then
       GetCommands \
        | sed -e 's/INSTALL_USER=root/INSTALL_USER=attr/' \
              -e 's/INSTALL_GROUP=root/INSTALL_GROUP=attr/' \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_BIN_DIR)/d' attr\/Makefile" \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_BIN_DIR)/d' getfattr\/Makefile" \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_BIN_DIR)/d' setfattr\/Makefile" \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man1\/Makefile" \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man2\/Makefile" \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man3\/Makefile" \
              -e "/make install/i\  sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man5\/Makefile" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
     else
       GetCommands \
        | sed -e 's/\(.*\)&&$/\1/' \
        >> $Output
     fi
    ;;
    avahi)
       if ! $as_root; then
         if [ "$SYSTEMD" = yes ]; then
           GetCommands \
            | sed -e '/groupadd/,/groupadd/d' \
                  -e '/--disable-qt4        \\/d' \
                  -e 's/--with-distro=none /--with-distro=none  \\/' \
                  -e '/--with-distro=none/a\      --with-autoipd-user=avahi \\\n\      --with-autoipd-group=avahi \\\n\      --with-systemdsystemunitdir=/usr/lib/systemd/system' \
                  -e '/make install-avahi/d' \
                  -e 's/\(.*\)&&$/\1/' \
            >> $Output
         else
           GetCommands \
            | sed -e '/groupadd/,/groupadd/d' \
                  -e '/--disable-qt4        \\/d' \
                  -e '/make install-avahi/d' \
                  -e 's/\(.*\)&&$/\1/' \
            >> $Output
         fi
       else
         GetCommands \
          | sed -e '/--disable-qt4        \\/d' \
                -e '/make install-avahi/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    avr-binutils)
         GetInternalCommands avrbinutilsComms >> $Output
    ;;
    avr-gcc)
         GetInternalCommands avrgccComms >> $Output
    ;;
    avr-libc)
      GetInternalCommands basicComms \
        | sed -e 's/disable-static/disable-static --host=avr/' \
        >> $Output
    ;;
    baobab)
       GetInternalCommands basicComms >> $Output
    ;;
    bind)
       if ! $as_root; then
         GetCommands \
          | sed -e '/patch -Np1 -i/d' \
                -e '\/bin\/tests\/system\/ifconfig.sh/,/grep/d' \
                -e '/groupadd/,/useradd/d' \
                -e '/mknod/,/chmod/d' \
                -e 's/rndc-confgen/\/usr\/sbin\/rndc-confgen/' \
                -e '/cp \/etc\/resolv.conf/,/dig www/d' \
                -e '/dig www.linuxfromscratch.org/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/patch -Np1 -i/d' \
                -e '\/bin\/tests\/system\/ifconfig.sh/,/grep/d' \
                -e '/cp \/etc\/resolv.conf/,/dig www.linuxfromscratch.org/d' \
                -e '/dig www.linuxfromscratch.org/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    blfs-btscrpts)
        GetInternalCommands blfsbtscrptsComms >> $Output
    ;;
    bluez)
       if [ "$SYSTEMD" = yes ]; then
         GetCommands \
          | sed -e 's/--without-systemdunitdir/--with-systemdunitdir=\/usr\/lib\/systemd\/system/' \
                -e '/make install-bluetooth/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/make install-bluetooth/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    boost)
       GetInternalCommands boostComms >> $Output
    ;;   
    cacerts)
        GetcacertsCommands \
        | sed -e '/wget --output-document/i wgetopts="-e use_proxy=yes -e http_proxy=\$http_proxy -e ftp_proxy=\$ftp_proxy"' \
              -e 's/wget --output-document/wget \$wgetopts -O/' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    caribou)
       GetInternalCommands basicComms \
        | sed -e 's/libexecdir=\/usr\/lib/libexecdir=\/usr\/lib\/caribou/' \
              -e "/make_commands()$/N;/make_commands()\n{ :/a\  sed -i -e 's\/ -shared \/ -Wl,-O1,--as-needed\\\\0/g' libtool" \
        >> $Output
    ;;
    cloog)
       GetInternalCommands basicComms \
        | sed -e 's/\.\/configure --prefix=\/usr/\.\/configure --prefix=\/usr --with-isl=system/' \
        >> $Output
    ;;
    colord)
       if [ "$SYSTEMD" = yes ]; then
         GetCommands \
          | sed -e '/groupadd/,/-g colord -s \/bin\/false colord/d' \
                -e 's/--disable-systemd-login/--with-systemdsystemunitdir=\/usr\/lib\/systemd\/system/' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/groupadd/,/-g colord -s \/bin\/false colord/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    colord-gtk)
       GetInternalCommands basicComms \
        | sed -e 's/--prefix=\/usr/--prefix=\/usr \\\n\              --enable-vala/' \
        >> $Output
    ;;
    coreutils)
        GetInternalCommands coreutilsComms >> $Output
    ;;
    cracklib)
       GetCommands \
        | sed -e 's/--prefix=\/usr/--prefix=\/usr --sbindir=\/usr\/bin/' \
              -e 's/--with-default-dict=\/lib/--with-default-dict=\/usr\/lib/' \
              -e '/mv -v/,/ln -v -sf ..\/..\/lib/d' \
              -e '/create-cracklib-dict/,/\/usr\/share\/dict\/cracklib-extra-words/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    cups)
       if ! $as_root; then
         if [ "$SYSTEMD" = yes ]; then
           GetCommands \
            | sed -e '/useradd/,/usermod/d' \
                  -e '/sed -i/d' \
                  -e '/patch -Np1 -i/i patch -Np1 -i ../cups-systemd-socket.patch' \
                  -e 's/--with-system-groups=lpadmin/--with-system-groups=lpadmin \\\n  --with-systemdsystemunitdir=\/usr\/lib\/systemd\/system/' \
                  -e '/make install-cups/d' \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BUILDROOT)\\\\\$(DBUSDIR)\\\/system.d; \\\\\\\/d' desktop\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LOCALEDIR)/d' locale\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(DATADIR)\\\/mime/d' conf\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(MANDIR)\\\/man1/d' man\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(MANDIR)\\\/man5/d' man\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(MANDIR)\\\/man7/d' man\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(AMANDIR)\\\/man\\\\\$(MAN8DIR)/d' man\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BINDIR)/d' Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' cups\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' filter\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' cgi-bin\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' ppdc\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' scheduler\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BINDIR)/d' test\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BINDIR)/d' berkeley\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(SBINDIR)/d' berkeley\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) \\\\\$(BINDIR)/d' ppdc\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(SBINDIR)/d' scheduler\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(SBINDIR)/d' systemv\/Makefile" \
                  -e "/make install/i\  sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BINDIR)/d' systemv\/Makefile" \
                  -e 's/\(.*\)&&$/\1/' \
            >> $Output
         else
           GetCommands \
            | sed -e '/useradd/,/usermod/d' \
                  -e '/make install-cups/d' \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BUILDROOT)\\\\\$(DBUSDIR)\\\/system.d; \\\\\\\/d' desktop\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LOCALEDIR)/d' locale\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(DATADIR)\\\/mime/d' conf\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(MANDIR)\\\/man1/d' man\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(MANDIR)\\\/man5/d' man\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(MANDIR)\\\/man7/d' man\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(AMANDIR)\\\/man\\\\\$(MAN8DIR)/d' man\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BINDIR)/d' Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' cups\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' filter\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' cgi-bin\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' ppdc\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' scheduler\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BINDIR)/d' test\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BINDIR)/d' berkeley\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(SBINDIR)/d' berkeley\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) \\\\\$(BINDIR)/d' ppdc\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(SBINDIR)/d' scheduler\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(SBINDIR)/d' systemv\/Makefile" \
                  -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BINDIR)/d' systemv\/Makefile" \
                  -e 's/\(.*\)&&$/\1/' \
            >> $Output
         fi
       else
         GetCommands \
          | sed -e '/make install-cups/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    curl)
       GetCommands \
        | sed -e '/cp -v -R docs/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    cvs)
       GetCommands \
        | sed -e '/make -C doc html txt/d' \
              -e "/sed -e 's\/rsh};\/ssh};/,/-i src\/sanity.sh/d" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    cyrus-sasl)
       GetCommands \
        | sed -e 's/\.\/configure/CFLAGS+="-fPIC" \.\/configure/' \
              -e '/make install-saslauthd/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    db)
       if ! $as_root; then
         GetCommands \
          | sed -e 's/root:root/db:db/' \
              -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    dbus)
       if ! $as_root; then
         GetCommands \
          | sed -e '/groupadd/,/-u 18 -g messagebus/d' \
                -e '/make distclean/,/kill \$DBUS_SESSION_BUS_PID/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/make distclean/,/make install-dbus/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    dhcpcd)
       GetCommands \
        | sed -e '/make install-service-dhcpcd/d' \
              -e '/cat > \/etc\/sysconfig\/ifconfig.eth0/,/EOF/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    docbook-xml)
       GetCommands \
        | sed -e '/chown -R root:root/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    docbook-xsl)
       GetCommands \
        | sed -e '/tar -xf/d' \
              -e '/install -v -m644 -D README/ i install -v -d \/usr\/share\/doc\/docbook-xsl-1.77.1' \
              -e '/cp -v -R doc/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    dialog|dotconf|ffmpegthumnaler|gnome-common|isl|libcdio|libgphoto2|nmap|portaudio|pygtk|pyatspi|ragel|yelp-tools)
       GetInternalCommands  basicComms >> $Output
    ;;
    dsktp-file-utls)
       GetCommands \
        | sed -e '/update-desktop-database/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    esound)
       GetCommands \
        | sed -e '/chown -v root:root \/usr\/share\/doc\/esound-0.2.41/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    espeak)
       GetInternalCommands espeakComms >> $Output
    ;;
    evol-data-server)
       GetInternalCommands basicComms \
        | sed -e 's/--libexecdir=\/usr\/lib/--libexecdir=\/usr\/lib\/evolution-data-server \\\n\              --enable-vala-bindings --disable-uoa/' \
        >> $Output
    ;;
    evolution)
       GetInternalCommands basicComms \
        | sed -e 's/disable-static/disable-static \\\n\              --disable-bogofilter \\\n\              --disable-spamassassin \\\n\              --disable-text-highlight \\\n\              --disable-pst-import/' \
        >> $Output
    ;;
    faac)
       GetCommands \
        | sed -e '/Front_Left/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    faad2)
       GetCommands \
        | sed -e '/sample.wav/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    ffmpeg)
       GetCommands \
        | sed -e 's/LIBRARY_PATH=\$XORG_PREFIX\/lib/CFLAGS+="-I\/usr\/include\/openjpeg-1.5"/ ' \
              -e '/unset LIBRARY_PATH/d' \
              -e '/pushd doc/,/unset DOCNAME/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    firefox)
       GetCommands \
        | sed -e 's/\#mk_add_options/mk_add_options/' \
              -e '/DBus-Glib/,/--disable-libnotify/d' \
              -e 's/\#ac_add_options --enable-startup-notification/ac_add_options --enable-startup-notification/' \
              -e '/chown -R -v root:root \/usr\/lib\/firefox-'"$ffoxvers"'/d' \
              -e '/make -C firefox-build-dir install/,/ln -sfv ..\/mozilla\/plugins \/usr\/lib\/firefox-'"$ffoxvers"'/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    folks)
       GetInternalCommands basicComms \
        | sed -e 's/disable-static/disable-static \\\n\              --enable-vala/' \
        >> $Output
    ;;
    foomatic)
       GetInternalCommands basicComms \
        | sed -e 's/disable-static/disable-static \\\n\    --enable-dbus/' \
        >> $Output
    ;;
    fontconfig)
        GetCommands \
        | sed -e '/install -v -dm755/,/\/usr\/share\/{man\/man/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    freeglut)
       GetCommands \
        | sed -e '/configure_commands()/ised -i "s\/smooth_opengl3 \/\/" progs\/demos\/Makefile.\*\nautoreconf -vfi' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    freetype)
        GetCommands \
        | sed -e '/cp -v -R docs/ i install -v -m755 -d \/usr\/share\/doc\/freetype-'"${freetypevers}"'' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gdk-pixbuf)
       GetCommands \
        | sed -e '/gdk-pixbuf-query-loaders/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gdm)
       GetInternalCommands basicComms \
        | sed -e 's/libexecdir=\/usr\/lib/libexecdir=\/usr\/lib\/gdm/' \
              -e 's/disable-static/disable-static \\\n\              --with-at-spi-registryd-directory=\/usr\/lib\/at-spi2-core \\\n\              --with-check-accelerated-directory=\/usr\/lib\/gnome-session \\\n\              --with-authentication-agent-directory=\/usr\/lib\/polkit-gnome \\\n\              --with-systemd/' \
        >> $Output
    ;;
    ghostscript)
       GetCommands \
        | sed -e 's/LIBS=-lz/LIBS=-lz --with-install-cups/' \
              -e '/bin\/gs/d' \
              -e '/tar -xvf/ i for (( i=0; i<\${#fontfile[@]}; i++ )); do' \
              -e 's/\*\*EDITME<font-tarball>EDITME\*\*/\${fontfile[\$i]}/' \
              -e '/tar -xvf/ a done' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gimp)
       GetCommands \
        | sed -e 's/ --without-gvfs//' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    git)
       if ! $as_root; then
         GetCommands \
          | sed -e "/configure_commands()/ i sed -i \"/ifndef NO_GETTEXT/{ N; s/ifndef NO_GETTEXT\\\n\\\t\\\\\$(INSTALL) -d -m 755 '\\\\\$(DESTDIR_SQ)\\\\\$(localedir_SQ)'// }\" Makefile" \
                -e "/configure_commands()/ i sed -i '/(cd po\\\/build\\\/locale \\\&\\\&/,/endif/d' Makefile" \
                -e '/make html/,/make man/d' \
                -e '/make install-man/d' \
                -e '/tar -xf  ..\/git-htmldocs/ i mkdir -p \/usr\/share\/doc\/git-'"$gitvers"'\/man-pages\/{html,text}' \
                -e '/git config/d' \
                -e 's/\(.*\)&&$/\1/' \
          | awk '{if ($1 == "make" && $2 =="install")
print "  "$1" "$2"\n  cd po/build\n  for code in locale/*\n  do\n   if [ ! -d /usr/share/${code}/LC_MESSAGES ]; then\n     install -v -d /usr/share/${code}/LC_MESSAGES\n   fi\n   cp ${code}/LC_MESSAGES/git.mo /usr/share/${code}/LC_MESSAGES/\n  done\n  cd ../..";
else
print $0;
}' \
        >> $Output
       else
         GetCommands \
          | sed -e '/make html/,/make man/d' \
                -e '/make install-man/d' \
                -e '/tar -xf  ..\/git-htmldocs/ i mkdir -p \/usr\/share\/doc\/git-1.8.0\/man-pages\/{html,text}' \
                -e 's/\(.*\)&&$/\1/' \
        >> $Output
       fi
    ;;
    gjs)
       GetCommands \
        | sed -e 's/prefix=\/usr/prefix=\/usr --disable-tests/' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output 
    ;;
    gmime)
       GetCommands \
        | sed -e '/pushd/,/popd/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gnome-bckgrnds)
       GetInternalCommands basicComms  >> $Output
    ;;
    gnome-bluetooth)
       GetInternalCommands basicComms \
        | sed -e 's/disable-static/disable-static \\\n\              --disable-desktop-update \\\n\              --disable-icon-update/' \
              -e "/make_commands()$/N;/make_commands()\n{ :/a\  sed -i -e 's\/ -shared \/ -Wl,-O1,--as-needed\\\\0/g' libtool" \
        >> $Output
    ;;
    gnome-calculator)
       GetInternalCommands basicComms >> $Output
    ;;
    gnome-cntrl-cntr)
       GetInternalCommands basicComms\
        | sed -e 's/libexecdir=\/usr\/lib/libexecdir=\/usr\/lib\/gnome-control-center/' \
              -e "/make_commands()$/N;/make_commands()\n{ :/a\  sed -i -e 's\/ -shared \/ -Wl,-O1,--as-needed\\\\0/g' libtool" \
        >> $Output
    ;;
    gnome-dictionary)
       GetInternalCommands basicComms >> $Output
    ;;
    gnome-disk-util)
       GetInternalCommands basicComms >> $Output
    ;;
    gnome-doc-utils)
       GetInternalCommands basicComms >> $Output
    ;;
    gnome-games)
       if ! $as_root; then
         GetCommands \
          | sed -e '/install -v/,/chown/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi 
    ;;
    gnome-js-common)
       GetInternalCommands basicComms >> $Output
    ;;
    gnome-menus)
       GetInternalCommands basicComms \
        | sed -e '/configure_commands()/i patch -Np1 -i ../gnome-menus-3.8.0-calculator-1.patch' \
        >> $Output
    ;;
    gnome-panel)
       GetInternalCommands basicComms \
        | sed -e '/configure_commands()/i patch -Np1 -i ..\/gnome-panel-3.6.2-gnome-desktop-3.8.patch\npatch -Np0 -i ..\/gnome-panel-3.6.2-drop-gweather-xml-include.patch\npatch -Np1 -i ..\/gnome-panel-3.6.2-18_fix_force_quit_applet.patch\npatch -Np1 -i ..\/gnome-panel-3.6.2-fix-autoconf.patch' \
              -e '/configure_commands()/i autoreconf -fi' \
              -e 's/libexecdir=\/usr\/lib/libexecdir=\/usr\/lib\/gnome-panel/' \
        >> $Output
    ;;
    gnm-scrnsaver)
       GetInternalCommands basicComms \
        | sed -e '/configure_commands()/i patch -Np1 -i ../gnome-screensaver-3.6.1-move-desktop-file-1.patch' \
              -e "/configure_commands()/i sed -i 's\/AM_CONFIG_HEADER\/AC_CONFIG_HEADERS\/' configure.ac" \
              -e '/configure_commands()/i autoreconf -fi' \
              -e 's/libexecdir=\/usr\/lib/libexecdir=\/usr\/lib\/gnome-screen-saver/' \
        >> $Output
    ;;
    gnome-serch-tool)
       GetInternalCommands basicComms >> $Output
    ;;
    gnome-session)
       GetInternalCommands basicComms \
        | sed -e 's/libexecdir=\/usr\/lib/libexecdir=\/usr\/lib\/gnome-session/' \
              -e 's/disable-static/disable-static --enable-systemd/' \
        >> $Output
    ;;
    gnome-set-daemon)
       GetInternalCommands basicComms \
        | sed -e 's@libexecdir=/usr/lib@libexecdir=/usr/lib/gnome-settings-daemon@' \
              -e "/make_commands()$/N;/make_commands()\n{ :/a\  sed -i -e 's\/ -shared \/ -Wl,-O1,--as-needed\\\\0/g' libtool" \
        >> $Output
    ;;
    gnome-shell)
       GetInternalCommands basicComms \
        | sed -e '/configure_commands()/i patch -Np1 -i ../gnome-shell-3.8.4-nm-libexecdir.patch' \
              -e 's@libexecdir=/usr/lib@libexecdir=/usr/lib/gnome-shell@' \
              -e "/make_commands()$/N;/make_commands()\n{ :/a\  sed -i -e 's\/ -shared \/ -Wl,-O1,--as-needed\\\\0/g' libtool" \
        >> $Output
    ;;
    gnome-system-log)
       GetInternalCommands basicComms >> $Output
    ;;
    gnome-terminal)
       GetCommands \
        | sed -e 's/sysconfdir=\/etc/sysconfdir=\/etc --localstatedir=\/var \\\n\    --libexecdir=\/usr\/lib\/gnome-terminal/' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gnome-user-docs)
       GetInternalCommands basicComms >> $Output
    ;; 
    gnm-user-share)
       GetInternalCommands basicComms \
        | sed -e 's@libexecdir=/usr/lib@libexecdir=/usr/lib/gnome-user-share@' \
        >> $Output
    ;;
    gnupg)
       GetCommands \
        | sed -e '/makeinfo --html/,/make -C doc/d' \
              -e '/install -v -m755 -d \/usr\/share\/doc/i ln -s gpg2 \/usr\/bin\/gpg\n ln -s gpgv2 \/usr\/bin\/gpgv\n rm \/usr\/share\/gnupg\/com-certs.pem' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gnutls)
       GetCommands \
        | sed -e '/\/usr\/share\/doc\//d' \
              -e '/cp -v -R/,/make -C doc\/reference/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    goa)
       GetInternalCommands basicComms \
        | sed -e 's/--libexecdir=\/usr\/lib/--libexecdir=\/usr\/lib\/gnome-online-accounts/' \
        >> $Output
    ;;
    gperf)
       GetCommands \
        | sed -e '/makeinfo/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gpm)
       if [ "$SYSTEMD" = yes ]; then
         GetCommands \
          | sed -e '/make install-gpm/d' \
                -e '/cat > \/etc\/sysconfig\/mouse/,/EOF/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/make install-gpm/d' \
                -e 's/\*\*EDITME<yourdevice>EDITME\*\*/\/dev\/input\/mice/' \
                -e 's/\*\*EDITME<yourprotocol>EDITME\*\*/imps2/' \
                -e 's/\*\*EDITME<additional options>EDITME\*\*//' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    gset-dsktp-schms|gvfs)
       GetCommands \
        | sed -e '/glib-compile-schemas/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gsl)
       GetCommands \
        | sed -e '/make html/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gtkhtml)
       GetInternalCommands basicComms >> $Output
    ;;
    gtkplus2)
       GetCommands \
        | sed -e '/gtk-query-immodules-2.0/d' \
              -e '/cat/,/End root commands/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gtkplus3)
       GetCommands \
        | sed -e '/rm tests/,/make check/d' \
              -e '/gtk-query-immodules-3.0/,/glib-compile-schemas/d' \
              -e 's/\*\*EDITMEAdwaitaEDITME\*\*/Adwaita Cupertino/' \
              -e 's/\*\*EDITMEgnomeEDITME\*\*/gnome/' \
              -e 's/\*\*EDITMEClearwaitaEDITME\*\*/Adwaita Cupertino/' \
              -e 's/\*\*EDITMEelementaryEDITME\*\*/gnome/' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gtk-vnc)
       GetInternalCommands gtkvncComms >> $Output
    ;;
    guile)
       GetCommands \
        | sed -e '/make html/,/unset DIRNAME/d' \
              -e '/find examples -name/,/cp -v -R doc\/ref\/guile.htm/d' \
              -e '/for DIRNAME/,/done/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gutenprint)
       GetCommands \
        | sed -e '/\/etc\/rc.d\/init.d\/cups restart/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    icedtea-web)
       GetCommands \
        | sed -e 's/{JAVA_HOME}\/man/{JAVA_HOME}\/man --with-firefox=\/usr\/bin\/firefox/' \
              -e '/ln -s/i install -m644 javaws.png /usr/share/pixmaps\ninstall -m644 {javaws,itweb-settings}.desktop /usr/share/applications' \
              -e 's/<\*\*EDITMEarchEDITME\*\*>\///' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    iptables)
       GetCommands \
        | sed -e 's/--with-xtlibdir=\/lib/--with-xtlibdir=\/usr\/lib/' \
              -e '/ln -sfv ..\/..\/sbin/,/make install-iptables/d' \
              -e "/configure_commands()/ i sed -i -e '\/sbin\\\/ldconfig/d' \\\\\n    -e '/\${INSTALL} -dm0755 \"\${DESTDIR}\${bindir}\";/'d iptables\/Makefile.in" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    iw)
       GetInternalCommands basicComms \
        | sed -e '/configure/,/disable-static/d' \
        >> $Output
    ;;
    java-hamcrest)
       GetInternalCommands hamcrestComms >> $Output
    ;;
    jdkbin)
       GetInternalCommands jdkbinComms >> $Output
    ;;
    json-c)
       GetCommands \
        | sed -e '/make install/a\   cp json_object_iterator.h /usr/include/json' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    junit)
       GetInternalCommands junitComms >> $Output
    ;;
    krb5)
       GetCommands \
        | sed -e '/gpg/d' \
              -e '/mv -v/d' \
              -e '/ln -v -sf/d' \
              -e '/cat > \/etc\/krb5.conf/,/make install-krb5/d' \
              -e '/unset LIBRARY/i install -dm 755 \/var\/lib\/krb5kdc\n install -pm 644 config-files\/kdc.conf \/var\/lib\/krb5kdc\/kdc.conf\n install -pm 644 config-files\/krb5.conf \/etc\/krb5.conf\ninstall -m 644 util\/ac_check_krb5.m4 \/usr\/share\/aclocal' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libassuan)
        GetCommands \
        | sed -e '/make -C doc pdf ps/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libcanberra)
       if [ "$GNOME_OR_XFCE" = xfce ]; then
         GetCommands \
          | sed -e 's/oss/oss --disable-schemas-install/' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       elif [ "$SYSTEMD" = yes ]; then
         GetCommands \
          | sed -e 's/oss/oss \\\n   --with-systemdsystemunitdir=\/usr\/lib\/systemd\/system/' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    libdaemon)
        GetCommands \
        | sed -e '/make -C doc doxygen/d' \
              -e '/install -v -m644 doc\/reference\/man/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libdvdcss)
       GetCommands \
        | sed -e '/doxygen.cfg/d' \
              -e '/make -C doc\/latex pdf/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libgcrypt)
        GetCommands \
        | sed -e '/make -C doc pdf ps html/,/makeinfo --plaintext/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libgda)
       GetCommands \
        | sed -e '/--enable-system-sqlite/ i --with-java=no \\' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libgdata)
       GetInternalCommands basicComms >> $Output
    ;;
    libgee)
       GetInternalCommands basicComms >> $Output
    ;;
    libgnomekbd)
       GetInternalCommands basicComms >> $Output
    ;;
    libgweather)
       GetInternalCommands basicComms \
        | sed -e 's/--prefix=\/usr/--prefix=\/usr --enable-locations-compression/' \
        >> $Output
    ;;
    libical)
       GetCommands \
        | sed -e '/mkdir build/i if [ ! -d build ]; then' \
              -e '/cd build/i fi' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libidl)
       GetCommands \
        | sed -e '/make pdf ps/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libidn)
       GetCommands \
        | sed -e '/cp/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libisoburn)
       GetCommands \
        | sed -e '/doxygen/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libksba)
       GetCommands \
        | sed -e '/makeinfo/,/make -C doc/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    liboauth)
       GetInternalCommands basicComms  >> $Output
    ;;
    libproxy)
       GetInternalCommands libproxyComms >> $Output
    ;;
    libpwquality)
       GetInternalCommands libpwqualityComms >> $Output
    ;;
    libreoffice)
       GetCommands \
        | sed -e '/tar -xf libreoffice/,/cd libreoffice/d' \
              -e '/tar -xvf ..\/libreoffice-translations/,/ln -sv ..\/..\/libreoffice-translations/d' \
              -e 's/--enable-python=system/--disable-python/' \
              -e '/--with-system-odbc/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    librest)
       GetInternalCommands basicComms >> $Output
    ;;
    libsoup)
       if [ "$GNOME_OR_XFCE" = xfce ]; then
         GetCommands \
          | sed -e 's/disable-static/disable-static --without-gnome/' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    libtasn1)
        GetCommands \
        | sed -e '/make -C doc\/reference install-data-local/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libtheora)
       GetCommands \
        | sed -e '/cd examples/,/install/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libtirpc)
       GetCommands \
        | sed -e '/mv -v/,/ln -sfv/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libunique)
      GetInternalCommands basicComms \
       | sed -e 's/--disable-static/--disable-static --disable-dbus/' \
       >> $Output
    ;;
    libusb|cpio)
       GetCommands \
        | sed -e '/make -C doc /d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libwacom)
      GetInternalCommands basicComms >> $Output
    ;;
    libxcb)
       GetCommands \
        | sed -e "/make install/i\  sed -i -e 's/libxcb\\\/install-sh/libxcb\\\/libxcb-1.9.1\\\/install-sh/' doc\\\/Makefile" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libxml2)
       GetCommands \
        | sed -e '/tar xf ../d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libzeitgeist)
      GetInternalCommands basicComms >> $Output
    ;;
    linux-pam)
       GetCommands \
        | sed -e 's/prefix=\/usr/prefix=\/usr --libdir=\/usr\/lib --sbindir=\/usr\/sbin/' \
              -e '/chmod -v 4755/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    llvm) # don't bother with clang at the moment
       GetCommands \
        | sed -e '/tar -xf/,/mv projects/d' \
              -e '/make -C docs/d' \
              -e '/install -v -m644 docs/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    lvm2)
       if [ "$SYSTEMD" = yes ]; then
         GetCommands \
          | sed -e 's/--enable-udev_sync/--enable-udev_sync \\\n\              --with-udev-prefix=\/usr \\\n\              --with-systemdsystemunitdir=\/usr\/lib\/systemd\/system \\\n\              --with-default-pid-dir=\/run \\\n\              --with-default-dm-run-dir=\/run \\\n\              --with-default-run-dir=\/run\/lvm \\\n\              --enable-dmeventd \\\n\              --enable-lvmetad \\\n\              --enable-udev_rules \\\n\              --with-default-locking-dir=\/run\/lock\/lvm/' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    mesalib)
       GetCommands \
        | sed -e '/\.\/configure --prefix=\$XORG_PREFIX --disable-static/i cd \.\.\/glu*' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    metacity)
       GetInternalCommands basicComms \
        | sed -e 's@libexecdir=/usr/lib@libexecdir=/usr/lib/metacity@' \
        >> $Output
    ;;
    mutter)
       GetInternalCommands basicComms \
        | sed -e 's@libexecdir=/usr/lib@libexecdir=/usr/lib/mutter@' \
              -e 's/disable-static/disable-static --enable-compile-warnings=no/' \
              -e "/make_commands()$/N;/make_commands()\n{ :/a\  sed -i -e 's\/ -shared \/ -Wl,-O1,--as-needed\\\\0/g' libtool" \
        >> $Output
    ;;
    mysql)
       GetInternalCommands mariadbComms >> $Output
    ;;
    nasm)
       GetCommands \
        | sed -e '/tar -xf/d' \
              -e '/cp -v doc\/info/,/install-info/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    nautilus-sendto)
       GetInternalCommands basicComms >> $Output
    ;;
    neon)
       GetCommands \
        | sed -e 's/disable-static/disable-static \\\n\              --with-expat --with-ssl=openssl \\\n\              --with-ca-certificates=\/etc\/ssl\/ca-bundle.crt/' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    netctl)
       GetInternalCommands netctlComms >> $Output
    ;;
    ntificatn-demon)
       GetInternalCommands ntificatndemonComms >> $Output
    ;;
    networkmanager)
       if [ "$SYSTEMD" = yes ]; then
         GetCommands \
          | sed -e '/--disable-ppp/i\              --with-dhcpcd=\/usr\/sbin\/dhcpcd \\\n\              --with-iptables=\/usr\/sbin\/iptables \\\n\              --with-systemdsystemunitdir=\/usr\/lib\/systemd\/system \\\n\              --with-udev-dir=\/usr\/lib\/udev \\\n\              --with-session-tracking=systemd \\\n\              --disable-static \\' \
                -e '/make install-networkmanager/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/make install-networkmanager/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    nss)
       GetCommands \
        | sed -e '/patch/i patch -Np1 -i ../nss-3.15.1-add_spi+cacert_ca_certs.patch' \
              -e '/cd ..\/dist/d' \
              -e '/install -v -m755 Linux/i\  cd ..\/dist' \
              -e '/cp -v -RL/ i cd ..\/dist' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    opal)
       GetCommands \
        | sed -e "/make install/ i\  sed -i '/mkdir -p \\\\\$(DESTDIR)\\\\\$(libdir); chmod 755 \\\\\$(DESTDIR)\\\\\$(libdir)/d' Makefile" \
              -e "/make install/ i\  sed -i '/mkdir -p \\\\\$(DESTDIR)\\\\\$(libdir)\\\/pkgconfig ; chmod 755 \\\\\$(DESTDIR)\\\\\$(libdir)\\\/pkgconfig/d' Makefile" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    openjdk)
       GetInternalCommands openjdkComms >> $Output
    ;;
    openldap)
       GetCommands \
        | sed -e '/chown -R ldap:ldap/,/ldapsearch/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    openssh)
       if ! $as_root; then
         GetCommands \
          | sed -e '/install -v -m700 -d \/var\/lib\/sshd/,/-s \/bin\/false -u 50 sshd/d' \
                -e '/ssh-keygen/,/echo "ChallengeResponseAuthentication/d' \
                -e '/make install-sshd/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/ssh-keygen/,/echo "ChallengeResponseAuthentication/d' \
                -e '/make install-sshd/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    openssl)
       GetCommands \
        | sed -e '/\/usr\/share\/doc\/openssl/d' \
              -e '/cp -v -r doc/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    pango)
       GetCommands \
        | sed -e '/pango-querymodules/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    parted)
       GetCommands \
        | sed -e '/make -C doc html/,/dvips/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    pcre)
       if [ "$SYSTEMD" = yes ]; then 
         GetCommands \
          | sed -e '/mv -v/,/ln -sfv/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands  >> $Output
       fi
    ;;
    php)
       rtrnCom="" # need the version of php used in the book commands
       getComms $pkgname
       numcomms=${#rtrnCom[@]}
       phpXBookVers ${rtrnCom[numcomms-10]}
       GetCommands \
        | sed -e 's/--prefix=\/usr/${_phpconfig} ${_phpextensions} --disable-cgi/' \
              -e 's/--sysconfdir=\/etc/--sysconfdir=\/etc --mandir=\/usr\/share\/man/' \
              -e '/install -v -m644 p/a\  install -v -m755 -d \/usr\/share\/doc\/php-'"${phpvers}"'\n  install -v -m644 ..\/php_manual_en.html.gz \/usr\/share\/doc\/php-'"${phpvers}"'' \
              -e '/tar -xvf/,/-C \/usr\/share\/doc\/php-'"${phpvers}"' --no-same-owner/d' \
              -e "s/$phpXbookvers/$phpvers/" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    pinentry)
       GetCommands \
        | sed -e 's/--prefix=\/usr/--prefix=\/usr \\\n\  --enable-pinentry-curses \\\n\  --disable-pinentry-gtk \\\n\  --disable-pinentry-qt \\\n\  --enable-fallback-curses/' \
        | sed -e '/makeinfo --html/,/make -k -C doc/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    polkit)
       if ! $as_root; then
         if [ "$SYSTEMD" = yes ]; then
           GetCommands \
            | sed -e '/groupadd/,/-g polkitd -s \/bin\/false polkitd/d' \
                  -e 's/--with-authfw=shadow \\/--with-systemdsystemunitdir=\/usr\/lib\/systemd\/system \\\n\             --enable-libsystemd-login=yes \\/' \
                  -e 's/\(.*\)&&$/\1/' \
            >> $Output
         else
           GetCommands \
            | sed -e '/groupadd/,/-g polkitd -s \/bin\/false polkitd/d' \
                  -e '/--with-authfw=shadow/d' \
                  -e 's/\(.*\)&&$/\1/' \
            >> $Output
         fi
       else
         if [ "$SYSTEMD" = yes ]; then
           GetCommands \
            | sed -e 's/--with-authfw=shadow \\/--with-systemdsystemunitdir=\/usr\/lib\/systemd\/system \\/' \
                  -e 's/\(.*\)&&$/\1/' \
            >> $Output
         else
           GetCommands \
            | sed -e '/--with-authfw=shadow/d' \
                  -e 's/\(.*\)&&$/\1/' \
            >> $Output
         fi
       fi
    ;;
    ptlib)
       GetCommands \
        | sed -e "/make install/i\  sed -e '/mkdir -p \$(DESTDIR)\$(LIBDIR)\\\/pkgconfig/d' \\\\" \
              -e "/make install/i\      -e '/chmod 755 \$(DESTDIR)\$(LIBDIR)\\\/pkgconfig/d' -i Makefile" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    pulseaudio)
       GetCommands \
        | sed -e '/groupadd/,/usermod -a -G/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    py2-atspi)
       GetInternalCommands py2atspiComms >> $Output
    ;;
    py3-atspi)
       GetInternalCommands py2atspiComms \
        | sed -e 's/python2/python3/' \
        >> $Output
    ;;
    py3cairo|py2-xdg|py3-xdg|docutils)
       GetInternalCommands pyComms >> $Output
    ;;
    py2-dbus)
       GetInternalCommands py2dbusComms >> $Output
    ;;
    py3-dbus)
       GetInternalCommands py3dbusComms >> $Output
    ;;
    py2-gobject3)
       GetInternalCommands basicComms \
        | sed -e "/configure_commands()/i sed -i '/Werror=format/d' configure" \
              -e 's/disable-static/disable-static --with-python=\/usr\/bin\/python2/' \
        >> $Output
    ;;
    py3-gobject3)
       GetInternalCommands basicComms \
        | sed -e "/configure_commands()/i sed -i '/Werror=format/d' configure" \
              -e 's/disable-static/disable-static --with-python=\/usr\/bin\/python3/' \
        >> $Output
    ;;
    pysolfc)
       GetInternalCommands pysolfcComms >> $Output
    ;;
    pysolss)
       GetInternalCommands pysolssComms >> $Output
    ;;
    python2)
       GetCommands \
        | sed -e '/make -C Doc html/d' \
              -e '/cp -rfv Doc/d' \
              -e '/tar --strip-components=1/d' \
              -e '/-xvf ../d' \
              -e '/export PYTHONDOCS=/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    python3)
       GetCommands \
        | sed -e '/tar --strip/ i install -v -m755 -d /usr/share/doc/python-${Python3vers}/html' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    qtchooser)
       GetCommands \
        | sed -e '/ln -sfv 5.conf/d' \
              -e '/export QT_SELECT=5/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    samba)
       GetCommands \
        | sed -e 's/pammodulesdir=\/lib/pammodulesdir=\/usr\/lib/' \
              -e 's/wrapper/wrapper --with-sockets-dir=\/var\/run\/samba \\\n\      --with-swat --with-winbind --with-pam --with-configdir=\/etc\/samba \\\n\      --with-lockdir=\/var\/cache\/samba/' \
              -e '/mv -v/,/make install-swat/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    sdl)
       GetCommands \
        | sed -e '/cd test/,/make/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    seamonkey)
       GetCommands \
        | sed -e '/Yasm/,/disable-libnotify/d' \
              -e 's/\# ac_add_options --enable-startup-notification/ac_add_options --enable-startup-notification/' \
              -e 's/\# ac_add_options --enable-system-sqlite/ac_add_options --enable-system-sqlite/' \
              -e 's/\# ac_add_options --enable-system-libevent/ac_add_options --enable-system-libevent/' \
              -e 's/\# ac_add_options --with-system-libvpx/ac_add_options --with-system-libvpx/' \
              -e 's/\# ac_add_options --with-system-nspr/ac_add_options --with-system-nspr/' \
              -e 's/\# ac_add_options --with-system-nss/ac_add_options --with-system-nss/' \
              -e '/make -C moz-build-dir install/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    seed)
       GetInternalCommands basicComms >> $Output
    ;;
    sgml-common)
       GetCommands \
        | sed -e '/install-catalog --remove/,/\/etc\/sgml\/sgml-ent.cat/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    shadow)
        # assume cracklib support with Linux-PAM
        # don't install foreign man pages
        if ! $as_root; then
          GetCommands \
          | sed -e '/DICTPATH\\t\/lib\/cracklib/d' \
              -e "/configure_commands()/i sed -i -e 's\/po cs da de es fi fr hu id it ja pl pt_BR ru sv tr \\\\\\\//' \\\\\n -e 's\/zh_CN zh_TW\/\/' \\\\\n -e 's\/po cs da de es fi fr hu id it ja pl pt_BR ru sv tr\//'  man/Makefile.in" \
              -e '/mv -v \/usr\/bin\/passwd/d' \
              -e 's/\(.*\)&&$/\1/' \
          >> $Output
        else
          GetCommands \
          | sed -e '/DICTPATH\\t\/lib\/cracklib/d' \
              -e "/configure_commands()/i sed -i -e 's\/po cs da de es fi fr hu id it ja pl pt_BR ru sv tr \\\\\\\//' \\\\\n -e 's\/zh_CN zh_TW\/\/' \\\\\n -e 's\/po cs da de es fi fr hu id it ja pl pt_BR ru sv tr\//'  man/Makefile.in" \
              -e '/mv -v \/usr\/bin\/passwd/d' \
              -e 's/\(.*\)&&$/\1/' \
          >> $Output
        fi
    ;;
    smpeg)
       GetInternalCommands smpegComms >> $Output
    ;;
    speechd)
       GetInternalCommands basicComms \
        | sed -e 's/disable-static/disable-static --without-flite/' \
        >> $Output
    ;;
    sqlite)
       GetCommands \
        | sed -e '/unzip/d' \
              -e '/cp -v -R sqlite-doc/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    squid)
       GetInternalCommands squidComms >> $Output
    ;;
    subversion)
       GetCommands \
        | sed -e 's/disable-static/disable-static \\\n\              --with-apr=\/usr --with-apr-util=\/usr \\\n\              --with-apache-libexecdir=\/usr\/lib\/httpd\/modules \\\n\              --with-ruby-sitedir=\/usr\/lib\/ruby\/vendor_ruby/' \
              -e '/cp -v -R sqlite-doc/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    sudo)
       GetCommands \
        | sed -e '/--without-pam/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    systemd)
        GetInternalCommands systemdComms  >> $Output
    ;;
    tcl)
       GetCommands \
        | sed -e '/cp      -v -R       ../d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    tlpthy-frstream)
        GetInternalCommands tlpthyfrstreamComms  >> $Output
    ;;
    telepathy-glib)
        GetInternalCommands telepathyglibComms  >> $Output
    ;;
    telepathy-logr)
        GetInternalCommands telepathylogrComms  >> $Output
    ;;
    tpthymisscntrl)
        GetInternalCommands tpthymisscntrlComms  >> $Output
    ;;
    traceroute)
       GetCommands \
        | sed -e '/mv \/usr\/bin\/traceroute/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    udev)
       rtrnCom="" # need the version of udev from the udev-lfs tar file
       getComms $pkgname
       udevXBookVers ${rtrnCom[0]}
       GetCommands \
        | sed -e "s/$udevXbookvers/$udevvers/" \
              -e '/sed -i -e/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    udisks)
       if [ "$SYSTEMD" = yes ]; then
         GetCommands \
          | sed -e 's/--disable-static/--disable-static --with-systemdsystemunitdir=\/usr\/lib\/systemd\/system/' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    unzip)
       GetCommands \
        | sed -e '/This.block.must.be.edited/,/End.of.editable.block/d' \
        >> $Output
    ;;
    upower) # put udev rules in /usr/lib
       GetCommands \
        | sed -e '/configure_commands()/i sed -i "\/slashlibdir=\/s#\/lib#\/usr\/lib#" configure' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    v4l-utils)
       GetInternalCommands v4lComms >> $Output
    ;;
    vlc)
       GetCommands \
        | sed -e 's/--prefix=\/usr/--prefix=\/usr --disable-lua/' \
              -e '/gtk-update-icon-cache/,/update-desktop-database/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    wavpack)
       GetInternalCommands basicComms \
        | sed -e 's/disable-static/disable-static --enable-mmx/' \
        >> $Output
    ;;
    webkitgtk)
       if [ "$GNOME_OR_XFCE" = xfce ]; then
         GetCommands \
          | sed -e '/sed -i/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/sed -i/,/patch -Np1/d' \
                -e '/configure_commands()/i export CPPFLAGS="$CPPFLAGS -Wno-unused-local-typedefs"' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    webkitgtk2)
         GetCommands \
          | sed -e '/sed -i/d' \
                -e "/configure_commands()/i sed -i '\/parse-param\/ a%lex-param {YYLEX_PARAM}' \\\\\n\           Source\/ThirdParty\/ANGLE\/src\/compiler\/glslang.y" \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
    ;;
    which)
       GetCommands \
        | sed -e '/cat/,/chown/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    wpa_supplicant)
       if [ "$SYSTEMD" = yes ]; then
         GetCommands \
          | sed -e 's/update-desktop-database/install -m644 systemd\/*.service \/usr\/lib\/systemd\/system/' \
                -e '/wpa_passphrase/,/ifup/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/update-desktop-database/,/ifup/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    x264)
       GetInternalCommands basicComms \
        | sed -e '/configure/,/disable-static/d' \
              -e '/configure_commands()/a\  ./configure --enable-shared --enable-pic' \
              -e 's/make install/make bindir=\/usr\/bin \\\n\   libdir=\/usr\/lib \\\n\   includedir=\/usr\/include \\\n\   install/' \
        >> $Output
    ;;
    $xapp)
        GetXCommands \
        | sed -e 's/bash -e/set -e/' \
              -e '/for package in/ i cd $cursec' \
              -e '/configure/i\  for curFile in .\/*; do\n  permval=$(stat -c %a $curFile)\n  if [ $permval -eq 555 ]; then\n   chmod 755 $curFile\n  fi\n  done' \
              -e 's/XORG_CONFIG/XORG_CONFIG --disable-selective-werror 2>\&1 | tee ..\/\${packagedir}-configure.log/' \
              -e 's/as_root make install/make install 2>\&1 | tee ..\/\${packagedir}-install.log/' \
              -e '/exit/d' \
              -e 's/\(.*\)&&$/\1/' \
         | awk '{
if( $1 == "make" && $2 == "")
  print "  "$1" 2>&1 | tee ../${packagedir}-make.log";
else
  print $0;
}' \
       >> $Output
    ;;
    xfce4-session)
       GetCommands \
        | sed -e '/.xinitrc/d' \
              -e '/\*\*EDITMEUSERNAMEEDITME\*\*/,/sudoers/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    $xlib)
        GetXCommands \
        | sed -e 's/bash -e/set -e/' \
              -e '/for package in/ i cd $cursec' \
              -e '/case $packagedir in/i\  for curFile in .\/*; do\n  permval=$(stat -c %a $curFile)\n  if [[ $permval -eq 555 || $permval -eq 444 ]]; then\n   chmod 755 $curFile\n  fi\n  done' \
              -e 's/disable-devel-docs/disable-devel-docs 2>\&1 | tee ..\/\${packagedir}-configure.log/' \
              -e 's/appdefaultdir=\/etc\/X11\/app-defaults/appdefaultdir=\/etc\/X11\/app-defaults 2>\&1 | tee ..\/\${packagedir}-configure.log/' \
              -e 's/as_root make install/    make install 2>\&1 | tee ..\/\${packagedir}-install.log/' \
              -e '/as_root \/sbin\/ldconfig/d' \
              -e '/exit/d' \
              -e '/ln -sv \$XORG_PREFIX/d' \
              -e 's/\(.*\)&&$/\1/' \
        | awk '{
if ($1 == "./configure" && $2 == "$XORG_CONFIG")
{
  icount++;
  if (icount == 3)
    print "      "$1" "$2" 2>&1 | tee ../${packagedir}-configure.log";
  else
    print $0;
}
else if ($1 == "make" && $2 == "")
  print "      "$1" 2>&1 | tee ../${packagedir}-make.log";
else
  print $0;
}' \
       >> $Output
    ;;
    xorg-server)
        GetCommands \
         | sed -e '/--enable-install-setuid/d' \
               -e 's/xkb \\/xkb/' \
               -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    xorg-vmmouse)
        GetCommands \
         | sed -e 's/--with-udev-rules-dir=\/lib/--with-udev-rules-dir=\/usr\/lib/' \
               -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    $xproto|$xfont)
        GetXCommands \
         | sed -e 's/bash -e/set -e/' \
              -e '/for package in/ i cd $cursec' \
              -e '/.\/configure \$XORG_CONFIG/i\  for curFile in .\/*; do\n  permval=$(stat -c %a $curFile)\n  if [[ $permval -eq 555 || $permval -eq 444 ]]; then\n   chmod 755 $curFile\n  fi\n  done' \
              -e 's/.\/configure \$XORG_CONFIG/.\/configure \$XORG_CONFIG 2>\&1 | tee ..\/\${packagedir}-configure.log/' \
              -e 's/as_root make install/make install 2>\&1 | tee ..\/\${packagedir}-install.log/' \
              -e '/exit/d' \
              -e 's/\(.*\)&&$/\1/' \
         | awk '{
if( $1 == "make" && $2 == "")
  print "  "$1" 2>&1 | tee ../${packagedir}-make.log";
else
  print $0;
}' \
       >> $Output
    ;;
    xterm)
        GetCommands \
         | sed -e '/make install-ti/d' \
               -e '/cat/,/EOF/d' \
               -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    xulrunner)
       GetCommands \
        | sed -e 's/\#mk_add_options/mk_add_options/' \
              -e '/DBus-Glib/,/--disable-libnotify/d' \
              -e 's/\#ac_add_options --enable-startup-notification/ac_add_options --enable-startup-notification/' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    yajl)
       GetInternalCommands basicComms \
        | sed -e '/configure/,/disable-static/d' \
              -e '/configure_commands()/a\  cmake -DCMAKE_INSTALL_PREFIX=\/usr ./' \
        >> $Output
    ;;
    zenity)
       GetInternalCommands basicComms >> $Output
    ;;
    *)
        GetCommands \
        | sed -e 's/\(.*\)&&$/\1/' \
        >> $Output
        return_val=$?
        if [ $return_val -eq $RETURN_PARAM ]; then # no build file
          echo "No build file available in ${LFS}${srcrootdir}/pkguser"
          echo "Please place the build file there"
          exit 1
        fi
    ;;
esac
} # end WriteScript
#
cleanstart () {
for Script in ${Section}.sh
do
  for loc in $LFS ~/
  do
    if [ -e $loc/$Script ]; then rm $loc/$Script;fi
  done
done
} #end cleanstart
#
PkgDepend () {
cat >> $Output << "EOF"
PkgDepend () {
declare -a ndep
declare -a tdep
foundDep=false
dpName=${FuncName}dep # package dependencies
depfile=${blfsfiles}/dependencies/${Section}-dependencies
if [ ! -e $depfile ]; then
 return $RETURN_PARAM
else
  while read depline
  do
    case $depline in
      $dpName*)
        foundDep=true
        ic=0
        ndep=""
        tdep=""
        stordep=""
        ndeps=($depline)
        for (( i=1; i<${#ndeps[@]}-1; i++ ))
        do
          tdep[ic++]=${ndeps[i]}
        done
      ;;
    esac
  done < $depfile
  if ! $foundDep; then # no deps found for this package
    return $RETURN_NOTSET
  else
    DepRtrn=(${tdep[@]})
    return 0
  fi
fi
} # end PkgDepend
EOF
} # end PkgDepend
#
testDeps () {
cat >> $Output << "EOF"
testDeps () {
declare -a tstDeps=("${!1}")
declare -a stordep
countdep=0
for (( k=0; k<${#tstDeps[@]}; k++ ))
do
  pfile=$(echo ${tstDeps[k]} | awk 'BEGIN {FS="/"}{print $2}')
  case $pfile in
    systemd_gudev)
        tstDeps[k]="core/systemd"
    ;;
    udev_extras)
        tstDeps[k]="core/udev"
    ;;
  esac
  testfile=${PKGUSERDIR}/${tstDeps[k]}/.${pfile}
  if [ ! -f $testfile ]; then 
    if [ "$SYSTEMD" = yes ]; then 
      case $pfile in 
         expat|intltool|dbus|attr|acl|gperf|libcap|xml-parser)
           : # already installed in lfs
         ;;
         udev_extras|consolekit)
           : # not needed - replaced by systemd
         ;;
         *)
           stordep[countdep++]=${tstDeps[k]} # package dependency not met
         ;;
      esac
    else
      case $pfile in
         netctl|systemd_gudev)
           : # not required if not systemd
         ;;
         *) 
           stordep[countdep++]=${tstDeps[k]}
         ;;
      esac
    fi
  fi
done
if [ $countdep -gt 0 ]; then # some dependencies not met
  rtrnDepNotMet=(${stordep[@]})
  return $RETURN_DEPNOTMET
else
  return $RETURN_ALLDEPSMET # all dependencies met
fi
} # end testDeps
EOF
} # end testDeps
#
numcharInstall () { # get the number of chars in the install group
cat >> $Output << "EOF"
numcharInstall () {
group="/etc/group"
grpname=$1
while read line
do
case $line in
   $grpname*)
         numchars=$( printf $line | wc -c ) # should be <= 2048
         return 0
   ;;
esac
done < $group
} # end numcharInstall
EOF
} # end numcharInstall
#
setMime () {
cat >> $Output << "EOF"
setMime () {
# sets everything under /usr/share/mime to owner $1
onr=$1
chown -R $onr:$onr /usr/share/mime/{a*,g*,i*,m*,p*,s*,t*,v*,x*,X*}
} # end setMime
EOF
} # end setMime
#
SetXorgVars () {
mkdir -p ${LFS}/etc/profile.d
if [ ! -e ${LFS}/etc/profile.d/xorg.sh ]; then
  xorgsh="${LFS}/etc/profile.d/xorg.sh"
  echo "XORG_PREFIX=$XORG_PREFIX" >> $xorgsh
  cat >> $xorgsh << "EOF"
XORG_CONFIG="--prefix=$XORG_PREFIX \
             --sysconfdir=/etc \
             --mandir=$XORG_PREFIX/share/man \
             --localstatedir=/var"
export XORG_PREFIX XORG_CONFIG
EOF
  chmod 644 $xorgsh
  if [ "$XORG_PREFIX" != "/usr" ]; then
    cat >> $xorgsh << "EOF"
pathappend $XORG_PREFIX/bin PATH
pathappend $XORG_PREFIX/lib/pkgconfig PKG_CONFIG_PATH
pathappend $XORG_PREFIX/share/pkgconfig PKG_CONFIG_PATH
export PATH PKG_CONFIG_PATH
EOF
    echo "${XORG_PREFIX}/lib" >> ${LFS}/etc/ld.so.conf
    sed 's@/usr/X11R6@<PREFIX>@g' -i ${LFS}/etc/man_db.conf
    case $(uname -m) in
        x86_64)
             install -v -m755 -d ${LFS}$XORG_PREFIX
             install -v -m755 -d ${LFS}$XORG_PREFIX/lib
             ln -s lib ${LFS}$XORG_PREFIX/lib64
        ;;
    esac
  fi
fi
} # end SetXorgVars
#
altFileNames () {
IFS=' '
declare -a pkgnm=""
declare -a srcnm=""
declare -a cmdnm=""
secFiles=${BLFSBUILDFILES}/files/${1}-files
if [ ! -e $secFiles ]; then
  return $RETURN_PARAM
else
  ic=0
  while read n1 n2 n3 n4
  do
    pkgnm[ic++]=$n2
    srcnm[ic++]=$n3
    cmdnm[ic++]=${n4%??} # strip last 2 chars
  done < $secFiles
fi
rtrnPkg=(${pkgnm[@]})
rtrnSrc=(${srcnm[@]})
rtrnCmd=(${cmdnm[@]})
return 0
} # end altFileNames
#
pkgInSection () {
pkgToTest=$1
InSection=$2
pkgFiles=${BLFSBUILDFILES}/files/${InSection}-files
if [ ! -e $pkgFiles ]; then # try and get the section-files
  if [ ! -e ${LFS}/${blfsfilesTar} ]; then
    echo "The file $blfsfilesTar should be in $LFS"
    echo "Please place it there in order to continue"
    echo "Exiting now"
    exit 1
  else # tar file exists so unpack it
    if [ ! -d ${LFS}${blfsBuildFiles} ]; then 
      install -v -m0755 -d ${LFS}${blfsBuildFiles}
    fi
    if [ -d $BLFSBUILDFILES ]; then
      rm -rf $BLFSBUILDFILES
    fi
    unpackBLFSfiles # files define pkg names and dependencies
  fi
else # section files exist - but first test if tar file present
  if [ -e ${LFS}/${blfsfilesTar} ]; then # ask if want to replace the build files
    echo "**Warning** - $blfsfilesTar present and $BLFSBUILDFILES exists."
    echo "Replace $BLFSBUILDFILES with the contents of $blfsfilesTar? (Y/n)"
    read reply
      case $reply in
         [nN]|[nN][Oo])
            echo "okay - continuing with existing $BLFSBUILDFILES"
         ;;
         *)
            echo "okay replacing $BLFSBUILDFILES"
            rm -rf ${LFS}${blfsBuildFiles}
            mkdir -pv ${LFS}${blfsBuildFiles}
            unpackBLFSfiles
         ;;
      esac
  fi 
fi
# test again if the section-files exist
if [ ! -e $pkgFiles ]; then
  echo "Couldn't find $pkgFiles"
  if [ "$InSection" = all ]; then
    echo "You've requested ALL sections"
    echo "You must specify the section that contains $pkgToTest and"
  fi
  echo "make sure it's in $BLFSBUILDFILES"
  exit 1
fi
while read aline
do
pkg_is=$(echo $aline | awk -F= '{print $1}')
  case $pkg_is in
     $pkgToTest)
          return 0
     ;;
  esac
done < $pkgFiles
return $RETURN_PARAM
} # end pkgInSection
#
delElement () { # deletes an element from a specified position in an array
cat >> $Output << "EOF"
delElement () {
# array input in $1, position to delete is $2
declare -a arrayIn=("${!1}")
pos=$2
arrayIn=(${arrayIn[@]:0:$pos} ${arrayIn[@]:$(($pos + 1))})
rtrDelArray=(${arrayIn[@]})
} # end delElement
EOF
} # end delElement
#
delElementPattern () { # deletes an array element that matches a pattern
cat >> $Output << "EOF"
delElementPattern () {
# array input in $1, pattern to delete is $2
declare -a arrayInput=("${!1}")
patToMatch=$2
declare -a delPatArray=( ${arrayInput[@]/$patToMatch*/} )
rtrPlessArray=(${delPatArray[@]})
} # end delElementPattern
EOF
} # end delElementPattern
#
min2 () { # return min of two integers
if [ -z "$2" ]
then
  return $RETURN_PARAM
fi

if [ "$1" -eq "$2" ]
then
  return $1
else
  if [ "$1" -lt "$2" ]
  then
    return $1
  else
    return $2
  fi
fi
} # end min2
#
# Return the value of an operation e.g addition: z=$(float_val "$x + $y")
float_val () {
     echo | awk 'END { print '"$1"'; }'
}
#
# Return status code of a comparison e.g. float_test "$x > $y" && num=$x
# or float_test "$x < $y" && num=$y to find greater of two floating point numbers
float_test () {
echo "float_test () {
     echo | awk 'END { exit ( !( '\"\$1\"')); }'
}" >> $Output
}
#
Start () {
declare -a PkgName=("${!2}")
declare -a SrcName=("${!3}")
declare -a CommandName=("${!4}")
Section=$1
secFiles=${BLFSBUILDFILES}/files/${Section}-files
cursection=$Section
if ! $single_package; then
  cleanstart
  Output=${LFS}/${Section}.sh
else
  if [ -e ${LFS}/${SINGLE_PACKAGE}.sh ]; then rm ${LFS}/${SINGLE_PACKAGE}.sh; fi
  Output=${LFS}/${SINGLE_PACKAGE}.sh
fi
Getxmlsec $Section
if [[ "$Section" == x ]]; then SetXorgVars; fi
REPODIR=${BLFS_BOOK_LOC_DIR}/$version
Header
if ! $as_root; then
  pkguser # need it if installing as a package user
  numcharInstall
fi
if [ "$Section" != blfs ]; then
  PkgDepend
  testDeps
fi
if [[ "$Section" = networks || "$Section" = sysutils || "$Section" = xlibs || "$Section" = multimedia ]]; then
  delElementPattern
fi
if [[ "$Section" == gnomeplatform || "$Section" == gnomedesktop || "$Section" == gnomeutils ]]; then
  setMime
fi
numpkgs=${#PkgName[@]}
for (( pkgn=0; pkgn<$numpkgs; pkgn++ ))
do
  if $single_package; then # find the package
    if [[ "$SINGLE_PACKAGE" == "${PkgName[$pkgn]}" ]]; then # found the package
      pkgname=${PkgName[pkgn]}
      FuncName=$( echo $pkgname | sed -e s/-//g -e s/_//g )
      srcname=${SrcName[pkgn]}
      commandname=${CommandName[pkgn]}
      if [[ "$cursection" != "$Section" ]]; then # section changed - reset
        cursection=$Section
        if ! $as_root; then pkguser; fi
      fi
      Output=$LFS/${SINGLE_PACKAGE}.sh
      case $pkgname in
        coreutils|shadow|systemd) # these are core LFS
           cursection=core
           if ! $as_root; then updatePkgUser; fi
           Function
        ;;
        udev) # change commandname to udev-extras and srcname to systemd-
           cursection=core
           commandname=udev-extras
           srcname=systemd-
           if ! $as_root; then updatePkgUser; fi
           Function
        ;;
        *)
           Function
        ;;
      esac
      break
    fi
  elif [[ "$Section" = browser ]]; then
    if [[ "$BROWSER" == "${PkgName[$pkgn]}" ]]; then
      pkgname=${PkgName[pkgn]}
      FuncName=$( echo $pkgname | sed -e s/-//g -e s/_//g )
      srcname=${SrcName[pkgn]}
      commandname=${CommandName[pkgn]}
      Output=$LFS/${Section}.sh
      Function
      break
    fi
  else
    pkgname=${PkgName[pkgn]}
    FuncName=$( echo $pkgname | sed -e s/-//g -e s/_//g )
    srcname=${SrcName[pkgn]}
    commandname=${CommandName[pkgn]}
    if [[ "$cursection" != "$Section" ]]; then # section changed - reset
      cursection=$Section
      if ! $as_root; then pkguser; fi
    fi
    Output=$LFS/${Section}.sh
    case $pkgname in
       coreutils|shadow|systemd)
          cursection=core
          if ! $as_root; then updatePkgUser; fi
          Function
       ;;
       udev) # change command name to udev-extras
          if [ "$SYSTEMD" = no ]; then
            cursection=core
            commandname=udev-extras
            srcname=systemd-
            if ! $as_root; then updatePkgUser; fi
            Function
          fi
       ;;
       *)
          Function
       ;;
    esac
  fi
done
#
awk '/_\ \(\)\ \{/ {print $1}' $Output >> /tmp/.9876543
#
# this next section allows you to change the order of, or remove, a package
#
while read eachFunc; do
  case $eachFunc in
      expat_|intltool_|dbus_|attr_|acl_|gperf_|libcap_|xmlparser_|firewall_|udev_|consolekit_) # test if systemd used
          if [ "$SYSTEMD" = no ]; then echo $eachFunc >> $Output; fi
      ;;
      systemd_) # don't use if SYSTEMD is no
          if [ "$SYSTEMD" = yes ]; then echo $eachFunc >> $Output; fi
      ;;
      *)
          echo $eachFunc >> $Output
  esac
done < /tmp/.9876543
rm /tmp/.9876543
chmod 700 $Output
if $single_package; then
  fpkgnme=${LFS}/${SINGLE_PACKAGE}.sh
else
  fpkgnme=${LFS}/${Section}.sh
fi
sed -e 's@BuildLog='$LFS'@BuildLog=@' -i $fpkgnme
# remove any test statements and the root and edit comments
sed -e '/make check/d' \
    -e '/make -j1 check/d' \
    -e '/make -j1 test/d' \
    -e '/make -k check/d' \
    -e '/make -kj1 check/d' \
    -e '/make test/d' \
    -e '/\# End root commands/d' \
    -e '/\# Run this as root/d' \
    -e '/\# This block must be edited to suit your needs./d' \
    -e '/\# End of editable block./d' \
    -i $fpkgnme
} # end Start
#
GetPkgVersion () {
# $1 is the location of the src package
# $2 is the name of the package
# $3 is the name to trim against - usually tar
local pkgloc=$1
local pkgnm=$2
local trim=$3
local fnd
local fileExt
local pkgvers=""
if [ ! -e $pkgloc ]; then return $RETURN_PARAM; fi # pkg loc does not exist
fnd=$( ls -l $pkgloc | grep ${pkgnm}[0-9].*.tar.*z* | awk '{print $NF}' )
fileExt="${fnd#*${pkgnm}}"
pkgvers="${fileExt%${trim}*}"
rtrvers=($pkgvers)
return 0
} # end GetPkgVersion
#
udevXBookVers () {
# $1 the command to parse for the version #
fileis=$(echo $1 | awk -F\/ '{print $2}')
fExt="${fileis#*lfs-}"
udevXbookvers="${fExt%.tar*}"
} # end udevXBookVers
#
phpXBookVers () {
# $1 the command to parse for the version #
fileis=$(echo $1 | awk -F\/ '{print $5}')
phpXbookvers="${fileis#php-}"
} # end phpXBookVers
#
evolutionVersion () {
echo "evolutionVersion () {
baseval=0.0 # assume version # will be > 0
evoldir="/usr/lib/evolution"
for evers in \${evoldir}/*; do # loop through all files in the directory
evoltest=\$( echo \$evers | awk -F\/ '{print \$NF}' )
if [[ \"\$evoltest\" =~ ^[0-9]+([.][0-9]+)?$ ]]; then # a number so test its value
  float_test \"\$evoltest > \$baseval\" && evolVers=\$evoltest
  baseval=\$evolVers
fi
done
}" >> $Output
} # end evolutionVersion
#
# ***main program***  - call the functions
#
configEdit # option to change the config file
retval=$?
if [ $retval -eq $RETURN_PARAM ]; then
 echo "Cancel pressed. Exiting now"
 exit 1
fi
source $cfg # make sure config file values are current
SECTION=$(echo ${SECTION,,*}) # convert SECTION to lower case
SOURCES=$(echo ${SOURCES,,*}) # convert SOURCES to lower case
xversion=$XVERSION # set up the x version
as_root=false
if [ "$AS_ROOT" = yes ]; then as_root=true; fi
#
if [[ "$SINGLE_PACKAGE" == no ]]; then
  single_package=false
else
  single_package=true
  pkgnamenohyph=$( echo ${SINGLE_PACKAGE/-/} ) # remove any - in package name
  pkgInSection $pkgnamenohyph $SECTION
  retv=$?
  if [ $retv -eq $RETURN_PARAM ]; then
    echo "Package $SINGLE_PACKAGE not found in section $SECTION"
    echo "exiting now"
    exit 1
  else
    echo "Package $SINGLE_PACKAGE found in section $SECTION"
    echo "Will produce a script called $SINGLE_PACKAGE.sh for this single package"
  fi
fi
#
# get the book
#
bookDir=$BLFS_BOOK_LOC_DIR
if [ "$BOOK_VERSION" = systemd ]; then bookDir=${bookDir}/SYSTEMD; fi
#
if [ $BOOK = "svn" ]; then
  GetSvnUrl # make sure the svn url is set
  if [ $BOOK_VERSION != "blank" ]; then #check if the requested book is present locally
    ChkLocalBook ${bookDir}/${BOOK_VERSION}
    SetBLFSBook
  else #version set to blank so ask for which book
    WhichBLFSBook # choose which BLFS version to download the xml files
    # check if the requested book is already present locally
    ChkLocalBook $bookDir/${BOOK_VERSION}
  fi
  if [ "$SOURCES" = download ]; then CleanLocalREPO $bookDir/${BOOK_VERSION}; fi # delete any files in local book repository
  CheckoutSVN  $bookDir/${BOOK_VERSION} # svn the requested book xml files
else  # local book requested. Make sure it exists
  if [ "$BOOK_VERSION" = "blank" ]; then # need to choose book version
    GetLocalREPO $bookDir/${BOOK_VERSION}
    return_val=$?
    if [ $return_val -eq $RETURN_PARAM ]; then #no local book found
      echo "You did not choose a local $REPO book"
      echo "Change the local dir of the book or svn it. Exiting now"
      exit 1
    else # config file would have changed so source it
      source $cfg
      LocalBook
    fi
  else
    ChkLocalBookExists $bookDir/${BOOK_VERSION}
    return_val=$?
    if [ $return_val -eq $RETURN_PARAM ]; then #no local book found
      echo "The requested book was not found at $BLFS_BOOK_LOC_DIR."
      echo "Change the local dir of the book or svn it. Exiting now"
      exit 1
    else
      LocalBook  # set values for locally stored book xml
      echo "Local book found for $BOOK_VERSION at $BLFS_BOOK_LOC_DIR"
    fi
  fi
fi
DumpCommands $REPO $bookDir/${BOOK_VERSION} # get the commands from the book
#
if ! $single_package; then # test if the build files dir exists
  if [ ! -d $BLFSBUILDFILES ]; then # doesn't exist so try and build it
    if [ ! -e ${LFS}/${blfsfilesTar} ]; then
      echo "The file $blfsfilesTar should be in $LFS"
      echo "Please place it there in order to continue"
      echo "Exiting now"
      exit 1
    else # tar file exists so unpack it
      if [ ! -d ${LFS}${blfsBuildFiles} ]; then
        mkdir -pv ${LFS}${blfsBuildFiles}
      fi
      unpackBLFSfiles # files define pkg names and dependencies
    fi
  else # build files exist - test if tar file present
    if [ -e ${LFS}/${blfsfilesTar} ]; then # ask if want to replace the build files
      echo "**Warning** - $blfsfilesTar present and $BLFSBUILDFILES exists."
      echo "Replace $BLFSBUILDFILES with the contents of $blfsfilesTar? (Y/n)"
      read reply
        case $reply in
           [nN]|[nN][Oo])
              echo "okay - continuing with existing $BLFSBUILDFILES"
           ;;
           *)
              echo "okay replacing $BLFSBUILDFILES"
              rm -rf ${LFS}${blfsBuildFiles}
              mkdir -pv ${LFS}${blfsBuildFiles}
              unpackBLFSfiles
           ;;
        esac
    fi
  fi
fi
#
# update the proxy settings for wget
#
ipadd=$(ip addr | grep 192 | awk '{print $2}' | awk -F\/ '{print $1}')
proxyset=http://${ipadd}:3128/
http_proxy=$proxyset
ftp_proxy=$proxyset
all_proxy=socks://${ipadd}:3128/
https_proxy=$proxyset
#
SetupSections # create the array SectionsAll. Contains the sections to build
for (( ij=0; ij<$numSections; ij++ )); do # loop through each section to get the sources
  Section=${SectionsALL[$ij]}
  skipSection=false
  if [ "$GNOME_OR_XFCE" = gnome ]; then # skip section xfce
    if [ "$Section" = xfce ]; then skipSection=true; fi
  else # requested xfce so skip all the gnome sections
    if [[ "$Section" == gnomeplatform || "$Section" == gnomedesktop || "$Section" == gnomeutils ]]; then
    skipSection=true
    fi
  fi
  if $skipSection; then
    :
  else # build the section
    rtrnPkg=""
    rtrnSrc=""
    rtrnCmd=""
    altFileNames $Section # get pkg name, src name and command name for each package in this section
    return_val=$?
    if [ $return_val -eq $RETURN_PARAM ]; then
      echo "no ${Section}-files  file found. It should be in ${BLFSBUILDFILES}/files"
      echo "Place it there in order to continue. Exiting now"
      exit 1
    fi
    if [[ "$SOURCES" = download || "$SOURCES" = downloads ]]; then # download the sources for this section
      CleanSourceDir $Section # clean the sources file if not empty
      if [ "$Section" = x ]; then # delete the x subdirs
        rm -rf ${SOURCEDIR}/${Section}/${xproto}
        rm -rf ${SOURCEDIR}/${Section}/${xlib}
        rm -rf ${SOURCEDIR}/${Section}/${xapp}
        rm -rf ${SOURCEDIR}/${Section}/${xfont}
      fi
      GetListFile $bookDir  #get wget-list
      GetSources $Section rtrnPkg[@] rtrnSrc[@] # download the sources in the wget-list file
    fi
# check all requested src files are present
    if [[ "$Section" != browser ]]; then
      if [ -e ${SOURCEDIR}/${Section}/${WgetList} ]; then
        ChkSrcPresent ${SOURCEDIR}/${Section} ${SOURCEDIR}/${Section}/${WgetList}
      else
         echo "No wget-list file in ${SOURCEDIR}/${Section}"
         echo "Cannot check presence of source files"
      fi
      ret_val=$?
      if [ $ret_val -eq $RETURN_PARAM ]; then 
        echo "Not all requested files in ${SOURCEDIR}/${Section}/${WgetList} have been downloaded."
        echo "If the required sources are not being downloaded with wget in the script, then"
        echo "you will have to download them yourself and place in ${SOURCEDIR}/${Section}"
        echo "Do you want to continue? (Y/n)"
        read reply
        case $reply in
           [yY]|[yY][Ee][Ss])
                echo "okay continuing"
           ;;  
           [nN]|[nN][Oo])
                echo "Exiting now"
                exit 1
           ;;  
           *)  
                echo "okay continuing"
           ;;  
        esac
      fi
    else # check the browser source exists
      ChkSrcPresent ${SOURCEDIR}/${Section} ${SOURCEDIR}/${Section}/${sortedfile}
      if [ "$?" -eq $RETURN_PARAM ]; then exit 1; fi
    fi
    ChkEmptySrcFiles $Section #check for empty source files
    return_val=$?
    if [ $return_val -eq $RETURN_PARAM ]; then
      echo "Dir ${LFS}${srcrootdir}/${Section} is empty or has empty files."
      echo "If the required sources are not being downloaded with wget in the script, then"
      echo "you will have to download them to ${LFS}${srcrootdir}/${Section}"
      echo "Continuing to make the script(s) for section $Section"
    fi
    if [ "$Section" = browser ]; then
      if [ "$BROWSER" = firefox ]; then
        if [ -z $ffoxvers ]; then # null, so fill
          firefoxloc="${LFS}${srcrootdir}/browser"
          if [ -d $firefoxloc ]; then
            : # okay, so continue
          else
            firefoxloc="${LFS}${PKGUSERDIR}/browser/firefox"
            if [ -d $firefoxloc ]; then
              : # okay, so continue
            else
              echo "Requested Firefox version but cannot find source location"
              echo "Modify this code to include proper source location"
              echo "Exiting now"
              exit 1
            fi           
          fi
          rtrvers=""
          GetPkgVersion $firefoxloc firefox- .source
          ffoxvers=$rtrvers
          echo "Firefox version is $ffoxvers"
        fi
      fi
    fi
    if ! $single_package; then
      case $Section in
        avr)
          rtrvers=""
          GetPkgVersion ${LFS}${PKGUSERDIR}/core/gcc gcc- .tar # for gcc version
          retval=$?
          if [ $retval -eq $RETURN_PARAM ]; then
            echo "**WARNING** ${LFS}${PKGUSERDIR}/core/gcc doesn't exist"
            echo "You won't be able to install avrgcc here"
            echo "You should install it manually instead"
          else
            gccvers=$rtrvers
            echo "gcc version is $gccvers"
          fi
        ;;
        libraries)
          rtrvers=""
          GetPkgVersion ${LFS}${PKGUSERDIR}/core/perl perl- .tar
          perlvers=$rtrvers
          echo "perl version is $perlvers"
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/libraries freetype- .tar
          freetypevers=$rtrvers
          echo "freetype version is $freetypevers"
        ;;
        programming)
          rtrvers=""
          GetPkgVersion ${LFS}${PKGUSERDIR}/core/perl perl- .tar
          perlvers=$rtrvers
          echo "perl version is $perlvers"
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming php- .tar
          phpvers=$rtrvers
          echo "php version is $phpvers"
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming Python-2. .tar
          Python2vers=2.$rtrvers
          echo "Python2 version is $Python2vers"
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming Python-3. .tar
          Python3vers=3.$rtrvers
          echo "Python3 version is $Python3vers"
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming git- .tar
          gitvers=$rtrvers
          echo "git version is $gitvers"
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming jdk- -linux
          jdkvers=$rtrvers
          echo "jdk version is $jdkvers"
        ;;
        security)
          rtrvers=""
          GetPkgVersion ${LFS}${PKGUSERDIR}/core/coreutils coreutils- .tar
          coreutilsvers=$rtrvers
          echo "coreutils version is $coreutilsvers"
        ;;
        sysutils)
          if [ "$SYSTEMD" = yes ]; then
            rtrvers=""
            GetPkgVersion ${LFS}${PKGUSERDIR}/core/systemd systemd- .tar
            systemdvers=$rtrvers
            echo "systemd version is $systemdvers"
          else
            rtrvers=""
            GetPkgVersion ${LFS}${PKGUSERDIR}/core/udev udev-lfs- .tar # for udev version
            retval=$?
            if [ $retval -eq $RETURN_PARAM ]; then
              echo "**WARNING** ${LFS}${PKGUSERDIR}/core/udev doesn't exist"
              echo "You won't be able to install udev here"
              echo "You should install it manually instead"
            else
              udevvers=$rtrvers
              echo "udev version is $udevvers"
            fi
          fi
        ;;
      esac
    else
      case $SINGLE_PACKAGE in
        freetype)
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/libraries freetype- .tar
          freetypevers=$rtrvers
          echo "freetype version is $freetypevers"
        ;;
        git)
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming git- .tar
          gitvers=$rtrvers
          echo "git version is $gitvers"
        ;;
        php)
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming php- .tar
          phpvers=$rtrvers
          echo "php version is $phpvers"
        ;;
        python2)
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming Python-2. .tar
          Python2vers=2.$rtrvers
          echo "Python2 version is $Python2vers"
        ;;
        python3)
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming Python-3. .tar
          Python3vers=3.$rtrvers
          echo "Python3 version is $Python3vers"
        ;;
        jdkbin)
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming jdk- -linux
          jdkvers=$rtrvers
          echo "jdk version is $jdkvers"
        ;;
        udev)
          if [ "$SYSTEMD" = no ]; then
            rtrvers=""
            GetPkgVersion ${LFS}${PKGUSERDIR}/core/udev udev-lfs- .tar
            retval=$?
            if [ $retval -eq $RETURN_PARAM ]; then
              echo "**WARNING** ${LFS}${PKGUSERDIR}/core/udev doesn't exist"
              echo "You won't be able to install udev here"
              echo "You should install it manually instead"
            else
              udevvers=$rtrvers
              echo "udev version is $udevvers"
            fi
          fi
        ;;
      esac
    fi
    Start $Section rtrnPkg[@] rtrnSrc[@] rtrnCmd[@] # build the script for this section
  fi
done
