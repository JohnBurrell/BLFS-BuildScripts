#!/bin/bash
#
LFS=$LFS
if [[ ! -d $LFS || "$LFS" = "" ]]; then
  echo "'$LFS' is not a directory"
  echo "do: export LFS=/mnt/lfs"
  echo
  exit 1
fi

# repository will be for BLFS
REPO="BLFS"
DumpedCommands=$LFS/blfs-commands
Dumpedhtml=$LFS/blfs-html
WgetList="wget-list" # default name for the source list file
sortedfile="sortedfile" # name of the sorted WgetList file
anduin_src_root="http://anduin.linuxfromscratch.org/sources/BLFS/svn"
patch_root="http://www.linuxfromscratch.org/patches/blfs/svn" # patch url
RETURN_PARAM=35  # error return
RETURN_NOTSET=37 #  no dependencies set
RETURN_DEPNOTMET=39 # package dependency not met
RETURN_ALLDEPSMET=41 # all dependencies met
srcrootdir=/blfs-sources # all source files are under this dir
blfsBuildFiles=/blfsBuildFiles # location of the pkgs, pkg-order and pkg-dependencies files
blfsfiles=blfsfiles # name of the subdir to the build files dir
blfsfilesTar=${blfsfiles}.tar.xz # tar file with files names and dependencies for each section
PKGUSERDIR=/usr/src # pkguser dir will be $PKGUSERDIR/$Section
BuildLog=${LFS}/BLFS-buildlog.log # keep a record of packages and times
if [ ! -e $BuildLog ]; then
  touch $BuildLog
fi
BLFSBUILDFILES=${LFS}${blfsBuildFiles}/${blfsfiles} # location of the blfs build files
SOURCEDIR=${LFS}${srcrootdir}
build="build" # name of the build file for each package
cfg=~/BLFS.conf # config file to hold required params

#initialize the config variables
BLFS_BOOK_LOC_DIR=$HOME/LFS_SVN/$REPO # define local dir for the downloaded book xml
SVN_URL="svn://svn.linuxfromscratch.org/$REPO/" # svn url
BOOK_VERSION=$BOOK_VERSION
SOURCES=$SOURCES
BOOK=$BOOK
SECTION=$SECTION
XORG_PREFIX=$XORG_PREFIX
XVERSION=$XVERSION
GNOME_OR_XFCE=$GNOME_OR_XFCE
BROWSER=$BROWSER
SINGLE_PACKAGE=$SINGLE_PACKAGE
AS_ROOT=$AS_ROOT # 'no' install as package user, 'yes' install as root
if [ -e $cfg ]; then
  source $cfg # exists so source it
else
  touch $cfg #cfg is new
  if [ -z $BOOK_VERSION ]; then
    BOOK_VERSION="blank"
  fi
  if [ -z $SOURCES ]; then
    SOURCES="download"
  fi
  if [ -z $BOOK ]; then
    BOOK="svn"
  fi
  if [ -z $SECTION ]; then
    SECTION="libraries"
  fi
  if [ -z $XORG_PREFIX ]; then
    XORG_PREFIX="/usr"
  fi
  if [ -z $XVERSION ]; then
    XVERSION="7.7-1"
  fi
  if [ -z $GNOME_OR_XFCE ]; then
    GNOME_OR_XFCE="gnome"
  fi
  if [ -z $BROWSER ]; then
    BROWSER="firefox"
  fi
  if [ -z $SINGLE_PACKAGE ]; then
    SINGLE_PACKAGE="no"
  fi
  if [ -z $AS_ROOT ]; then #null
    AS_ROOT="no"
  fi
# store the values in the new config file
  echo "BLFS_BOOK_LOC_DIR=$HOME/LFS_SVN/$REPO" | tee $cfg
  echo "SVN_URL=svn://svn.linuxfromscratch.org/$REPO/" | tee -a $cfg
  echo "BOOK_VERSION=$BOOK_VERSION" | tee -a $cfg
  echo "SOURCES=$SOURCES" | tee -a $cfg
  echo "BOOK=$BOOK" | tee -a $cfg
  echo "SECTION=$SECTION" | tee -a $cfg
  echo "XORG_PREFIX=$XORG_PREFIX" | tee -a $cfg
  echo "XVERSION=$XVERSION" | tee -a $cfg
  echo "GNOME_OR_XFCE=$GNOME_OR_XFCE" | tee -a $cfg
  echo "BROWSER=$BROWSER" | tee -a $cfg
  echo "SINGLE_PACKAGE=$SINGLE_PACKAGE" | tee -a $cfg
  echo "AS_ROOT=$AS_ROOT" | tee -a $cfg
fi
#
# set up names of x subdirs
xproto="x7proto"
xlib="x7lib"
xapp="x7app"
xfont="x7font"
#
# functions
#
_log() {                      # turn on debugging commands with _DEBUG=true
  if [ "$_DEBUG" == "true" ]; then
    echo 1>&2 "$@"
  fi
} # end _log
#
configEdit () {
tempfile1=dialog_1
tempfile2=dialog_2
tempfile3=dialog_3
DIALOG=dialog # could set to gui dialog - xdialog, if availale
#test -n "$DISPLAY" && DIALOG=xdialog
# delete temp files on exit
trap "rm -f $tempfile1 $tempfile2 $tempfile3" 0 1 2 5 15

_edit () {
   items=$(awk -F\= '{print $1,$2}' $cfg)
   $DIALOG --title "" \
          --menu "BLFS config file editor:" 0 0 0 $items 2> $tempfile1

   retval=$?
   parameter=$(cat $tempfile1)

   [ $retval -eq 0 ] && tochange=$parameter || return 1
   if [ "$tochange" = BLFS_BOOK_LOC_DIR ]; then
     display="Enter the local directory to store the BLFS Book"
   elif [ "$tochange" = SVN_URL ]; then
     display="Enter the svn url of the BLFS book"
   elif [ "$tochange" = BOOK_VERSION ]; then
     display="BLFS book version. For development type BOOK or Current_Development (type blank to get a list)"
   elif [ "$tochange" = BOOK ]; then
     display="svn (or) local (if local the book must be in $BLFS_BOOK_LOC_DIR)"
   elif [ "$tochange" = SOURCES ]; then
     display="download (or) local (if local, must be in ${LFS}${srcrootdir}/${SECTION})"
   elif [ "$tochange" = SECTION ]; then
     display="options are blfs, security, libraries, genutils, sysutils, programming, networks, server, x, xlibs, gnomeplatform, gnomedesktop, gnomeutils, xfce, browser, office, xsoftware, multimedia, pst, or ALL"
   elif [ "$tochange" = XORG_PREFIX ]; then
     display="Choose the installation prefix for Xorg"
   elif [ "$tochange" = XVERSION ]; then
     display="Enter the current X version in the BLFS book"
   elif [ "$tochange" = GNOME_OR_XFCE ]; then
     display="type gnome or xfce - you can install one or the other, not both"
   elif [ "$tochange" = BROWSER ]; then
     if [ "$SECTION" = browser ]; then
       display="Type firefox or seamonkey"
     else
       display="Type firefox or seamonkey. Set SECTION to browser to install it."
     fi
   elif [ "$tochange" = SINGLE_PACKAGE ]; then
     if [[ "$SECTION" = ALL || "$SECTION" = all ]]; then
     display="Name of single package to install. There is no section ALL, so change it to the correct section for the package you have specified."
     else
     display="Name of single package to install. It must be in $SECTION. If specified, this will take precedence. Type no to switch off the option"
     fi
   elif [ $tochange = "AS_ROOT" ]; then
     display="If yes, install packages as root. If no, install as package user"
   fi
   val=$(awk -F\= -v x=$tochange '$1==x {print $2}' $cfg)
   $DIALOG --clear --title "Change value" \
          --inputbox "$display" 0 0 $val 2> $tempfile2

   $DIALOG --title "Confirmation"  --yesno "Commit ?" 0 0
   case $? in
       0) newval=$(cat $tempfile2)
          awk -v x=$tochange -v n=$newval '
               BEGIN {FS=OFS="="}$1==x {$2=n} {print}
               ' $cfg > $cfg.tmp
          mv $cfg.tmp $cfg
          . $cfg
       ;;
       1|255) $DIALOG --infobox "Value not changed" 0 0
              sleep 1
   ;;
   esac
   $DIALOG --textbox $cfg 0 0
}

_main () {
   $DIALOG --title "BLFS config file editor" \
           --menu "Please choose an option:" 15 55 5 \
                   1 "View the config file" \
                   2 "Edit config file" \
                   3 "Exit from this menu" 2> $tempfile3

   retv=$?
   choice=$(cat $tempfile3)
   [ $retv -eq 1 -o $retv -eq 255 ] && return $RETURN_PARAM

   case $choice in
       1) $DIALOG --textbox $cfg 0 0
          _main
           ;;
       2) _edit
          _main 
           ;;
       3) return 
           ;;
   esac
}
_main
rm -rf $tempfile1 $tempfile2 $tempfile3 # make sure temp files are removed
} #end configEdit
#
GetAllSections () {
local allsec=""
secfile=${BLFSBUILDFILES}/allSections
if [ ! -e $secfile ]; then
  return $RETURN_PARAM
else
IFS='
'
allsec=( $( < $secfile ) )
rtrnSec=(${allsec[@]})
return 0
fi
} # end GetAllSections
#
SetupSections () {
numSections=1
if [ "$SECTION" = all ]; then
  rtrnSec=""
  GetAllSections
  return_val=$?
  if [ $return_val -eq $RETURN_PARAM ]; then
    echo "Error reading in allSections file."
    echo "Make sure file allSections is in $BLFSBUILDFILES"
    echo "Exiting now"
    exit 1
  else
    SectionsALL=(${rtrnSec[@]})
    numSections=${#SectionsALL[@]}
  fi
else
  SectionsALL[0]=$SECTION
fi
} # end SetupSections
#
GetLocalREPO () {
# create a list of local BLFS books - only works relative to $BLFS_BOOK_LOC_DIR
unset Paths
for Path in $( find $BLFS_BOOK_LOC_DIR -name index.xml -exec dirname {} ';' )
do
  if [ -e $Path/.svn ]; then
    Paths="$Paths $Path"
  fi
done
PathCount=$( echo $Paths | awk '{print NF}' )
case $PathCount in
   0) echo >&2 "Couldn't find any local BLFS book in $BLFS_BOOK_LOC_DIR"
      echo >&2 "Suggest you svn one or specify a different location"
      return $RETURN_PARAM
   ;;
   1) Path=$Paths
      svn info $Path >&2
      PS3="Is this correct? : "
      select confirm in Yes No
      do
        case $confirm in
          '') echo >&2 "Please enter 1 for Yes or 2 for No"
          ;;
          ?*) break
          ;;
        esac
      done
      case $confirm in
         No) echo >&2 "This is the only BLFS book in $BLFS_BOOK_LOC_DIR"
             return $RETURN_PARAM
         ;;
        Yes) 
            BOOK_VERSION=$(echo $Path | awk 'BEGIN {FS="/"}{print $5}')
            tochange="BOOK_VERSION"
            awk -v x=$tochange -v n=$BOOK_VERSION '
               BEGIN {FS=OFS="="}$1==x {$2=n} {print}
               ' $cfg > $cfg.tmp
            mv $cfg.tmp $cfg
            return 0
         ;;
      esac
   ;;
   *)
      PS3="which is your $REPO svn repo? : "
      select Path in $( echo $Paths | sed 's@'$HOME'@~@g')
      do
        Path=$( echo $Path | sed 's@~@'$HOME'@' )
        case $Path in
         '') echo >&2 "Please select using number"
         ;;
         ?*) echo >&2 "You have selected svn repo"
             svn info $Path >&2
             PS3="Is this correct? : "
             select confirm in Yes No
             do
               case $confirm in
                '') echo >&2 "Please enter 1 for Yes or 2 for No"
                ;;
                ?*) break
                ;;
               esac
             done
             case $confirm in
               No) 
                   return $RETURN_PARAM
              ;;
              Yes)
                    BOOK_VERSION=$(echo $Path | awk 'BEGIN {FS="/"}{print $5}')
                    tochange="BOOK_VERSION"
                    awk -v x=$tochange -v n=$BOOK_VERSION '
                    BEGIN {FS=OFS="="}$1==x {$2=n} {print}
                    ' $cfg > $cfg.tmp
                    mv $cfg.tmp $cfg
                    return 0
              ;;
             esac
         ;;
        esac
      done
   ;;
esac
} # end GetLocalREPO
ChkLocalBook () {
ChkLocalBookExists
    return_val=$?
    if [ $return_val -eq $RETURN_PARAM ]; then # requested book not present
      echo "Requested book not present locally. Will svn it"
    else # book present, test if need to svn an update
      ChkLocalBookDetails
      return_val=$?
      if [ $return_val -eq $RETURN_PARAM ]; then
        exit 1
      fi
    fi
} # end ChkLocalBook
#
ChkLocalBookExists () {
unset BookPath
for BookPath in $( find $BLFS_BOOK_LOC_DIR -name index.xml -exec dirname {} ';' )
do
  if [ -e $BookPath/.svn ]; then #a book exists, check the version
    if [ "$BOOK_VERSION" = Current_Development -o "$BOOK_VERSION" = BOOK ]; then
      version="BOOK"
    else
      version=$BOOK_VERSION
    fi
    if [ $version != "BOOK" ]; then BookPath="$BookPath/";fi # add a / 
    if [ $BookPath == ${BLFS_BOOK_LOC_DIR}/${version} ]; then
      return 0 #requested version is present locally
    fi
  fi
done
return $RETURN_PARAM #requested book not present locally
} #end ChkLocalBookExists
#
ChkLocalBookDetails () {
if [ "$BOOK_VERSION" = Current_Development -o "$BOOK_VERSION" = BOOK ]; then
  # check the last svn date
  returned_array=( $(LastAccessSvn "$argument") )
  retval=$?
  if [ $retval -eq 0 ]; then # compare last svn date with today's date
    if [ ${returned_array[0]} -eq ${returned_array[1]} ]; then
      echo "same book already downloaded today"
      echo "you will have to delete it if you want to svn again"
      return $RETURN_PARAM
    else
      return 0
    fi
  else
    echo "Could not retrieve date of last svn - no entries file found."
    echo "Will svn it"
    return 0
  fi
else # book is a release version so don't update it
  echo "Requested book is present locally and is a release version"
  echo "so update not necessary"
  return $RETURN_PARAM
fi
} # end ChkLocalBookDetails
#
CleanLocalREPO () { # del any files in the local directory
if [ -d $BLFS_BOOK_LOC_DIR ]; then #local dir exists
  if [ "$(ls -A $BLFS_BOOK_LOC_DIR)" ]; then
    rm -rf $BLFS_BOOK_LOC_DIR/$version # delete contents of local book dir
  fi
else  # create it
  mkdir -pv $BLFS_BOOK_LOC_DIR
fi
} # end CleanLocalREPO
#
GetSvnUrl () {
if [ $SVN_URL = "blank" ]; then
  SVN_URL="svn://svn.linuxfromscratch.org/${REPO}/"
fi
} # end GetSvnUrl
#
WhichBLFSBook () {
Ignore="bootscripts"
PS3="Please select the book version : "
select TAG in 'Current Development' $( svn ls ${SVN_URL}tags | grep -vE "$Ignore" )
do
  case $TAG in
    '') echo >&2 "Please select a numbered option";;
    Current*)
      type=trunk
      version=BOOK
      BOOK_VERSION="Current_Development"
    ;;
    ?*)
      type=tags
      version=$TAG
      BOOK_VERSION=$TAG
    ;;
  esac
  BOOK_SVN_URL="${SVN_URL}$type/$version"
  echo >&2 "You have selected '$TAG'"
  echo >&2 "$BOOK_SVN_URL"
  PS3="Is this correct? : "
  select confirm in Yes No
  do
    case $confirm in
      '') echo >&2 "Please enter 1 for Yes or 2 for No";;
      ?*) break
    esac
  done
  case $confirm in
    No) PS3="Please select the book version : ";;
# update the config file with the book version
   Yes) awk -v x=BOOK_VERSION -v n=$BOOK_VERSION '
             BEGIN {FS=OFS="="}$1==x {$2=n} {print}
             ' $cfg > $cfg.tmp
             mv $cfg.tmp $cfg
      break
  esac
done
} #end WhichBLFSBook
#
SetBLFSBook () {
if [ "$BOOK_VERSION" = Current_Development -o "$BOOK_VERSION" = BOOK ]; then
  type=trunk
  version=BOOK
else
  type=tags
  version=$BOOK_VERSION
fi
} #end SetBLFSBook
#
LastAccessSvn () {
local passed_array   # Local variable
BookLoc=${BLFS_BOOK_LOC_DIR}/${version}
if [ -e ${BookLoc}/.svn/entries ]; then #check time of last svn
  EntriesDate=$( stat --printf=%y ${BookLoc}/.svn/entries | awk 'gsub(/-/,"") {printf $1}' )
  date=$(date +'%Y-%m-%d %H:%M:%S') # today's date
  read Y M D h m s <<< ${date//[-: ]/ }
  today=$Y$M$D
  passed_array=( $EntriesDate $today ) # return the last svn date and today
  echo "${passed_array[@]}"
  return 0
else
  return $RETURN_PARAM # no entries file found
fi
} # end LastAccessSvn
CheckoutSVN () {
Dir=$BLFS_BOOK_LOC_DIR
Url="${SVN_URL}$type/$version"
Tag=$version
#
svn co $Url ${Dir}/$Tag # get the requested book
#
} # end CheckoutSVN
#
LocalBook () {
if [ "$BOOK_VERSION" = Current_Development -o "$BOOK_VERSION" = BOOK ]; then
    type="trunk"
    version="BOOK"
else
    type="tags"
    version=$BOOK_VERSION
fi
} # end LocalBook
#
CleanSourceDir () {
DirToClean=${SOURCEDIR}/${1}
wgetFile=${DirToClean}/${WgetList}
sortedFile=${DirToClean}/${sortedfile}
if [ -d $DirToClean ]; then
  if [ "$(ls -A $DirToClean)" ]; then # dir has files in it
    for File in ${DirToClean}/*
    do
      fndfile=$( echo $File | awk -F\/ '{print $NF}' )
      if [ -e $wgetFile ]; then
        if [ "$( grep -q $fndfile $wgetFile ; echo $? )" = "0" ]; then
          rm -rf ${DirToClean}/${fndfile} # delete the file if in wget-list
        fi
      fi
    done
    if [ -e $wgetFile ]; then rm $wgetFile; fi
    if [ -e $sortedFile ]; then rm $sortedFile; fi
  else
     echo "directory $DirToClean is empty"
  fi
else
  install -v -d $DirToClean
fi
} #end CleanSourceDir
#
ChkSrcPresent () {
# $1 is the directory to check and $2 is the wget-list of files
fileMissing=false
dirtochk=$1
wgetFile=$2
if [ -z $wgetFile ]; then
  echo "No wget file present in ${SOURCEDIR}/${Section}"
  echo "sources are not available"
  return 0
fi
while read FileUrl; do
  if [[ ${FileUrl:0:1} != '#' ]]; then # ignore file if it has a hash at the start
    filetofind=$( echo $FileUrl | awk -F\/ '{print $NF}' )
    if [ ! -e ${dirtochk}/${filetofind} ]; then
      echo "file $filetofind not downloaded"
      fileMissing=true
    fi
  fi
done < $wgetFile
if $fileMissing; then
  return $RETURN_PARAM
else
  return 0
fi
} # end ChkSrcPresent
#
createMd5File () {
  commandname=$1
  xmlsec="x"
  rtrnCom=""
  filetoget=${1}fnames
  getComms $filetoget
  fileComm=(${rtrnCom[@]})
  printf "%s\n" "${fileComm[@]}" > ${SrcPath}/${1}/tmpfile #write to tmp file
  currentdir=$( echo $PWD )
  cd ${SrcPath}/${1}
  source tmpfile
  rm tmpfile
  cd $currentdir
  return 0
} # createMd5File
#
  GetXtraFiles () {
  commandname=$1
  xmlsec="x"
  rtrnCom=""
  filetoget=${1}wget
  getComms $filetoget
  fileComm=(${rtrnCom[@]})
  printf "%s\n" "${fileComm[@]}" | sed -e 's/\(.*\)&&$/\1/' > ${SrcPath}/${1}/tmpfile
  currentdir=$( echo $PWD )
  cd ${SrcPath}/${1}
  source tmpfile # download the files
  cd ..
  rm tmpfile
  cd $currentdir
  return 0
} # end GetXtraFiles
#
GetSources () {
# $1 is the section name and $2 is the array of src names
local fname
local extName
declare -a srcname=("${!2}")
pkgfile=${SOURCEDIR}/${WgetList}
if [ ! -e "$pkgfile" ]; then
  echo "\""$pkgfile"\" does not exist. Please download wget-list"
  exit 1
else
  echo will use $pkgfile to download files from anduin
fi
#
SrcPath=${SOURCEDIR}/${1}
if [ ! -d $SrcPath ]; then
  mkdir -v $SrcPath
fi
for sn in ${srcname[@]}
do
  if $single_package; then # find the package
    if [[ "$SINGLE_PACKAGE" == "$sn" ]]; then # found the package
      tomatch="/${sn}"
      grep $tomatch $pkgfile >> ${SrcPath}/${WgetList}
      break
    fi
  else
    tomatch="/${sn}"
    grep $tomatch $pkgfile >> ${SrcPath}/${WgetList} # list of files in this section
  fi
done
# make sure there are no duplicate lines
sort -u ${SrcPath}/${WgetList} > ${SrcPath}/${sortedfile}
if [[ "$BROWSER" == firefox ]]; then
  sed -i '/seamonkey-/d' ${SrcPath}/${sortedfile}
elif [[ "$BROWSER" == seamonkey ]]; then
  sed -i '/firefox-/d' ${SrcPath}/${sortedfile}
fi
# download the sources from anduin
while read url_line
do
  fname=$(echo $url_line |  awk -F\/ '{print $NF}' )
  extName=$(echo $fname | awk -F\. '{print $NF}' )
  case $Section in
      x)
         initial="Xorg"
      ;;
      *)
         case $fname in
           Archive*|ExtUtils*|Glib*|URI*|XML*) # perl modules
             initial="perl-modules"
           ;;
           pyatspi*|py2cairo*|pygtk*|pygobject*|pyxdg*) # python modules
             initial="python-modules"
           ;;
           *)
             initial=${fname:0:1}
             initial=$(echo ${initial,,*}) # make sure first char is lower case
           ;;
         esac
      ;;
  esac
  full_url=${anduin_src_root}/${initial}/${fname}
  if [ "$extName" = patch ]; then full_url=${patch_root}/${fname}; fi
  wget $full_url -P $SrcPath
done < ${SrcPath}/${sortedfile}
if [ "$Section" = x ]; then # get all the extra files
  srcUrl="http://xorg.freedesktop.org/releases/individual"
#set up the dirs under x
  if [ ! -e ${SrcPath}/${xproto} ]; then
    install -v -d ${SrcPath}/${xproto}
  fi
  if [ ! -e ${SrcPath}/${xlib} ]; then
    install -v -d ${SrcPath}/${xlib}
  fi
  if [ ! -e ${SrcPath}/${xapp} ]; then
    install -v -d ${SrcPath}/${xapp}
  fi
  if [ ! -e ${SrcPath}/${xfont} ]; then
    install -v -d ${SrcPath}/${xfont}
  fi
  createMd5File $xproto # create all the md5 files
  createMd5File $xlib
  createMd5File $xapp
  createMd5File $xfont
  GetXtraFiles $xproto # get the wget commands
  GetXtraFiles $xlib
  GetXtraFiles $xapp
  GetXtraFiles $xfont
fi
} #end GetSources
#
GetListFile () {
REPODIR=${BLFS_BOOK_LOC_DIR}/$version
if [ -e ${SOURCEDIR}/${WgetList} ]; then
  rm ${SOURCEDIR}/${WgetList}
fi
make -j1 -f $REPODIR/Makefile -C $REPODIR BASEDIR=$SOURCEDIR $WgetList
WgetFile=${SOURCEDIR}/${WgetList}
#
} #end GetListFile
#
ChkEmptySrcFiles () {
if [ ! -d ${SOURCEDIR}/${1} ]; then
  mkdir -pv ${SOURCEDIR}/${1}
  return $RETURN_PARAM
fi
if [ "$(ls -A ${SOURCEDIR}/${1})" ]; then #  directory is not empty
  zeroLenFiles=$(ls -l $SOURCEDIR/${1}|awk '!/^d/&&$5==0 {print $NF}')
  len=${#zeroLenFiles}
  if [ $len -gt 0 ]; then
    echo -e "These files are empty:\n$zeroLenFiles"
    return $RETURN_PARAM
  else
    return 0 # no empty files found
  fi
else
  return $RETURN_PARAM # section directory is empty
fi
} # end ChkEmptySrcFiles
#
DumpCommands () {
REPODIR=${BLFS_BOOK_LOC_DIR}/$version
target=$( echo $1 | awk '{print tolower($1)}')
SVNINFO="$(svn info $REPODIR | awk '{printf $0"|"}')"
# Note, tagged | on the end so it can be used as a record separator later
# e.g.
# echo $SVNINFO | awk 'BEGIN{ RS = "|" }; {print $0}'
# will 'reconstitute it
SVNrevision=$( echo $SVNINFO | awk 'BEGIN{ RS = "|" };/Revision/ {print $0}' )
for dir in $DumpedCommands $Dumpedhtml
do
  if [ ! -d $dir ]; then
    install -vd $dir
    touch $dir/.revision #suppress error message for the cat  5 lines below
  fi
done
for dir in $Dumpedhtml $DumpedCommands
do
  if [ -e "$dir" -a "$SVNrevision" != "$( cat $dir/.revision | awk '/Revision/ {print $0}')" ]; then
    if [ -d $Dumpedhtml ]; then rm -rf $Dumpedhtml;fi
    if [ -d $DumpedCommands ]; then rm -rf $DumpedCommands;fi
    pushd $REPODIR
            make -j1 DUMPDIR=$DumpedCommands BASEDIR=$Dumpedhtml $target dump-commands
            for dir in $DumpedCommands $Dumpedhtml
            do
              echo $SVNINFO | awk 'BEGIN{ RS = "|" }; {print $0}' > $dir/.revision
            done
    popd
    break
  fi
done
} # end of DumpCommands
#
unpackBLFSfiles () {
CURDIR="$( cd "$( dirname "$0" )" && pwd )" # where this script is held
cd ${LFS}${blfsBuildFiles}
tar Jxf ${blfsfilesTar}
rm ${blfsfilesTar} # untarred so can remove it
# move the java openjdk file to blfs-sources/programming
if [ ! -d ${LFS}${srcrootdir}/programming ]; then
  mkdir -pv ${LFS}${srcrootdir}/programming
fi
if [ -e ${BLFSBUILDFILES}/OpenJDK-* ]; then
    rm -rf ${LFS}${srcrootdir}/programming/OpenJDK-* # delete any existing
    mv ${BLFSBUILDFILES}/OpenJDK-*  ${LFS}${srcrootdir}/programming/
fi
cd $CURDIR
} #end unpackBLFSfiles
#
GetBLFSfiles () {
if [ ! -d ${LFS}${blfsBuildFiles} ]; then
  mkdir -pv ${LFS}${blfsBuildFiles}
fi
if [ ! -d $BLFSBUILDFILES ]; then
  if [ -e ${LFS}${blfsBuildFiles}/${blfsfilesTar} ]; then
    unpackBLFSfiles
  else
    if [ -e ${LFS}/${blfsfilesTar} ]; then
      mv ${LFS}/${blfsfilesTar} ${LFS}${blfsBuildFiles}
      unpackBLFSfiles
    else
      return $RETURN_PARAM
    fi
  fi
fi
return 0
} # end GetBLFSfiles
#
combineScripts () {
declare -a commands=("${!1}")
declare -a buildWrap=("${!2}")
local combine=""
numc=${#commands[@]}
numb=${#buildWrap[@]}
countc=0 # counter for the combine array
countbl=0 # counter for build lines written
inc=false # switch for whether a configure, make and install section is present
cont=0 # # of continuation lines
#
for (( i=0; i<$numb; i++ ))
do
  case "${buildWrap[i]}" in
    configure_commands*)
      combine[countc++]=${buildWrap[countbl++]}
      combine[countc++]=${buildWrap[countbl++]} # the {: line
      if $isPython; then
        case "${commands[countg]}" in
          *\\)
             while [[ "${commands[countg]}" == *\\ ]]; do
               combine[countc++]="  ${commands[countg++]}"
             done
             combine[countc++]="  ${commands[countg++]}" # end of the continuation lines
             inc=true
          ;;
          *)
             :
          ;;
        esac
      fi
      until [[ "${commands[countg]}" == make* || "${commands[countg]}" == *install* || "${commands[countg]}" == error_count* ]]; do
        case "${commands[countg]}" in
         *\\)
             storit[cont++]="${commands[countg++]}"
           ;;
           *)
               #deal with continuation lines
              if [ $cont -gt 0 ]; then # continuation line found
                 for (( l=0; l<$cont; l++ )); do
                   combine[countc++]="  ${storit[l]}"
                 done
                 combine[countc++]="  ${commands[countg++]}"
                 cont=0
                 inc=true
              else
                combine[countc++]="  ${commands[countg++]}" # configure commands
                inc=true # found at least one configure command
              fi
              if [[ "${commands[countg]}" == *install* || $countg -eq $numc ]]; then
                break
              fi
           ;;
        esac
      done
      if [ $cont -gt 0 ]; then
        for (( l=0; l<$cont; l++ )); do
          combine[countc++]="  ${storit[l]}"
        done
        combine[countc++]="  ${commands[countg++]}"
        inc=true
      fi
      if ! $inc; then
        combine[countc++]='  echo "no configure script for this package"'
      fi
      ;;
    make_commands*)
      inc=false
      cont=0
      combine[countc++]=${buildWrap[countbl++]}
      combine[countc++]=${buildWrap[countbl++]} # the {: command
      until [[ "${commands[countg]}" == *install* || "${commands[countg]}" == SEGMENTS* ]]; do
       case "${commands[countg]}" in
         *\\)
            storit[cont++]="${commands[countg++]}"
           ;;
           *)
             if [ $cont -gt 0 ]; then # continuation line found
               for (( l=0; l<$cont; l++ )); do
                 combine[countc++]="  ${storit[l]}"
               done
               combine[countc++]="  ${commands[countg++]}"
               cont=0
               inc=true
             else
               combine[countc++]="  ${commands[countg++]}" # make commands
               inc=true #at least one make command found
             fi
             if [ $countg -eq $numc ]; then # no more commands left
               if [[ "${commands[$countg-1]}" != *make* ]]; then
                 ((countc--))
                 ((countg--))
               fi
               break
             fi
             ;;
        esac
       done
       if ! $inc; then
         combine[countc++]='  echo "no make script for this package"'
       fi
      ;;
    install_commands*)
      inc=false
      foundDoc=false
      combine[countc++]=${buildWrap[countbl++]}
      combine[countc++]=${buildWrap[countbl++]} # the {: command
       case "${commands[$countg]}" in
         *install*)
               if [ $cont -gt 0 ]; then # there is a continuation line
                 for (( il=0; il<$cont; il++ )); do
                 combine[countc++]="  ${storit[il]}"
                 done
                 cont=0
               fi
               case "${commands[$countg]}" in
                 *\\) # install continuation line so store it
                    storit[cont++]="${commands[countg++]}"
                 ;;
                 *)
                    if [ $cont -gt 0 ]; then # continuation line found
                      for (( l=0; l<$cont; l++ )); do
                        combine[countc++]="  ${storit[l]}"
                      done
                      combine[countc++]="  ${commands[countg++]}"
                      cont=0
                      inc=true
                    else
                      combine[countc++]="  ${commands[countg++]}" # install commands
                      inc=true #at least one install command found
                      cont=0
                    fi
                    if [ $countg -eq $numc ]; then # no more commands left
                      :
                    else           # test if more install commands
                      until [[ "${commands[countg]}" != install* && "${commands[countg]}" != make* && "${commands[countg]}" != \#* ]]; do
                            case "${commands[countg]}" in
                               *man[0-9]*) # probably writing man pages
                                  combine[countc++]="  ${commands[countg++]}"
                               ;;
                               *doc*)
                                  foundDoc=true
                                  break
                               ;;
                               *\\) # install continuation line so store it
                                  storit[cont++]="${commands[countg++]}"
                               ;;
                               \#*)
                                  ((countg++)) # comment so ignore it
                               ;;
                               *) # write out the install command - not a doc
                                 combine[countc++]="  ${commands[countg++]}" # install commands
                                 inc=true # not necessary - just making sure!
                               ;;
                            esac
                      done
                      if ! $foundDoc; then #write out any cont lines
                        if [ $cont -gt 0 ]; then # continuation line found
                          case "${commands[countg]}" in
                             *doc*)
                                ((countg++)) # doc so don't write this line
                             ;;
                             *)
                                for (( l=0; l<$cont; l++ )); do
                                  combine[countc++]="  ${storit[l]}"
                                done
                                combine[countc++]="  ${commands[countg++]}"
                                cont=0
                              ;;
                           esac
                        fi
                      fi
                    fi
                 ;;
               esac
         ;;
         SEGMENTS*) # mysql install uses env variable SEGMENTS
              until [[ "${commands[countg]}" == unset* ]]; do
                combine[countc++]="  ${commands[countg++]}"
              done
              combine[countc++]="  ${commands[countg++]}" # write unset SEGMENTS
         ;;
         *)
              if ! $inc; then
                combine[countc++]='  echo "no install script for this package"'
              fi
         ;;
       esac
      ;;
      *)
        if [ $i -lt $countbl ]; then
          :
        else
          combine[countc++]=${buildWrap[i]}
          ((countbl++)) # increment because have written another build command
        fi
      ;;
  esac
done
rtr=(${combine[@]})
} # end combineScript
#
getBuild () {
local abuild=""
buildfile=$BLFSBUILDFILES/buildsrc
if [ ! -e $buildfile ]; then
  return $RETURN_PARAM
else
IFS='
'
abuild=( $( < $buildfile ) )
rtrnBuild=(${abuild[@]})
return 0
fi
} # end getBuild
#
Getxmlsec () {
xmlsec=general
case $1 in
  blfs|security)
        xmlsec=postlfs
  ;;
  networks)
        xmlsec=basicnet
  ;;
  gnomeplatform|gnomedesktop|gnomeutils)
        xmlsec=gnome
  ;;
  office|xsoftware|browser)
        xmlsec=xsoft
  ;;
  multimedia)
        xmlsec=multimedia
  ;;
  pst)
        xmlsec=pst
  ;;
  server)
        xmlsec=server
  ;;
  x|xlibs)
        xmlsec=x
  ;;
  xfce)
        xmlsec=xfce
  ;;
esac
} # end Getxmlsec
#
getComms () {
local acom=""
local bcom=""
local localpkgname=$1
if [[ "$localpkgname" == ffmpeg || "$localpkgname" == atk ]]; then # avoid at-spi2-atk which *-atk matches
  curfile=${DumpedCommands}/${xmlsec}/???-${commandname}
else
  if [ -e ${DumpedCommands}/${xmlsec}/*-${commandname} ]; then
    curfile=${DumpedCommands}/${xmlsec}/*-${commandname}
  else
    echo "No commands matching ${DumpedCommands}/${xmlsec}/*-${commandname}"
    echo "Adjust the command name before continuing. Exiting now"
    exit 1
  fi
fi
IFS='
'
acom=( $( < $curfile ) )
case $localpkgname in
     dbus-glib)
           ic=0
           found=false
           for tline in ${acom[@]}
           do
             case $tline in
                *configure*)
                       if ! $found; then
                         found=true
                         bcom[ic++]=$tline
                       else
                         rtrnCom=(${bcom[@]})
                         return 0
                       fi
                  ;;
                  *)
                        bcom[ic++]=$tline
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     dbus-python)
             ic=0
             numfc=0
             foundconf=false
             for tline in ${acom[@]}
             do
               case $tline in
                  *configure*)
                    if [ $numfc -eq 1 ]; then
                      foundconf=true # found 2nd occurrence of configure
                      bcom[ic++]=$tline # write the configure
                    else
                      ((numfc++))
                    fi
                  ;;
                  *install*)
                    if $foundconf; then
                      bcom[ic++]=$tline
                      break
                    fi
                  ;;
                  *)
                    if $foundconf; then
                      bcom[ic++]=$tline
                    fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     firewall)
             ic=0
             EOFfound=false # need to find 2 EOFs and ignore the remaining commands
             for tline in ${acom[@]}
             do
               case $tline in
                  *EOF*)
                    if ! $EOFfound; then # found first EOF  - write til next EOF
                      EOFfound=true
                      bcom[ic++]=$tline # write the cat - EOF line
                    else # finish writing commands
                      bcom[ic++]=$tline # EOF line
                      EOFfound=false
                    fi   
                  ;;
                  modprobe*)
                    :
                  ;;
                  chmod*)
                      bcom[ic++]=$tline
                      break
                  ;;
                  *)   
                    if $EOFfound; then # write all commands until next EOF
                      bcom[ic++]=$tline
                    fi   
                  ;;   
               esac 
             done 
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     xml-parser|tie-ixhash|xml-simple|extutls-dpnds|extutls-pkgcnfg|perl-glib|uri|archive-zip)
             ic=0
             found=false
             for tline in ${acom[@]}
             do
               case $tline in
                  perl*)
                         if ! $found; then
                           found=true
                           bcom[ic++]=$tline
                         fi
                  ;;
                  *install*)
                         if $found; then
                           bcom[ic++]=$tline
                           rtrnCom=(${bcom[@]})
                           return 0
                         fi
                  ;;
                  *)
                         if $found; then
                           bcom[ic++]=$tline
                         fi
                  ;;
               esac
             done
             return $RETURN_PARAM #install command not found
     ;;
     aspell|xorg-evdev|xorg-synaptics|xorg-wacom|xorg-nouveau)
             ic=0
             found=false
             for tline in ${acom[@]}
             do
               case $tline in
                  *configure*)
                         if $found; then
                           break # write no more lines
                         else
                           found=true
                           bcom[ic++]=$tline
                         fi
                  ;;
                  *)
                         if $found; then # write commands until next configure
                           bcom[ic++]=$tline
                         fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     xorg-vmmouse)
             ic=0
             found=false
             for tline in ${acom[@]}
             do
               case $tline in
                  "./configure \$XORG_CONFIG \\")
                         found=true
                         bcom[ic++]=$tline
                  ;;
                  *configure*)
                         if $found; then break; fi
                  ;;
                  *)
                         if $found; then # write commands until next configure
                           bcom[ic++]=$tline
                         fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     linux-pam) # remove all the test commands
             ic=0
             instfound=false
             for tline in ${acom[@]}
             do
               case $tline in
                  *install*)
                     if ! $instfound; then
                       instfound=true
                     else
                       bcom[ic++]=$tline
                       instfound=false
                     fi
                  ;;
                  *)
                     if ! $instfound; then #write the commands
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     shadow) # only pass system-passwd with cracklib
             ic=0
             passwdcount=0
             syspasswdfound=false
             for tline in ${acom[@]}
             do
               case $tline in
                  'cat > /etc/pam.d/system-password'*)
                       ((passwdcount++))
                       if [ $passwdcount -eq 2 ]; then
                         syspasswdfound=true
                       else
                         bcom[ic++]=$tline
                       fi
                  ;;
                  EOF*)
                       if $syspasswdfound; then
                         syspasswdfound=false
                       else
                         bcom[ic++]=$tline
                       fi
                  ;;
                  *)
                       if ! $syspasswdfound; then
                         bcom[ic++]=$tline
                       fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     docbook-xsl)
             ic=0
             catcount=0 # need to find 4 xmlcatalog commands then ignore the rest
             xmlcatfound=false
             for tline in ${acom[@]}
             do
               case $tline in
                  xmlcatalog*)
                    ((catcount++))
                    if [ $catcount -ge 5 ]; then #ignore remaining commands
                      xmlcatfound=true
                    else
                      bcom[ic++]=$tline
                     fi
                  ;;
                  *)
                     if ! $xmlcatfound; then #write the commands
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     ${xproto}fnames|${xlib}fnames|${xapp}fnames|${xfont}fnames)
             ic=0
             for tline in ${acom[@]}
             do
               case $tline in
                  mkdir*)
                     break
                  ;;
                  *)
                     bcom[ic++]=$tline
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     ${xproto}wget|${xlib}wget|${xapp}wget|${xfont}wget)
             ic=0
             mkdirfound=false
             for tline in ${acom[@]}
             do
               case $tline in
                  mkdir*)
                     bcom[ic++]=$tline
                     mkdirfound=true
                  ;;
                  export*)
                     break
                  ;;
                  *)
                     if $mkdirfound; then
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     $xproto|$xlib|$xapp|$xfont)
             ic=0
             foundbash=false
             for tline in ${acom[@]}
             do
               case $tline in
                  bash*)
                     foundbash=true
                     bcom[ic++]=$tline
                  ;;
                  *)
                     if $foundbash; then
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     git)
             ic=0
             foundhtml=false
             for tline in ${acom[@]}
             do
               case $tline in
                  "make htmldir"*)
                     foundhtml=true
                  ;;
                  tar*)
                     foundhtml=false
                     bcom[ic++]=$tline
                  ;;
                  *)
                     if ! $foundhtml; then
                       bcom[ic++]=$tline
                     fi
                  ;;
               esac
             done
             rtrnCom=(${bcom[@]})
             return 0
     ;;
     *)
             rtrnCom=(${acom[@]})
             return 0
     ;;
esac
} # end getComms
#
GetCommands () {
#get access to the arrays
rtrnBuild=""
getBuild
return_val=$?
if [ $return_val -eq $RETURN_PARAM ]; then # no build file present
  return $RETURN_PARAM
else
  buildScripts=(${rtrnBuild[@]})
  rtrnCom=""
  getComms $pkgname
  commandScripts=(${rtrnCom[@]})
  numclines=${#commandScripts[@]} # # of commands
# 
# output commands until first configure found
  countg=0 # # of commands wriiten out
  contline=0
  wpa_sup=false
  mozconfigfnd=false
  isSed=false
  isPython=false
  for line in "${commandScripts[@]}"
  do
    if $mozconfigfnd || $wpa_sup; then # never both true-in different sections
       case "$line" in
          EOF)
            echo "$line"
            ((countg++))
            if $mozconfigfnd; then 
              mozconfigfnd=false
            else
              wpa_sup=false
            fi
          ;;
          *)  # continue writing until an EOF found
            echo "$line"
            ((countg++))
          ;;
       esac
    else
      case "$line" in
        'cat > wpa_supplicant/.config << "EOF"'|'cat >> wpa_supplicant/.config << "EOF"') # wpa_supp writes .config document
            wpa_sup=true
            echo $line
            ((countg++))
        ;;
        "cat > mozconfig <<"*) # firefox, seamonkey write mozconfig
            mozconfigfnd=true
            echo $line
            ((countg++))
        ;;
        *HERE_DOC*) # apache writes a here doc
              echo $line
              ((countg++))
        ;;
        sed*)
# test if sed has continuation line
          case "$line" in
            *\\)
              isSed=true # this is a sed with cont line(s)
              cacheit[contline++]="$line"
              ((countg++))
            ;;
            *)
              echo "$line"
              ((countg++))
            ;;
          esac
        ;;
        export*) # catch any env variables being set up
          echo "$line"
          ((countg++))
        ;;
        "perl Makefile.PL"*) # a perl module
          break
        ;;
        'cat > /etc/rc.d/rc.iptables << "EOF"') # the firewall for iptables
         echo $line
         ((countg++))
        ;;
        *configure*|*Configure*|*bootstrap*|*config*|*autogen.sh*|cmake*) # boost is bootstrap, openssl is config mysql is cmake
          if $isSed; then # write out the sed lines
            for (( l=0; l<$contline; l++ )); do
              echo "${cacheit[l]}"
            done
            echo "$line"
            contline=0
            ((countg++))
            isSed=false # finished with this sed command
          else
            if [ $contline -gt 0 ]; then countg=$countg-$contline; fi
            break
          fi
        ;;
        make*) #begins with make
          if $isSed; then # write out the sed lines
            for (( l=0; l<$contline; l++ )); do
              echo "${cacheit[l]}"
            done
            echo "$line"
            contline=0
            ((countg++))
            isSed=false # finished with this sed command
          else
            break
          fi
        ;;
        *)
          case "$line" in
            *\\) # if a continuation line, store in cache
              cacheit[contline++]="$line"
              ((countg++))
            ;;
            *)
             if [ $contline -gt 0 ]; then # write out continuation line 
               for (( l=0; l<$contline; l++ )); do
                 echo "${cacheit[l]}"
               done
               echo "$line"
               contline=0
               isSed=false # finished with any sed command
               ((countg++)) # count # of commands written to output
               if [ $countg -eq $numclines ]; then # no more commands
                 return 0
               fi
             else
               echo "$line"
               ((countg++)) # count # of commands written to output
               if [ $countg -eq $numclines ]; then # no more commands
                 return 0 
               fi
             fi
            ;;
          esac
       ;;
      esac
    fi
  done
#
  rtr=""
  combineScripts commandScripts[@] buildScripts[@]
  scriptOut=(${rtr[@]})
  for t in "${scriptOut[@]}"
  do
    echo $t
  done
  if [ $countg -ne $numclines ]; then # output remaining commands
    contin=false
    contline=0
    iftest=false # test for an if with a /usr/share/doc in it
    for (( k=$countg; k<$numclines; k++ ))
    do
      case ${commandScripts[k]} in
         install*)
                case ${commandScripts[k]} in
                   *'/usr/share/doc'*)
                       case ${commandScripts[k]} in
                          *\\) # a continuation line
                             contin=true
                          ;;
                       esac
                   ;;
                   *\\) # a continuation line
                       cacheit[contline++]=${commandScripts[k]}
                       contin=true
                   ;;
                   *) # install but not a doc or a cont line
                       echo ${commandScripts[k]}
                   ;;
                esac
         ;;
         if*) # starts with if so if a doc, will need to delete the closing fi
                case ${commandScripts[k]} in
                   *'/usr/share/doc'*)
                       iftest=true
                       case ${commandScripts[k]} in
                          *\\) # a continuation line
                             contin=true
                          ;;
                       esac
                   ;;
                   *\\) # a continuation line
                       cacheit[contline++]=${commandScripts[k]}
                       contin=true
                   ;;
                   *) # if test but not a doc or a cont line
                       echo ${commandScripts[k]}
                   ;;
                esac
         ;;
         gunzip*) # unpack a tarball so write it
                echo ${commandScripts[k]}
         ;;
         *'/usr/share/doc'*)
                case ${commandScripts[k]} in
                    *\\) # a continuation line
                       contin=true
                    ;;
                    *)
                       if $contin; then # is a doc, so don't write
                         contin=false
                         contline=0
                       fi
                    ;;
                esac
         ;;
         "fi"*)
                if $iftest; then # end of a doc if test - don't write it
                  iftest=false
                else
                  echo ${commandScripts[k]} # if block is not a doc
                fi
         ;;
         *)
              if ! $iftest; then # not commands within a doc if block
                case ${commandScripts[k]} in
                    *\\) # continuation line, store it
                       cacheit[contline++]=${commandScripts[k]}
                       contin=true
                    ;;
                    *) 
                       if [ $contline -gt 0 ]; then # write out continuation line(s)
                         for (( l=0; l<$contline; l++ )); do
                           echo "${cacheit[l]}"
                         done
                         contin=false
                         contline=0
                       fi
                       echo ${commandScripts[k]}
                    ;;
                esac
              fi
         ;;
      esac
    done
  fi
  return 0
fi
} # end GetCommands
#
GetXCommands () {
#get access to the xml x commands
rtrnCom=""
getComms $pkgname
commandScripts=(${rtrnCom[@]})
numclines=${#commandScripts[@]} # # of commands
for xt in "${commandScripts[@]}"
do
  echo $xt
done
return 0
} # GetXCommands 
GetcacertsCommands () {
rtrnCom=""
getComms $pkgname
commandScripts=(${rtrnCom[@]})
# dump all the commands
for line in "${commandScripts[@]}"
do
  echo $line
done
} # end GetcacertsCommands
#
coreutilsComms () {
corecom[0]="sed -i -e 's/! isatty/isatty/' \\"
corecom[1]="       -e '45i\              || errno == ENOENT' gnulib-tests/test-getlogin.c"
corecom[2]='patch -Np1 -i ../coreutils-8.19-i18n-1.patch'
corecom[3]='FORCE_UNSAFE_CONFIGURE=1 ./configure \'
corecom[4]='--prefix=/usr --libexecdir=/usr/lib --enable-no-install-program=kill,uptime'
corecom[5]='make'
corecom[6]='make install'
corecom[7]='mv -v /usr/bin/{cat,chgrp,chmod,chown,cp,date,dd,df,echo} /bin'
corecom[8]='mv -v /usr/bin/{false,ln,ls,mkdir,mknod,mv,pwd,rm} /bin'
corecom[9]='mv -v /usr/bin/{rmdir,stty,sync,true,uname} /bin'
corecom[10]='mv -v /usr/bin/chroot /usr/sbin'
corecom[11]='mv -v /usr/share/man/man1/chroot.1 /usr/share/man/man8/chroot.8'
corecom[12]='sed -i s/\"1\"/\"8\"/1 /usr/share/man/man8/chroot.8'
corecom[13]='mv -v /usr/bin/{head,sleep,nice} /bin'
coreRtrn=(${corecom[@]})
} # end coreutilsComms
#
GetcoreutilsCommands () {
#get access to the arrays
rtrnBuild=""
getBuild
return_val=$?
if [ $return_val -eq $RETURN_PARAM ]; then # no build file present
  return $RETURN_PARAM
else
  buildScripts=(${rtrnBuild[@]})
  coreRtrn=""
  coreutilsComms
  commandScripts=(${coreRtrn[@]})
  numclines=${#commandScripts[@]}
  countg=0 # initialize commands counter
  contline=0
  isPython=false
  for line in "${commandScripts[@]}"
  do
    case "$line" in
       *configure*)
        break
       ;;
       make*) #begins with make
       break
       ;;
       *)
         case "$line" in
            *\\) # if a continuation line then store in cache
             cacheit[contline++]="$line"
             ((countg++))
            ;;
            *)
             if [ $contline -gt 0 ]; then # continuation line found
               for (( l=0; l<$contline; l++ )); do
                 echo "${cacheit[l]}"
               done
               echo "$line"
               contline=0
               ((countg++)) # count # of commands written to output
               if [ $countg -eq $numclines ]; then
                 return 0
               fi
             else
               echo "$line"
               ((countg++)) # count # of commands written to output
               if [ $countg -eq $numclines ]; then
                 return 0
               fi
             fi
            ;;
          esac
       ;;
    esac
  done
#
  rtr=""
  combineScripts commandScripts[@] buildScripts[@]
  scriptOut=(${rtr[@]})
  for t in "${scriptOut[@]}"
  do
    echo $t
  done
  if [ $countg -ne $numclines ]; then # output remaining commands
    contin=false
    for (( k=$countg; k<$numclines; k++ ))
    do
      if [[ "${commandScripts[k]}" == install* ]]; then #don't install docs
        if [[ "${commandScripts[k]}" == *\\ ]]; then
          contin=true # continuation line found
        else
          :
        fi
      else
        if $contin; then
          if [[ "${commandScripts[k]}" == *\\ ]]; then # more continuation
            :
          else
            contin=false
          fi
        else
          echo ${commandScripts[k]}
        fi
      fi
    done
  fi
  return 0
fi
} # end GetcoreutilsCommands
#
x264Comms () {
local x264com=""
x264com[0]="./configure --prefix=/usr"
x264com[1]="make"
x264com[2]="make install"
x264Rtrn=(${x264com[@]})
} # end x264Comms

Getx264Commands () {
#get access to the arrays
rtrnBuild=""
getBuild
return_val=$?
if [ $return_val -eq $RETURN_PARAM ]; then # no build file present
  return $RETURN_PARAM
else
  buildScripts=(${rtrnBuild[@]})
  x264Rtrn=""
  x264Comms
  commandScripts=(${x264Rtrn[@]})
  numclines=${#commandScripts[@]}
  countg=0 # initialize commands counter
  isPython=false
  rtr=""
  combineScripts commandScripts[@] buildScripts[@]
  scriptOut=(${rtr[@]})
  for t in "${scriptOut[@]}"
  do
    echo $t
  done
  return 0
fi
} # end Getx264Commands
#
ffmpegthumComms () {
local ffmpegthumcom=""
ffmpegthumcom[0]="./configure --prefix=/usr"
ffmpegthumcom[1]="make"
ffmpegthumcom[2]="make install"
ffmpegthumRtrn=(${ffmpegthumcom[@]})
} # end ffmpegthumComms
#
GetffmpegthumCommands () {
# get access to the arrays
rtrnBuild=""
getBuild
return_val=$?
if [ $return_val -eq $RETURN_PARAM ]; then # no build file present
  return $RETURN_PARAM
else
  buildScripts=(${rtrnBuild[@]})
  ffmpegthumRtrn=""
  ffmpegthumComms
  commandScripts=(${ffmpegthumRtrn[@]})
  numclines=${#commandScripts[@]}
  countg=0 # initialize commands counter
  isPython=false
  rtr=""
  combineScripts commandScripts[@] buildScripts[@]
  scriptOut=(${rtr[@]})
  for t in "${scriptOut[@]}"
  do
    echo $t
  done
  return 0
fi
} # end GetffmpegthumCommands
#
OpenJDKComms () {
local openjdkcom=""
openjdkcom[0]="install -v -m755 -d /opt/OpenJDK-1.7.0.5"
openjdkcom[1]="mv -v * /opt/OpenJDK-1.7.0.5"
openjdkcom[2]="ln -v -nsf OpenJDK-1.7.0.5 /opt/OpenJDK"
openjdkcom[3]='cat > /etc/profile.d/openjdk.sh << "EOF"'
openjdkcom[4]="# Begin /etc/profile.d/openjdk.sh"
openjdkcom[5]="# Set JAVA_HOME directory"
openjdkcom[6]="JAVA_HOME=/opt/OpenJDK"
openjdkcom[7]="# Adjust PATH"
openjdkcom[8]="pathappend \${JAVA_HOME}/bin PATH"
openjdkcom[9]="# Auto Java CLASSPATH"
openjdkcom[10]="# Copy jar files to, or create symlinks in this directory"
openjdkcom[11]="AUTO_CLASSPATH_DIR=/usr/share/java"
openjdkcom[12]="pathprepend . CLASSPATH"
openjdkcom[13]="for dir in \`find \${AUTO_CLASSPATH_DIR} -type d 2>/dev/null\`; do"
openjdkcom[14]="    pathappend \$dir CLASSPATH"
openjdkcom[15]="done"
openjdkcom[16]='for jar in `find ${AUTO_CLASSPATH_DIR} -name "*.jar" 2>/dev/null`; do'
openjdkcom[17]="    pathappend \$jar CLASSPATH"
openjdkcom[18]="done"
openjdkcom[19]="export JAVA_HOME CLASSPATH"
openjdkcom[20]="unset AUTO_CLASSPATH_DIR"
openjdkcom[21]="unset dir"
openjdkcom[22]="unset jar"
openjdkcom[23]="# End /etc/profile.d/openjdk.sh"
openjdkcom[24]="EOF"
openjdkRtrn=(${openjdkcom[@]})
} #end OpenJDKComms
#
GetOpenJDKCommands () {
#get access to the arrays
rtrnBuild=""
getBuild
return_val=$?
if [ $return_val -eq $RETURN_PARAM ]; then # no build file present
  return $RETURN_PARAM
else
  buildScripts=(${rtrnBuild[@]})
  jdkRtrn=""
  OpenJDKComms
  commandScripts=(${openjdkRtrn[@]})
  numclines=${#commandScripts[@]}
  countg=0 # initialize commands counter
  isPython=false
  rtr=""
  combineScripts commandScripts[@] buildScripts[@]
  scriptOut=(${rtr[@]})
  for t in "${scriptOut[@]}"
  do
    echo $t
  done
  if [ $countg -ne $numclines ]; then # output remaining commands
    contin=false
    for (( k=$countg; k<$numclines; k++ ))
    do
      if [[ "${commandScripts[k]}" == install* ]]; then #don't install docs
        if [[ "${commandScripts[k]}" == *\\ ]]; then
          contin=true # continuation line found
        else
          :
        fi
      else
        if $contin; then
          if [[ "${commandScripts[k]}" == *\\ ]]; then # more continuation
            :
          else
            contin=false
          fi
        else
          echo ${commandScripts[k]}
        fi
      fi
    done
  fi
  return 0
fi
} #end GetOpenJDKCommands
#
blfsbtscrptsComms () {
local blfscom=""
blfscom[0]='make install-$bsToInstall'
blfsRtrn=(${blfscom[@]})
} # end blfsbtscrptsComms
#
GetblfsCommands () {
rtrnBuild=""
getBuild
return_val=$?
if [ $return_val -eq $RETURN_PARAM ]; then # no build file present
  return $RETURN_PARAM
else
  buildScripts=(${rtrnBuild[@]})
  blfsRtrn=""
  blfsbtscrptsComms
  commandScripts=(${blfsRtrn[@]})
  numclines=${#commandScripts[@]}
  countg=0 # initialize commands counter
  isPython=false
  rtr=""
  combineScripts commandScripts[@] buildScripts[@]
  scriptOut=(${rtr[@]})
  for t in "${scriptOut[@]}"
  do
    echo $t
  done
return 0
fi
} # end GetblfsCommands
#
pyComms () {
local pycom=""
if [[ "$pkgname" == py2cairo ]]; then
pycom[0]="./waf configure --prefix=/usr"
pycom[1]="./waf build"
pycom[2]="./waf install"
elif [[ "$pkgname" == pygobject2 ]]; then
pycom[0]="patch -p1 < ../pygobject-2.28.6-introspection-1.patch"
pycom[1]="./configure --prefix=/usr"
pycom[2]="make"
pycom[3]="make install"
elif [[ "$pkgname" == pygobject3 || "$pkgname" == pygtk || "$pkgname" == pyatspi ]]; then
pycom[0]="./configure --prefix=/usr"
pycom[1]="make"
pycom[2]="make install"
elif [[ "$pkgname" == pyxdg ]]; then
isPython=true
pycom[0]="python setup.py install"
fi
pyRtrn=(${pycom[@]})
} #end pyComms
GetPythonModule () {
#get access to the arrays
rtrnBuild=""
getBuild
return_val=$?
if [ $return_val -eq $RETURN_PARAM ]; then # no build file present
  return $RETURN_PARAM
else
  buildScripts=(${rtrnBuild[@]})
  pyRtrn=""
  isPython=false
  pyComms
  commandScripts=(${pyRtrn[@]})
  numclines=${#commandScripts[@]}
  countg=0 # initialize commands counter
# write out commands until first configure or install found
  for line in "${commandScripts[@]}"
  do
    case "$line" in
       *configure*|*install*)
         break
       ;;
       *)
         echo $line
         ((countg++))
       ;;
    esac
  done 
  rtr=""
  combineScripts commandScripts[@] buildScripts[@]
  scriptOut=(${rtr[@]})
  for t in "${scriptOut[@]}"
  do
    echo $t
  done
return 0
fi
} # end GetPythonModule
#
libcdioComms () {
local libcdiocom=""
libcdiocom[0]="./configure --prefix=/usr"
libcdiocom[1]="make"
libcdiocom[2]="make install"
libcdioRtrn=(${libcdiocom[@]})
} # libcdioComms
#
GetLibcdioCommands () {
rtrnBuild=""
getBuild
return_val=$?
if [ $return_val -eq $RETURN_PARAM ]; then # no build file present
  return $RETURN_PARAM
else
  buildScripts=(${rtrnBuild[@]})
  libcdioRtrn=""
  libcdioComms
  commandScripts=(${libcdioRtrn[@]})
  numclines=${#commandScripts[@]}
  countg=0 # initialize commands counter
  isPython=false
  rtr=""
  combineScripts commandScripts[@] buildScripts[@]
  scriptOut=(${rtr[@]})
  for t in "${scriptOut[@]}"
  do
    echo $t
  done
return 0
fi
} # end GetLibcdioCommands
#
GetBLFSCommands () {
echo "put commands here"
} # GetBLFSCommands
#
CreateBuildDirasroot () {  #1 is the build dir
cat << "EOF"
CreateBuildDirasroot () {
BuildDirasroot=$1
if [ ! -e $BuildDirasroot ]; then install -d $BuildDirasroot; fi
cd $BuildDirasroot
CUR_DIR=".."
}
EOF
} # end CreateBuildDirasroot
#
Header () {
echo writing the script to: $Output
cat > $Output << "EOF"
#!/bin/bash
#
if [ $UID -ne 0 ]; then echo Please run this script as root. ; exit 1; fi
#
EOF
if [[ "$Section" == blfs ]]; then
  echo 'bsToInstall=$1' >> $Output
else
echo "RETURN_PARAM=$RETURN_PARAM # exit with an error
RETURN_NOTSET=$RETURN_NOTSET # no dependencies set
RETURN_DEPNOTMET=$RETURN_DEPNOTMET # package dependency not met
RETURN_ALLDEPSMET=$RETURN_ALLDEPSMET # all dependencies met" >> $Output
fi
echo "me=\$0
LFS=$LFS
SVNINFO=\"$SVNINFO\"
srcrootdir=$srcrootdir
blfsfiles=${blfsBuildFiles}/${blfsfiles}
BuildLog=$BuildLog
build=$build # name of the build file for each package
Section=$cursection
PKGUSERDIR=$PKGUSERDIR" >> $Output
if $as_root; then CreateBuildDirasroot >> $Output; fi
} # end Header
#
pkguser () {
cat >> $Output << "EOF"
pkguser_ () {
# make sure pkgusers can write to the logfile
chgrp install $BuildLog
chmod 664 $BuildLog
#
cat > /etc/pkgusr/bash_profile << "BashProfile"
export PATH=/usr/lib/pkgusr:/bin:/usr/bin:/opt/OpenJDK/bin:/opt/ant/bin:/opt/qt/bin
export PROMPT_COMMAND='PS1="package \u:"$(pwd)"> "'
cd
EOF
echo "PkgUserDir=${PKGUSERDIR}/${cursection}" >> $Output
cat >> $Output << "EOF"
complete -o default -o nospace -A user su finger pinky
export PkgName=$LOGNAME
EOF
echo "if [ -e \${PkgUserDir}/\${LOGNAME}/$build -a ! -e ~/.\${LOGNAME} ]; then
  cd
  bash \${PkgUserDir}/\${LOGNAME}/$build" >> $Output
cat >> $Output << "EOF"
  exit
fi
BashProfile
install -v -d ${PkgUserDir}/${LOGNAME}
}
EOF
} # end of pkguser
#
updatePkgUser () {
cat >> $Output << "EOF"
updatePkgUser_ () {
cat > /etc/pkgusr/bash_profile << "BashProfile"
export PATH=/usr/lib/pkgusr:/bin:/usr/bin
export PROMPT_COMMAND='PS1="package \u:"$(pwd)"> "'
cd
EOF
echo "PkgUserDir=${PKGUSERDIR}/${cursection}" >> $Output
cat >> $Output << "EOF"
complete -o default -o nospace -A user su finger pinky
export PkgName=$LOGNAME
EOF
echo "if [ -e \${PkgUserDir}/\${LOGNAME}/$build -a ! -e ~/.\${LOGNAME} ]; then
  cd
  bash \${PkgUserDir}/\${LOGNAME}/$build" >> $Output
cat >> $Output << "EOF"
  exit
fi
BashProfile
install -v -d ${PkgUserDir}/${LOGNAME}
}
EOF
} # end updatePkgUser
#
delSrcFile () {
echo "cd \$curdir
cd ..
rm -rf \$curdir
rm -rf .cache"
} # end of delSrcFile
#
Function () {
echo "${FuncName}_ () {
PkgName=$pkgname
SrcName=$srcname
cursection=$cursection
PkgUserDir=${PKGUSERDIR}/${cursection}" >> $Output
if $as_root; then 
  case $pkgname in
    coreutils)
      echo "sourcedir=${PKGUSERDIR}/${cursection}/${pkgname}" >> $Output
    ;;
    shadow)
      echo "sourcedir=${srcrootdir}/security" >> $Output
    ;;
    *)
      echo "sourcedir=${srcrootdir}/${cursection}" >> $Output
    ;;
  esac
fi
case $pkgname in
   blfs-btscrpts)
cat >> $Output << "EOF"
bsToInstall=$bsToInstall
EOF
   ;;
   udev)
echo "udevvers=$udevvers" >> $Output
   ;;
esac
echo "starttime=\$( date +%s )" >> $Output
case $pkgname in
   blfs-btscrpts)
cat >> $Output << "EOF"
if [ -e "${PkgUserDir}/${PkgName}/.${bsToInstall}" ]; then
  echo "skipping ${PkgName}/${bsToInstall}"
  return
fi
EOF
   ;;
   *)
      cat >> $Output << "EOF"
if [ -e "${PkgUserDir}/${PkgName}/.${PkgName}" ]; then
  echo "skipping $PkgName"
  return
fi
EOF
case $pkgname in
   firewall) # no need to check dependencies
   echo "BuildScript=true" >> $Output
   ;;
   *)
cat >> $Output << "EOF"
# check for dependencies
BuildScript=false
FuncName=$( echo $PkgName | sed -e s/-//g -e s/_//g )
DepRtrn=""
PkgDepend
return_val=$?
if [[ $return_val -eq $RETURN_PARAM || $return_val -eq $RETURN_NOTSET ]]; then
  echo "No dependencies - building script for $PkgName"
  BuildScript=true
elif [[ $return_val -eq 0 ]]; then # test if dependencies met
EOF
    case $pkgname in
      glib-networking|libsoup|gvfs|webkitgtk|pulseaudio|gst-plgns-good|libcanberra)
          if [ "$GNOME_OR_XFCE" = xfce ]; then
            cat >> $Output << "EOF"
  rtrPlessArray=""
EOF
            case $pkgname in
              glib-networking)
                cat >> $Output << "EOF"
  delElementPattern DepRtrn[@] "gnomeplatform/gset-dsktp-schms"
EOF
              ;;
              libsoup|gvfs)
                cat >> $Output << "EOF"
  delElementPattern DepRtrn[@] "gnomeplatform/libgnome-keyring"
EOF
              ;;
              webkitgtk)
                cat >> $Output << "EOF"
  delElementPattern DepRtrn[@] "networks/geoclue"
EOF
              ;;
              pulseaudio|gst-plgns-good|libcanberra)
                cat >> $Output << "EOF"
  delElementPattern DepRtrn[@] "gnomeplatform/gconf"
EOF
              ;;
            esac
            cat >> $Output << "EOF"
  unset DepRtrn
  DepRtrn=(${rtrPlessArray[@]})
EOF
          fi
      ;;
    esac
cat >> $Output << "EOF"
  rtrnDepNotMet=""
  testDeps DepRtrn[@]
  ret_val=$?
  if [ $ret_val -eq $RETURN_ALLDEPSMET ]; then
    echo "All dependencies met - building script for $PkgName"
    BuildScript=true
  fi
fi
EOF
   ;;
esac
echo "if \$BuildScript; then" >> $Output
   ;;
esac
if ! $as_root; then
  echo 'install -v -d ${PkgUserDir}/${PkgName}' >> $Output
  echo "touch \${PkgUserDir}/\${PkgName}/$build" >> $Output
  cat >> $Output << "EOF"
echo "#!/bin/bash
EOF
  echo 'BuildLog=$BuildLog" > ${PkgUserDir}/${PkgName}/'$build >> $Output
  if [[ "$pkgname" == "blfs-btscrpts" ]]; then
    echo "echo \"bsToInstall=\$bsToInstall\" >> \${PkgUserDir}/\${PkgName}/$build" >> $Output
  fi
  echo "cat >> \${PkgUserDir}/\${PkgName}/$build << \"IPS\"" >>$Output
  cat >> $Output << "EOF"
set +h
PkgName=$LOGNAME
CUR_DIR=$HOME
EOF
  if [[ "$Section" == x || "$pkgname" == libdrm || "$pkgname" == freeglut ]]; then
    echo "source /etc/profile.d/xorg.sh" >> $Output
  fi
  echo "SrcName=$srcname" >> $Output
  case $pkgname in
    cups)
     echo "sourcedir=${srcrootdir}/${Section}
blfsfiles=${blfsBuildFiles}/${blfsfiles}" >> $Output
    ;;
    firewall) # no source file
     cat >> $Output << "EOF"
starttime=$( date +%s )
EOF
    ;;
    *)
      echo "sourcedir=${srcrootdir}/${Section}" >> $Output
    ;;
  esac
else # building as root
  echo "starttime=\$( date +%s )" >> $Output
  cat >> $Output << "EOF"
CreateBuildDirasroot ${PkgUserDir}/${PkgName}
EOF
  if [[ "$Section" == x || "$pkgname" == libdrm || "$pkgname" == freeglut ]]; then
    echo "source /etc/profile.d/xorg.sh" >> $Output
  fi
fi # end as_root
case $pkgname in
  cacerts)
     cat >> $Output << "EOF"
starttime=$( date +%s )
EOF
  ;;
  firewall) # don't need to unpack sources
     :
  ;;
  *)
unpack >> $Output
cat >> $Output << "EOF"
unpack
if [ "$?" -eq 1 ]; then # unpack failed so abort
  echo "Failed to unpack source for package $pkgname. Exiting now."
  exit 1
fi
EOF
  case $pkgname in # need to set up some env variables if building as root
    $xproto|$xlib|$xapp|$xfont)
      cursec=${pkgname//x7/}
echo "cursec=$cursec" >> $Output
    ;;
    *)
      echo "curdir=\$( echo \$PWD )" >> $Output
      case $pkgname in
         avahi|vlc)
            echo "source /etc/profile.d/qt.sh
export PKG_CONFIG_PATH=\$PKG_CONFIG_PATH:/opt/qt/lib/pkgconfig" >> $Output
         ;;
         apache-ant)
            echo "source /etc/profile.d/openjdk.sh" >> $Output
         ;;
      esac
    ;;
  esac
  ;;
esac
WriteScript
closefunction
} # end of Function
#
closefunction () {
case $pkgname in
  aspell)  # install a dictionary (english by default)
    cat >> $Output << "EOF"
cd ..
language="aspell6-en"
dictionary="${language}-7.1-0.tar.bz2"
wget ftp://ftp.gnu.org/gnu/aspell/dict/en/${dictionary}
cd $(tar vxf ${language}*.tar.*z* | awk -F\/ 'END{print $1}')
./configure
make
make install
cd ..
rm -rf ${language}-7.1-0.
#end install dict
EOF
  ;;
esac
case $pkgname in
    blfs-btscrpts)
      if $as_root; then
        echo 'touch ${PkgUserDir}/${PkgName}/.${bsToInstall}' >> $Output
      else
        echo 'touch ~/.${bsToInstall}' >> $Output
      fi
    ;;
    $xproto|$xlib|$xapp|$xfont)
      if $as_root; then
echo 'set +e
touch ${PkgUserDir}/${PkgName}/.${PkgName}' >> $Output
      else
echo "set +
touch ~/.${pkgname}" >> $Output
      fi
    ;;      
    *)
      if $as_root; then
        echo 'touch ${PkgUserDir}/${PkgName}/.${PkgName}' >> $Output
      else
        echo "touch ~/.${pkgname}" >> $Output
      fi
    ;;
esac
cat >> $Output << "EOF"
endtime=$( date +%s )
EOF
case $pkgname in
  cacerts|blfs-btscrpts|$xproto|$xlib|$xapp|$xfont|xterm|firewall)
     : # don't delete any files
  ;;
  mesalib) # delete the glu dir as well
     delSrcFile >> $Output
     echo "rm -rf \$gludir" >> $Output
  ;;
  *)
     delSrcFile >> $Output
  ;;
esac
cat >> $Output << "EOF"
elapsedtime=$( expr $endtime - $starttime )
echo "${PkgName} $unpacktime $elapsedtime" >> $BuildLog
EOF
if ! $as_root; then
echo "IPS" >> $Output
setuplinks # setup any preprocessing commands - then test doFirst and links
if [[ ! -z $doFirst || ! -z $links ]]; then resolvelinks; fi # not null
if [ "$pkgname" = evolution ]; then # write out the functions to get version #
float_test
evolutionVersion
fi
cat >> $Output << "EOF"
if [ "$(grep -q ^$PkgName\: /etc/passwd;echo $?)" != 0 ]; then
  if [ "$(grep -q ^install3\: /etc/group;echo $?)" = 0 ]; then # install3 exists
    numcharInstall install3
    if [ $numchars -gt 2030 ]; then
      echo "You'll have to make yet another install group - install4"
      echo "Update /usr/sbin/installpkg as before"
      exit 1
    fi
  elif [ "$(grep -q ^install2\: /etc/group;echo $?)" = 0 ]; then
    numcharInstall install2
    if [ $numchars -gt 2030 ]; then
      echo "Yoiks, what a lot of packages you've installed"
      echo "You'll have to make yet another install group - install3"
      echo "Update /usr/sbin/installpkg as before"
      exit 1
    fi
  else
    numcharInstall install
    if [ $numchars -gt 2030 ]; then # limit of 2048. Create a new install group
      echo "install group has nearly reached the limit of 2048 chars"
      echo "create a new install group called install2. To do this, edit"
      echo "/etc/group and insert install2:x:9999:"
      echo "Then change install in /usr/sbin/installpkg to install2"
      echo "You'll find it at the end of the useradd line."
      exit 1
    fi
  fi
EOF
case $pkgname in
  apache)
   cat >> $Output << "EOF"
    installpkg $PkgName $cursection 25
EOF
  ;;
  mysql)
   cat >> $Output << "EOF"
    installpkg $PkgName $cursection 40
EOF
  ;;
  avahi)
   cat >> $Output << "EOF"
    installpkg $PkgName $cursection 84
EOF
  ;;
  gdm)
   cat >> $Output << "EOF"
    installpkg $PkgName $cursection 21
EOF
  ;;
  *)
   cat >> $Output << "EOF"
    installpkg $PkgName $cursection
EOF
  ;;
esac
cat >> $Output << "EOF"
fi
EOF
if [[ "$pkgname" == nautilus || "$pkgname" == gcr || "$pkgname" == brasero ]]; then
echo "setMime $pkgname # need to own everything under /usr/share/mime" >> $Output
fi
if [[ ! -z $doFirst || ! -z $links ]]; then # preprocessing
cat >> $Output << "EOF"
resolvelinks
EOF
fi
if [ "$pkgname" = evolution ]; then
cat >> $Output << "EOF"
evolutionVersion
EOF
fi
cat >> $Output << "EOF"
su $PkgName
EOF
case $pkgname in
   blfs-btscrpts)
    cat >> $Output << "EOF"
if [ ! -e $PkgUserDir/$PkgName/.$bsToInstall ]; then
  echo "${bsToInstall} failed"
  exit 1
fi
EOF
   ;;
   *)
cat >> $Output << "EOF"
if [ ! -e $PkgUserDir/$PkgName/.$PkgName ]; then
  echo "${PkgName} failed"
  exit 1
fi
EOF
   ;;
esac
cat >> $Output << "EOF"
ldconfig
EOF
echo "chown \$PkgName:\$PkgName \${PkgUserDir}/\${PkgName}/$build" >> $Output
#
#set required dirs to be install dirs if installing as a package user 
#
case $pkgname in
    json-c) # /usr/libexec
          cat >> $Output << "EOF"
install -vd /usr/libexec
chgrp install /usr/libexec
chmod g+w,o+t /usr/libexec
EOF
    ;;
    apr) # /usr/include/apr-1
          cat >> $Output << "EOF"
chgrp install /usr/include/apr-1 #for apr-util
chmod g+w,o+t /usr/include/apr-1
chgrp install /srv
chmod g+w,o+t /srv
chgrp install /var/log
chmod g+w,o+t /var/log
EOF
    ;;
    freetype) #/var/cache
          cat >> $Output << "EOF"
chgrp install /var/cache
chmod g+w,o+t /var/cache
chgrp install /lib/udev # for bluez
chmod g+w,o+t /lib/udev
EOF
echo "chgrp install /usr/lib/perl5/${perlvers}/i686-linux
chmod g+w,o+t /usr/lib/perl5/${perlvers}/i686-linux
chgrp install /usr/lib/perl5/site_perl/${perlvers} # needs to be done early
chmod g+w,o+t /usr/lib/perl5/site_perl/${perlvers}
chgrp install /usr/lib/perl5/site_perl/${perlvers}/i686-linux
chmod g+w,o+t /usr/lib/perl5/site_perl/${perlvers}/i686-linux" >> $Output
    ;;
    fontconfig) 
          cat >> $Output << "EOF"
chgrp install /usr/share/xml # for iso-codes
chmod g+w,o+t /usr/share/xml
chgrp install /usr/share/fontconfig/conf.avail
chmod g+w,o+t /usr/share/fontconfig/conf.avail
chgrp install /etc/fonts
chmod g+w,o+t /etc/fonts
chgrp install /etc/fonts/conf.d # for xfont
chmod g+w,o+t /etc/fonts/conf.d
EOF
    ;;
    p11-kit)
          cat >> $Output << "EOF"
chgrp install /usr/share/gtk-doc/html # for gegl
chmod g+w,o+t /usr/share/gtk-doc/html
chgrp install /etc/pkcs11
chmod g+w,o+t /etc/pkcs11
EOF
    ;;
    cvs) #/opt /etc/profile.d/extrapaths.sh
          cat >> $Output << "EOF"
chgrp install /opt
chmod g+w,o+t /opt
chgrp install /etc/profile.d
chmod g+w,o+t /etc/profile.d
chgrp install /etc/profile.d/extrapaths.sh
chmod 664 /etc/profile.d/extrapaths.sh
chgrp install /etc/ld.so.conf
chmod 664 /etc/ld.so.conf
EOF
    ;;
    archive-zip)  #perl
echo "chgrp install /usr/lib/perl5/site_perl/${perlvers}/i686-linux/auto
chmod g+w,o+t /usr/lib/perl5/site_perl/${perlvers}/i686-linux/auto" >> $Output
    ;;
    xml-parser)  #perl
echo "chgrp install /usr/lib/perl5/site_perl/${perlvers}/i686-linux/auto/XML
chmod g+w,o+t /usr/lib/perl5/site_perl/${perlvers}/i686-linux/auto/XML
chgrp install /usr/lib/perl5/${perlvers}/i686-linux/perllocal.pod
chmod 664 /usr/lib/perl5/${perlvers}/i686-linux/perllocal.pod" >> $Output
    ;;
    python)  #/usr/share/man
          cat >> $Output << "EOF"
chgrp install /usr/share/man
chmod g+w,o+t /usr/share/man
chgrp install /usr/lib/python2.7/site-packages #for python modules
chmod g+w,o+t /usr/lib/python2.7/site-packages
EOF
    ;;
    libsigcpp)   #/usr/share/devhelp/books
         cat >> $Output << "EOF"
chgrp install /usr/share/devhelp # for devhelp
chmod g+w,o+t /usr/share/devhelp
chgrp install /usr/share/devhelp/books # for glibmm
chmod g+w,o+t /usr/share/devhelp/books
EOF
    ;;
    tcl)   #/usr/share/man
         cat >> $Output << "EOF"
chgrp install /usr/share/man/mann
chmod g+w,o+t /usr/share/man/mann
chgrp install /usr/share/gdb/auto-load #for glib
chmod g+w,o+t /usr/share/gdb/auto-load
chgrp install /etc/bash_completion.d #for glib
chmod g+w,o+t /etc/bash_completion.d
EOF
    ;;
    glib)   #/usr/share/pkgconfig
          cat >> $Output << "EOF"
chgrp install /usr/share/glib-2.0/schemas
chmod g+w,o+t /usr/share/glib-2.0/schemas
chgrp install /usr/lib/gio/modules # for dconf
chmod g+w,o+t /usr/lib/gio/modules
chgrp install /usr/share/bash-completion/completions # for udisks
chmod g+w,o+t /usr/share/bash-completion/completions
EOF
    ;;
    libgpg-error)   #/usr/share/common-lisp/source
          cat >> $Output << "EOF"
chgrp install /usr/share/common-lisp/source # for gpgme
chmod g+w,o+t /usr/share/common-lisp/source
EOF
    ;;
    iso-codes)   #/usr/share/locale/LC_MESSAGES
           cat >> $Output << "EOF"
chgrp install /usr/share/pkgconfig # for usbutils
chmod g+w,o+t /usr/share/pkgconfig
chmod g+w,o+t /usr/share/locale/*/LC_MESSAGES
chgrp install /usr/share/xml # for docbook-xml
chmod g+w,o+t /usr/share/xml
EOF
    ;;
    gobject-intro)   #/usr/share/gir-1.0
          cat >> $Output << "EOF"
chgrp install /usr/share/gir-1.0 # for json-glib
chmod g+w,o+t /usr/share/gir-1.0
chgrp install /usr/lib/girepository-1.0
chmod g+w,o+t /usr/lib/girepository-1.0
EOF
    ;;
    libatasmart)   #/usr/share/vala/vapi
          cat >> $Output << "EOF"
chgrp install /usr/share/vala # for vala
chmod g+w,o+t /usr/share/vala
chgrp install /usr/share/vala/vapi # for libgee
chmod g+w,o+t /usr/share/vala/vapi
EOF
    ;;
    libgsf)
          cat >> $Output << "EOF"
chgrp install /usr/share/thumbnailers
chmod g+w,o+t /usr/share/thumbnailers
EOF
    ;;
    aspell)
          cat >> $Output << "EOF"
echo "*************************************************************"
echo "*                                                           *"
echo "* English dictionary installed - edit script to change this *"
echo "*                                                           *"
echo "*************************************************************"
EOF
    ;;
    attr)   #/usr/include/sys
          cat >> $Output << "EOF"
chgrp install /usr/include/sys # for acl
chmod g+w,o+t /usr/include/sys
EOF
    ;;
    openssl)   #/usr/share/gtk-doc/html
          cat >> $Output << "EOF"
chgrp install /run # for linux-pam
chmod g+w,o+t /run
chgrp install /var/db
chmod g+w,o+t /var/db
chgrp install /etc/ssl # for cacerts
chmod g+w,o+t /etc/ssl
chgrp install /etc/ssl/certs
chmod g+w,o+t /etc/ssl/certs
EOF
    ;;
    babl) # /usr/share/gtk-doc/html
          cat >> $Output << "EOF"
chgrp install /usr/share/gtk-doc/html # for gnutls
chmod g+w,o+t /usr/share/gtk-doc/html
EOF
    ;;
    openssh)
          cat >> $Output << "EOF"
chown root /usr/libexec/ssh-keysign
chmod 4755 /usr/libexec/ssh-keysign
EOF
    ;;
    sudo)
          cat >> $Output << "EOF"
chown root /usr/bin/{sudo,sudoedit}
chmod 4111 /usr/bin/{sudo,sudoedit}
chown root /usr/lib/sudo/sudoers.so
chown root /etc/sudoers
chown root /etc/sudoers.d
chmod 444  /etc/sudoers
EOF
    ;;
    consolekit)
          cat >> $Output << "EOF"
chgrp install /usr/share/dbus-1/interfaces # for upower
chmod g+w,o+t /usr/share/dbus-1/interfaces
EOF
    ;;
    linux-pam)   #/etc/pam.d
          cat >> $Output << "EOF"
chown linux-pam:install /etc/pam.d
chmod g+w,o+t /etc/pam.d
chgrp install /lib/security # for consolekit
chmod g+w,o+t /lib/security
chgrp install /etc/security # for libpwquality
chmod g+w,o+t /etc/security
EOF
     ;;
     shadow)  #/bin/su, etc setuid root
           cat >> $Output << "EOF"
chown root /bin/{su,passwd}
chmod 4755 /bin/{su,passwd}
chown root /usr/bin/{chage,chfn,chsh,expiry,gpasswd,newgrp}
chmod 4755 /usr/bin/{chage,chfn,chsh,expiry,gpasswd,newgrp}
chgrp install /etc/pam.d/system-session
chmod 664 /etc/pam.d/system-session # consolekit adds to it
EOF
     ;;
     gperf) # reset /usr/share/info/dir permissions
          cat >> $Output << "EOF"
chgrp install /usr/share/info/dir
chmod 664 /usr/share/info/dir
EOF
     ;;
     rarian)
           cat >> $Output << "EOF"
chgrp install /usr/share/help
chmod g+w,o+t /usr/share/help
EOF
     ;;
     $xproto) # /usr/include/X11
           cat >> $Output << "EOF"
chgrp install /usr/include/X11
chmod g+w,o+t /usr/include/X11
chgrp install /usr/include/X11/extensions
chmod g+w,o+t /usr/include/X11/extensions
chgrp install /usr/include/X11/fonts
chmod g+w,o+t /usr/include/X11/fonts
chgrp install /usr/include/GL # for MesaLib
chmod g+w,o+t /usr/include/GL
chgrp install /usr/include/GL/internal
chmod g+w,o+t /usr/include/GL/internal
EOF
     ;;
     libxcb) # /usr/include/xcb
           cat >> $Output << "EOF"
chgrp install /usr/include/xcb
chmod g+w,o+t /usr/include/xcb
EOF
     ;;
     $xlib)
           cat >> $Output << "EOF"
chgrp install /usr/lib/X11
chmod g+w,o+t /usr/lib/X11
chgrp install /usr/share/X11
chmod g+w,o+t /usr/share/X11
EOF
    ;;
    $xapp)
           cat >> $Output << "EOF"
chgrp install /etc/X11
chmod g+w,o+t /etc/X11
chgrp install /etc/X11/app-defaults
chmod g+w,o+t /etc/X11/app-defaults
chgrp install /usr/share/terminfo/x #for xterm
chmod g+w,o+t /usr/share/terminfo/x
EOF
    ;;
    $xfont)
           cat >> $Output << "EOF"
chgrp install /usr/share/fonts
chmod g+w,o+t /usr/share/fonts
EOF
    ;;
    xcursor-themes)
           cat >> $Output << "EOF"
chgrp install /usr/share/icons
chmod g+w,o+t /usr/share/icons
EOF
    ;;
    xorg-server)
           cat >> $Output << "EOF"
chgrp install /usr/include/xorg
chmod g+w,o+t /usr/include/xorg
chgrp install /usr/share/X11/xorg.conf.d
chmod g+w,o+t /usr/share/X11/xorg.conf.d
chgrp install /usr/lib/xorg
chmod g+w,o+t /usr/lib/xorg
chgrp install /usr/lib/xorg/modules
chmod g+w,o+t /usr/lib/xorg/modules
chgrp install /usr/lib/xorg/modules/multimedia
chmod g+w,o+t /usr/lib/xorg/modules/multimedia
chown root /usr/bin/Xorg # setuid root binary
chmod 4755 /usr/bin/Xorg
EOF
    ;;
    xorg-evdev)
               cat >> $Output << "EOF"
chgrp install /usr/lib/xorg/modules/input
chmod g+w,o+t /usr/lib/xorg/modules/input
EOF
    ;;
    xterm)
           cat >> $Output << "EOF"
cd ${PkgUserDir}/${PkgName}/${PkgName}*
make install-ti # have to do this as root
cd ..
for flToDlt in *.tgz
do
  dltfile=${flToDlt%.tgz}
done
rm -rf $dltfile
chown xterm:xterm /usr/share/terminfo/x/xterm-65
chown xterm:xterm /usr/share/terminfo/x/xterm+app+pc
chown xterm:xterm /usr/share/terminfo/x/xterm-boldso
chown xterm:xterm /usr/share/terminfo/x/xterm+decedit
chown xterm:xterm /usr/share/terminfo/x/xterm-ic
chown xterm:xterm /usr/share/terminfo/x/xterm+kbs
chown xterm:xterm /usr/share/terminfo/x/xterm-mono
chown xterm:xterm /usr/share/terminfo/x/xterm+noapp+pc
chown xterm:xterm /usr/share/terminfo/x/xterm-nrc
chown xterm:xterm /usr/share/terminfo/x/xterm+pce0
chown xterm:xterm /usr/share/terminfo/x/xterm+pce1
chown xterm:xterm /usr/share/terminfo/x/xterm+pce3
chown xterm:xterm /usr/share/terminfo/x/xterm+pcf1
chown xterm:xterm /usr/share/terminfo/x/xterm+pcf3
chown xterm:xterm /usr/share/terminfo/x/xterm+pcfn
chown xterm:xterm /usr/share/terminfo/x/xterm+pcfN
chown xterm:xterm /usr/share/terminfo/x/xterm-rep
chown xterm:xterm /usr/share/terminfo/x/xterm+tmux
chown xterm:xterm /usr/share/terminfo/x/xterm-vi
chown xterm:xterm /usr/share/terminfo/x/xterm-xmc
chgrp install /usr/share/pixmaps # for evol-data-server
chmod g+w,o+t /usr/share/pixmaps
EOF
echo "ln -vsf $XORG_PREFIX /usr/X11R6" >> $Output
    ;;
    alsa-utils)
           cat >> $Output << "EOF"
chgrp install /usr/share/sounds
chmod g+w,o+t /usr/share/sounds
EOF
     ;;
     alsa-lib)
           cat >> $Output << "EOF"
chgrp install /usr/lib/alsa-lib
chmod g+w,o+t /usr/lib/alsa-lib
chgrp install /usr/share/alsa
chmod g+w,o+t /usr/share/alsa
EOF
     ;;
     avahi)
           cat >> $Output << "EOF"
chgrp install /usr/share/applications
chmod g+w,o+t /usr/share/applications
EOF
     ;;
     vlc)
           cat >> $Output << "EOF"
chgrp install /usr/share/applications
chmod g+w,o+t /usr/share/applications
EOF
     ;;
     gst-plgns-good0)
           cat >> $Output << "EOF"
chgrp install /etc/gconf/schemas
chmod g+w,o+t /etc/gconf/schemas
EOF
     ;;
     dbus)
           cat >> $Output << "EOF"
chgrp install /usr/lib/dbus-1.0
chmod g+w,o+t /usr/lib/dbus-1.0
chgrp install /usr/include/dbus-1.0/dbus
chmod g+w,o+t /usr/include/dbus-1.0/dbus
chgrp install /etc/dbus-1/system.d
chmod g+w,o+t /etc/dbus-1/system.d
chgrp install /usr/share/dbus-1
chmod g+w,o+t /usr/share/dbus-1
chgrp install /usr/share/dbus-1/services
chmod g+w,o+t /usr/share/dbus-1/services
chgrp install /usr/share/dbus-1/system-services
chmod g+w,o+t /usr/share/dbus-1/system-services
chown root:messagebus /usr/lib/dbus-1.0/dbus-daemon-launch-helper
chmod 4750 /usr/lib/dbus-1.0/dbus-daemon-launch-helper  # set uid root binary
EOF
     ;;
     upower)
           cat >> $Output << "EOF"
chgrp install /usr/share/dbus-1/interfaces
chmod g+w,o+t /usr/share/dbus-1/interfaces
EOF
     ;;
     docbook-xml)
           cat >> $Output << "EOF"
chgrp install /usr/share/xml/docbook
chmod g+w,o+t /usr/share/xml/docbook
chgrp install /etc/xml/catalog
chgrp install /etc/xml/docbook
chmod 664 /etc/xml/catalog
chmod 664 /etc/xml/docbook
EOF
     ;;
     cups)
           cat >> $Output << "EOF"
chgrp install /usr/lib/cups/driver # for gutenprint
chmod g+w,o+t /usr/lib/cups/driver
chgrp install /usr/lib/cups/filter
chmod g+w,o+t /usr/lib/cups/filter
chgrp install /usr/share/cups
chmod g+w,o+t /usr/share/cups
chgrp install /usr/share/cups/model # for ghostscript
chmod g+w,o+t /usr/share/cups/model
chgrp install /usr/share/cups/data # for cups-filters
chmod g+w,o+t /usr/share/cups/data
chgrp install /usr/share/cups/drv
chmod g+w,o+t /usr/share/cups/drv
chgrp install /etc/cups
chmod g+w,o+t /etc/cups
chgrp install /usr/lib/cups/backend
chmod g+w,o+t /usr/lib/cups/backend # for samba symlink smb
EOF
     ;;
     polkit)
           cat >> $Output << "EOF"
groupadd -fg 27 polkitd # dedicated user to take control of polkitd
useradd -c "PolicyKit Daemon Owner" -d /etc/polkit-1 -u 27 \
        -g polkitd -s /bin/false polkitd
chgrp install /usr/share/polkit-1/actions # for colord
chmod g+w,o+t /usr/share/polkit-1/actions
chown root /usr/lib/polkit-1/polkit-agent-helper-1
chmod 4755 /usr/lib/polkit-1/polkit-agent-helper-1
chown root /usr/bin/pkexec
chmod 4755 /usr/bin/pkexec
chown polkitd /etc/polkit-1/rules.d
chmod 700 /etc/polkit-1/rules.d
chown polkitd:install /usr/share/polkit-1/rules.d
chmod 1775 /usr/share/polkit-1/rules.d
chgrp install /etc/dbus-1 # for dbus
chmod g+w,o+t /etc/dbus-1
chgrp install /etc/dbus-1/system.d # for udisks
chmod g+w,o+t /etc/dbus-1/system.d
chgrp install /usr/share/dbus-1 # for dbus
chmod g+w,o+t /usr/share/dbus-1
chgrp install /usr/share/dbus-1/system-services
chmod g+w,o+t /usr/share/dbus-1/system-services
EOF
     ;;
     gstreamer)
           cat >> $Output << "EOF"
chgrp install /usr/include/gstreamer-1.0/gst # for plugins
chmod g+w,o+t /usr/include/gstreamer-1.0/gst
chgrp install /usr/lib/gstreamer-1.0
chmod g+w,o+t /usr/lib/gstreamer-1.0
EOF
     ;;
     gstreamer0)
           cat >> $Output << "EOF"
chgrp install /usr/include/gstreamer-0.10/gst # for plugins
chmod g+w,o+t /usr/include/gstreamer-0.10/gst
chgrp install /usr/lib/gstreamer-0.10
chmod g+w,o+t /usr/lib/gstreamer-0.10
EOF
     ;;
     gst-plgns-base)
           cat >> $Output << "EOF"
chgrp install /usr/include/gstreamer-1.0/gst/video
chmod g+w,o+t /usr/include/gstreamer-1.0/gst/video
chgrp install /usr/share/gst-plugins-base
chmod g+w,o+t /usr/share/gst-plugins-base
EOF
     ;;
     gst-plgns-base0)
           cat >> $Output << "EOF"
chgrp install /usr/include/gstreamer-0.10/gst/interfaces
chmod g+w,o+t /usr/include/gstreamer-0.10/gst/interfaces
chgrp install /usr/include/gstreamer-0.10/gst/video
chmod g+w,o+t /usr/include/gstreamer-0.10/gst/video
EOF
     ;;
     gst-plgns-bad)
           cat >> $Output << "EOF"
chgrp install /usr/include/gstreamer-1.0/gst/interfaces
chmod g+w,o+t /usr/include/gstreamer-1.0/gst/interfaces
EOF
     ;;
     libcanberra)
           cat >> $Output << "EOF"
chgrp install /usr/lib/gtk-3.0/modules
chmod g+w,o+t /usr/lib/gtk-3.0/modules
chgrp install /usr/share/gdm # for gdm
chmod g+w,o+t /usr/share/gdm
EOF
     ;;
     gdk-pixbuf)
           cat >> $Output << "EOF"
chgrp install /usr/lib/gdk-pixbuf-2.0/2.10.0/loaders # for librsvg
chmod g+w,o+t /usr/lib/gdk-pixbuf-2.0/2.10.0/loaders
EOF
     ;;
     gtkplus3)
           cat >> $Output << "EOF"
chgrp install /usr/lib/gtk-3.0
chmod g+w,o+t /usr/lib/gtk-3.0
chgrp install /usr/lib/gtk-3.0/3.0.0 # for gnome-themes-standard
chmod g+w,o+t /usr/lib/gtk-3.0/3.0.0
chgrp install /usr/lib/gtk-3.0/3.0.0/immodules # for ibus
chmod g+w,o+t /usr/lib/gtk-3.0/3.0.0/immodules
EOF
     ;;
     gtkplus2)
           cat >> $Output << "EOF"
chgrp install /usr/share/themes
chmod g+w,o+t /usr/share/themes
chgrp install /usr/share/themes/Default
chmod g+w,o+t /usr/share/themes/Default
chgrp install /usr/share/themes/Emacs
chmod g+w,o+t /usr/share/themes/Emacs
chgrp install /usr/lib/gtk-2.0/2.10.0
chmod g+w,o+t /usr/lib/gtk-2.0/2.10.0
chgrp install /usr/lib/gtk-2.0/2.10.0/engines
chmod g+w,o+t /usr/lib/gtk-2.0/2.10.0/engines
chgrp install /usr/lib/gtk-2.0/modules
chmod g+w,o+t /usr/lib/gtk-2.0/modules
EOF
     ;;
     colord)
           cat >> $Output << "EOF"
chgrp install /usr/include/colord-1 # for colord-gtk
chmod g+w,o+t /usr/include/colord-1
EOF
     ;;
     vala)
           cat >> $Output << "EOF"
chgrp install /usr/share/vala
chmod g+w,o+t /usr/share/vala
chgrp install /usr/share/vala-0.18/vapi
chmod g+w,o+t /usr/share/vala-0.18/vapi
EOF
     ;;
     apache)
           cat >> $Output << "EOF"
chgrp install /usr/libexec/apache # for subversion
chmod g+w,o+t /usr/libexec/apache
EOF
     ;;
     php)
           cat >> $Output << "EOF"
chgrp install /usr/lib/php/extensions/no-debug-zts-20100525
chmod g+w,o+t /usr/lib/php/extensions/no-debug-zts-20100525
EOF
     ;;
     hcolr-icon-thme)
           cat >> $Output << "EOF"
chgrp install /usr/share/icons/hicolor
chmod g+w,o+t /usr/share/icons/hicolor
chgrp install /usr/share/icons/hicolor/*/apps
chmod g+w,o+t /usr/share/icons/hicolor/*/apps
chgrp install /usr/share/icons/hicolor/*/actions
chmod g+w,o+t /usr/share/icons/hicolor/*/actions
chgrp install /usr/share/icons/hicolor/*/mimetypes # for color-manager
chmod g+w,o+t /usr/share/icons/hicolor/*/mimetypes
chgrp install /usr/share/icons/hicolor/*/devices
chmod g+w,o+t /usr/share/icons/hicolor/*/devices
chgrp install /usr/share/icons/hicolor/*/status
chmod g+w,o+t /usr/share/icons/hicolor/*/status
chgrp install /usr/share/icons/hicolor/*/emblems
chmod g+w,o+t /usr/share/icons/hicolor/*/emblems
chgrp install /usr/share/icons/hicolor/*/categories
chmod g+w,o+t /usr/share/icons/hicolor/*/categories
chgrp install /usr/share/icons/hicolor/*/stock/navigation
chmod g+w,o+t /usr/share/icons/hicolor/*/stock/navigation
chgrp install /usr/share/icons/hicolor/*/stock/media
chmod g+w,o+t /usr/share/icons/hicolor/*/stock/media
EOF
     ;;
     sgml-common)
           cat >> $Output << "EOF"
chgrp install /usr/share/sgml
chmod g+w,o+t /usr/share/sgml # for opensp
EOF
     ;;
     udev)
           cat >> $Output << "EOF"
chgrp install /lib/udev/rules.d
chmod g+w,o+t /lib/udev/rules.d
EOF
     ;;
     telepathy-glib)
           cat >> $Output << "EOF"
chgrp install /usr/include/telepathy-1.0
chmod g+w,o+t /usr/include/telepathy-1.0
EOF
     ;;
     telepathy-logr)
           cat >> $Output << "EOF"
chgrp install /usr/lib/telepathy # for telepathy-mission-control
chmod g+w,o+t /usr/lib/telepathy
chgrp install /usr/share/telepathy/clients
chmod g+w,o+t /usr/share/telepathy/clients
EOF
     ;;
     pygobject2)
           cat >> $Output << "EOF"
chgrp install /usr/lib/python2.7/site-packages/gi
chmod g+w,o+t /usr/lib/python2.7/site-packages/gi
chgrp install /usr/lib/python2.7/site-packages/gi/repository
chmod g+w,o+t /usr/lib/python2.7/site-packages/gi/repository
chgrp install /usr/lib/python2.7/site-packages/gi/overrides
chmod g+w,o+t /usr/lib/python2.7/site-packages/gi/overrides
chgrp install /usr/lib/python2.7/site-packages/gtk-2.0
chmod g+w,o+t /usr/lib/python2.7/site-packages/gtk-2.0
chgrp install /usr/include/pygtk-2.0
chmod g+w,o+t /usr/include/pygtk-2.0
EOF
     ;;
     pygtk)
           cat >> $Output << "EOF"
chgrp install /usr/share/pygtk/2.0/defs
chmod g+w,o+t /usr/share/pygtk/2.0/defs
EOF
     ;;
     clutter)
           cat >> $Output << "EOF"
chgrp install /usr/include/clutter-1.0
chmod g+w,o+t /usr/include/clutter-1.0
EOF
     ;;
     at-spi2-core)
           cat >> $Output << "EOF"
chgrp install /etc/xdg
chmod g+w,o+t /etc/xdg
chgrp install /etc/xdg/autostart # for polkit-gnome
chmod g+w,o+t /etc/xdg/autostart
EOF
     ;;
     at-spi2-atk)
           cat >> $Output << "EOF"
chgrp install /usr/lib/gnome-settings-daemon-3.0
chmod g+w,o+t /usr/lib/gnome-settings-daemon-3.0
chgrp install /usr/lib/gnome-settings-daemon-3.0/gtk-modules
chmod g+w,o+t /usr/lib/gnome-settings-daemon-3.0/gtk-modules
chgrp install /usr/lib/gtk-2.0
chmod g+w,o+t /usr/lib/gtk-2.0
chgrp install /usr/lib/gtk-2.0/modules
chmod g+w,o+t /usr/lib/gtk-2.0/modules
EOF
     ;;
     gcr)
           cat >> $Output << "EOF"
chgrp install /usr/share/GConf
chmod g+w,o+t /usr/share/GConf
chgrp install /usr/share/GConf/gsettings
chmod g+w,o+t /usr/share/GConf/gsettings
chgrp install /usr/lib/gnome-keyring
chmod g+w,o+t /usr/lib/gnome-keyring
EOF
     ;;
     libgnomekbd)
           cat >> $Output << "EOF"
chgrp install /usr/share/GConf/gsettings
chmod g+w,o+t /usr/share/GConf/gsettings
EOF
     ;;
     shrd-mime-info)
           cat >> $Output << "EOF"
chgrp install /usr/share/mime
chmod g+w,o+t /usr/share/mime
chgrp install /usr/share/mime/packages
chmod g+w,o+t /usr/share/mime/packages
EOF
     ;;
     gconf)
           cat >> $Output << "EOF"
chgrp install /etc/gconf
chmod g+w,o+t /etc/gconf
chgrp install /etc/gconf/gconf.xml.defaults
chmod g+w,o+t /etc/gconf/gconf.xml.defaults
EOF
     ;;
     libgweather)
           cat >> $Output << "EOF"
rm /etc/gconf/gconf.xml.defaults/*
chgrp install /usr/share/icons/gnome
chmod g+w,o+t /usr/share/icons/gnome
chgrp install /usr/share/icons/gnome/*
chmod g+w,o+t /usr/share/icons/gnome/*
chgrp install /usr/share/icons/gnome/*/status
chmod g+w,o+t /usr/share/icons/gnome/*/status
EOF
     ;;
     gnome-doc-utils)
           cat >> $Output << "EOF"
chgrp install /usr/share/gnome
chmod g+w,o+t /usr/share/gnome
chgrp install /usr/share/gnome/help
chmod g+w,o+t /usr/share/gnome/help
EOF
     ;;
     gnome-icon-thme)
           cat >> $Output << "EOF"
chgrp install /usr/share/icons/gnome
chmod g+w,o+t /usr/share/icons/gnome
chgrp install /usr/share/icons/gnome/{256x256,48x48,8x8}
chmod g+w,o+t /usr/share/icons/gnome/{256x256,48x48,8x8}
chgrp install /usr/share/icons/gnome/*/*
chmod g+w,o+t /usr/share/icons/gnome/*/*
EOF
     ;;
     gnome-bckgrnds)
           cat >> $Output << "EOF"
chgrp install /usr/share/gnome-background-properties
chmod g+w,o+t /usr/share/gnome-background-properties
EOF
     ;;
     vte)
           cat >> $Output << "EOF"
chown root.utmp /usr/lib/vte-2.90/gnome-pty-helper
chmod g+s       /usr/lib/vte-2.90/gnome-pty-helper
EOF
     ;;
     yelp-xsl)
           cat >> $Output << "EOF"
chgrp install /usr/share/yelp-xsl/xslt/common/domains
chmod g+w,o+t /usr/share/yelp-xsl/xslt/common/domains
EOF
     ;;
     ibus)
           cat >> $Output << "EOF"
chgrp install /etc/dconf/profile
chmod g+w,o+t /etc/dconf/profile
chgrp install /etc/dconf/db
chmod g+w,o+t /etc/dconf/db
EOF
     ;;
     gnome-desktop)
           cat >> $Output << "EOF"
chgrp install /usr/share/help/* # for gnome-user-docs
chmod g+w,o+t /usr/share/help/*
chgrp rarian /usr/share/help/rarian.document
chmod 644 /usr/share/help/rarian.document
EOF
     ;;
     gtk-engines)
           cat >> $Output << "EOF"
chgrp install /usr/share/themes/Crux
chmod g+w,o+t /usr/share/themes/Crux
EOF
     ;;
     mutter)
           cat >> $Output << "EOF"
chgrp install /usr/share/gnome/wm-properties
chmod g+w,o+t /usr/share/gnome/wm-properties
chgrp install /usr/share/gnome-control-center
chmod g+w,o+t /usr/share/gnome-control-center
chgrp install /usr/share/gnome-control-center/keybindings
chmod g+w,o+t /usr/share/gnome-control-center/keybindings
EOF
     ;;
     gnome-user-docs)
           cat >> $Output << "EOF"
chgrp install /usr/share/help/*
chmod g+w,o+t /usr/share/help/*
chown rarian:rarian /usr/share/help/rarian.document
chmod 644 /usr/share/help/rarian.document
EOF
     ;;
     gnome-menus)
           cat >> $Output << "EOF"
chgrp install /usr/share/desktop-directories
chmod g+w,o+t /usr/share/desktop-directories
chgrp install /etc/xdg/menus
chmod g+w,o+t /etc/xdg/menus
EOF
     ;;
     gnome-terminal)
           cat >> $Output << "EOF"
chgrp install /etc/gconf/schemas
chmod g+w,o+t /etc/gconf/schemas
EOF
     ;;
     gnome-session)
           cat >> $Output << "EOF"
chgrp install /usr/share/gnome-session/sessions
chmod g+w,o+t /usr/share/gnome-session/sessions
EOF
     ;;
     nautilus)
           cat >> $Output << "EOF"
chgrp install /usr/lib/nautilus
chmod g+w,o+t /usr/lib/nautilus
chgrp install /usr/share/gnome-shell
chmod g+w,o+t /usr/share/gnome-shell
chgrp install /usr/share/gnome-shell/search-providers
chmod g+w,o+t /usr/share/gnome-shell/search-providers
EOF
     ;;
     zenity)
           cat >> $Output << "EOF"
chgrp install /usr/share/help/{bg,da,en_GB} # for gnome-terminal
chmod g+w,o+t /usr/share/help/{bg,da,en_GB}
EOF
     ;;
     file-roller)
           cat >> $Output << "EOF"
chgrp install /usr/lib/nautilus/extensions-3.0
chmod g+w,o+t /usr/lib/nautilus/extensions-3.0
EOF
     ;;
     baobab)
           cat >> $Output << "EOF"
chgrp install /usr/share/help/*
chmod g+w,o+t /usr/share/help/*
chown rarian:rarian /usr/share/help/rarian.document
chmod 644 /usr/share/help/rarian.document
EOF
     ;;
     brasero)
           cat >> $Output << "EOF"
chgrp install /usr/lib/nautilus/extensions-3.0
chmod g+w,o+t /usr/lib/nautilus/extensions-3.0
chgrp install /usr/share/mime/packages
chmod g+w,o+t /usr/share/mime/packages
EOF
     ;;
     gcalctool)
           cat >> $Output << "EOF"
chgrp install /usr/share/help/bg
chmod g+w,o+t /usr/share/help/bg
chgrp install /usr/share/help/ko
chmod g+w,o+t /usr/share/help/ko
EOF
     ;;
     evince)
           cat >> $Output << "EOF"
chgrp install /usr/lib/nautilus/extensions-3.0 # in case brasero not installed
chmod g+w,o+t /usr/lib/nautilus/extensions-3.0
EOF
     ;;
     epiphany)
           cat >> $Output << "EOF"
chgrp install /usr/share/epiphany
chmod g+w,o+t /usr/share/epiphany
EOF
     ;;
     evolution)
           cat >> $Output << "EOF"
chgrp install /usr/lib/evolution/$evolVers/plugins
chmod g+w,o+t /usr/lib/evolution/$evolVers/plugins
chgrp install /usr/share/help/mk
chmod g+w,o+t /usr/share/help/mk
EOF
     ;;
     gnome-panel)
           cat >> $Output << "EOF"
chgrp install /usr/lib/gnome-applets
chmod g+w,o+t /usr/lib/gnome-applets
chgrp install /usr/share/gnome-panel/4.0/applets
chmod g+w,o+t /usr/share/gnome-panel/4.0/applets
chgrp install /usr/share/help/{pt,th,zh_HK,zh_TW}
chmod g+w,o+t /usr/share/help/{pt,th,zh_HK,zh_TW}
EOF
     ;;
     gnome-shell)
           cat >> $Output << "EOF"
chgrp install /usr/share/gnome-shell # if gnome-shell installed first
chmod g+w,o+t /usr/share/gnome-shell
chgrp install /usr/lib/mozilla/plugins
chmod g+w,o+t /usr/lib/mozilla/plugins
EOF
     ;;
     gnome-games)
           cat >> $Output << "EOF"
chgrp install /usr/share/help/tr
chmod g+w,o+t /usr/share/help/tr
EOF
     ;;
     aisleriot)
           cat >> $Output << "EOF"
chgrp install /usr/share/help/eu
chmod g+w,o+t /usr/share/help/eu
chgrp install /usr/share/help/en_GB
chmod g+w,o+t /usr/share/help/en_GB
chgrp install /usr/share/help/oc
chmod g+w,o+t /usr/share/help/oc
chgrp install /usr/share/help/zh_CN
chmod g+w,o+t /usr/share/help/zh_CN
EOF
     ;;
     gedit)
           cat >> $Output << "EOF"
chgrp install /usr/share/help/ar
chmod g+w,o+t /usr/share/help/ar
chgrp install /usr/share/help/bg
chmod g+w,o+t /usr/share/help/bg
chgrp install /usr/share/help/cs
chmod g+w,o+t /usr/share/help/cs
chgrp install /usr/share/help/da
chmod g+w,o+t /usr/share/help/da
chgrp install /usr/share/help/ko
chmod g+w,o+t /usr/share/help/ko
chgrp install /usr/share/help/th
chmod g+w,o+t /usr/share/help/th
chgrp install /usr/share/help/uk
chmod g+w,o+t /usr/share/help/uk
chgrp install /usr/share/help/zh_HK
chmod g+w,o+t /usr/share/help/zh_HK
chgrp install /usr/share/help/zh_TW
chmod g+w,o+t /usr/share/help/zh_TW
EOF
     ;;
     nautilus-sendto)
           cat >> $Output << "EOF"
chgrp install /usr/lib/nautilus-sendto/plugins
chmod g+w,o+t /usr/lib/nautilus-sendto/plugins
chgrp install /usr/lib/nautilus/extensions-3.0
chmod g+w,o+t /usr/lib/nautilus/extensions-3.0
EOF
     ;;
     gnome-bluetooth)
           cat >> $Output << "EOF"
chgrp install /usr/lib/gnome-bluetooth/plugins
chmod g+w,o+t /usr/lib/gnome-bluetooth/plugins
chgrp install /usr/share/help/ro
chmod g+w,o+t /usr/share/help/ro
EOF
     ;;
     gdm)
           cat >> $Output << "EOF"
usermod -a -G audio gdm
usermod -a -G video gdm
sed -i 's/id:3:initdefault:/id:5:initdefault:/' \
    /etc/inittab
EOF
     ;;
     libxfce4util)
           cat >> $Output << "EOF"
chgrp install /usr/include/xfce4
chmod g+w,o+t /usr/include/xfce4
EOF
     ;;
     extutls-dpnds)
echo "chgrp install /usr/lib/perl5/site_perl/${perlvers}/ExtUtils
chmod g+w,o+t /usr/lib/perl5/site_perl/${perlvers}/ExtUtils
chgrp install /usr/lib/perl5/site_perl/${perlvers}/i686-linux/auto/ExtUtils
chmod g+w,o+t /usr/lib/perl5/site_perl/${perlvers}/i686-linux/auto/ExtUtils" >> $Output
     ;;
     garcon)
           cat >> $Output << "EOF"
chgrp install /etc/xdg
chmod g+w,o+t /etc/xdg
chgrp install /etc/xdg/menus
chmod g+w,o+t /etc/xdg/menus
EOF
     ;;
     parole)
           cat >> $Output << "EOF"
chgrp install /usr/share/applications
chmod g+w,o+t /usr/share/applications
EOF
     ;;
     libxfce4ui)
           cat >> $Output << "EOF"
chgrp install /etc/xdg/xfce4
chmod g+w,o+t /etc/xdg/xfce4
chgrp install /etc/xdg/xfce4/xfconf/xfce-perchannel-xml
chmod g+w,o+t /etc/xdg/xfce4/xfconf/xfce-perchannel-xml
EOF
     ;;
     xfconf)
           cat >> $Output << "EOF"
chgrp install /usr/lib/xfce4
chmod g+w,o+t /usr/lib/xfce4
EOF
     ;;
     exo)
           cat >> $Output << "EOF"
chgrp install /usr/share/xfce4
chmod g+w,o+t /usr/share/xfce4
EOF
     ;;
     thunar)
           cat >> $Output << "EOF"
chgrp install /usr/share/Thunar/sendto
chmod g+w,o+t /usr/share/Thunar/sendto
EOF
     ;;
     xfce4pwrmngr)
           cat >> $Output << "EOF"
chgrp install /etc/xdg/autostart
chmod g+w,o+t /etc/xdg/autostart
EOF
     ;;
     gimp)
           cat >> $Output << "EOF"
chgrp install /usr/lib/gimp/2.0/plug-ins
chmod g+w,o+t /usr/lib/gimp/2.0/plug-ins
EOF
     ;;
     git)
           cat >> $Output << "EOF"
git config --system http.sslCAPath /etc/ssl/certs
EOF
     ;;
     bind)
           cat >> $Output << "EOF"
mknod /srv/named/dev/null c 1 3
mknod /srv/named/dev/random c 1 8
chmod 666 /srv/named/dev/{null,random}
EOF
     ;;
esac
fi # end ! as_root
# most of these are needed whether root or package user
case $pkgname in
    openssl) # install /etc/pam.d for linux-pam
          cat >> $Output << "EOF"
install -v -m755 -d /etc/pam.d
EOF
    ;;
    linux-pam)   #/etc/pam.d
          cat >> $Output << "EOF"
chown root /sbin/unix_chkpwd
chmod -v 4755 /sbin/unix_chkpwd
cat > /etc/pam.d/other << "PAMEND"
# Begin /etc/pam.d/other
auth            required        pam_unix.so     nullok
account         required        pam_unix.so
session         required        pam_unix.so
password        required        pam_unix.so     nullok
# End /etc/pam.d/other
PAMEND
EOF
    ;;
    cracklib)
          cat >> $Output << "EOF"
create-cracklib-dict /usr/share/dict/cracklib-words \
                     /usr/share/dict/cracklib-extra-words
EOF
    ;;
    openjdk) # update man_db.conf
          cat >> $Output << "EOF"
cat >> /etc/man_db.conf << "MANDBEOF"
MANDATORY_MANPATH     /opt/OpenJDK/man
MANPATH_MAP           /opt/OpenJDK/bin     /opt/OpenJDK/man
MANDB_MAP             /opt/OpenJDK/man     /var/cache/man/OpenJDK
MANDBEOF
mandb -c /opt/OpenJDK/man
EOF
    ;;
    apache-ant)
          cat >> $Output << "EOF"
cat > /etc/profile.d/apache_ant.sh << "EOFANT"
export PATH=$PATH:/opt/ant/bin
export ANT_HOME=/opt/ant
EOFANT
EOF
    ;;
    sudo)
          cat >> $Output << "EOF"
cat >> /etc/sudoers << "SUDO"
x7lib ALL=(ALL) NOPASSWD: ALL
SUDO
EOF
    ;;
     pciutils) # run update-pciids
           cat >> $Output << "EOF"
update-pciids
EOF
     ;;
     usbutils) # run update-usbids
           cat >> $Output << "EOF"
update-usbids
EOF
     ;;
     samba) # create /etc/samba/smb.conf
     cat >> $Output << "EOF"
cat > /etc/samba/samba.conf << "EOFSAMBA"
[global]
    workgroup = HOMEGROUP
    dos charset = cp850
    unix charset = ISO-8859-1
#    server string =
#    security =
#    hosts allow =
#    load printers =
#    log file =
#    max log size =
#    socket options =
#    local master =

[homes]
    comment = Home Directories
    browseable = no
    writable = yes

[printers]
    comment = All Printers
    path = /var/spool/samba
    browseable = no
    guest ok = no
    printable = yes
EOFSAMBA
EOF
     ;;
     dhcpcd) #remove ifconfig.eth0
           cat >> $Output << "EOF"
rm /etc/sysconfig/ifconfig.eth0
EOF
     ;;
     bind)
           cat >> $Output << "EOF"
chown -R named:named /srv/named
echo "****************************************"
echo "Edit /etc/resolv.conf to suit your needs"
echo "****************************************"
EOF
     ;;
     $xlib)
           if [[ "$XORG_PREFIX" != "/usr" ]]; then # set up symlinks
             cat >> $Output << "EOF"
ln -sv $XORG_PREFIX/lib/X11 /usr/lib/X11
ln -sv $XORG_PREFIX/include/X11 /usr/include/X11
ln -sv $XORG_PREFIX /usr/X11R6
EOF
           fi
    ;;
    alsa-utils)
           cat >> $Output << "EOF"
touch /var/lib/alsa/asound.state
alsactl store
usermod -a -G audio john # replace john with your username
EOF
     ;;
     pulseaudio)
           cat >> $Output << "EOF"
groupadd -g 58 pulse
groupadd -g 59 pulse-access
useradd -c "Pulseaudio User" -d /var/run/pulse -g pulse \
        -s /bin/false -u 58 pulse
usermod -a -G audio pulse
EOF
     ;;
     mysql)
           cat >> $Output << "EOF"
echo "The mysql root password is currently blank"
echo "After this do: mysqld_safe --user=mysql 2>&1 >/dev/null &"
echo "and /usr/bin/mysql_secure_installation to set up the password."
mysql_install_db --basedir=/usr --datadir=/srv/mysql --user=mysql
chgrp -v mysql /srv/mysql{,/test,/mysql}
install -v -m755 -o mysql -g mysql -d /var/run/mysql
mysqld_safe --user=mysql 2>&1 >/dev/null &
mysqladmin -p shutdown
EOF
     ;;
     gnome-session)
           cat >> $Output << "EOF"
cat > ~/.xinitrc << "EOL"
dbus-launch --exit-with-session gnome-session
EOL
cat > /etc/profile.d/gnome.sh << "EOW"
export XDG_DATA_DIRS=/usr/share
export XDG_CONFIG_DIRS=/etc/xdg
EOW
EOF
     ;;
     xfce4-session)
           cat >> $Output << "EOF"
echo "exec dbus-launch --exit-with-session xfce4-session" > ~/.xinitrc
echo john ${HOSTNAME} = NOPASSWD: /usr/lib/xfce4/session/xfsm-shutdown-helper \
  >> /etc/sudoers
echo "********************************************************************"
echo "Change last line in /etc/sudoers file to your username and hostname"
echo "********************************************************************"
EOF
     ;;
esac
if [[ "$Section" != blfs ]]; then
cat >> $Output << "EOF"
else
echo "Script not run for package $PkgName"
echo "unmet dependencies are:"
echo ${rtrnDepNotMet[@]}
fi
EOF
fi
cat >> $Output << "EOF"
}
EOF
} #end closefunction
#
setuplinks () { # setup preprocessing
case $pkgname in
    openssh)
        doFirst="install -v -m700 -d /var/lib/sshd && chown -v root:sys /var/lib/sshd && groupadd -g 50 sshd && useradd -c 'sshd PrivSep' -d /var/lib/sshd -g sshd -s /bin/false -u 50 sshd"
        links=""
    ;;
    talloc)
        doFirst="if [ -e /usr/lib/python2.7/site-packages/talloc.so ]; then chown talloc:talloc /usr/lib/python2.7/site-packages/talloc.so; fi"
        links=""
    ;;
    dbus)
        doFirst='groupadd -g 18 messagebus && useradd -c "D-Bus Message Daemon User" -d /var/run/dbus -u 18 -g messagebus -s /bin/false messagebus'
        links=""
    ;;
    alsa-utils)
        doFirst="chgrp install /usr/share/man/* && chmod g+w,o+t /usr/share/man/*"
        links=""
    ;;
    faad2)
        doFirst="chgrp install /usr/share/man && chmod g+w,o+t /usr/share/man"
        links=""
    ;;
    cups)
        doFirst='useradd -c "Print Service User" -d /var/spool/cups -g lp -s /bin/false -u 9 lp && groupadd -g 19 lpadmin && chgrp install /var/spool && chmod g+w,o+t /var/spool'
        links=""
    ;;
    cups-filters)
        doFirst="if [ -e /usr/share/cups/mime ]; then rm /usr/share/cups/mime; fi"
        links=""
    ;;
    avahi)
        doFirst="groupadd -fg 86 netdev"
        links=""
    ;;
    firewall)
        doFirst="chgrp install /etc/rc.d && chmod 1775 /etc/rc.d"
        links=""
    ;;
    xorg-server)
        doFirst="chown root:install /etc/sysconfig/createfiles && chmod 664 /etc/sysconfig/createfiles"
        links=""
    ;;
    qt4)
        doFirst="chgrp install /etc/ld.so.conf && chmod 664 /etc/ld.so.conf"
        links=""
    ;;
    bind)
        doFirst='groupadd -g 20 named && useradd -c "BIND Owner" -g named -s /bin/false -u 20 named'
        links=""
    ;;
    shadow)
        doFirst=""
        links="/bin/su /bin/passwd /etc/pam.d/other"
    ;;
    glib)
        doFirst=""
        links="/usr/share/aclocal/{glib-2.0.m4,glib-gettext.m4,gsettings.m4}"
    ;;
    net-tools)
        doFirst=""
        links="/bin/hostname"
    ;;
    gperf) # has to re-create /usr/share/info/dir
        doFirst=""
        links="/usr/share/info/dir"
    ;;
    gst-plgns-bad|gst-plgns-bad0|at-spi2-atk|telepathy-logr|dconf|libgnomekbd|gset-dsktp-schms|caribou|gnome-keyring|yelp|mutter|gnome-shell|ibus|gdm)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled"
    ;;
    gnome-set-daemon|evol-data-server|folks|metacity|tpthymisscntrl|epiphany|gcalctool|gnome-contacts|gnome-dictionary)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled"
    ;;
    gnm-power-mngr|gnome-sys-monitr|gnome-scrnshot|gucharmap|mousetweaks|vino|gedit|epiphany-ext)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled"
    ;;
    gst-plgns-good|aisleriot|file-roller|evince|gnome-applets|gnome-panel|evolution|ntwrk-mngr-applt|empathy|gnome-nettool|libpeas|totem|libgweather|gcr|goa|gnome-session)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled /etc/gconf/gconf.xml.defaults/* /usr/share/icons/hicolor/icon-theme.cache"
    ;;
    gconf|gvfs)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled /usr/lib/gio/modules/giomodule.cache"
    ;;
    nautilus-sendto)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled /usr/lib/nautilus-sendto/plugins/{libnstburn.la,libnstburn.so,libnstgajim.la,libnstgajim.so,libnstpidgin.la,libnstpidgin.so,libnstremovable_devices.la,libnstremovable_devices.so} /usr/bin/nautilus-sendto"
    ;;
    gtkplus3) # has to own /usr/bin/gtk-update-icon-cache
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled /usr/bin/gtk-update-icon-cache /usr/share/man/man1/gtk-update-icon-cache.1"
    ;;
    nautilus|gnome-bluetooth|gnm-user-share|gnome-cntrl-cntr|baobab|alacarte|brasero|cheese|eog|gnome-disk-util|gnome-serch-tool|gnome-system-log)
        doFirst=""
        links="/usr/share/glib-2.0/schemas/gschemas.compiled /usr/share/icons/hicolor/icon-theme.cache"
    ;;
    apache)
        doFirst=""
        links="/usr/libexec/apache/build/mkdir.sh"
    ;;
    librsvg)
        doFirst=""
        links="/usr/lib/gdk-pixbuf-2.0/2.10.0/loaders.cache"
    ;;
    pygobject3)
        doFirst=""
        links="/usr/lib/python2.7/site-packages/gi/{repository/*,overrides/*,_gi*,*.p*}"
    ;;
    farstream)
        doFirst=""
        links="/usr/lib/gstreamer-1.0/{libfsrawconference.*,libfsrtpconference.*,libfsmsnconference.*,libfsfunnel.*,libfsrtcpfilter.*,libfsvideoanyrate.*}"
    ;;
    libcanberra|gnome-terminal)
        doFirst=""
        links="/etc/gconf/gconf.xml.defaults/*"
    ;;
    gnome-icon-thme|gnm-icn-thme-ext|gnm-icn-thme-sym)
        doFirst=""
        links="/usr/share/icons/gnome/icon-theme.cache"
    ;;
    accerciser|gnome-tweak-tool|xfce4-session)
        doFirst=""
        links="/usr/share/icons/hicolor/icon-theme.cache"
    ;;
    gnome-games)
        doFirst='install -v -m755 -d /var/games && groupadd -g 60 games && useradd -c "Games High Score Owner" -d /var/games -g games -s /bin/false -u 60 games && chown -v games:games /var/games'
        links="/usr/share/glib-2.0/schemas/gschemas.compiled"
    ;;
    *)
        doFirst=""
        links=""
    ;;
esac
} # end setuplinks
#
resolvelinks() {
echo "resolvelinks () {
$doFirst
for link in $links
do
  if [ -e "\$link" ]; then
    chown -h \$PkgName:\$PkgName \$link # change owner to package user so can overwrite
  fi
done
return
}" >> $Output
} #end resolvelinks
#
unpack () {
    cat << "EOF"
unpack () {
starttime=$( date +%s )
EOF
case $srcname in
    junit|jasper*|docbook-xml*) # src is a zip file
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
EOF
    case $srcname in
       docbook-xml*)
           cat << "EOF"
for f in *.zip; do
docbookDir="${f%.zip}"
done
mkdir -pv $docbookDir
cd $docbookDir
unzip ../${SrcName}*.zip
EOF
       ;;
       *)
         cat << "EOF"
unzip ${SrcName}*.zip
cd ${SrcName}*
EOF
       ;;
    esac
    ;;
    tcl*) # there is -src and -html so specify src
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*-src.tar.*z* | awk -F\/ 'END{print $1}')
EOF
    ;;
    Linux-PAM-|libusb-) # do not want to untar the docs or libusb-compat
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}?.?.?.tar.*z* | awk -F\/ 'END{print $1}')
EOF
    ;;
    shadow-) # delete original src
    cat << "EOF"
rm -rf shadow*.tar.*z*
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
    ;;
    certdata.txt) # copy certdata.txt to pkguser dir
    cat << "EOF"
cp ${sourcedir}/${SrcName} .
EOF
    ;;
    LVM2.|sg3_utils-|zip|icu4c-|cdparanoia-|xterm-|sgml-common-) # a .tgz src file
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*.*z* | awk -F\/ 'END{print $1}')
EOF
    ;;
    MesaLib-) # download the glu src and extract to Mesa-xxx not MesaLib
    cat << "EOF"
glusrc="glu-9.0.0.tar.bz2"
gludir="glu-9.0.0"
if [ ! -e $glusrc ]; then
wget ftp://ftp.freedesktop.org/pub/mesa/glu/${glusrc}
fi
tar xf $glusrc
cp ${sourcedir}/${SrcName}*.* .
tar xf ${SrcName}*.tar.*z*
cd Mesa-*
EOF
   ;;
    systemd-) # don't copy src file - use srcname-xxx
    cat << "EOF"
cd $(tar vxf ${SrcName}???.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
    ghostscript-) # get the fonts too
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
extraFont=gnu-gs-fonts-other-6.0.tar.gz
if [ ! -e $extraFont ]; then
wget http://downloads.sourceforge.net/gs-fonts/${extraFont}
fi
count=0
for fl in *font*
do
  fontfile[$count]=$fl
  ((count++))
done
cd $(tar vxf ${SrcName}[0-9]*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
    x264-) # wget the source file
    cat << "EOF"
x264src="last_stable_x264.tar.bz2"
if [ ! -e $x264src ]; then
wget ftp://ftp.videolan.org/pub/x264/snapshots/${x264src}
fi
cd $(tar vxf $x264src | awk -F\/ 'END{print $1}')
EOF
   ;;
    pyxdg-) # wget the source file
    cat << "EOF"
pyxdgsrc="pyxdg-0.24.tar.gz"
if [ ! -e $pyxdgsrc ]; then
wget http://people.freedesktop.org/~takluyver/${pyxdgsrc}
fi
cd $(tar vxf $pyxdgsrc | awk -F\/ 'END{print $1}')
EOF
   ;;
   ffmpegthumbnailer-) # get the source file
    cat << "EOF"
ffmpegthumsrc="ffmpegthumbnailer-2.0.8.tar.gz"
if [ ! -e $ffmpegthumsrc ]; then
wget http://ffmpegthumbnailer.googlecode.com/files/${ffmpegthumsrc}
fi
cd $(tar vxf $ffmpegthumsrc | awk -F\/ 'END{print $1}')
EOF
   ;;
   polkit-|dbus-|glib-|freetype-|docbook-xsl-|poppler-|git-|cracklib-) # not polkit-gnome, dbus-glib, glibmm, freetype-doc, cracklib-words, git manpages and htmldocs
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}[0-9]*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   Tie-IxHash-)
    cat << "EOF"
tieixhashSrc=${SrcName}1.22.tar.gz
if [ ! -e $tieixhashSrc ]; then
wget http://search.cpan.org/CPAN/authors/id/C/CH/CHORNY/${tieixhashSrc}
fi
cd $(tar vxf $tieixhashSrc | awk -F\/ 'END{print $1}')
EOF
   ;;
   cups-1)
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cp ${blfsfiles}/cups-responses .
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
    php-) # wget the docs (single html)
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
phpManual=php_manual_en.html.gz
if [ ! -e $phpManual ]; then
wget -O $phpManual http://us.php.net/get/${phpManual}/from/this/mirror
fi
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   mysql-) # wget the docs (single html)
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
mysqlManual=refman-5.5-en.html.tar.gz
if [ ! -e $mysqlManual ]; then
wget -O $mysqlManual http://downloads.mysql.com/docs/${mysqlManual}
fi
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   libcdio-)
    cat << "EOF"
libcdioSrc=libcdio-0.83.tar.bz2
if [ ! -e $libcdioSrc ]; then
wget http://ftp.gnu.org/gnu/libcdio/${libcdioSrc}
fi
cd $(tar vxf $libcdioSrc | awk -F\/ 'END{print $1}')
EOF
   ;;
   llvm-)
    cat << "EOF"
clangSrc=clang-3.1.src.tar.gz
if [ ! -e $clangSrc ]; then
wget http://llvm.org/releases/3.1/${clangSrc}
fi
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   boost_) # untars to ./boost_ so name is in $2, not $1
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $2}')
EOF
   ;;
   coreutils-) # don't need to copy the source - already in place
    cat << "EOF"
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   $xproto|$xlib|$xapp|$xfont)
    cat << "EOF"
cp -r ${sourcedir}/${SrcName}/* . # copy the md5 file and sources
EOF
   ;;
   krb5-) # untars to a tar.gz and a tar.gz.asc
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
tar xvf ${SrcName}*.tar
rm *.asc
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   OpenJDK-)
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
rm -rf ${SrcName}*-bin*
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
   libreoffice) # need --no-overwrite-dir when untaring
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*.tar.*z* --no-overwrite-dir | awk -F\/ 'END{print $1}')
EOF
   ;;
   *) # tar.xz,gz,bz2,tgz
    cat << "EOF"
cp ${sourcedir}/${SrcName}*.* .
cd $(tar vxf ${SrcName}*.tar.*z* | awk -F\/ 'END{print $1}')
EOF
   ;;
esac
    cat << "EOF"
endtime=$( date +%s )
unpacktime=$( expr $endtime - $starttime )
starttime=$( date +%s )
}
EOF
} # end unpack
#
WriteScript () {
# remove docs statements and && and some other stuff
case $pkgname in
    libusb|cpio|gnupg)
       GetCommands \
        | sed -e '/make -C doc /d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    krb5)
       GetCommands \
        | sed -e '/gpg/d' \
              -e '/cat > \/etc\/krb5.conf/,/make install-krb5/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libidn)
       GetCommands \
        | sed -e '/cp/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libassuan)
        GetCommands \
        | sed -e '/make -k -C doc pdf ps html/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libgcrypt)
        GetCommands \
        | sed -e '/make -C doc pdf ps html/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libksba)
       GetCommands \
        | sed -e '/tex/d' \
              -e '/dvips/d' \
              -e '/make -C doc pdf html/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libtasn1)
        GetCommands \
        | sed -e '/make -C doc\/reference install-data-local/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libdaemon)
        GetCommands \
        | sed -e '/make -C doc doxygen/d' \
              -e '/install -v -m644 doc\/reference\/man/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    freetype)
        GetCommands \
        | sed -e '/cp -v -R docs/ i install -v -m755 -d \/usr\/share\/doc\/freetype-'"${freetypevers}"'' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    cvs)
       GetCommands \
        | sed -e '/make -C doc html txt dvi ps/d' \
              -e '/sed/d' \
              -e '/-e /d' \
              -e '/-i src\/sanity.sh/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    python)
       GetCommands \
        | sed -e '/make -C Doc html/d' \
              -e '/cp -rfv Doc/d' \
              -e '/chmod -v 755/ i install -v -m755 -d \/usr\/share\/doc\/Python-'"${Pythonvers}"'' \
              -e '/tar --strip-components=1/d' \
              -e '/-xvf ../d' \
              -e '/export PYTHONDOCS=/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    tcl)
       GetCommands \
        | sed -e '/cp      -v -R       ../d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libxml2)
       GetCommands \
        | sed -e '/tar xf ../d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libidl)
       GetCommands \
        | sed -e '/make pdf ps/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gmime)
       GetCommands \
        | sed -e '/pushd/,/popd/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    ptlib)
       GetCommands \
        | sed -e "/make install/ i sed -i '163,164d' Makefile" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    attr)
     if ! $as_root; then
       GetCommands \
        | sed -e 's/INSTALL_USER=root/INSTALL_USER=attr/' \
              -e 's/INSTALL_GROUP=root/INSTALL_GROUP=attr/' \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_BIN_DIR)/d' attr\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_BIN_DIR)/d' getfattr\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_BIN_DIR)/d' setfattr\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man1\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man2\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man3\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man5\/Makefile" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
     else
       GetCommands \
        | sed -e 's/\(.*\)&&$/\1/' \
        >> $Output
     fi
    ;;
    acl)
     if ! $as_root; then
       GetCommands \
        | sed -e 's/INSTALL_USER=root/INSTALL_USER=acl/' \
              -e 's/INSTALL_GROUP=root/INSTALL_GROUP=acl/' \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_BIN_DIR)/d' getfacl\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_BIN_DIR)/d' setfacl\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_BIN_DIR)/d' chacl\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man1\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man3\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(MAN_DEST)/d' man\/man5\/Makefile" \
              -e "/make install/ i sed -i '0,/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_INC_DIR)/{//d;}' include\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL) -m 755 -d \\\\\$(PKG_INC_DIR)\\\/sys/d' include\/Makefile" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
     else
       GetCommands \
        | sed -e 's/\(.*\)&&$/\1/' \
        >> $Output
     fi
    ;;
    cups)
       if ! $as_root; then
         GetCommands \
          | sed -e '/useradd/,/usermod/d' \
              -e '/make install-cups/d' \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BUILDROOT)\\\\\$(DBUSDIR)\\\/system.d; \\\/d' desktop\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LOCALEDIR)/d' locale\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(DATADIR)\\\/mime/d' conf\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(MANDIR)\\\/man1/d' man\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(MANDIR)\\\/man5/d' man\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(MANDIR)\\\/man7/d' man\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(AMANDIR)\\\/man\\\\\$(MAN8DIR)/d' man\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BINDIR)/d' Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' cups\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' filter\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' cgi-bin\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' ppdc\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(LIBDIR)/d' scheduler\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BINDIR)/d' test\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BINDIR)/d' berkeley\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(SBINDIR)/d' berkeley\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) \\\\\$(BINDIR)/d' ppdc\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(SBINDIR)/d' scheduler\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(SBINDIR)/d' systemv\/Makefile" \
              -e "/make install/ i sed -i '/\\\\\$(INSTALL_DIR) -m 755 \\\\\$(BINDIR)/d' systemv\/Makefile" \
              -e 's/make install/make install < ..\/cups-responses/' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
       else
         GetCommands \
          | sed -e '/make install-cups/d' \
                -e 's/\*\*EDITME<username>EDITME\*\*/john/' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    opal)
       GetCommands \
        | sed -e "/make install/ i sed -i '/mkdir -p \\\\\$(DESTDIR)\\\\\$(libdir); chmod 755 \\\\\$(DESTDIR)\\\\\$(libdir)/d' Makefile" \
              -e "/make install/ i sed -i '/mkdir -p \\\\\$(DESTDIR)\\\\\$(libdir)\\\/pkgconfig ; chmod 755 \\\\\$(DESTDIR)\\\\\$(libdir)\\\/pkgconfig/d' Makefile" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    iptables)
       GetCommands \
        | sed -e '/make install-iptables/d' \
              -e "/configure_commands()/ i sed -i -e '\/sbin\\\/ldconfig/d' \\\\\n    -e '/\${INSTALL} -dm0755 \"\${DESTDIR}\${bindir}\";/'d iptables\/Makefile.in" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gnutls)
       GetCommands \
        | sed -e '/\/usr\/share\/doc\//d' \
              -e '/cp -v -R/,/make -C doc\/reference/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    openssl)
       GetCommands \
        | sed -e '/\/usr\/share\/doc\/openssl/d' \
              -e '/cp -v -r doc/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    cracklib)
       GetCommands \
        | sed -e '/create-cracklib-dict/,/\/usr\/share\/dict\/cracklib-extra-words/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    linux-pam) 
       GetCommands \
        | sed -e '/chmod -v 4755 \/sbin\/unix_chkpwd/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libpwquality)
       GetCommands \
        | sed -e '/--disable-python-bindings/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    sudo)
       GetCommands \
        | sed -e '/--without-pam/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    shadow)
        # assume cracklib support with Linux-PAM
        # don't install foreign man pages
        if ! $as_root; then
          GetCommands \
          | sed -e '/DICTPATH\\t\/lib\/cracklib/d' \
              -e "/configure_commands()/i sed -i -e 's\/po cs da de es fi fr hu id it ja pl pt_BR ru sv tr \\\\\\\//' \\\\\n -e 's\/zh_CN zh_TW\/\/' \\\\\n -e 's\/po cs da de es fi fr hu id it ja pl pt_BR ru sv tr\//'  man/Makefile.in" \
              -e 's/\(.*\)&&$/\1/' \
              -e '/for FUNCTION/ i install -v -m644 \/etc\/login.defs \/etc\/login.defs.orig' \
          >> $Output
        else
          GetCommands \
          | sed -e '/DICTPATH\\t\/lib\/cracklib/d' \
              -e "/configure_commands()/i sed -i -e 's\/po cs da de es fi fr hu id it ja pl pt_BR ru sv tr \\\\\\\//' \\\\\n -e 's\/zh_CN zh_TW\/\/' \\\\\n -e 's\/po cs da de es fi fr hu id it ja pl pt_BR ru sv tr\//'  man/Makefile.in" \
              -e 's/\(.*\)&&$/\1/' \
          >> $Output
        fi
    ;;
    py2cairo|pygobject2|pygobject3|pygtk|pyatspi|pyxdg)
        GetPythonModule >> $Output
    ;;
    blfs-btscrpts)
        GetblfsCommands >> $Output
    ;;
    cacerts)
        GetcacertsCommands \
        | sed -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    coreutils)
        GetcoreutilsCommands >> $Output
    ;;
    openssh)
       if ! $as_root; then
         GetCommands \
          | sed -e '/install -v -m700 -d/,/-s \/bin\/false -u 50 sshd/d' \
                -e '/make tests/,/grep FATAL/d' \
                -e '/ssh-keygen/,/echo "ChallengeResponseAuthentication/d' \
                -e '/make install-sshd/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/make tests/,/grep FATAL/d' \
                -e '/ssh-keygen/,/echo "ChallengeResponseAuthentication/d' \
                -e '/make install-sshd/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    polkit)
       if ! $as_root; then
         GetCommands \
          | sed -e '/groupadd/,/-g polkitd -s \/bin\/false polkitd/d' \
                -e '/--with-authfw=shadow/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/--with-authfw=shadow/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    dhcpcd)
       GetCommands \
        | sed -e '/make install-service-dhcpcd/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    wpa_supplicant)
       GetCommands \
        | sed -e '/EDITMESSIDEDITME/d' \
              -e '/ip addr add/,/ip route add default/d' \
              -e '/wpa_supplicant -B/ i cat > /etc/rc.d/init.d/wireless_wlan0 << "EOF"' \
              -e '/dhcpcd/ a EOF' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    curl)
       GetCommands \
        | sed -e '/cp -v -R docs/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    liboauth)
       GetCommands \
        | sed -e '/cp -rv doc/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    samba)
       GetCommands \
        | sed -e '/\/etc\/openldap\/schema/,/ln -v -s ..\/..\/samba\/swat/d' \
              -e '/groupadd/,/make install-swat/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    dsktp-file-utls)
       GetCommands \
        | sed -e '/update-desktop-database/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    pinentry)
       GetCommands \
        | sed -e '/ make -k -C doc pdf ps html/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    which)
       GetCommands \
        | sed -e '/cat/,/chown/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    unzip)
       GetCommands \
        | sed -e '/This.block.must.be.edited/,/End.of.editable.block/d' \
        >> $Output
    ;;
    bluez)
       GetCommands \
        | sed -e '/make install-bluetooth/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    dbus)
       if ! $as_root; then
         GetCommands \
          | sed -e '/groupadd/,/-u 18 -g messagebus/d' \
                -e '/make distclean/,/kill \$DBUS_SESSION_BUS_PID/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/make distclean/,/make install-dbus/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    gpm)
       GetCommands \
        | sed -e '/chmod   -v   755    doc\/support/,/End \/etc\/sysconfig\/mouse/d' \
              -e '/EOF/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    udev)
       rtrnCom="" # need the version of udev used in the book commands
       getComms $pkgname
       udevXBookVers ${rtrnCom[0]}
       GetCommands \
        | sed -e "s/$udevXbookvers/$udevvers/" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    git)
       if ! $as_root; then
         GetCommands \
          | sed -e "/configure_commands()/ i sed -i \"/ifndef NO_GETTEXT/{ N; s/ifndef NO_GETTEXT\\\n\\\t\\\\\$(INSTALL) -d -m 755 '\\\\\$(DESTDIR_SQ)\\\\\$(localedir_SQ)'// }\" Makefile" \
                -e "/configure_commands()/ i sed -i '/(cd po\\\/build\\\/locale \\\&\\\&/,/endif/d' Makefile" \
                -e '/make man/,/make html/d' \
                -e '/make install-man/d' \
                -e '/tar -xf ..\/git-manpages/d' \
                -e '/git config/d' \
                -e 's/\(.*\)&&$/\1/' \
          | awk '{if ($1 == "make" && $2 =="install")
print "  "$1" "$2"\n  cd po/build\n  for code in locale/*\n  do\n   if [ ! -d /usr/share/${code}/LC_MESSAGES ]; then\n     install -v -d /usr/share/${code}/LC_MESSAGES\n   fi\n   cp ${code}/LC_MESSAGES/git.mo /usr/share/${code}/LC_MESSAGES/\n  done\n  cd ../..";
else
print $0
}' \
        >> $Output
       else
         GetCommands \
          | sed -e '/make man/,/make html/d' \
                -e '/make install-man/d' \
                -e 's/\(.*\)&&$/\1/' \
        >> $Output
       fi
    ;;
    guile)
       GetCommands \
        | sed -e '/make html/,/unset DIRNAME/d' \
              -e '/find examples -name/,/cp -v -R doc\/ref\/guile.htm/d' \
              -e '/for DIRNAME/,/done/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    openjdk)
       GetOpenJDKCommands >> $Output
    ;;
    junit)
       GetCommands \
        | sed -e '/chown -R root:root/d' \
              -e 's/java/\/opt\/OpenJDK\/bin\/java/' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    php)
       rtrnCom="" # need the version of php used in the book commands
       getComms $pkgname
       numcomms=${#rtrnCom[@]}
       phpXBookVers ${rtrnCom[numcomms-10]}
       GetCommands \
        | sed -e '/install -v -m644 p/ a   install -v -m755 -d \/usr\/share\/doc\/php-'"${phpvers}"'\n  install -v -m644 ..\/php_manual_en.html.gz \/usr\/share\/doc\/php-'"${phpvers}"'' \
              -e '/tar -xvf/,/-C \/usr\/share\/doc\/php-'"${phpvers}"' --no-same-owner/d' \
              -e "s/$phpXbookvers/$phpvers/" \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    $xproto|$xapp|$xfont)
        GetXCommands \
        | sed -e 's/bash -e/set -e/' \
              -e '/for package in/ i cd $cursec' \
              -e 's/as_root make install/make install/' \
              -e '/exit/d' \
              -e 's/\(.*\)&&$/\1/' \
       >> $Output
    ;;
    $xlib)
        GetXCommands \
        | sed -e 's/bash -e/set -e/' \
              -e '/for package in/ i cd $cursec' \
              -e 's/as_root make install/make install/' \
              -e '/as_root \/sbin\/ldconfig/d' \
              -e '/exit/d' \
              -e '/ln -sv \$XORG_PREFIX/d' \
              -e 's/\(.*\)&&$/\1/' \
       >> $Output
    ;;
    xorg-server)
        GetCommands \
         | sed -e '/--enable-install-setuid/d' \
               -e 's/xkb \\/xkb/' \
               -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    xterm)
        GetCommands \
         | sed -e '/make install-ti/d' \
               -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    mesalib)
         GetCommands \
          | sed -e '/\.\/configure --prefix=\/usr --disable-static/i cd \.\.\/glu*' \
                -e 's/\(.*\)&&$/\1/' \
         >> $Output
    ;;
    db)
       if ! $as_root; then
         GetCommands \
          | sed -e 's/root:root/db:db/' \
              -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    sqlite)
       GetCommands \
        | sed -e '/unzip/d' \
              -e '/cp -v -R sqlite-doc/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    apache)
       if ! $as_root; then
         GetCommands \
          | sed -e '/groupadd/,/-s \/bin\/false/d' \
                -e '/chown -v root:root/,/index.html/d' \
                -e '/index.html/d' \
                -e '/make install-httpd/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/make install-httpd/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    mysql)
       if ! $as_root; then
         GetCommands \
          | sed -e '/groupadd/,/useradd/d' \
                -e '/SEGMENTS="Client ManPages SharedLibraries"/,/unset SEGMENTS/d' \
                -e '/mysql_install_db/,/make install-mysql/d' \
                -e "/sed -i/ a install -v -m0755 -d \/usr\/share\/doc\/mysql-${mysqlvers}\ninstall -v -m644 ..\/..\/refman-5.5-en.html.tar.gz \/usr\/share\/doc\/mysql-${mysqlvers}\ntar xvf \/usr\/share\/doc\/mysql-${mysqlvers}\/refman-5.5-en.html.tar.gz" \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/SEGMENTS="Client ManPages SharedLibraries"/,/unset SEGMENTS/d' \
                -e '/mysql_install_db/,/make install-mysql/d' \
                -e "/sed -i/ a install -v -m0755 -d \/usr\/share\/doc\/mysql-${mysqlvers}\ninstall -v -m644 ..\/..\/refman-5.5-en.html.tar.gz \/usr\/share\/doc\/mysql-${mysqlvers}\ntar xvf \/usr\/share\/doc\/mysql-${mysqlvers}\/refman-5.5-en.html.tar.gz" \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    alsa-lib)
       GetCommands \
        | sed -e '/make doc/,/install -m644 src\/.libs\/libasound.a/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    alsa-utils)
       GetCommands \
        | sed -e '/make install-alsa/d' \
              -e '/touch \/var\/lib\/alsa\/asound.state/,/usermod/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    esound)
       GetCommands \
        | sed -e '/chown -v root:root \/usr\/share\/doc\/esound-0.2.41/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    faac)
       GetCommands \
        | sed -e '/Front_Left/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    faad2)
       GetCommands \
        | sed -e '/sample.wav/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    sdl)
       GetCommands \
        | sed -e '/cd test/,/make/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    x264)
       Getx264Commands >> $Output
    ;;
    ffmpeg)
       GetCommands \
        | sed -e '/export LIBRARY_PATH/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    ffmpegthumnaler)
       GetffmpegthumCommands >> $Output
    ;;
    libtheora)
       GetCommands \
        | sed -e '/cd examples/,/install/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libcdio)
       GetLibcdioCommands >> $Output
    ;;
    libdvdcss)
       GetCommands \
        | sed -e '/doxygen.cfg/d' \
              -e '/make -C doc\/latex pdf/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libcanberra)
       if [ "$GNOME_OR_XFCE" = xfce ]; then
         GetCommands \
          | sed -e 's/oss/oss --disable-schemas-install/' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    pulseaudio)
       GetCommands \
        | sed -e '/groupadd/,/usermod -a -G/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    nss)
       GetCommands \
        | sed -e '/cd ..\/..\/dist/d' \
              -e '/install -v -m755 Linux\*\/lib/ i cd ..\/..\/dist' \
              -e '/cp -v -RL/ i cd ..\/..\/dist' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    cyrus-sasl)
       GetCommands \
        | sed -e '/make install-saslauthd/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    docbook-xml)
       GetCommands \
        | sed -e '/chown -R root:root/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    docbook-xsl)
       GetCommands \
        | sed -e '/tar -xf/d' \
              -e '/install -v -m644 -D README/ i install -v -d \/usr\/share\/doc\/docbook-xsl-1.77.1' \
              -e '/cp -v -R doc/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    ghostscript)
       GetCommands \
        | sed -e 's/LIBS=-lz/LIBS=-lz --with-install-cups/' \
              -e '/bin\/gs/d' \
              -e '/tar -xvf/ i for (( i=0; i<\${#fontfile[@]}; i++ )); do' \
              -e 's/\*\*EDITME<font-tarball>EDITME\*\*/\${fontfile[\$i]}/' \
              -e '/tar -xvf/ a done' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gutenprint)
       GetCommands \
        | sed -e '/\/etc\/rc.d\/init.d\/cups restart/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gtkplus3)
       GetCommands \
        | sed -e '/rm tests/d' \
              -e '/cat/,/End root commands/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gtkplus2)
       GetCommands \
        | sed -e '/gdk-pixbuf-query-loaders/,/gtk-query-immodules-2.0/d' \
              -e '/cat/,/End root commands/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    webkitgtk)
       if [ "$GNOME_OR_XFCE" = xfce ]; then
         GetCommands \
          | sed -e 's/--with-gstreamer=1.0/--with-gstreamer=0.10/' \
                -e 's/introspection/introspection --disable-geolocation --enable-gtk=2.0 --disable-webkit2/' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    qt4)
       GetCommands \
        | sed -e '/ldconfig/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    networkmanager)
       GetCommands \
        | sed -e "/--disable-ppp/ a     sed -i 's/-Werror//' src/ppp-manager/Makefile" \
              -e '/make install-networkmanager/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    avahi)
       if ! $as_root; then
         GetCommands \
          | sed -e '/groupadd/,/groupadd/d' \
              -e '/--disable-qt4        \\/d' \
              -e '/make install-avahi/d' \
              -e 's/\(.*\)&&$/\1/' \
          >> $Output
        else
         GetCommands \
          | sed -e '/--disable-qt4        \\/d' \
                -e '/make install-avahi/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
        fi
    ;;
    libgda)
       GetCommands \
        | sed -e '/--enable-system-sqlite/ i --with-java=no \\' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libsoup)
       if [ "$GNOME_OR_XFCE" = xfce ]; then
         GetCommands \
          | sed -e 's/disable-static/disable-static --without-gnome/' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    librest)
       if [ "$GNOME_OR_XFCE" = xfce ]; then
         GetCommands \
          | sed -e 's/prefix=\/usr/prefix=\/usr --without-gnome/' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    libgdata)
       if [ "$GNOME_OR_XFCE" = xfce ]; then
         GetCommands \
          | sed -e 's/disable-static/disable-static --disable-gnome/' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    bind)
       if ! $as_root; then
         GetCommands \
          | sed -e '/patch -Np1 -i/d' \
                -e '\/bin\/tests\/system\/ifconfig.sh/,/grep/d' \
                -e '/cd doc/,/useradd/d' \
                -e '/mknod/,/chmod/d' \
                -e 's/rndc-confgen/\/usr\/sbin\/rndc-confgen/' \
                -e '/cp \/etc\/resolv.conf/,/dig www/d' \
                -e '/dig www.linuxfromscratch.org/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/patch -Np1 -i/d' \
                -e '\/bin\/tests\/system\/ifconfig.sh/,/grep/d' \
                -e '/cp \/etc\/resolv.conf/,/dig www.linuxfromscratch.org/d' \
                -e '/dig www.linuxfromscratch.org/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    gnome-games)
       if ! $as_root; then
         GetCommands \
          | sed -e '/install -v/,/chown/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    evolution)
       GetCommands \
        | sed -e 's/disable-contact-maps/with-clutter/' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    gdm)
       if ! $as_root; then
         GetCommands \
          | sed -e '/groupadd/,/usermod -a -G video/d' \
                -e '/make install-gdm/,/\/etc\/inittab/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       else
         GetCommands \
          | sed -e '/make install-gdm/d' \
                -e 's/\(.*\)&&$/\1/' \
          >> $Output
       fi
    ;;
    gimp)
       GetCommands \
        | sed -e 's/ --without-gvfs//' \
              -e '/ALL_LINGUAS/,/chown -R/d' \
              -e 's[\*\*EDITME<browser>EDITME\*\*['$BROWSER'[' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    xfce4-session)
       GetCommands \
        | sed -e '/.xinitrc/d' \
              -e '/\*\*EDITMEUSERNAMEEDITME\*\*/,/sudoers/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    firefox)
       GetCommands \
        | sed -e '/Yasm/,/disable-libnotify/d' \
              -e 's/\# ac_add_options --enable-startup-notification/ac_add_options --enable-startup-notification/' \
              -e 's/\# ac_add_options --enable-system-sqlite/ac_add_options --enable-system-sqlite/' \
              -e 's/\# ac_add_options --with-system-libvpx/ac_add_options --with-system-libvpx/' \
              -e 's/\# ac_add_options --with-system-nspr/ac_add_options --with-system-nspr/' \
              -e 's/\# ac_add_options --with-system-nss/ac_add_options --with-system-nss/' \
              -e '/chown -R -v root:root \/usr\/lib\/firefox-'"$ffoxvers"'/,/cp -v dom\/plugins\/base/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    seamonkey)
       GetCommands \
        | sed -e '/Yasm/,/disable-libnotify/d' \
              -e 's/\# ac_add_options --enable-startup-notification/ac_add_options --enable-startup-notification/' \
              -e 's/\# ac_add_options --enable-system-sqlite/ac_add_options --enable-system-sqlite/' \
              -e 's/\# ac_add_options --with-system-libvpx/ac_add_options --with-system-libvpx/' \
              -e 's/\# ac_add_options --with-system-nspr/ac_add_options --with-system-nspr/' \
              -e 's/\# ac_add_options --with-system-nss/ac_add_options --with-system-nss/' \
              -e '/make -C moz-build-dir install/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    llvm)
       GetCommands \
        | sed -e '/--enable-optimized/ i  --disable-docs \\' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    libreoffice)
       GetCommands \
        | sed -e '/tar -xf libreoffice/,/cd libreoffice/d' \
              -e 's/\(.*\)&&$/\1/' \
        >> $Output
    ;;
    *)
        GetCommands \
        | sed -e 's/\(.*\)&&$/\1/' \
        >> $Output
        return_val=$?
        if [ $return_val -eq $RETURN_PARAM ]; then # no build file
          echo "No build file available in ${LFS}${srcrootdir}/pkguser"
          echo "Please place the build file there"
          exit 1
        fi
    ;;
esac
} # end WriteScript
#
cleanstart () {
for Script in ${Section}.sh
do
  for loc in $LFS ~/
  do
    if [ -e $loc/$Script ]; then rm $loc/$Script;fi
  done
done
} #end cleanstart
#
PkgDepend () {
cat >> $Output << "EOF"
PkgDepend () {
declare -a ndep
declare -a tdep
foundDep=false
dpName=${FuncName}dep # package dependencies
depfile=${blfsfiles}/${Section}-dependencies
if [ ! -e $depfile ]; then
 return $RETURN_PARAM
else
  while read depline
  do
    case $depline in
      $dpName*)
        foundDep=true
        ic=0
        ndep=""
        tdep=""
        stordep=""
        ndeps=($depline)
        for (( i=1; i<${#ndeps[@]}-1; i++ ))
        do
          tdep[ic++]=${ndeps[i]}
        done
      ;;
    esac
  done < $depfile
  if ! $foundDep; then # no deps found for this package
    return $RETURN_NOTSET
  else
    DepRtrn=(${tdep[@]})
    return 0
  fi
fi
} # end PkgDepend
EOF
} # end PkgDepend
#
testDeps () {
cat >> $Output << "EOF"
testDeps () {
declare -a tstDeps=("${!1}")
declare -a stordep
countdep=0
for (( k=0; k<${#tstDeps[@]}; k++ ))
do
  pfile=$(echo ${tstDeps[k]} | awk 'BEGIN {FS="/"}{print $2}')
  testfile=${PKGUSERDIR}/${tstDeps[k]}/.$pfile
  if [ ! -f $testfile ]; then stordep[countdep++]=${tstDeps[k]}; fi
done
if [ $countdep -gt 0 ]; then # some dependencies not met
  rtrnDepNotMet=(${stordep[@]})
  return $RETURN_DEPNOTMET
else
  return $RETURN_ALLDEPSMET # all dependencies met
fi
} # end testDeps
EOF
} # end testDeps
#
numcharInstall () { # get the number of chars in the install group
cat >> $Output << "EOF"
numcharInstall () {
group="/etc/group"
grpname=$1
while read line
do
case $line in
   $grpname*)
         numchars=$( printf $line | wc -c ) # should be <= 2048
         return 0
   ;;
esac
done < $group
} # end numcharInstall
EOF
} # end numcharInstall
#
setMime () {
cat >> $Output << "EOF"
setMime () {
# sets everything under /usr/share/mime to owner $1
onr=$1
chown -R $onr:$onr /usr/share/mime/{a*,g*,i*,m*,p*,s*,t*,v*,x*,X*}
} # end setMime
EOF
} # end setMime
#
SetXorgVars () {
mkdir -p ${LFS}/etc/profile.d
if [ ! -e ${LFS}/etc/profile.d/xorg.sh ]; then
  xorgsh="${LFS}/etc/profile.d/xorg.sh"
  echo "XORG_PREFIX=$XORG_PREFIX" >> $xorgsh
  cat >> $xorgsh << "EOF"
XORG_CONFIG="--prefix=$XORG_PREFIX \
             --sysconfdir=/etc \
             --mandir=$XORG_PREFIX/share/man \
             --localstatedir=/var"
export XORG_PREFIX XORG_CONFIG
EOF
  chmod 644 $xorgsh
  if [ "$XORG_PREFIX" != "/usr" ]; then
    cat >> $xorgsh << "EOF"
pathappend $XORG_PREFIX/bin PATH
pathappend $XORG_PREFIX/lib/pkgconfig PKG_CONFIG_PATH
pathappend $XORG_PREFIX/share/pkgconfig PKG_CONFIG_PATH
export PATH PKG_CONFIG_PATH
EOF
    echo "${XORG_PREFIX}/lib" >> ${LFS}/etc/ld.so.conf
    sed 's@/usr/X11R6@<PREFIX>@g' -i ${LFS}/etc/man_db.conf
    case $(uname -m) in
        x86_64)
             install -v -m755 -d ${LFS}$XORG_PREFIX
             install -v -m755 -d ${LFS}$XORG_PREFIX/lib
             ln -s lib ${LFS}$XORG_PREFIX/lib64
        ;;
    esac
  fi
fi
} # end SetXorgVars
#
altFileNames () {
IFS=' '
declare -a pkgnm=""
declare -a srcnm=""
declare -a cmdnm=""
secFiles=${BLFSBUILDFILES}/${1}-files
if [ ! -e $secFiles ]; then
  return $RETURN_PARAM
else
  ic=0
  while read n1 n2 n3 n4
  do
    pkgnm[ic++]=$n2
    srcnm[ic++]=$n3
    cmdnm[ic++]=${n4%??} # strip last 2 chars
  done < $secFiles
fi
rtrnPkg=(${pkgnm[@]})
rtrnSrc=(${srcnm[@]})
rtrnCmd=(${cmdnm[@]})
return 0
} # end altFileNames
#
pkgInSection () {
pkgToTest=$1
InSection=$2
pkgFiles=${BLFSBUILDFILES}/${InSection}-files
if [ ! -e $pkgFiles ]; then # try and get the section-files
  GetBLFSfiles
  return_val=$?
  if [ $return_val -eq $RETURN_PARAM ]; then
    echo "The file $blfsfilesTar should be in $LFS"
    echo "Please place it there in order to continue"
    echo "Exiting now"
    exit 1
  fi  
fi
#test if the section-files exists
if [ ! -e $pkgFiles ]; then
  echo "Couldn't find $pkgFiles"
  if [ "$InSection" = all ]; then
    echo "You've requested ALL sections"
    echo "You must specify the section that contains $pkgToTest and"
  fi
  echo "make sure it's in $BLFSBUILDFILES"
  exit 1
fi
while read aline
do
pkg_is=$(echo $aline | awk -F= '{print $1}')
  case $pkg_is in
     $pkgToTest)
          return 0
     ;;
  esac
done < $pkgFiles
return $RETURN_PARAM
} # end pkgInSection
#
delElement () { # deletes an element from a specified position in an array
cat >> $Output << "EOF"
delElement () {
# array input in $1, position to delete is $2
declare -a arrayIn=("${!1}")
pos=$2
arrayIn=(${arrayIn[@]:0:$pos} ${arrayIn[@]:$(($pos + 1))})
rtrDelArray=(${arrayIn[@]})
} # end delElement
EOF
} # end delElement
#
delElementPattern () { # deletes an array element that matches a pattern
cat >> $Output << "EOF"
delElementPattern () {
# array input in $1, pattern to delete is $2
declare -a arrayInput=("${!1}")
patToMatch=$2
declare -a delPatArray=( ${arrayInput[@]/$patToMatch*/} )
rtrPlessArray=(${delPatArray[@]})
} # end delElementPattern
EOF
} # end delElementPattern
#
min2 () { # return min of two integers
if [ -z "$2" ]
then
  return $RETURN_PARAM
fi

if [ "$1" -eq "$2" ]
then
  return $1
else
  if [ "$1" -lt "$2" ]
  then
    return $1
  else
    return $2
  fi
fi
} # end min2
#
# Return the value of an operation e.g addition: z=$(float_val "$x + $y")
float_val () {
     echo | awk 'END { print '"$1"'; }'
}
#
# Return status code of a comparison e.g. float_test "$x > $y" && num=$x
# or float_test "$x < $y" && num=$y to find greater of two floating point numbers
float_test () {
echo "float_test () {
     echo | awk 'END { exit ( !( '\"\$1\"')); }'
}" >> $Output
}
#
Start () {
declare -a PkgName=("${!2}")
declare -a SrcName=("${!3}")
declare -a CommandName=("${!4}")
Section=$1
secFiles=${BLFSBUILDFILES}/${Section}-files
cursection=$Section
if ! $single_package; then
  cleanstart
  Output=${LFS}/${Section}.sh
else
  if [ -e ${LFS}/${SINGLE_PACKAGE}.sh ]; then rm ${LFS}/${SINGLE_PACKAGE}.sh; fi
  Output=${LFS}/${SINGLE_PACKAGE}.sh
fi
Getxmlsec $Section
if [[ "$Section" == x ]]; then SetXorgVars; fi
REPODIR=${BLFS_BOOK_LOC_DIR}/$version
Header
if ! $as_root; then
  pkguser # need it if installing as a package user
  numcharInstall
fi
if [ "$Section" != blfs ]; then
  PkgDepend
  testDeps
fi
if [[ "$Section" = networks || "$Section" = sysutils || "$Section" = xlibs || "$Section" = multimedia ]]; then
  delElementPattern
fi
if [[ "$Section" == gnomeplatform || "$Section" == gnomedesktop || "$Section" == gnomeutils ]]; then
  setMime
fi
numpkgs=${#PkgName[@]}
for (( pkgn=0; pkgn<$numpkgs; pkgn++ ))
do
  if $single_package; then # find the package
    if [[ "$SINGLE_PACKAGE" == "${PkgName[$pkgn]}" ]]; then # found the package
      pkgname=${PkgName[pkgn]}
      FuncName=$( echo $pkgname | sed -e s/-//g -e s/_//g )
      srcname=${SrcName[pkgn]}
      commandname=${CommandName[pkgn]}
      if [[ "$cursection" != "$Section" ]]; then # section changed - reset
        cursection=$Section
        if ! $as_root; then pkguser; fi
      fi
      Output=$LFS/${SINGLE_PACKAGE}.sh
      case $pkgname in
        coreutils|shadow) # these are core LFS
           cursection=core
           if ! $as_root; then updatePkgUser; fi
           Function
        ;;
        udev) # change commandname to udev-extras and srcname to systemd-
           cursection=core
           commandname=udev-extras
           srcname=systemd-
           if ! $as_root; then updatePkgUser; fi
           Function
        ;;
        *)
           Function
        ;;
      esac
      break
    fi
  elif [[ "$Section" = browser ]]; then
    if [[ "$BROWSER" == "${PkgName[$pkgn]}" ]]; then
      pkgname=${PkgName[pkgn]}
      FuncName=$( echo $pkgname | sed -e s/-//g -e s/_//g )
      srcname=${SrcName[pkgn]}
      commandname=${CommandName[pkgn]}
      Output=$LFS/${Section}.sh
      Function
      break
    fi
  else
    pkgname=${PkgName[pkgn]}
    FuncName=$( echo $pkgname | sed -e s/-//g -e s/_//g )
    srcname=${SrcName[pkgn]}
    commandname=${CommandName[pkgn]}
    if [[ "$cursection" != "$Section" ]]; then # section changed - reset
      cursection=$Section
      if ! $as_root; then pkguser; fi
    fi
    Output=$LFS/${Section}.sh
    case $pkgname in
       coreutils|shadow)
          cursection=core
          if ! $as_root; then updatePkgUser; fi
          Function
       ;;
       udev) # change command name to udev-extras
          cursection=core
          commandname=udev-extras
          srcname=systemd-
          if ! $as_root; then updatePkgUser; fi
          Function
       ;;
       *)
          Function
       ;;
    esac
  fi
done
#
awk '/_\ \(\)\ \{/ {print $1}' $Output >> $Output
chmod 700 $Output
if $single_package; then
  fpkgnme=${LFS}/${SINGLE_PACKAGE}.sh
else
  fpkgnme=${LFS}/${Section}.sh
fi
sed -e 's@BuildLog='$LFS'@BuildLog=@' -i $fpkgnme
# remove any test statements
sed -e '/make check/d' \
    -e '/make -j1 check/d' \
    -e '/make -j1 test/d' \
    -e '/make -k check/d' \
    -e '/make -kj1 check/d' \
    -e '/make test/d' \
    -i $fpkgnme
} # end Start
#
GetPkgVersion () {
# $1 is the location of the src package
# $2 is the name of the package
# $3 is the name to trim against - usually tar
local pkgloc=$1
local pkgnm=$2
local trim=$3
local fnd
local fileExt
local pkgvers=""
fnd=$( ls -l $pkgloc | grep ${pkgnm}-[0-9].*.tar.*z* | awk '{print $NF}' )
fileExt="${fnd#*-}"
pkgvers="${fileExt%.${trim}*}"
rtrvers=($pkgvers)
} # end GetPkgVersion
#
udevXBookVers () {
# $1 the command to parse for the version #
fileis=$(echo $1 | awk -F\/ '{print $2}')
fExt="${fileis#*lfs-}"
udevXbookvers="${fExt%.tar*}"
} # end udevXBookVers
#
phpXBookVers () {
# $1 the command to parse for the version #
fileis=$(echo $1 | awk -F\/ '{print $5}')
phpXbookvers="${fileis#php-}"
} # end phpXBookVers
#
evolutionVersion () {
echo "evolutionVersion () {
baseval=0.0 # assume version # will be > 0
evoldir="/usr/lib/evolution"
for evers in \${evoldir}/*; do # loop through all files in the directory
evoltest=\$( echo \$evers | awk -F\/ '{print \$NF}' )
if [[ \"\$evoltest\" =~ ^[0-9]+([.][0-9]+)?$ ]]; then # a number so test its value
  float_test \"\$evoltest > \$baseval\" && evolVers=\$evoltest
  baseval=\$evolVers
fi
done
}" >> $Output
} # end evolutionVersion
#
# ***main program***  - call the functions
#
configEdit # option to change the config file
retval=$?
if [ $retval -eq $RETURN_PARAM ]; then
 echo "Cancel pressed. Exiting now"
 exit 1
fi
source $cfg # make sure config file values are current
SECTION=$(echo ${SECTION,,*}) # convert SECTION to lower case
SOURCES=$(echo ${SOURCES,,*}) # convert SOURCES to lower case
xversion=$XVERSION # set up the x version
as_root=false
if [ "$AS_ROOT" = yes ]; then as_root=true; fi
#
if [[ "$SINGLE_PACKAGE" == no ]]; then
  single_package=false
else
  single_package=true
  pkgInSection $SINGLE_PACKAGE $SECTION
  retv=$?
  if [ $retv -eq $RETURN_PARAM ]; then
    echo "Package $SINGLE_PACKAGE not found in section $SECTION"
    echo "exiting now"
    exit 1
  else
    echo "Package $SINGLE_PACKAGE found in section $SECTION"
    echo "Will produce a script called $SINGLE_PACKAGE.sh for this single package"
  fi
fi
if [ $BOOK = "svn" ]; then
  GetSvnUrl # make sure the svn url is set
  if [ $BOOK_VERSION != "blank" ]; then #check if the requested book is present locally
    ChkLocalBook
    SetBLFSBook
  else #version set to blank so ask for which book
    WhichBLFSBook # choose which BLFS version to download the xml files
    # check if the requested book is already present locally
    ChkLocalBook
  fi
  CleanLocalREPO # delete any files in local book repository
  CheckoutSVN  # svn the requested book xml files
else  # local book requested. Make sure it exists
  if [ "$BOOK_VERSION" = "blank" ]; then # need to choose book version
    GetLocalREPO
    return_val=$?
    if [ $return_val -eq $RETURN_PARAM ]; then #no local book found
      echo "You did not choose a local $REPO book"
      echo "Change the local dir of the book or svn it. Exiting now"
      exit 1
    else # config file would have changed so source it
      source $cfg
      LocalBook
    fi
  else
    ChkLocalBookExists
    return_val=$?
    if [ $return_val -eq $RETURN_PARAM ]; then #no local book found
      echo "The requested book was not found at $BLFS_BOOK_LOC_DIR."
      echo "Change the local dir of the book or svn it. Exiting now"
      exit 1
    else
      LocalBook  # set values for locally stored book xml
      echo "Local book found for $BOOK_VERSION at $BLFS_BOOK_LOC_DIR"
    fi
  fi
fi
DumpCommands $REPO # get the commands from the book
if ! $single_package; then
  GetBLFSfiles # files define pkg names and dependencies
  return_val=$?
  if [ $return_val -eq $RETURN_PARAM ]; then
    echo "The file $blfsfilesTar should be in $LFS"
    echo "Please place it there in order to continue"
    echo "Exiting now"
    exit 1
  fi
fi
SetupSections # create the array SectionsAll. Contains the sections to build
for (( ij=0; ij<$numSections; ij++ )); do # loop through each section to get the sources
  Section=${SectionsALL[$ij]}
  skipSection=false
  if [ "$GNOME_OR_XFCE" = gnome ]; then # skip section xfce
    if [ "$Section" = xfce ]; then skipSection=true; fi
  else # requested xfce so skip all the gnome sections
    if [[ "$Section" == gnomeplatform || "$Section" == gnomedesktop || "$Section" == gnomeutils ]]; then
    skipSection=true
    fi
  fi
  if $skipSection; then
    :
  else # build the section
    rtrnPkg=""
    rtrnSrc=""
    rtrnCmd=""
    altFileNames $Section # get pkg name, src name and command name for each package in this section
    return_val=$?
    if [ $return_val -eq $RETURN_PARAM ]; then
      echo "no ${Section}-files  file found. It should be in $BLFSBUILDFILES"
      echo "Place it there in order to continue. Exiting now"
      exit 1
    fi
    if [[ "$SOURCES" = download || "$SOURCES" = downloads ]]; then # download the sources for this section
      CleanSourceDir $Section # clean the sources file if not empty
      if [ "$Section" = x ]; then # delete the x subdirs
        rm -rf ${SOURCEDIR}/${Section}/${xproto}
        rm -rf ${SOURCEDIR}/${Section}/${xlib}
        rm -rf ${SOURCEDIR}/${Section}/${xapp}
        rm -rf ${SOURCEDIR}/${Section}/${xfont}
      fi
      GetListFile #get wget-list
      GetSources $Section rtrnSrc[@] # download the sources in the wget-list file
    fi
# check all requested src files are present
    if [[ "$Section" != browser ]]; then
      if [ -e ${SOURCEDIR}/${Section}/${WgetList} ]; then
        ChkSrcPresent ${SOURCEDIR}/${Section} ${SOURCEDIR}/${Section}/${WgetList}
      else
         echo "No wget-list file in ${SOURCEDIR}/${Section}"
         echo "Cannot check presence of source files"
      fi
      ret_val=$?
      if [ $ret_val -eq $RETURN_PARAM ]; then 
        echo "not all requested files in ${SOURCEDIR}/${Section}/${WgetList} have been downloaded"
        echo "You will have to download them yourself and place in ${SOURCEDIR}/${Section}"
        echo "Do you want to continue? (Y/n)"
        read reply
        case $reply in
           [yY]|[yY][Ee][Ss])
                echo "okay continuing"
           ;;  
           [nN]|[nN][Oo])
                echo "Exiting now"
                exit 1
           ;;  
           *)  
                echo "okay continuing"
           ;;  
        esac
      fi
    else # check the browser source exists
      ChkSrcPresent ${SOURCEDIR}/${Section} ${SOURCEDIR}/${Section}/${sortedfile}
      if [ "$?" -eq $RETURN_PARAM ]; then exit 1; fi
    fi
    ChkEmptySrcFiles $Section #check for empty source files
    return_val=$?
    if [ $return_val -eq $RETURN_PARAM ]; then
      echo "Dir ${LFS}${srcrootdir}/${Section} is empty or has empty files"
      echo "You will have to download the required sources to this dir."
      echo "Continuing to make the scripts for section $Section"
    fi
    if [ "$Section" = browser ]; then
      if [ "$BROWSER" = firefox ]; then
        if [ -z $ffoxvers ]; then # null, so fill
          firefoxloc="${LFS}${srcrootdir}/browser"
          if [ -d $firefoxloc ]; then
            : # okay, so continue
          else
            firefoxloc="${LFS}${PKGUSERDIR}/browser/firefox"
            if [ -d $firefoxloc ]; then
              : # okay, so continue
            else
              echo "Requested Firefox version but cannot find source location"
              echo "Modify this code to include proper source location"
              echo "Exiting now"
              exit 1
            fi           
          fi
          rtrvers=""
          GetPkgVersion $firefoxloc firefox source
          ffoxvers=$rtrvers
          echo "Firefox version is $ffoxvers"
        fi
      fi
    fi
    if ! $single_package; then
      case $Section in
        sysutils)
          rtrvers=""
          GetPkgVersion ${LFS}${PKGUSERDIR}/core/udev systemd tar # for udev version
          udevvers=$rtrvers
          echo "udev version is $udevvers"
        ;;
        libraries)
          rtrvers=""
          GetPkgVersion ${LFS}${PKGUSERDIR}/core/perl perl tar
          perlvers=$rtrvers
          echo "perl version is $perlvers"
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/libraries freetype tar
          freetypevers=$rtrvers
          echo "freetype version is $freetypevers"
        ;;
        programming)
          rtrvers=""
          GetPkgVersion ${LFS}${PKGUSERDIR}/core/perl perl tar
          perlvers=$rtrvers
          echo "perl version is $perlvers"
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming php tar
          phpvers=$rtrvers
          echo "php version is $phpvers"
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming Python tar
          Pythonvers=$rtrvers
          echo "Python version is $Pythonvers"
        ;;
        server)
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/server mysql tar
          mysqlvers=$rtrvers
          echo "mysql version is $mysqlvers"
      ;;
      esac
    else
      case $SINGLE_PACKAGE in
        udev)
          rtrvers=""
          GetPkgVersion ${LFS}${PKGUSERDIR}/core/udev systemd tar
          udevvers=$rtrvers
          echo "udev version is $udevvers"
        ;;
        freetype)
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/libraries freetype tar
          freetypevers=$rtrvers
          echo "freetype version is $freetypevers"
        ;;
        php)
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming php tar
          phpvers=$rtrvers
          echo "php version is $phpvers"
        ;;
        python)
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/programming Python tar
          Pythonvers=$rtrvers
          echo "Python version is $Pythonvers"
        ;;
      mysql)
          rtrvers=""
          GetPkgVersion ${LFS}${srcrootdir}/server mysql tar
          mysqlvers=$rtrvers
          echo "mysql version is $mysqlvers"
      ;;
      esac
    fi
    Start $Section rtrnPkg[@] rtrnSrc[@] rtrnCmd[@] # build the script for this section
  fi
done
